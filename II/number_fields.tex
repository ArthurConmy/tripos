\documentclass[a4paper]{article}

\def\npart{II}

\def\ntitle{Number Fields}
\def\nlecturer{J.\ Thorne}

\def\nterm{Lent}
\def\nyear{2018}

\input{header}

\renewcommand*{\O}{\mathcal{O}}
\DeclareMathOperator{\n}{N}
\DeclareMathOperator{\disc}{disc}
\DeclareMathOperator{\Cl}{Cl}%ideal class group
\newcommand*{\red}[1]{\overline{#1}}%reduction mod
\DeclareMathOperator{\vol}{vol}

\makeindex

\begin{document}

\input{titlepage}

\tableofcontents

\setcounter{section}{-1}

\section{Motivation}

Recall the following example from IB Groups, Rings and Modules:

\begin{theorem}
  Let \(p\) be an odd prime, then \(p = a^2 + b^2\) if and only if \(p = 1 \pmod 4\).
\end{theorem}

\begin{proof}
  If \(p = a^2 + b^2\) then \(p = 0, 1 \text{ or } 2 \pmod 4\) so this condition is necessary.

  Suppose instead \(p = 1 \pmod 4\), then \(\binom{-1}{p} = 1\) so there exists \(a \in \Z\) such that \(a^2 = 1 \pmod p\), or \(p \divides a^2 + 1\). We can factor \(a^2 + 1 = (a + i)(a - i) \in \Z[i]\). We know from IB Groups, Rings and Modules that \(\Z[i]\) is a UFD. As \(p \divides (a + i)(a - i)\), if \(p\) is irreducible in \(\Z[i]\)  then \(p \divides a + i\) or \(p \divides a - i\). Thus \(p \in \Z[i]\) is reducible so \(p = z_1z_2\) with \(z_1z_2 \in \Z[i]\). If \(z_1 = A + Bi\) where \(A, B \in \Z\) then \(A^2 + B^2 = p\).
\end{proof}

\begin{notation}
  If \(R \subseteq S\) are rings and \(\alpha \in S\) then
  \[
    R[\alpha] = \left\{ \sum{i = 0}^n a_i\alpha^i \in s: a_i \in R \right\}
  \]
  which is the smallest subring of \(S\) containing both \(R\) and \(\alpha\).
\end{notation}

Another example is given \(p\) an odd prime, does the equation
\[
  x^p + y^p = z^p
\]
have solutions such that \(x, y, z \in \Z, xyz \neq 0\)?

\begin{theorem}[Kummer, 1850]
  If \(\Z[e^{2\pi i/p}]\) is a UFD then there are no solutions.
\end{theorem}

The strategy is to factor
\[
  x^p + y^p = \prod_{j = 0}^{p - 1} (x + e^{2\pi ij/p}y) \in \Z[e^{2\pi i/p}].
\]
We now know that \(\Z[e^{2\pi i/p}]\) is a UFD if and only if \(p \leq 19\), so unfortunately this does not lead us very far. Instead, we have the more powerful theorem

\begin{theorem}[Kummer, 1850]
  If \(p\) is a \emph{regular} prime then there are no solutions.
\end{theorem}

We will define regular prime later in this course. This theorem is more powerful that the previous one. To give an idea, if \(p < 100\) then \(p\) is regular if and only if \(p \neq 37, 59, 67\).

This course studies the ring of integers of a number field, which is a finite extension of \(\Q\). In the end of the course we will come back to Kummer's theorem.

\section{Ring of integers}

Recall that a field extension \(L/K\) is an inclusion \(K \subseteq L\) of fields. The degree of \(L/K\) is
\[
  [L:K] = \dim_K L.
\]
We say \(L/K\) is finite if \([L:K] < \infty\).

\begin{definition}[Number field]\index{number field}
  A \emph{number field} is a finite extension \(L/\Q\).
\end{definition}

Here are two ways to construct number fields:
\begin{enumerate}
\item Let \(\alpha \in \C\) be an algebraic number. Then \(L = \Q(\alpha)\) is a number field.
\item Let \(K\) be a number field \(K\) and \(f(x) \in K[x]\) be irreducible. Then \(L = K[x]/(f(x))\) is a number field. Recall Tower Law from IID Galois Theory:
  \[
    [L:\Q] = [L:K][K:\Q] < \infty.
  \]
\end{enumerate}
Note that the first one comes with an embedding in \(\C\), but the second one doesn't (and in general there are more than one).

\begin{definition}[Algebraic integer]\index{algebraic integer}\leavevmode
  \begin{enumerate}
  \item Let \(L/K\) be a field extension. We say \(\alpha \in L\) is \emph{algebraic} over \(K\) if there exists a monic polynomial \(f(x) \in K[x]\) such that \(f(\alpha) = 0\).
  \item Let \(L/\Q\) be a field extension. We say \(\alpha \in L\) is an \emph{algebraic integer} if there exists a monic polynomial \(f(x) \in \Z[x]\) such that \(f(\alpha) = 0\).
  \end{enumerate}
\end{definition}

\begin{definition}[Minimal polynomial]\index{minimal polynomial}
  Let \(L/K\) be a field extension and let \(\alpha \in L\) be an algebraic over \(K\). We call the \emph{minimal polynomial} of \(\alpha\) over \(K\) the monic polynomial \(f_\alpha(x) \in K[x]\) of the least degree such that \(f_\alpha(\alpha) = 0\).
\end{definition}

Note that \(f_\alpha(x)\) is well-defined: firstly there exists some monic \(f(x) \in K[x]\) such that \(f(\alpha) = 0\) since \(\alpha\) is algebraic. If \(f_\alpha(x), f_\alpha'(x) \in K[x]\) both satisfy the definition of minimal plynomial then we apply the polynomial division algorithm to write
\[
  f_\alpha(x) = q(x)f_\alpha'(x) + r(x)
\]
where \(p(x), r(x) \in K[x]\) and \(\deg r < \deg f_\alpha'\). Evaluate at \(\alpha\), we get
\[
  0 = f_\alpha(\alpha) = p(\alpha)f_\alpha'(\alpha) + r(\alpha) = r(\alpha)
\]
so by minimality of \(\deg f_\alpha'\), \(r = 0\). Then \(\deg f_\alpha = \deg f_\alpha'\) and they are both monic so \(p = 1\). \(f_\alpha = f_\alpha'\).

\begin{lemma}
  Let \(L/\Q\) be a field extension and let \(\alpha \in L\) to be an algebraic integer. Then
  \begin{enumerate}
  \item the minimal polynomial \(f_\alpha(x)\) of \(\alpha\) over \(\Q\) lies in \(\Z[x]\);
  \item if \(g(x) \in \Z[x]\) satisfies \(g(\alpha) = 0\) then there exists \(q(x) \in \Z[x]\) such that \(g(x) = f_\alpha(x)q(x)\);
  \item the kernel of the ring homomorphism
    \begin{align*}
      \Z[x] &\to L \\
      f(x) &\mapsto f(\alpha)
    \end{align*}
    equals to \((f_\alpha(x))\).
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Recall from IB Groups, Rings and Modules that given \(f(x) = \sum_{i = 0}^n a_ix^i \in \Z[x]\), we define the content to be
    \[
      c(f) = \gcd(a_n, \dots, a_0).
    \]
    Gauss' Lemma says that if \(f(x), g(x) \in \Z[x]\) then \(c(fg) = c(f)c(g)\).

    Since \(\alpha \in L\) is an algebraic integer, there exists a monic \(f(x) \in \Z[x]\) such that \(f(\alpha) = 0\). Thus \(c(f) = 1\). Apply polynomial division in \(\Q[x]\) to get
    \[
      f(x) = p(x)f_\alpha(x) + r(x)
    \]
    where \(p(x), r(x) \in \Q[x]\). Same as before, we must have \(r(x) = 0\) so \(f(x) = p(x)f_\alpha(x)\). Now choose integers \(n, m \geq 1\) such that \(np(x) \in \Z[x], c(np) = 1\) and \(mf_\alpha(x) \in \Z[x], c(mf_\alpha) = 1\). Then
    \[
      nmf(x) = np(x) \cdot mf_\alpha(x).
    \]
    Take contents,
    \[
      nm = c(nmf(x)) = c(np \cdot mf_\alpha) = c(np)c(mf_\alpha) = 1.
    \]
    Thus \(n = m = 1\) so \(f_\alpha(x) \in \Z[x]\).
  \item This is similar to the previous one. Let \(g(x) \in \Z[x]\) be such that \(g(\alpha) = 0\). wlog \(g(x) \neq 0\) and \(c(g) = 1\). We deduce \(g(x) = q(x)f_\alpha(x)\) where \(q(x) \in \Q[x]\). Choose \(k \geq 1\) such that \(kq(x) \in \Z[x]\) and \(c(kq) = 1\). Then
    \[
      k = c(kg) = c(kq \cdot f_\alpha) = c(kq) c(f_\alpha) = 1
    \]
    so \(q(x) \in \Z[x]\).
  \item Reformulation of (2).
  \end{enumerate}
\end{proof}

\begin{corollary}
  If \(a \in \Q\), then \(\alpha\) is an algebraic integer if and only if \(\alpha \in \Z\).
\end{corollary}

\begin{proof}
  By the above lemma, \(\alpha\) is an algebraic integer if and only if \(f_\alpha(x) \in \Z[x]\). If \(\alpha \in \Q\) then \(f_\alpha(x) = x - \alpha\).
\end{proof}

\begin{notation}
  If \(L/\Q\) is a field extension, we write
  \[
    \O_L = \{\alpha \in L: \alpha \text{ is an algebraic integer}\}.
  \]
\end{notation}

\begin{proposition}
  If \(L/\Q\) is a field extension, \(\O_L\) is a ring.
\end{proposition}

\begin{proof}
  \(0, 1 \in \O_L\). If \(\alpha \in \O_L\) then
  \[
    f_{-\alpha}(x) = (-1)^{\deg f_\alpha} f_\alpha(-x)
  \]
  so \(-\alpha \in \O_L\). Easy. Now given \(\alpha, \beta \in \O_L\), we need to show \(\alpha + \beta, \alpha\beta \in \O_L\). First notice the following characterisation of algebraic integers: if \(\alpha \in \O_L\) then \(\Z[\alpha] \subseteq L\) is a finitely generated \(\Z\)-module: by definition, \(\Z[\alpha]\) is generated by \(1, \alpha, \alpha^2, \dots\). Let
  \[
    f_\alpha(x) = x^d + a_1x^{d - 1} + \dots + a_d \in \Z[x],
  \]
  then
  \[
    \alpha^d = -(a_1\alpha^{d - 1} + \dots + a_d) \in \sum_{i = 0}^{d - 1} \Z \alpha^i.
  \]
  Thus by induction, \(\alpha^n \in \sum_{i = 0}^{d - 1}\Z \alpha^i\) for all \(n \geq d\).

  Now take \(\alpha, \beta \in \O_L\) and let \(d = \deg f_\alpha, e = \deg f_\beta\). By definition, \(\Z[\alpha, \beta] = \Z[\alpha][\beta]\) is generated as an \(\Z\)-module by \(\{\alpha^i\beta^j\}_{i, j \in \N_0}\). The same argument shows that in fact the ring is generated as a \(\Z\)-module by \(\{\alpha^i\beta^j\}_{0 \leq i < d, 0 \leq j < e}\). Now use classification of finitely generated \(\Z\)-modules, there is an isomorphism
  \[
    \Z[\alpha, \beta] \cong \Z^r \oplus T
  \]
  for some \(r \geq 1\) and finite abelian group \(T\). In fact \(T = 0\): if \(\gamma \in T\) then \(|T|\gamma = 0\) by Lagrange. But \(\Z[\alpha, \beta] \subseteq L\), a \(\Q\)-vector space, so this forces \(\gamma = 0\). We can therefore fix an isomorphism
  \[
    \Z[\alpha, \beta] \cong \Z^r
  \]
  for some \(r \geq 1\). Now there is a \(\Z\)-module endomorphism
  \begin{align}
    m_{\alpha\beta}: \Z[\alpha, \beta] &\to \Z[\alpha, \beta] \\
    \gamma &\mapsto \alpha\beta\gamma
  \end{align}
  \(m_{\alpha\beta}\) can be represented by an \(r \times r\) matrix \(A_{\alpha\beta} \in \matrixring_{r \times r}(\Z)\). Let
  \[
    F_{\alpha\beta}(x) = \det(x \cdot I_r - A_{\alpha\beta}) \in \Z[x]
  \]
  be the characteristic polynomial. Then by Cayley-Hamilton Theorem,
  \[
    F_{\alpha\beta}(m_{\alpha\beta}) = 0.
  \]
  Write
  \[
    F_{\alpha\beta}(x) = x^r + b_1x^{r - 1} + \dots + b_r \in \Z[x]
  \]
  so
  \[
    m_{\alpha\beta}^r + b_1m_{\alpha\beta}^{r - 1} + \dots + b_r \cdot \id = 0.
  \]
  Apply the above endomorphism to \(1 \in \Z[\alpha, \beta]\), we get
  \[
    (\alpha\beta)^r + b_1(\alpha\beta)^{r - 1} + \dots + b_r = F_{\alpha\beta}(\alpha\beta) = 0
  \]
  so \(\alpha\beta \in \O_L\).

  The argument to show \(\alpha + \beta \in \O_L\) is identical, replacing \(m_{\alpha\beta}\) by
  \begin{align*}
    m_{\alpha + \beta}: \Z[\alpha, \beta] &\to \Z[\alpha, \beta] \\
    \gamma &\mapsto (\alpha + \beta)\gamma
  \end{align*}
\end{proof}

\begin{definition}[Ring of integers]\index{ring of integers}
  \(\O_L\) is the \emph{ring of algebraic integers} of \(L\).
\end{definition}

\begin{lemma}
  Let \(L/\Q\) be a number field and let \(\alpha \in L\). Then there exists \(n \in \Z, n \geq 1\) such that \(n \alpha \in \O_L\).
\end{lemma}

\begin{proof}
  Let \(f(x) \in \Q[x]\) be a monic polynomial such that \(f(\alpha) = 0\). Then there exists \(n \in \Z, n \geq 1\) such that \(g(x) = n^{\deg f} f(x/n) \in \Z[x]\) is monic. Then
  \[
    g(n\alpha) = n^{\deg f} f(\alpha) = 0
  \]
  so \(n\alpha \in \O_L\).
\end{proof}

\section{Complex Embeddings}

Let \(L\) be a number field.

\begin{definition}[Complex embedding]\index{complex embedding}
  A \emph{complex embedding} of \(L\) is a field homomorphism
  \[
    \sigma: L \to \C.
  \]
\end{definition}

\begin{note}
  In this case \(\sigma\) is injective and \(\sigma|_\Q\) is the unique embedding \(\Q \to \C\).
\end{note}

\begin{proposition}
  Let \(L/K\) be an extension of number fields, and let \(\sigma_0: K \to \C\) be a complex embedding. Then there exist exactly \([L:K]\) embeddings \(\sigma: L \to \C\) such that \(\sigma|_K = \sigma_0\).
\end{proposition}

\begin{proof}
  By induction on \([L:K]\). If \([L:K] = 1\) then \(L = K\).

  In general, choose \(\alpha \in L \setminus K\) and consider \(L/K(\alpha)/K\). By the Tower Law
  \[
    [L:K] = [L:K(\alpha)][K(\alpha):K]
  \]
  and \([K(\alpha):K] > 1\). By induction, it suffices to show that there are exactly \([K(\alpha):K]\) embeddings \(\sigma: K(\alpha) \to \C\) extending \(\sigma_0\). Let \(f_\alpha(x) \in K[x]\) be the minimal polynomial of \(\alpha\) over \(K\). Notice that there is an isomorphism of fields
  \begin{align*}
    K[x]/(f_\alpha(x)) &\to K(\alpha) \\
    x &\mapsto \alpha
  \end{align*}
  To get a complex embedding \(\sigma: K(\alpha) \to \C\) extending \(\sigma_0\), it's equivalent to give a root \(\beta\) of \((\sigma_0f_\alpha)(x)\) in \(\C\). We have
  \[
    [K(\alpha):K] = \deg f_\alpha = \deg \sigma_0f_\alpha
  \]
  so it suffices to show that \(\sigma_0f_\alpha\) has distinct roots in \(\C\). The polynomial \(f_\alpha(x) \in K[x]\) is irreducible so is prime to its derivative \(f_\alpha'(x)\). We can therefore find \(A(x), B(x) \in K[x]\) such that
  \[
    Af_\alpha + Bf_\alpha' = 1.
  \]
  Hence
  \[
    (\sigma_0 A)(\sigma_0f_\alpha) + (\sigma_0B)(\sigma_0f_\alpha') = 1.
  \]
  Hence if \(\beta \in \C\) and \((\sigma_0f_\alpha)(\beta) = 0\), \((\sigma_0f_\alpha')(\beta) \neq 0\).
\end{proof}

\begin{notation}
  If \(\sigma: L \to \C\) is a complex embedding, then \(\conj \sigma\) is also a complex embedding where \(\conj \sigma(\alpha) = \conj{\sigma(\alpha)}\). In the other words, complex conjugation is an automorphism of \(\C\) and we can post-compose it with any field embedding.

  If \(\sigma = \conj \sigma\) then \(\sigma(L) \subseteq \R\). Otherwise \(\sigma \neq \conj \sigma\) and \(\sigma(L)\) is not contained in \(\R\). We write \(r\) for the number of complex embeddings \(\sigma\) such that \(\sigma = \conj \sigma\) and \(s\) for the number of pairs of embeddings \(\{\sigma, \conj \sigma\}\) where \(\sigma \neq \conj \sigma\). It then follows that
  \[
    r + 2s = [L:\Q].
  \]
\end{notation}

\begin{eg}[Quadratic field]\index{quadratic field}
  Let \(d \in \Z\) be square-free and \(d \neq 0, 1\). Let\
  \[
    \Q(\sqrt d) = \Q[x]/(x^2 - d).
  \]
  If \(d > 0\) then \(r = 2, s = 0\), which we call real quadratic field. If \(d < 0\) then \(r = 0, s = 1\), which we call imaginary quadratic field.
\end{eg}

\begin{eg}
  Let \(m \in \Z\) be cube-free and \(m \neq -1, 0, 1\). Let
  \[
    \Q(\sqrt[3]{m}) = \Q[x]/(x^3 - m).
  \]
  Then \(r = 1, s = 1\).
\end{eg}

\begin{definition}[Trace \& norm]\index{trace}\index{norm}
  Let \(L/K\) be a extension of number fields and let \(\alpha \in L\). Let \(m_\alpha\) be the \(K\)-linear map
  \begin{align*}
    m_\alpha: L &\to L \\
    \beta &\mapsto \alpha\beta
  \end{align*}
  Then we define the \emph{trace} of \(\alpha\) to be
  \[
    \tr_{L/K}(\alpha) = \tr m_\alpha \in K
  \]
  and the \emph{norm} of \(\alpha\) to be
  \[
    \n_{L/K}(\alpha) = \det m_\alpha \in K.
  \]
\end{definition}

\begin{lemma}
  If \(L/K\) is an extension of number fields and \(\alpha \in L\), then
  \begin{enumerate}
  \item \(\tr_{L/K}(\alpha) = [L:K(\alpha)] \tr_{K(\alpha)/K}(\alpha)\).
  \item \(\n_{L/K}(\alpha) = \n_{K(\alpha)/K}(\alpha)^{[L:K(\alpha)]}\).
  \end{enumerate}
\end{lemma}

\begin{proof}
  There is an isomorphism \(L \cong K(\alpha)^{[L:K(\alpha)]}\) of \(K(\alpha)\)-vector spaces.
\end{proof}

\begin{lemma}
  Let \(L/K\) be an extension of number fields and let \(\alpha \in L\). Let \(\sigma_0: K \to \C\) be a complex embedding and \(\sigma_1, \dots, \sigma_n: L \to \C\) be complex embeddings extending \(\sigma_0\). Then
  \begin{align*}
    \sigma_0(\tr_{L/K}(\alpha)) &= \sum_{i = 1}^n \sigma_i(\alpha) \\
    \sigma_0(\n_{L/K}(\alpha)) &= \prod_{i = 1}^n \sigma_i(\alpha)
  \end{align*}
\end{lemma}

\begin{proof}
  wlog \(L = K(\alpha)\). Let \(f_\alpha(x) \in K[x]\) be the minimal polynomial of \(\alpha\) over \(K\). Recall that
  \[
    (\sigma_0f_\alpha)(x) = \prod_{i = 1}^n (x - \sigma_i(\alpha)).
  \]
  Write \(f_\alpha(x) = x^n + a_1x^{n - 1} + \dots + a_n\). Then
  \begin{align*}
    \sigma_0(a_1) &= - \sum_{i = 1}^n \sigma_i(\alpha) \\
    \sigma_0(a_n) &= (-1)^n \prod_{i = 1}^n \sigma_i(\alpha)
  \end{align*}
  Let \(g(x) \in K[x]\) be the characteristic polynomial of \(m_\alpha\). If \(g(x) = x^n + b_1x^{n - 1} + \dots + b_n\) then
  \begin{align*}
    b_1 &= -\tr m_\alpha = -\tr_{L/K}(\alpha) \\
    b_n &= (-1)^n\det m_\alpha = (-1)^n \n_{L/K}(\alpha)
  \end{align*}
  so done if we can show \(f_\alpha(x) = g(x)\). By Cayley-Hamilton, \(g(m_\alpha) = 0\) so \(g(\alpha) = 0\). Thus \(f_\alpha(x) = g(x)\).
\end{proof}

\begin{corollary}
  If \(\alpha \in \O_L\) then \(\tr_{L/K}(\alpha), \n_{L/K}(\alpha) \in \O_K\).
\end{corollary}

\begin{proof}
  We have the following characterisation of ring of integers: if \(\beta \in K\) then \(\beta \in \O_K\) if and only if \(\sigma_0(\beta) \in \O_\C\) as for all \(f(x) \in \Z[x]\), \(f(\beta) = 0\) if and only if \(f(\sigma_0(\beta)) = 0\).

  By the lemma, \(\sigma_0 \tr_{L/K}(\alpha) = \sigma_1(\alpha) + \dots + \sigma_n(\alpha)\). If \(\alpha \in \O_L\) then \(\sigma_i(\alpha) \in \O_\C\) for all \(i\). But \(\O_\C\) is a ring so \(\sigma_0 \tr_{L/K}(\alpha) \in \O_\C\). Thus \(\tr_{L/K}(\alpha) \in \O_K\). Similar for norm.
\end{proof}

\begin{proposition}[Classification of ring of integers of quadratic fields]
  Let \(d \in \Z\) be square-free and \(d \neq 0, 1\). Let \(L = \Q(\sqrt d)\). Then
  \[
    \O_L =
    \begin{cases}
      \Z[\sqrt d] & \text{if } d = 2, 3 \pmod 4 \\
      \Z[\frac{1 + \sqrt d}{2}] & \text{if } d = 1 \pmod 4
    \end{cases}
  \]
\end{proposition}

\begin{proof}
  We have a nice characterisation of algebraic integers in quadratic fields: if \(\alpha \in L\), then \(\alpha \in \O_L\) if and only if \(\tr_{L/\Q}(\alpha), \n_{L/\Q}(\alpha) \in \Z\). (Why?)

  Let \(\alpha \in L\). Write \(\alpha = \frac{u}{2} + \frac{v}{2}\sqrt d\) where \(u, v \in \Q\). If \(\alpha \in \O_L\) then
  \begin{align*}
    \tr_{L/\Q}(\alpha) &= u \in \Z \\
    \n_{L/\Q}(\alpha) &= \frac{1}{4}(u + v\sqrt d)(u - v\sqrt d) = \frac{1}{4}(u^2 - dv^2) \in \Z
  \end{align*}
  so \(u^2 - dv^2 \in 4\Z\), \(dv^2 \in \Z\). Write \(v = \frac{r}{s}\) where \(r, s \in \Z\) and are coprime. Then \(dr^2 \in s^2\Z\) so \(s^2 \divides dr^2\). If \(p\) is a prime and \(p \divides s\) then \(p^2 \divides d\). But this is absurd as \(d\) is square-free. Thus \(v \in \Z\).

  We have shown that if \(\alpha \in \O_L\) then \(\alpha = \frac{u}{2} + \frac{v}{2}\sqrt d\) where \(u, v \in \Z\) and \(u^2 = dv^2 \pmod 4\). Split into cases:
  \begin{enumerate}
  \item \(d = 2, 3 \pmod 4\): \(u^2 = 0, 1 \pmod 4, v^2 = 0, 1 \pmod 4\). Consider the congruence \(u^2 =dv^2 \pmod 4\) shows that \(u, v \in 2\Z\). Hence \(\alpha \in \Z[\sqrt d]\). Thus \(\O_L = \Z[\sqrt d]\).
  \item \(d = 1 \pmod 4\): \(u^2 = v^2 \pmod 4\) so \(u = v \pmod 2\). Hence
    \[
      \O_L \subseteq \left\{ \frac{u}{2} + \frac{v}{2}\sqrt d: u, v \in \Z, u = v \pmod 2 \right\} \cong \Z\oplus\Z\cdot \left(\frac{1 + \sqrt d}{2} \right).
    \]
    It thus remains to show that \(\frac{1 + \sqrt d}{2}\) is an algebraic integer. But we know
    \begin{align*}
      \tr_{L/\Q} \frac{1 + \sqrt d}{2} &= 1 \\
      \n_{L/\Q} \frac{1 + \sqrt d}{2} &= \frac{1 - d}{4} \in \Z
    \end{align*}
    so done.
  \end{enumerate}
\end{proof}

Recall that if \(R\) is a ring, then a \emph{unit} in \(R\) is an element \(u \in R\) such that there exists \(v \in R\) such that \(uv = 1\). The set
\[
  R^\times = \{u \in R: u \text{ is a unit}\}
\]
form a group under multiplication.

\begin{lemma}
  If \(L\) is a number field then
  \[
    \O_L^\times = \{\alpha \in \O_L: \n_{L/\Q}(\alpha) = \pm 1\}.
  \]
\end{lemma}

\begin{remark}
  We'll prove later in the course that \(\O_L^\times\) is a finite group if and only if \(L = \Q\) or \(L\) is an imaginary quadratic field.
\end{remark}

\begin{proof}
  Norm is multiplicative so
  \[
    \n_{L/\Q}(\alpha\beta) = \n_{L/\Q}(\alpha)\n_{L/\Q}(\beta)
  \]
  for all \(\alpha, \beta \in L\). If \(\alpha \in \O_L^\times\) then there exists \(\beta \in \O_L\) such that \(\alpha\beta = 1\). Thus \(\n_{L/\Q}(\alpha)\n_{L/\Q}(\beta) = 1\). As they are both integers,
  \[
    \n_{L/\Q}(\alpha) \in \Z^\times = \{\pm 1\}.
  \]

  Conversely, suppose \(\alpha \in \O_L\) and \(\n_{L/\Q}(\alpha) = \pm 1\). Then \(\alpha^{-1} \in L\). Let \(\sigma_1, \dots, \sigma_n: L \to \C\) be distinct complex embeddings of \(L\). Then
  \[
    \n_{L/\Q}(\alpha) = \prod_{i = 1}^n \sigma_i(\alpha) = \pm 1
  \]
  so
  \[
    \sigma_1(\alpha^{-1}) = \pm \prod_{i = 2}^n \sigma_i(\alpha) \in \O_\C
  \]
  so \(\alpha^{-1} \in \O_L\).
\end{proof}

\section{Discriminants and integral bases}

Let \(L\) be a number field, \(n = [L:\Q]\) and \(\sigma_1, \dots, \sigma_n: L \to \C\) be distinct complex embeddings of \(L\).

\begin{definition}[Discriminant]\index{discriminant}
  Let \(\alpha_1, \dots, \alpha_n \in L\). Then their \emph{discriminant} is
  \[
    \disc(\alpha_1, \dots, \alpha_n) = \det D^2
  \]
  where \(D \in \matrixring_{n \times n}(\C)\) is \(D_{ij} = \sigma_i(\alpha_j)\).
\end{definition}

\begin{notation}
  Sometimes we use the alternative notation
  \[
    \Delta(\alpha_1, \dots, \alpha_n) = \disc(\alpha_1, \dots, \alpha_n).
  \]
\end{notation}

\begin{note}
  This is independent of the choice of ordering of \(\sigma_i\)'s and \(\alpha_j\)'s, as changing them amounts to permuting the rows and columns, which changes \(\det D\) by a sign.
\end{note}

\begin{lemma}
  Let \(\alpha_1, \dots, \alpha_n \in L\). Then
  \[
    \disc(\alpha_1, \dots, \alpha_n) = \det T
  \]
  where \(T \in \matrixring_{n \times n}(\Q)\) is \(T_{ij} = \tr_{L/\Q}(\alpha_i\alpha_j)\).
\end{lemma}

\begin{proof}
  \[
    T_{ij}
    = \sum_{k = 1}^n \sigma_k(\alpha_i\alpha_j)
    = \sum_{k = 1}^n D_{ki}D_{kj}
    = (D^TD)_{ij}
  \]
\end{proof}

\begin{corollary}
  \(\disc(\alpha_1, \dots, \alpha_n) \in \Q\) and if further \(\alpha_1, \dots, \alpha_n \in \O_L\) then \(\disc(\alpha_1, \dots, \alpha_n) \in \Z\).
\end{corollary}

\begin{proof}
  \(\disc(\alpha_1, \dots, \alpha_n) = \det T \in \Q\).

  If \(\alpha_i\)'s are in \(\O_L\), then \(D_{ij} \in \O_\C\) for all \(i, j\). As \(\det\) is a polynomial, \(\disc(\alpha_1, \dots, \alpha_n) \in \O_\C \cap \Q = \Z\).
\end{proof}

\begin{proposition}
  Let \(\alpha_1, \dots, \alpha_n \in L\). Then \(\disc(\alpha_1, \dots, \alpha_n) \neq 0\) if and only if \(\alpha_i\)'s form a \(\Q\)-basis of \(L\).
\end{proposition}

\begin{proof}
  Suppose \(\alpha_i\)'s do not form a basis, i.e.\ they satisfy a non-trivial relation. Then the columns of the matrix \(D_{ij} = \sigma_i(\alpha_j)\) are linearly dependent so \(\disc(\alpha_1, \dots, \alpha_n) = 0\).

  Conversely, suppose \(\alpha_1, \dots, \alpha_n\) are linearly independent. Then \(\disc(\alpha_1, \dots, \alpha_n) \neq 0\) if and only if \(\det T \neq 0\), if and only if the symmetric bilinear form
  \begin{align*}
    \phi: L \times L &\to \Q \\
    (\alpha, \beta) &\mapsto \tr_{L/\Q}(\alpha\beta)
  \end{align*}
  is non-degenerate. In other words, for all \(\alpha \in L^\times\), there exists \(\beta \in L\) such that \(\phi(\alpha, \beta) \neq 0\). But if \(\alpha \in L^\times\) then \(\phi(\alpha, \alpha^{-1}) = \tr_{L/\Q}(1) = n \neq 0\).
\end{proof}

\begin{definition}[Integral basis]\index{integral basis}
  We say \(\alpha_1, \dots, \alpha_n \in L\) form an \emph{integral basis} for \(\O_L\) if
  \begin{enumerate}
  \item \(\alpha_1, \dots, \alpha_n \in \O_L\),
  \item \(\alpha_1, \dots, \alpha_n\) generate \(\O_L\) as a \(\Z\)-module.
  \end{enumerate}
\end{definition}

\begin{lemma}
  If \(\alpha_1, \dots, \alpha_n\) form an integral basis for \(\O_L\) then the function
  \begin{align*}
    f: \Z^n &\to \O_L \\
    (m_1, \dots, m_n) &\mapsto \sum_{i = 1}^n m_i\alpha_i
  \end{align*}
  is an isomorphism of \(\Z\)-modules.
\end{lemma}

\begin{proof}
  \(f\) is clearly a surjective homomorphism so remains to show it is injective. Observe that \(\alpha_1, \dots, \alpha_n\) form a \(\Q\)-basis of \(L\): we know that if \(\beta \in L\) then there exists \(N \geq 1, N \in \Z\) such that \(N\beta \in \O_L\). Write
  \[
    N\beta = \sum_{i = 1}^n m_i\alpha_i
  \]
  for some \(m_i \in \Z\). Thus \(\beta = \sum_{i = 1}^m \frac{m_1}{N} \alpha_i\). Thus \(\alpha_i\)'s span \(L\) and thus form a basis of \(L\).

  If \(f(m_1, \dots, m_n) = 0\) then \(\sum_{i = 1}^n m_i\alpha_i = 0\) so \(m_i = 0\) by linear independent of \(\alpha_i\)'s.
\end{proof}

We will soon prove that every number field has an integral basis.

\begin{lemma}[Sandwich lemma]\leavevmode
  \begin{enumerate}
  \item If \(H \leq G\) are abelian groups and \(G \cong \Z^a\) for some integer \(a \geq 0\), then \(H \cong \Z^b\) for some \(b \leq a\).
  \item If \(K \leq H \leq G\) are abelian groups and \(K \cong \Z^a, G \cong \Z^a\) for some \(a \geq 0\), then \(H \cong \Z^a\).
  \item If \(H \leq G\) are abelian groups and \(H \cong \Z^a, G \cong \Z^a\) for some \(a \geq 0\) then \(G/H\) is finite.
  \end{enumerate}
\end{lemma}

This is a generalisation of results about finite dimensional vector spaces (i.e.\ finitely generated free modules over fields) to finitely generated free \(\Z\)-modules.

\begin{proof}\leavevmode
  \begin{enumerate}
  \item \(G/H\) is a finitely generated abelian group. By the classification, \(G/H \cong \Z^n \oplus A\) where \(A\) is a finite abelian group. Choose \(p\) prime such that \(p \ndivides |A|\). Then the map
    \begin{align*}
      f: G/H &\to G/H \\
      x + H &\mapsto px + H
    \end{align*}
    is injective. Consider the map
    \begin{align*}
      f': H/pH &\to G/pG \\
      x + pH &\mapsto x + pG
    \end{align*}
    Claim this map is also injective: if \(x \in H, x \in pG\) then \(x = py\) for some \(y \in G\). Then \(y + H \in \ker f = H\). Thus \(x \in pH\).

    By classification \(H \cong \Z^b\). As \(f'\) is injective, \(|H/pH| \leq |G/pG|\), i.e.\ \(p^b \leq p^a\) so \(b \leq a\).
  \item Apply 1 to \(K \leq H\) and \(H \leq G\) to get \(H \cong \Z^b\) where \(a \leq b \leq a\) so \(a = b\).
  \item Again \(G/H\) is finitely generated so by classification \(G/H \cong \Z^N \oplus A\) where \(A\) is a finite abelian group. Let \(p\) be a prime such that \(p \ndivides |A|\). The same proof as in 1 shows that \(f': H/pH \to G/pG\) is injective. Since \(|H/pH| = |G/pG| = p^a\), \(f'\) is an isomorphism. Thus (?)
    \[
      G/H + pG \cong (\Z/p\Z)^N
    \]
    There is a surjective homomorphism \(G/pG \to G/H + pG\) which has kernel containing the image of \(f'\). Hence the map is surjective with kernel \(G/pG\). This forces \(N = 0\).
  \end{enumerate}
\end{proof}

\begin{proposition}
  There exists an integral basis for \(\O_L\).
\end{proposition}

\begin{proof}
  Let \(\beta_1, \dots, \beta_n \in L\) be a \(\Q\)-basis for \(L\). Wlog \(\beta_1, \dots, \beta_n \in \O_L\). Then \(\O_L \supseteq \bigoplus_{i = 1}^n \beta_i\Z\).

  Recall that
  \begin{align*}
    \phi: L \times L &\to \Q \\
    (\alpha, \beta) &\mapsto \tr_{L/\Q}(\alpha\beta)
  \end{align*}
  is a non-degenerate symmetric bilinear form. Let \(\beta_1^*, \dots, \beta_n^*\) be the dual basis, i.e.\ \(\tr_{L/\Q}(\beta_i \beta_j^*) = \delta_{ij}\). If \(\alpha \in \O_L\) then we can write
  \[
    \alpha = \sum_{i = 1}^n a_i\beta_i^*
  \]
  where \(a_i \in \Q\). We know \(\alpha\beta_i \in \O_L\) hence
  \[
    \tr_{L/\Q}(\alpha\beta_i)
    = \sum_{j = 1}^n \tr_{L/\Q}(a_j\beta_j^*\beta_i)
    = \sum_{j = 1}^n a_j \tr_{L/\Q} (\beta_j^*\beta_i)
    = a_i
    \in \Z
  \]
  so \(\O_L \subseteq \bigoplus_{i = 1}^n \beta_i^*\Z\). Thus by Sandwich lemma there is an isomorphism \(\O_L \cong \Z^n\).
\end{proof}

If \(\alpha_1, \dots, \alpha_n\) and \(\beta_1, \dots, \beta_n\) are both integral basis for \(\O_L\), then there exists \(A \in \matrixring_{n \times n}(\Z)\) such that
\[
  \beta_j = \sum_{i = 1}^n A_{ij}\alpha_i
\]
for each \(1 \leq j \leq n\). Moreover, we must have \(\det A = \pm 1\) and thus \(A \in \GL_n(\Z)\). Let \(D_{ij} = \sigma_i(\alpha_j), D_{ij}' = \sigma_i(\beta_j)\) and then \(\disc(\beta_1, \dots, \beta_n) = \det (D')^2\). We have
\[
  D_{ij}'
  = \sum_{k = 1}^n \sigma_i(A_{kj}\alpha_k)
  = \sum_{k = 1}^n \sigma_i(\alpha_k) A_{kj}
  = (DA)_{ij}
\]
We thus conclude that
\[
  \disc(\beta_1, \dots, \beta_n)
  = \det (D')^2
  = \det (DA)^2
  = \det D^2
  = \disc(\alpha_1, \dots, \alpha_n).
\]

\begin{definition}[Discriminant]\index{discriminant}
  The \emph{discriminant} \(D_L\) of a number field \(L\) is \(\disc(\alpha_1, \dots, \alpha_n)\) where \(\alpha_1, \dots, \alpha_n\) is any integral basis for \(\O_L\).
\end{definition}

\begin{proposition}
  Let \(L = \Q(\alpha)\) and let \(f(x) \in \Q[x]\) be the minimal polynomial of \(\alpha\) over \(\Q\). Then
  \[
    \disc(1, \alpha, \alpha^2, \dots, \alpha^{n - 1})
    = \prod_{i < j} (\sigma_i(\alpha) - \sigma_j(\alpha))^2
    = (-1)^{\binom{n}{2}} \n_{L/\Q}(f'(\alpha)).
  \]
\end{proposition}

\begin{note}
  In IID Galois Theory, we defined
  \[
    \disc f = \prod_{i < j} (\sigma_i(\alpha) - \sigma_j(\alpha))^2.
  \]
\end{note}

\begin{proof}
  Let \(D_{ij} = \sigma_i(\alpha^{j - 1})\). Then \(D \in \matrixring_{n \times n}(\C)\) and \(\disc(1, \alpha, \dots, \alpha^{n -1}) = \det D^2\). \(D\) is a Vandermonde matrix with
  \[
    \det D = \prod_{i < j} (\sigma_j(\alpha) - \sigma_i(\alpha)).
  \]

  For the second equality, note that
  \[
    \n_{L/\Q}(f'(\alpha))
    = \prod_{i = 1}^n \sigma_i(f'(\alpha))
    = \prod_{i = 1}^n f'(\sigma_i(\alpha)).
  \]
  Also since \(f(x) = \prod_{i = 1}^n (x - \sigma_i(\alpha))\), \(f'(x) = \sum_{i = 1}^n\prod_{j \neq i} (x - \sigma_j(\alpha))\). Substitute into the above formula to get
  \[
    \n_{L/\Q}(f'(\alpha))
    = \prod_{i = 1}^n \prod_{j \neq i} (\sigma_i(\alpha) - \sigma_j(\alpha))
    = (-1)^{\binom{n}{2}} \prod_{i < j}(\sigma_i(\alpha) - \sigma_j(\alpha))^2.
  \]
\end{proof}

\begin{note}
  If \(\alpha \in \O_L\) and \(\Z[\alpha] = \O_L\) then \(1, \alpha, \dots, \alpha^{n -1}\) is an integral basis for \(\O_L\). We can then use the above proposition to calculate \(D_L\).
\end{note}

\begin{eg}
  Let \(d \in \Z\) be square-free and \(d \neq 0, 1\). Let \(L = \Q(\sqrt d)\). Then
  \[
    D_L =
    \begin{cases}
      4d & \text{if } d = 2, 3 \pmod 4 \\
      d & \text{if } d = 1 \pmod 4
    \end{cases}
  \]
  If \(d = 2, 3 \pmod 4\) then \(\O_L = \Z[\sqrt d]\). Apply the proposition to \(f(t) = t^2 - d\) to get
  \[
    D_L = \disc(1, \sqrt d) = -\n_{L/\Q}(2\sqrt d) = 4d.
  \]

  On the other hand if \(d = 1 \pmod 4\) then \(\O_L = \Z[\alpha]\) where \(\alpha  = \frac{1 + \sqrt d}{2}\). Apply the proposition to \(f(t) = t^2 - t + \frac{1 - d}{4}\), \(f'(t) = 2t - 1\), \(f'(\alpha) = \sqrt d\). Thus
  \[
    D_L = -\n_{L/\Q}(\sqrt d) = d.
  \]
\end{eg}

\begin{proposition}
  If \(\alpha_1, \dots, \alpha_n \in \O_L\) are such that \(\disc(\alpha_1, \dots, \alpha_n)\) is a non-zero square-free integer then \(\alpha_1, \dots, \alpha_n\) form an integral basis for \(\O_L\).
\end{proposition}

\begin{proof}
  Let \(\beta_1, \dots, \beta_n\) be an integral basis for \(\O_L\). Then there exists \(A \in \matrixring_{n \times n}(\Z)\) such that
  \[
    \alpha_j = \sum_{i = 1}^n A_{ij}\beta_i
  \]
  for \(1 \leq j \leq n\). Then
  \[
    \disc(\alpha_1, \dots, \alpha_n) = \det A^2 \disc(\beta_1, \dots, \beta_n)
  \]
  using a previous argument. If \(\disc(\alpha_1, \dots, \alpha_n)\) is square-free and non-zero then \(\det A = \pm 1\) so \(A \in \GL_n(\Z)\). Thus \(\alpha_1, \dots, \alpha_n\) must generate \(\O_L\) and thus form an integral basis.
\end{proof}

\begin{eg}
  Let \(f(t) = t^3 - t - 1\). Use the formula
  \[
    \disc(t^3 + at + b) = -4a^3 - 27b^2
  \]
  to get \(\disc(f) = -23\), which is square-free (and non-zero of course). If \(L = \Q(\alpha)\) where \(\alpha\) is a root of \(f(t)\) then \(\O_L = \Z[\alpha]\).
\end{eg}

We have defined integral basis for rings of integers. In fact, we can generalise it to ideals of the ring:

\begin{definition}[Integral basis]\index{integral basis}
  Let \(I \subseteq \O_L\) be a non-zero ideal. Then elements \(\alpha_1, \dots, \alpha_n \in L\) form an \emph{integral basis} for \(I\) if
  \begin{enumerate}
  \item \(\alpha_1, \dots, \alpha_n \in I\),
  \item \(\alpha_1, \dots, \alpha_n\) generate \(I\) as a \(\Z\)-module.
  \end{enumerate}
\end{definition}

\begin{proposition}
  Let \(I \subseteq \O_L\) be a non-zero ideal. Then there exists an integral basis for \(I\).
\end{proposition}

\begin{proof}
  By definition \(I \subseteq \O_L \cong \Z^n\). Let \(\alpha_1, \dots, \alpha_n \in \O_L\) be an integral basis for \(\O_L\). Let \(a \in I\) be non-zero. Then \((a) \subseteq I\) and thus
  \[
    \bigoplus_{i = 1}^n a\alpha_i\Z \subseteq I \subseteq \O_L.
  \]
  By Sandwich lemma \(I \cong \Z^n\) as a \(\Z\)-module. Thus there exists an integral basis for \(I\).
\end{proof}

\begin{definition}[Norm]\index{norm}
  If \(I \subseteq \O_L\) is a non-zero ideal then its \emph{norm} is
  \[
    \n(I) = [\O_L:I].
  \]
\end{definition}

Note that norm is finite by Sandwich lemma.

\begin{definition}[Discriminant]\index{discriminant}
  If \(I \subseteq \O_L\) is a non-zero ideal then its \emph{discriminant} is
  \[
    \disc(I) = \disc(\alpha_1, \dots, \alpha_n)
  \]
  where \(\alpha_1, \dots, \alpha_n\) is any integral basis for \(I\).
\end{definition}

Note that the same argument for discriminant of ring of integers shows that this is well-defined.

\begin{lemma}
  If \(I \subseteq \O_L\) is a non-zero ideal then
  \[
    \disc(I) = \disc(\O_L) \cdot \n(I)^2.
  \]
\end{lemma}

\begin{proof}
  Let \(\alpha_1, \dots, \alpha_n\) be an integral basis for \(\O_L\) and \(\beta_1, \dots, \beta_n\) be an integral basis for \(I\). Then there exists \(A \in \matrixring_{n \times n}(\Z)\) such that
  \[
    \beta_j = \sum_{i = 1}^n A_{ij}\alpha_i
  \]
  for \(1 \leq j \leq n\) and
  \[
    \disc(\beta_1, \dots, \beta_n) = \disc(\alpha_1, \dots, \alpha_n) \det A^2.
  \]
  It thus suffices to show that \(\det A^2 = [\O_L:I]^2\). In fact we'll show that if \(B \in \matrixring_{n \times n}(\Z)\) and \(\det B \neq 0\) then
  \[
    |\Z^n/B\Z^n| = |\det B|.
  \]
  Then the result follows from \(\O_L \cong \Z^n\).

  \begin{proof}
    Recall from IB Groups, Rings and Modules that there exist \(P, Q \in \GL_n(\Z)\) such that
    \[
      PBQ = D = \operatorname{diag}(d_1, \dots, d_n)
    \]
    where \(d_i \in \Z\) (Smith normal form). Thus
    \[
      \Z^n/B\Z^n \cong \Z^n/D\Z^n \cong \bigoplus_{i = 1}^n \Z/d_i\Z
    \]
    so
    \[
      |\Z^n/B\Z^n| = |\Z^n/D\Z^n| = \prod_{i = 1}^n |d_i|.
    \]
    On the other hand \(|\det B| = |\det D| = \prod_{i = 1}^n |d_i|\).
  \end{proof}
\end{proof}

\begin{lemma}
  Let \(\alpha \in \O_L \setminus \{0\}\). Then
  \[
    \n((\alpha)) = |\n_{L/\Q}(\alpha)|.
  \]
\end{lemma}

\begin{proof}
  Let \(\alpha_1, \dots, \alpha_n\) be an integral basis for \(\O_L\). Then \(\alpha\alpha_1, \dots, \alpha\alpha_n\) is an integral basis for \(I = (\alpha)\).
  \begin{align*}
    \disc(I) 
    &= \disc(\alpha\alpha_1, \dots, \alpha\alpha_n) \\
    &= \det(\sigma_i(\alpha\alpha_j))^2 \\
    &= \det (\sigma_i(\alpha)\sigma_i(\alpha_j))^2 \\
    &= \left( \prod_{i = 1}^n \sigma_i(\alpha) \right)^2 \det(\sigma_i(\alpha_j))^2 \\
    &= \n_{L/\Q}(\alpha)^2 \disc(\O_L)
  \end{align*}
  On the other hand, we showed last time that for any non-zero ideal \(J \subseteq \O_L\),
  \[
    \disc(J) = \n(J)^2 \disc(\O_L)
  \]
  and the result follows.
\end{proof}

\begin{notation}
  If \(\alpha \in \O_L \setminus \{0\}\), we write
  \[
    \n(\alpha) = \n((\alpha)).
  \]
  Also define \(\n(0) = 0\). Then for all \(\alpha, \beta \in \O_L\), \(\n(\alpha\beta) = \n(\alpha)\n(\beta)\).
\end{notation}

In fact later we will show \(\n\) is multiplicative for all ideals.

\section{Unique factorisation in \texorpdfstring{\(\O_L\)}{O\_L}}

Recall that a ring \(R\) is a \emph{unique factorisation domain} (UFD) if
\begin{enumerate}
\item \(R\) is an integral domain,
\item if \(x \in R\) is non-zero and not a unit, then there exists an expression
  \[
    x = p_1 \cdots p_r
  \]
  where \(p_i \in R\) are irreducibles. This expression is unique in the sense that if
  \[
    x = q_1 \cdots q_s
  \]
  is another such expressions then \(r = s\) and after reordering each \(q_i\) is an associate of \(p_i\), i.e.\ \(q_i \in R^\times p_i\).
\end{enumerate}

We know that \(\Z\) is a UFD. However, if \(L\) is a number field then \(\O_L\) need not be a UFD. Let's see an example where uniqueness fails.

\begin{eg}
  Let \(L = \Q(\sqrt{-5})\). Then \(\O_L = \Z[\sqrt{-5}]\). From example sheet we know \(\O_L^\times = \{\pm 1\}\). In \(\O_L\) we have
  \[
    6 = 2 \times 3 = (1 + \sqrt{-5})(1 - \sqrt{-5}).
  \]
  We can check that \(2, 3, 1 \pm \sqrt{-5}\) are irreducibles and no two are associates. For example, suppose \(2 = xy\) where \(\n(x) > 1, \n(y) > 1\). As \(\n(2) = 4\), \(\n(x) = \n(y) = 2\). But \(\n(a + b\sqrt{-5}) = a^2 + 5b^2\) which is never \(2\). Contradiction.
\end{eg}

But this does not go terribly wrong. In fact, any non-zero \(x \in \O_L\) which is not a unit can be expressed as a product of irreducible elements:

\begin{proof}
  If \(x \in \O_L\) then \(x\) is a non-zero non-unit if and only if \(\n(x) > 1\). Suppose \(x \in \O_L\) is a non-zero non-unit which cannot be written as a product of irreducibles, and with \(\n(x)\) minimal among such elements. Then \(x = yz\) with \(\n(y), \n(z) > 1\), hence \(\n(y), \n(z) < \n(x)\). By minimality of \(\n(x)\), both \(y\) and \(z\) can be written as products of irreducibles.
\end{proof}

The way to get around this is to consider multiplication of ideals insteads of elements. Recall that if \(R\) is a ring and \(I, J\) are ideal of \(R\), we can define
\begin{align*}
  IJ &= \left\{ \sum_{i = 1}^k a_ib_i: a_i \in I, b_i \in J \right\} \\
  I + J &= \{ a + b: a \in I b \in J \}
\end{align*}

\begin{definition}[Irreducible ideal]\index{irreducible ideal}
  A proper ideal \(I \subseteq R\) is \emph{irreducible} if it does not admit an expression \(I = JK\) where \(J, K\) are proper ideals of \(R\).
\end{definition}

One caveat: even if \(\alpha \in \O_L\) is irreducible, the principal ideal \((\alpha)\) need not be irreducible. For example in \(\Z[\sqrt{-5}]\), we have
\begin{align*}
  (2) &= (2, 1 + \sqrt{-5})^2 \\
  (3) &= (3, 1 + \sqrt{-5})(3, 1 - \sqrt{-5})
\end{align*}

The aim of this chapter is to prove that factorisation of ideals into prime ideals is unique. Recall from IB Groups, Rings and Modules

\begin{definition}[Prime ideal]\index{prime ideal}
  Let \(R\) is a ring. We say that a proper ideal \(\mathfrak p \subseteq \R\) is \emph{prime} if for all \(x, y \in R\), \(xy \in \mathfrak p \implies x \in \mathfrak p \text{ or } y \in \mathfrak p\).
\end{definition}

The following lemma gives us a way to characterise prime ideals:
\begin{lemma}
  Let \(R\) be a ring and \(I, J, \mathfrak p \subseteq R\) be ideals. Suppose \(\mathfrak p\) is prime and \(IJ \subseteq \mathfrak{p}\) then \(I \subseteq \mathfrak{p}\) or \(J \subseteq \mathfrak{p}\).
\end{lemma}

\begin{proof}
  Wlog \(I \nsubseteq \mathfrak{p}\). Choose \(x \in I \setminus \mathfrak{p}\). For all \(y \in J\), \(xy \in IJ \subseteq \mathfrak{p}\) so \(y \in \mathfrak{p}\).
\end{proof}

Note that the converse is trivially true, so we can think about a prime ideal as a ``prime element'' among all ideals, instead of breaking the ideal apart and talking about properties of elements in the ideal.

From now on let \(L\) be a number field.

\begin{lemma}
  Any non-zero prime ideal \(\mathfrak{p} \subseteq \O_L\) is a maximal ideal.
\end{lemma}

\begin{proof}
  Recall that if \(R\) is a ring and \(I\) is a proper ideal of \(R\), then \(I\) is prime if and only if \(R/I\) is an integral domain and \(I\) is maximal if and only if \(R/I\) is a field.

  If \(\mathfrak{p} \subseteq \O_L\) is a non-zero prime ideal, then \(\O_L\) is a finite integral domain as its cardinality is \(\n(\mathfrak{p})\). Any finite integral domain is a field.
\end{proof}

\begin{lemma}
  If \(I \subseteq \O_L\) is a non-zero proper ideal then there exists non-zero prime ideals \(\mathfrak{p}_1, \dots, \mathfrak{p}_r \subseteq \O_L\) such that \(\mathfrak{p}_1 \cdots \mathfrak{p}_r \subseteq I\).
\end{lemma}

\begin{proof}
  For contradiction, let \(I \subsetneq \O_L\) be an ideal which does not have this property with \(\n(I)\) minimal among all such ideals. Clearly \(I\) is not prime so there exists \(x, y \in \O_L\) such that \(xy \in I\) but \(x, y \notin I\). It follows that
  \begin{align*}
    I &\subsetneq I + (x) \\
    I &\subsetneq I + (y)
  \end{align*}
  and therefore
  \begin{align*}
    \n(I + (x)) &< \n(I) \\
    \n(I + (y)) &< \n(I)
  \end{align*}
  By minimality of \(\n(I)\), we can find non-zero prime ideals \(\mathfrak{p}_1, \dots, \mathfrak{p}_r, \mathfrak{q}_1, \dots, \mathfrak{q}_s\) such that
  \begin{align*}
    \mathfrak{p}_1, \dots, \mathfrak{p}_r &\subseteq I + (x) \\
    \mathfrak{q}_1, \dots, \mathfrak{q}_s &\subseteq I + (y)
  \end{align*}
  so
  \[
    \mathfrak{p}_1 \cdots \mathfrak{p}_r\mathfrak{q}_1 \cdots \mathfrak{q}_s \subseteq (I + (x))(I + (y)) \subseteq I^2 + xI + yI + (xy) \subseteq I.
  \]
  Absurd.
\end{proof}

\begin{lemma}
  If \(I \subsetneq \O_L\) is a non-zero ideal then there exists \(\gamma \in L \setminus \O_L\) such that \(\gamma I \subseteq \O_L\).
\end{lemma}

\begin{proof}
  Let \(\alpha \in I \setminus \{0\}\). Let \(\mathfrak{p}_1, \dots, \mathfrak{p}_r \subseteq \O_L\) be non-zero prime ideals such that \(\mathfrak{p}_1 \dots \mathfrak{p}_r \subseteq (\alpha)\). Wlog \(r\) is minimal among all such expressions. Let \(\mathfrak{p}\) be a maximal ideal containing \(I\). Then
  \[
    \mathfrak{p} \supseteq I \supseteq (\alpha) \supseteq \mathfrak{p}_1 \cdots \mathfrak{p}_r
  \]
  so \(\mathfrak{p} \supseteq \mathfrak{p}_i\) for some \(i\). After reordering, assume \(\mathfrak{p} \supseteq \mathfrak{p}_1\). Since non-zero prime ideals are maximal, we have \(\mathfrak{p} = \mathfrak{p}_1\). Since \(r\) is minimal, we have \(\mathfrak{p}_2 \cdots \mathfrak{p}_r \nsubseteq (\alpha)\). Choose \(\beta \in \mathfrak{p}_2 \cdots \mathfrak{p}_r \setminus (\alpha)\). Claim that the element \(\gamma = \frac{\beta}{\alpha}\) has the desired property: if \(\gamma \in \O_L\) then \(\beta = \alpha\gamma \in (\alpha)\). Absurd. In addition
  \[
    \gamma I = \frac{\beta}{\alpha}I \subseteq \frac{1}{\alpha} \mathfrak{p}_2 \cdots \mathfrak{p}_r I \subseteq \frac{1}{\alpha} \mathfrak{p}_1\cdots \mathfrak{p}_r \subseteq \O_L.
  \]
\end{proof}

\begin{proposition}
  If \(I \subseteq \O_L\) is a non-zero ideal then there exists a non-zero ideal \(J \subseteq \O_L\) such that \(IJ\) is principal.
\end{proposition}

\begin{proof}
  Choose \(\alpha \in I \setminus \{0\}\). Define
  \[
    J = \{\beta \in \O_L: \beta I \subseteq (\alpha)\}.
  \]
  \(J\) is a non-zero ideal as \(\alpha \in J\). We have \(IJ \subseteq (\alpha)\). Suffices to show equality.

  Let \(K = \frac{1}{\alpha}IJ \subseteq \O_L\). We will show in fact that \(K = \O_L\): if \(K \neq \O_L\), there exists \(\gamma \in L \setminus \O_L\) such that \(\gamma K \subseteq \O_L\). We have \((\alpha) \subseteq I\) hence \(\frac{1}{\alpha} I \supseteq \O_L\), hence \(K = \frac{1}{\alpha}IJ \supseteq J\). Hence \(\gamma J \subseteq \gamma K \subseteq \O_L\). We also have
  \[
    \gamma IJ = \gamma \alpha K \subseteq (\alpha).
  \]
  If \(\beta \in \gamma J\) then \(\beta \in \O_L\) and \(\beta I \subseteq (\alpha)\) so \(\gamma J \subseteq J\).

  Recall that \(J\) admits an integral basis so there is an isomorphism \(J \cong \Z^n\). If \(A \in \matrixring_{n \times n}(\Z)\) be the matrix representing multiplication by \(\gamma\), with \(f(x) \in \Z[x]\) its characteristic polynomial, by Cayley-Hamilton \(f(\gamma) = 0\). Thus \(\gamma \in \O_L\). Absurd.

  This shows that \(IJ = (\alpha)\).
\end{proof}

Now we have the machinery to define ``division'' of ideals:

\begin{corollary}
  If \(I, J, K \subseteq \O_L\) are non-zero ideals and \(IJ = IK\) then \(J = K\).
\end{corollary}

\begin{proof}
  Choose a non-zero ideal \(A \subseteq \O_L\) such that \(AI = (\alpha)\) is principal. Then
  \[
    \alpha J = AIJ = AIK = \alpha K
  \]
  so \(J = K\).
\end{proof}

\begin{definition}[Ideal divisibility]\index{ideal divisibility}
  If \(I, J \subseteq \O_L\) are non-zero ideals, say \(I\) \emph{divides} \(J\), written \(I \divides J\), if there exists an ideal \(K \subseteq \O_L\) such that \(IK = J\).
\end{definition}

\begin{corollary}
  If \(I, J \subseteq \O_L\) are non-zero ideals, then \(I \divides J\) if and only if \(I \supseteq J\).
\end{corollary}

\begin{proof}
  If \(IK = J\) then \(J \subseteq I\). Conversely, suppose \(I \supseteq J\). Choose a non-zero ideal \(A \subseteq \O_L\) such that \(AI = (\alpha)\) is principal. Then \((\alpha) = AI \supseteq AJ\) and so \(\O_L \supseteq \frac{1}{\alpha}AJ\). So \(K = \frac{1}{\alpha}AJ\) is a non-zero ideal of \(\O_L\) and \(IK = \frac{1}{\alpha}AIJ = J\).
\end{proof}

Finally, the theorem we have promised:

\begin{theorem}
  If \(I \subseteq \O_L\) is a non-zero ideal, then there exist prime ideals \(\mathfrak{p}_1, \dots, \mathfrak{p}_r \subseteq \O_L\) such that
  \[
    I = \mathfrak{p}_1\cdots \mathfrak{p}_r.
  \]
  Moreover, the expression is unique up to reordering.
\end{theorem}

\begin{proof}
  We show existence by contradiction. Suppose \(I\) is an ideal which cannot be written as a product of primes, and with \(\n(I)\) minimal subject to this condition. We can find a maximal ideal \(\mathfrak{p} \supseteq I\), which is also prime. Then \(\mathfrak{p} \divides I\) so we can write \(I = \mathfrak{p}J\) for some \(J \subseteq \O_L\). Then \(J \divides I\), hence \(J \supseteq I\). If \(J = I\) then we get \(I = I\mathfrak{p}\) and hence \(\O_L = \mathfrak{p}\), contradicting the maximality of \(\mathfrak{p}\). Therefore \(J \supsetneq I\), hence \(N(J) < N(I)\). By minimality of \(N(I)\), we can write \(J = \mathfrak{p}_2 \cdots \mathfrak{p}_r\) where \(\mathfrak{p}_i \subseteq \O_L\) are prime ideals. Hence
  \[
    I = \mathfrak{p}J = \mathfrak{p}\mathfrak{p}_2 \cdots \mathfrak{p}_r.
  \]
  Absurd.

  For the uniqueness part, suppose \(\mathfrak{p}_1, \dots, \mathfrak{p}_r\) and \(\mathfrak{q}_1, \dots, \mathfrak{q}_s\) are non-zero ideals in \(\O_L\) such that
  \[
    \mathfrak{p}_1 \cdots \mathfrak{p}_r = \mathfrak{q}_1 \cdots \mathfrak{q}_s.
  \]
  Then \(\mathfrak{p}_1 \divides \mathfrak{q}_1 \cdots \mathfrak{q}_s\) so \(\mathfrak{p}_1 \supseteq \mathfrak{q}_i\) for some \(1 \leq i \leq s\). Wlog \(\mathfrak{p}_1 \supseteq \mathfrak{q}_1\). But both \(\mathfrak{p}_1\) and \(\mathfrak{q}_1\) are maximal so \(\mathfrak{p}_1 = \mathfrak{q}_1\). Cancel to get
  \[
    \mathfrak{p}_2\cdots \mathfrak{p}_r = \mathfrak{q}_2 \cdots \mathfrak{q}_s.
  \]
  Continue in this way to obtain \(r = s\) and \(\mathfrak{p}_i = \mathfrak{q}_i\) after reordering.
\end{proof}

Before going to construct prime ideals and do arithmetics on them, we first define

\begin{definition}[Ideal class group]\index{ideal class group}
  The \emph{ideal class group} is defined to be
  \[
    \Cl(\O_L) = \{I \subseteq \O_L \text{ non-zero ideal}\}/\sim
  \]
  where \(I \sim J\) if there exists \(\alpha \in L^\times\) such that \(\alpha I = J\).

  Write \([I]\) for the equivalence class containing \(I\).
\end{definition}

\begin{lemma}
  \(\Cl(\O_L)\) is a group under the operation
  \[
    [I][J] = [IJ]
  \]
  with identity \([\O_L]\).
\end{lemma}

\begin{proof}
  If \(I, J \subseteq \O_L\) are non-zero ideals and \(\alpha, \beta \in L^\times\) are such that \(\alpha I, \beta J \subseteq \O_L\) then
  \[
    (\alpha I)(\beta J) = \alpha\beta IJ
  \]
  so the operation is well-defined.

  For any \(I \subseteq \O_L\), \(\O_L I = I\) so \([\O_L]\) is the identity. We showed that if \(I \subseteq \O_L\) is any non-zero ideal then there exists a non-zero ideal \(J \subseteq \O_L\) such that \(IJ = (\alpha)\) is principal. Then
  \[
    [IJ] = [I][J] = [(\alpha)] = [\O_L]
  \]
  so \([I]^{-1} = [J]\). Associativity follows from associativity of ideal multiplication.
\end{proof}

\begin{proposition}
  TFAE:
  \begin{enumerate}
  \item \(\O_L\) is a PID.
  \item \(\O_L\) is a UFD.
  \item \(\Cl(\O_L)\) is trivial.
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(1 \implies 2\): See IB Groups, Rings and Modules.
  \item \(2 \implies 3\): Suffices to show every ideal \(I \subseteq \O_L\) is principal. We know that we can write
    \[
      I = \mathfrak{p}_1 \cdots \mathfrak{p}_r
    \]
    as a product of prime ideals. As products of principal ideals are principal, it suffices to show that every prime ideal of \(\O_L\) is principal. Let \(\mathfrak{p} \subseteq \O_L\) be a prime ideal and \(\alpha \in \mathfrak{p}\) non-zero, and let
    \[
      \alpha = \alpha_1 \cdots \alpha_r
    \]
    be a factorisation of \(\alpha\) into irreducibles. Recall that if a ring is a UFD then irreducible elements are prime. Since
    \[
      \mathfrak{p} \supseteq (\alpha) = (\alpha_1) \cdots (\alpha_r)
    \]
    so \(\mathfrak{p} \divides \mathfrak{p}_1 \cdots \mathfrak{p}_r\) where \(\mathfrak{p}_i = (\alpha_i)\). Since \(\alpha_i\)'s are prime, \(\mathfrak{p}_i\) is a prime ideal. Hence we must have \(\mathfrak{p} = \mathfrak{p}_i = (\alpha_i)\) for some \(i\). Thus \(\mathfrak{p}\) is principal.
  \item \(3 \implies 1\): Let \(I \subseteq \O_L\) be a non-zero ideal. Since \(\Cl(\O_L)\) is trivial, we have \([I] = [\O_L]\), so there exists \(\alpha \in L^\times\) such that \(\alpha \O_L = I\). We have \(\alpha \cdot 1 = \alpha \in I \subseteq \O_L\) so \(\alpha \in \O_L\). Then \(I = (\alpha)\) is principal.
  \end{itemize}
\end{proof}

Thus \(\Cl(\O_L)\) can be seen as the obstruction to \(\O_L\) being a UFD.

\begin{lemma}
  If \(I, J \subseteq \O_L\) are non-zero ideals then
  \[
    \n(IJ) = \n(I)\n(J).
  \]
\end{lemma}

\begin{proof}
  Example sheet.
\end{proof}

\section{Dedekind's criterion}

If \(\mathfrak{p} \subseteq \O_L\) is a non-zero prime ideal, then there is a unique prime number \(p \in \Z_{\geq 0}\) such that \(p \in \mathfrak{p}\) since
\[
  (p) = \ker (\Z \to \O_L/\mathfrak{p}).
\]
Then \(\mathfrak p \divides p \O_L\) and \(\n(\mathfrak p) = p^f\) for some \(f \geq 1\).

\begin{lemma}
  Let \(p\) be a prime number and factor
  \[
    p \O_L = \prod_{i = 1}^r \mathfrak{p}_i^{e_i}
  \]
  where \(\mathfrak{p}_1, \dots, \mathfrak{p}_r\) are distinct prime ideals of \(\O_L\) and \(e_i \geq 1\). Define \(f_i \geq 1\) by \(\n(\mathfrak{p}_i) = p^{f_i}\). Then
  \[
    \sum_{i = 1}^r e_if_i = [L:\Q].
  \]
  In particular, \(r \leq [L:\Q]\).
\end{lemma}

\begin{proof}
  Apply norm to get
  \[
    p^{[L:\Q]} = \n(p\O_L) = \prod_{i = 1}^r \n(\mathfrak{p}_i)^{e_1} = p^{\sum_{i = 1}^r e_if_i}.
  \]
\end{proof}

\begin{definition}[Ramification]\index{ramification}\index{inert}\index{split completely}
  Let \(p\) be a prime number and let \(p\O_L = \prod_{i = 1}^r \mathfrak{p}_i^{e_i}\) be the factorisation as above.
  \begin{enumerate}
  \item We say \(p\) \emph{ramifies} in \(L\) if \(e_i > 1\) for some \(i\). We say \(p\) is \emph{totally ramified} if \(r = 1\) and \(e_1 = [L:\Q]\), i.e.\ \(p\O_L = \mathfrak{p}_1^{[L:\Q]}\).
  \item We say \(p\) is \emph{inert} in \(L\) if \(r = 1\) and \(e_1 = 1\), i.e.\ \(p\O_L\) is prime.
  \item We say \(p\) \emph{splits completely} in \(L\) if \(r = [L:\Q]\) and \(e_i = f_i = 1\) for all \(i\).
  \end{enumerate}
\end{definition}

\begin{theorem}[Dedekind's criterion]\index{Dedekind's criterion}
  \label{thm:Dedekind}
  Let \(\alpha \in \O_L\) be such that \(L = \Q(\alpha)\). Let \(f(x) \in \Z[x]\) be its minimal polynomial and let \(p\) be a prime integer such that \(p \ndivides [\O_L:\Z[\alpha]]\). Let \(\red f(x) = f(x) \pmod p\) and factor
  \[
    \red f(x) = \prod_{i = 1}^r \red g_i(x)^{e_i} \in \F_p[x]
  \]
  where \(\red g_1(x), \dots, \red g_r(x) \in \F_p[x]\) are distinct monic irreducible polynomials. Let \(g_i(x) \in \Z[x]\) be any polynomial with \(g_i(x) \pmod p = \red g_i(x)\), and define
  \[
    \mathfrak{p}_i = (p, g_i(\alpha)) \subseteq \O_L,
  \]
  an ideal of \(\O_L\). Let \(f_i = \deg \red g_i(x)\).

  Then \(\mathfrak{p}_1, \dots, \mathfrak{p}_r\) are disjoint prime ideals of \(\O_L\) and
  \begin{align*}
    p\O_L &= \prod_{i = 1}^r \mathfrak{p}^{e_i} \\
    \n(\mathfrak{p}_i) &= p^{f_i}
  \end{align*}
\end{theorem}

\begin{eg}
  Let \(L = \Q(\sqrt{-11})\) and \(p = 5\). As \(-11 = 1 \pmod 4\), \(\O_L = \Z[\frac{1 + \sqrt{-11}}{2}]\). Thus \(\Z[\sqrt{-11}] \subseteq \O_L\) has index \(2\) as an additive subgroup. Therefore we can apply Dedekind's criterion to \(\alpha = \sqrt{-11}\). \(f(x) = x^2 + 11\).
  \[
    \red f(x) = f(x) \pmod 5 = x^2 + 1 = (x + 2)(x + 3) \in \F_5[x]
  \]
  so \(5\O_L = \mathfrak p \mathfrak q\) where
  \begin{align*}
    \mathfrak p &= (5, \sqrt{-11} + 2) \\
    \mathfrak q &= (5, \sqrt{-11} + 3)
  \end{align*}
  and \(\mathfrak p, \mathfrak q\) are distinct prime ideals of \(\O_L\). Thus \(5\) splits completely in \(\Q(\sqrt{-11})\).
\end{eg}

\begin{proof}
  Recall that if \(R\) is a ring and \(I \subseteq R\) is an ideal, then there is a bijection
  \begin{align*}
    \{\text{ideals } J \subseteq R \text{ containing } I\} &\leftrightarrow \{\text{ideals } K \text{ of } R/I\} \\
    J &\mapsto J/I \subseteq R/I
  \end{align*}
  Furthermore there is an isomorphism
  \[
    R/J \cong (R/I)/(J/I).
  \]
  We have \(\Z[\alpha] \subseteq \O_L\) of finite index. Let \(A = \Z[\alpha], \varphi: A \embed \O_L\). By reduction mod \(p\), get a ring homomorphism
  \begin{align*}
    \red \varphi: A/pA &\to \O_L/p\O_L \\
    \beta + pA &\mapsto \beta + p\O_L
  \end{align*}
  Claim that \(\red \varphi\) is an isomorphism. Since both the domain and the codomain have the same cardinality \(p^{[L:\Q]}\), it suffices to show \(\red \varphi\) is surjective. Let \(N = [\O_L:\Z[\alpha]]\). We can find \(a, b \in \Z\) such that \(aN + bp = 1\). If \(\beta \in \O_L\) then \(N\beta \in \Z[\alpha]\) by Lagrange, and \(\beta = aN\beta + bp\beta\) so \(\red \varphi(aN\beta + pA) = \beta + p\O_L\).

  Therefore
  \begin{align*}
    \{\text{ideals in } \O_L \text{ containing } p\} &\leftrightarrow \{\text{ideals of } A/pA\} \\
    (p) \subseteq I &\leftrightarrow I \ni p
  \end{align*}
  We have
  \begin{align*}
    A = \Z[\alpha] &\cong \Z[x]/(f(x)) \\
    \alpha &\mapsfrom x
  \end{align*}
  Reduction mod \(p\) gives an isomorphism
  \[
    A/pA \cong \Z[x]/(p, f(x)) \cong \F_p[x]/(\red f(x)).
  \]
  We have \(\red f(x) = \prod_{i = 1}^r \red g_i(x)^{e_1}\), so there are homomorphisms
  \[
    \F_p[x]/(\red f(x)) \to \F_p[x]/(\red g_i(x))
  \]
  given by quotienting by the ideal \((\red g_i(x)) \supseteq (\red f(x))\).

  Define \(\mathfrak p_i \subseteq \O_L\) to be the ideal containing \(p\) such that \(\mathfrak p_i/(p)\) is the kernel of the ring homomorphism
  \[
    \begin{tikzcd}
    \O_L/p\O_L
    \ar[r, "\red \varphi^{-1}"]
    & A/pA
    \ar[r, "\cong"]
    & \F_p[x]/(\red f(x))
    \ar[r]
    & \F_p[x]/(\red g_i(x))
    \end{tikzcd}
  \]
  This ring homomorphism is surjective and its image is a field of cardinality \(p^{f_i}\). Hence \(\O_L/\mathfrak p_i\) is a finite field of cardinality \(p^{f_i}\) so \(\mathfrak p_i\) is a prime ideal of norm
  \[
    \n(\mathfrak p_i) = p^{f_i}.
  \]

  The \(\mathfrak p_i\)'s are distinct because their images in \(\O_L/p\O_L\) are distinct, as if \(i \neq j\) then \((\red g_i(x), \red g_j(x))\) is the unit ideal of \(\F_p[x]\). To show \(\mathfrak p_i = (p, g_i(x))\), it suffices to show \(\mathfrak p_i/(p) \subseteq \O_L/p\O_L\) is generated by \(\red g_i(\alpha)\).

  This is equivalent to showing
  \[
    \ker(\F_p[x]/(\red f(x)) \to \F_p[x]/(\red g_i(x))
  \]
  is generated by \(\red g_i(x)\). This is true by definition.

  It remains to show
  \[
    \mathfrak p_1^{e_1} \cdots \mathfrak p_r^{e_r} = p\O_L.
  \]
  \begin{align*}
    \mathfrak p_1^{e_1} \cdots \mathfrak p_r^{e_r}
    &= (p, g_1(\alpha))^{e_1} \cdots (p, g_r(\alpha))^{e_r} \\
    &\subseteq (p, g_1(\alpha)^{e_1}) \cdots (p, g_r(\alpha)^{e_r}) \\
    &\subseteq (p, g_1(\alpha)^{e_1} \cdots g_r(\alpha)^{e_r}) \\
    &= (p, f(\alpha)) \\
    &= (p)
  \end{align*}
  by noting that
  \[
    (x, y)^n = (x^n, x^{n - 1}y, \dots, y^n) \subseteq (x, y^n).
  \]
  Take norm,
  \begin{align*}
    \n(\mathfrak p_1^{e_q} \cdots \mathfrak p_r^{e_r})
    &= \prod_{i = 1}^r \n(\mathfrak p_i)^{e_i} \\
    &= p^{\sum_{i = 1}^re_if_i} \\
    &= p^{\deg f} \\
    &= p^{[L:\Q]} \\
    &= \n(p)
  \end{align*}
  so equality holds.
\end{proof}

One application is the classification of prime ideals in ring of integers of quadratic fields:

\begin{proposition}
  Let \(d\) be a square-free integer, \(d \neq 0, 1\), \(L = \Q(\sqrt d)\) and let \(p\) be a prime number. Then
  \begin{enumerate}
  \item if \(p\) is odd then
    \begin{enumerate}
    \item if \(p \divides d\), then \((p) = \mathfrak p^2\) so \(p\) ramifies in \(L\).
    \item if \(p \ndivides d\) and \(\legendre{d}{p} = 1\) then \((p) = \mathfrak p \mathfrak q\) so \(p\) splits completely in \(L\).
    \item if \(p \ndivides d\) and \(\legendre{d}{p} = -1\) then \((p)\) is prime and thus inert in \(L\).
    \end{enumerate}
  \item if \(p = 2\) then
    \begin{enumerate}
    \item if \(d = 2, 3 \pmod 4\) then \(2\) ramifies in \(L\).
    \item if \(d = 1 \pmod 8\) then \(2\) splits completely in \(L\).
    \item if \(d = 5 \pmod 8\) then \(2\) is inert in \(L\).
    \end{enumerate}
  \end{enumerate}
\end{proposition}

\begin{proof}
  The case for \(p\) odd is similar to the worked example above and is left as an exercise. We just do the case for \(p = 2\). If \(d = 2, 3 \pmod 4\) then \(\O_L = \Z[\sqrt d]\) so by Dedekind's criterion, we must factor \(x^2 - d \pmod 2\). But
  \[
    x^2 - d = (x - d)^2 \pmod 2.
  \]

  If \(d = 1 \pmod 4\) then \(\O_L = \Z[\frac{1 + \sqrt d}{2}]\) so we must factor \(x^2 - x + \frac{1 - d}{4} \pmod 2\). If \(d = 1 \pmod 8\) then
  \[
    x^2 + x = x(x + 1) \pmod 2.
  \]
  If \(d = 5 \pmod 8\) then the polynomial is irreducible.
\end{proof}

\section{Geometry of numbers}

\begin{definition}[Lattice]\index{lattice}
  If \(V\) is a finite-dimensional \(\R\)-vector space, then a \emph{lattice} in \(V\) is a subgroup of the form
  \[
    \Lambda = \bigoplus_{i = 1}^n \Z v_i
  \]
  where \(v_1, \dots, v_n\) is a basis of \(V\) as an \(\R\)-vector space.
\end{definition}

This is a generalisation of the ususal lattice \(\Z^n \subseteq \R^n\).

\begin{definition}[Covolume]\index{covolume}
  If \(V\) is a finite-dimensional real inner product space and \(\Lambda \subseteq V\) is a lattice, then the \emph{covolume} of \(\Lambda\) is
  \[
    A(\Lambda) = \vol\left( \left\{ \sum_{i = 1}^n t_iv_i: t_i \in [0, 1)\right\}\right)
  \]
  where \(\Lambda = \bigoplus_{i = 1}^n \Z v_i\).
\end{definition}

It is an exercise to check that it is independent of the choice of basis (that generate \(\Lambda\)).

We first consider only a fixed imaginary quadratic field \(L = \Q(\sqrt d)\) where \(d < 0\) is square-free. Let \(\sigma: L \to \C\) be a complex embedding. Our first observation is that \(\sigma(\O_L)\) is a lattice in \(\C\):
\begin{enumerate}
\item if \(d = 2, 3 \pmod 4\), then \(\sigma(\O_L) = \Z \oplus \Z\sqrt d\).
\item if \(d = 1 \pmod 4\), then \(\sigma(\O_L) = \Z \oplus \Z \frac{1 + \sqrt d}{2}\).
\end{enumerate}

More generally, if \(I \subseteq \O_L\) is a non-zero ideal then \(\sigma(I)\) is a lattice in \(\C\).

\begin{lemma}
  If \(I \subseteq \O_L\) is a non-zero ideal then
  \[
    A(I) = \frac{1}{2}\sqrt{|\disc(I)|} = \frac{\n(I)}{2}\sqrt{|D_L|}.
  \]
\end{lemma}

\begin{proof}
  Let \(\alpha_1, \alpha_2\) be an integral basis for \(I\). Then
  \[
    \sigma(I) = \Z\sigma(\alpha_1) \oplus \Z\sigma(\alpha_2).
  \]
  If \(\sigma\alpha_1 = x_1 + iy_1, \sigma\alpha_2 = x_2 + iy_2\) where \(x_i, y_i\)'s are real, then
  \[
    A(\sigma(I))
    = \left| \det
      \begin{pmatrix}
        x_1 & x_2 \\
        y_1 & y_2
      \end{pmatrix}
    \right|
  \]
  which is the area of the parallelogram spanned by the two vectors. Also by definition,
  \begin{align*}
    \disc(I)
    &= \det
    \begin{pmatrix}
      x_1 + iy_1 & x_2 + iy_2 \\
      x_1 - iy_1 & x_2 - iy_2
    \end{pmatrix}
    ^2 \\
    &= \det
    \begin{pmatrix}
      x_1 + iy_1 & x_2 + iy_2 \\
      2x_1 & 2x_2
    \end{pmatrix}
    ^2 \\
    &= (2i)^2 \det
    \begin{pmatrix}
      y_1 & y_2 \\
      x_1 & x_2
    \end{pmatrix}
    ^2
  \end{align*}
\end{proof}

To demonstrate how to actually compute and use covolume, we state a theorem whose general version will be proved later:

\begin{theorem}[Special case of Minkowski's theorem]
  Let \(\Lambda \subseteq \R^2\) be a lattice and let \(S = D(0, r) \subseteq \R^2\) be the closed disk of radius \(r\). Then if \(\operatorname{area}(S) \geq 4A(\Lambda)\) then there exists \(\lambda \in \Lambda \setminus \{0\}\) such that \(\lambda \in S\).
\end{theorem}

The surprising thing about this theorem is that it is independent of the shape of the lattice.

In particular, there exists \(\lambda \in  \Lambda \setminus \{0\}\) such that
\[
  |\lambda|^2 \leq \frac{4}{\pi} A(\Lambda).
\]

\begin{corollary}
  If \(I \subseteq \O_L\) is a non-zero ideal then there exists \(\alpha \in I \setminus \{0\}\) such that
  \[
    \n(\alpha) \leq c_L \n(I)
  \]
  where \(c_L = \frac{2}{\pi}\sqrt{|D_L|}\).
\end{corollary}

\begin{proof}
  We apply the theorem to \(\sigma(I) \subseteq \C\) to get there exists \(\lambda \in \sigma(I) \setminus \{0\}\) such that
  \[
    |\lambda|^2 \leq \frac{4}{\pi} \frac{\n(I)}{2} \sqrt{|D_L|} = c_L \n(I).
  \]
  If \(\alpha \in I\) is such that \(\sigma(\alpha) = \lambda\) then
  \[
    \n(\alpha)
    = \sigma(\alpha) \conj{\sigma(\alpha)}
    = |\sigma(\alpha)|^2
    = |\lambda|^2.
  \]
\end{proof}

\begin{corollary}
  If \([I] \in \Cl(\O_L)\) then there exist \(J \in [I]\) such that
  \[
    \n(J) \leq c_L.
  \]
\end{corollary}

\begin{proof}
  Choose \(K \in [I]^{-1}\) such that \(IK\) is principal. Apply the previous corollary to find \(\alpha \in K \setminus \{0\}\) such that
  \[
    \n(\alpha) \leq c_L \n(K).
  \]
  As \((\alpha) \subseteq K\), \(K \divides (\alpha)\) so there exist \(J \subseteq \O_L\) non-zero such that \(JK = (\alpha)\). Then done since \([J] = [K]^{-1} = [I]\) and
  \[
    \n(J) = \frac{\n(\alpha)}{\n(K)} \leq c_L.
  \]
\end{proof}

Finally we can prove our first result in algebraic number theory:

\begin{theorem}
  The group \(\Cl(\O_L)\) is finite.
\end{theorem}

In fact, we will later prove that this is true for any number field \(L\).

\begin{proof}
  We've shown that every class \([I] \in \Cl(\O_L)\) has a representative of norm \(\leq c_L\). Thus suffices to show that for every \(m \in \Z, m \geq 1\), the number of ideals \(I \subseteq \O_L\) of norm \(\n(I) = m\) is finite.

  If \(\n(I) = m\) then \([\O_L:I] = m\) so by Lagrange \(m \in I\). Thus \(I\) comes from an ideal of the finite ring \(\O_L/m\O_L\).
\end{proof}

\begin{note}
  We see \(\Cl(\O_L)\) is generated by ideal classes \([\mathfrak p]\) where \(\mathfrak p \subseteq \O_L\) is a non-zero prime ideal of norm \(\n(\mathfrak p) \leq c_L\). To see this, any class has the form \([I]\) where \(\n(I) \leq c_L\). If \(I = \prod_{i = 1}^r \mathfrak p_i^{e_i}\) then
  \begin{align*}
    [I] &= \prod_{i = 1}^r [\mathfrak p_i]^{e_i} \\
    \n(I) &= \prod_{i = 1}^r \n(\mathfrak p_i)^{e_i}
  \end{align*}
  Thus \(\n(\mathfrak p_i) \leq \n(I) \leq c_L\).
\end{note}

\begin{eg}\leavevmode
  \begin{enumerate}
  \item \(d = -7\). As \(d = 1 \pmod 4\), \(D_L = d\) based on our results in previous chapters. Thus
    \[
      c_L = \frac{2}{\pi} \sqrt 7 < \frac{2}{3} \sqrt 7 < 2
    \]
    so \(\Cl(\O_L)\) is generated by ideals of norm \(< 2\). There are none except \(\O_L\). Thus \(\Cl(\O_L)\) is trivial. Hence \(\O_L = \Z[\frac{1 + \sqrt{-7}}{2}]\) is a UFD.
  \item \(d = -5\). We already knew this is not a UFD. \(D_L = 4d\) so
    \[
      c_L = \frac{2}{\pi}\sqrt{20} = \frac{4}{\pi}\sqrt 5 < \frac{4}{3} \sqrt 5 < 3
    \]
    so \(\Cl(\O_L)\) is generated by prime ideals \(\mathfrak p \subseteq \O_L\) of norm \(\n(\mathfrak p) = 2\). We know by Dedekind's criterion that \(2\O_L = \mathfrak p^2\). Thus \(\Cl(\O_L)\) is generated by \([\mathfrak p]\) and \([\mathfrak p]^2 = [2\O_L] = [\O_L]\) is the trivial class. Hence there are two possibilities:
    \begin{enumerate}
    \item if \(\mathfrak p\) is principal then \(\Cl(\O_L)\) is trivial.
    \item if \(\mathfrak p\) is not principal then \(\Cl(\O_L) \cong \Z/2\Z\).
    \end{enumerate}
    But we already knew that \(\O_L\) is not a UFD so \(\Cl(\O_L)\) is not trivial so must have
    \[
      \Cl(\O_L) \cong \Z/2\Z.
    \]
  \end{enumerate}
\end{eg}

Having a grasp of the tools we have, we will now move on to a general number field \(L\).

First we have a theorem that does not necessarily have any relation with number fields:

\begin{theorem}[Minkowski]\index{Minkowski's theorem}
  \label{thm:Minkowski}
  Let \(\Lambda \subseteq \R^n\) be a lattice and let \(E \subseteq \R^n\) be a measurable subset which is convex and centrally symmetric, i.e.\ \(E = -E = \{x \in \R^n: -x \in E\}\). Then
  \begin{enumerate}
  \item if \(\vol(E) > 2^n A(\Lambda)\), then there exists \(\lambda \in \Lambda \setminus \{0\}\) such that \(\lambda \in E\).
  \item if \(\vol(E) \geq 2^n A(\Lambda)\) and \(E\) is compact, then there exists \(\lambda \in \Lambda \setminus \{0\}\) such that \(\lambda \in E\).
  \end{enumerate}
\end{theorem}

Note that the special case we used above corresponds to \(n = 2\) and \(E\) closed disk.

\begin{proof}
  Let \(\Lambda = \bigoplus_{i = 1}^n \Z v_i, P = \left\{ \sum_{i = 1}^n t_iv_i: t_i \in [0, 1) \right\}\). Then \(\vol(P) = A(\Lambda)\) and \(\R^n = \bigcup_{\lambda \in \Lambda} (P + \lambda)\). Then
  \begin{enumerate}
  \item
    \begin{align*}
      \vol(P)
      &< \frac{1}{2^n} \vol(E) \\
      &= \vol(\frac{1}{2}E) \\
      &= \sum_{\lambda \in \Lambda} \vol(\frac{1}{2}E \cap (\lambda + P)) \\
      &= \sum_{\lambda \in \Lambda} \vol((\frac{1}{2}E - \lambda) \cap P)
    \end{align*}
    Claim that there exists \(\lambda, \mu \in \Lambda\) distinct such that \((\frac{1}{2}E - \lambda) \cap (\frac{1}{2}E - \mu)\) is non-empty: if not, the sets \(\frac{1}{2}E - \lambda\) are pariwise disjoint so
    \[
      \vol(P) < \sum_{\lambda \in \Lambda} \vol((\frac{1}{2}E - \lambda) \cap P) \leq \vol(P),
    \]
    absurd. Hence there exists \(z, w \in E\) such that \(\frac{z}{2} - \lambda = \frac{w}{2} - \mu\). Thus
    \[
      \lambda - \mu = \frac{z}{2} - \frac{w}{2} = \frac{z}{2} + \frac{-w}{2}.
    \]
    As \(E\) is centrally symmetric, \(-w \in E\). Finally as \(E\) is convex, \(\frac{z}{2} + \frac{-w}{2} \in E\). Thus \(\lambda - \mu \in (\Lambda \setminus \{0\}) \cap E\).
  \item Given the further assumption that \(E\) is compact, \(E\) is closed and bounded. \(\vol(E) \geq 2^n A(\Lambda)\) implies that for \(m \geq 1\)
    \[
      \vol((1 + \frac{1}{m})E) > 2^n A(\Lambda).
    \]
    By 1, for all \(m \in \N\) there exists \(\lambda_m \in (\Lambda \setminus \{0\}) \cap ((1 + \frac{1}{m})E)\). \((1 + \frac{1}{m}) E \subseteq 2E\) and \(2E \cap \Lambda\) is finite as \(2E\) is bounded. By pigenhole principle, we can assume there exists \(\lambda \in \Lambda \setminus \{0\}\) such that \(\lambda_m = \lambda\) for all \(m \geq 1\). \(E\) is closed and \(\lambda \in (1 + \frac{1}{m})E\) for all \(m \geq 1\). Thus \(\lambda \in E\).
  \end{enumerate}
\end{proof}

Now let \(L\) be a number field. Let \(n = [L:\Q]\) and \(\tau_1, \dots, \tau_r: L \to \R\) be real embeddings of \(L\) and \(\sigma_1, \conj \sigma_1, \dots, \sigma_s, \conj \sigma_s: L \to \R\) be complex embeddings. We have \(n = r + 2s\).

Define a map
\begin{align*}
  S: L &\to \R^r \times \C^s \\
  \alpha &\mapsto (\tau_1(\alpha), \dots, \tau_r(\alpha), \sigma_1(\alpha), \dots, \sigma_s(\alpha))
\end{align*}
This is a homomorphism of additive groups.

\begin{lemma}
  If \(I \subseteq \O_L\) is a non-zero ideal then \(S(I)\) is a lattice.
\end{lemma}

\begin{proof}
  Let \(\alpha_1, \dots,\alpha_n\) be an integral basis of \(I\). Then
  \[
    S(I) = \bigoplus_{i = 1}^n \Z S(\alpha_i)
  \]
  and \(\R^r \times \C^s\) is an \(n\)-dimensional \(\R\)-vector space. So we must show that \(S(\alpha_1), \dots, S(\alpha_n)\) are independent, or equivalently that
  \[
    \det
    \begin{pmatrix}
      \tau_1(\alpha_1) & \cdots & \tau_1(\alpha_n) \\
      \vdots & & \vdots \\
      \tau_r(\alpha_1) & \cdots & \tau_r(\alpha_n) \\
      \Re \sigma_1(\alpha_1) & \cdots & \Re \sigma_1(\alpha_n) \\
      \Im \sigma_1(\alpha_1) & \cdots & \Im \sigma_1(\alpha_n) \\
      \vdots & & \vdots \\
      \Re \sigma_s(\alpha_1) & \cdots & \Re \sigma_s(\alpha_n) \\
      \Re \sigma_s(\alpha_1) & \cdots & \Re \sigma_s(\alpha_n) \\
    \end{pmatrix}
    \neq 0.
  \]
  Note that for \(z \in \C\), we have
  \[
    \begin{pmatrix}
      z \\
      \conj z
    \end{pmatrix}
    =
    \begin{pmatrix}
      1 & i \\
      1 & -i
    \end{pmatrix}
    \begin{pmatrix}
      \Re z \\
      \Im z
    \end{pmatrix}
    .
  \]
  So this determinant equals to
  \[
    \left( \frac{1}{-2i} \right)^s \det
    \begin{pmatrix}
      \tau_1(\alpha_1) & \cdots & \tau_1(\alpha_n) \\
      \vdots & & \vdots \\
      \tau_r(\alpha_1) & \cdots & \tau_r(\alpha_n) \\
      \sigma_1(\alpha_1) & \cdots & \sigma_1(\alpha_n) \\
      \conj \sigma_1(\alpha_1) & \cdots & \conj \sigma_1(\alpha_n) \\
      \vdots & & \vdots \\
      \sigma_s(\alpha_1) & \cdots & \sigma_s(\alpha_n) \\
      \conj \sigma_s(\alpha_1) & \cdots & \conj \sigma_s(\alpha_n) \\
    \end{pmatrix}
    \neq 0
  \]
  as \(\disc(I) \neq 0\).
\end{proof}

\begin{lemma}
  If \(I \subseteq \O_L\) is a non-zero ideal, then
  \[
    A(S(I)) = \frac{1}{2^s} \sqrt{|\disc(I)|} = \frac{\n(I)}{2^s} \sqrt{|D_L|}.
  \]
\end{lemma}

\begin{proof}
  Same calculation with determninants as before.
\end{proof}

\begin{proposition}
  If \(I \subseteq \O_L\) is a non-zero ideal then there exists \(\alpha \in I \setminus \{0\}\) such that
  \[
    \n(\alpha) \leq c_L \n(I)
  \]
  where
  \[
    c_L = \left( \frac{4}{\pi} \right)^s \frac{n!}{n^n} \sqrt{|D_L|}.
  \]
\end{proposition}

\begin{definition}[Minkowski constant]\index{Minkowski constant}
  \(c_L\) above is called the \emph{Minkowski constant} of \(L\).
\end{definition}

\begin{proof}
  Apply \nameref{thm:Minkowski} to the lattice \(S(I)\) and the region, which might not be the most intuitive choice,
  \[
    B_{r, s}(t) = \left\{ (\V x, \V z) \in \R^r \times \C^s: \sum_{i = 1}^r |x_i| + 2 \sum_{i = 1}^s |z_i| \leq t \right\}.
  \]
  Check that it is convex, centrally symmetric and compact. If
  \[
    \vol(B_{r, s}(t)) \geq 2^n A(S(I))
  \]
  then there exists \(\alpha \in I \setminus \{0\}\) such that \(S(\alpha) \in B_{r, s}(t)\).

  Now we use AM-GM inequality to bound \(\n(\alpha)\):
  \begin{align*}
    \n(\alpha)^{1/n}
    &= \left( \prod_{i = 1}^r |\tau_i(\alpha)| \prod_{i = 1}^s |\sigma_i(\alpha)|^2 \right)^{1/n} \\
    &\leq \frac{1}{n} \left( \sum_{i = 1}^r |\tau_i(\alpha)| + 2 \sum_{i = 1}^s |\sigma_i(\alpha)| \right) \\
    &\leq \frac{t}{n}
  \end{align*}
  and therefore \(\n(\alpha) \leq \frac{t^n}{n^n}\). To get the optimal bound, choose \(t\) so that
  \[
    \vol(B_{r, s}(t)) = 2^nA(S(I)).
  \]
  It is an elementary exercise to show that
  \[
    \vol(B_{r, s}(t)) = 2^r \left( \frac{\pi}{2} \right)^s \frac{t^n}{n!}
  \]
  by induction on \(r\) and \(s\). Thus
  \[
    2^r \left( \frac{\pi}{2} \right)^s \frac{t^n}{n!} = 2^n A(S(I)) = 2^{r + s} \n(I) \sqrt{|D_L|}.
  \]
  Rearrange,
  \[
    \n(\alpha) \leq \frac{t^n}{n^n} = c_L \n(I).
  \]
\end{proof}

Similar corollaries:

\begin{corollary}
  For any class \([I] \in \Cl(\O_L)\), there exists \(J \in [I]\) such that
  \[
    \n(J) \leq c_L.
  \]
\end{corollary}

\begin{corollary}
  The group \(\Cl(\O_L)\) is finite and generated by \([\mathfrak{p}]\) where \(\mathfrak{p}\) is a prime ideal of norm \(\n(\mathfrak{p}) \leq c_L\).
\end{corollary}

\begin{proof}
  Exactly the same as before.
\end{proof}

\begin{remark}
  In practice, the Minkowski constant is a very effective bound.
\end{remark}

\begin{eg}\leavevmode
  Let \(f(x) = x^5 - x + 1\). This is irreducible modulo \(5\), so over \(\Q\). Let \(L = \Q(\alpha)\) where \(\alpha\) is a root of \(f(x)\). In this case \(r = 1, s = 2\). The discrimiant is
  \[
    \disc f = 2869 = 19 \cdot 151
  \]
  which is square-free. Thus \(\O_L = \Z[\alpha]\) and \(D_L = \disc f\). Thus
  \[
    c_L = \left( \frac{4}{\pi} \right)^2 \frac{5!}{5^5} \sqrt{2869} < 4.
  \]
  Hence \(\Cl(\O_L)\) is generated by prime ideals \(\mathfrak{p}\) of norm \(\n(\mathfrak{p}) = 2\) or \(3\). But by \nameref{thm:Dedekind}, such primes exists if and only if \(f(x)\) has a root in \(\F_2\) or \(\F_3\). In this case there are not such roots so \(\Cl(\O_L)\) is trivial so \(\Z[\alpha]\) is a UFD.
\end{eg}

\begin{eg}
  Let \(L = \Q(\sqrt{10})\). Then
  \[
    c_L = \frac{1}{2} \sqrt{4 \cdot 10} = \sqrt{10} < 4.
  \]
  Thus \(\Cl(\O_L)\) is generated by \([\mathfrak{p}]\) where \(\n(\mathfrak{p}) = 2\) or \(3\). By Dedekind's criterion,
  \begin{align*}
    (2) &= \mathfrak p_2^2 \\
    (3) &= \mathfrak p_3 \mathfrak p_3'
  \end{align*}
  where
  \begin{align*}
    \mathfrak p_2 &= (2, \sqrt{10}) \\
    \mathfrak p_3 &= (3, 1 + \sqrt{10}) \\
    \mathfrak p_3' &= (3, 1 - \sqrt{10})
  \end{align*}
  To find relations in \(\Cl(\O_L)\), we can calculate the norm. For example,
  \[
    \n(2 + \sqrt{10}) = |4 - 10| = 6
  \]
  so
  \[
    (2 + \sqrt{10}) = \mathfrak p_2 \mathfrak p_3 \text{ or } \mathfrak p_2 \mathfrak p_3'.
  \]
  In either case we see that \([\mathfrak p_2]\) generates \(\Cl(\O_L)\) so \(\Cl(\O_L)\) is either trivial or isomorphic to \(\Z/2\Z\), with the second case occurring if and only if \(\mathfrak p_2\) is not principal. \(\mathfrak p_2\) is principal if and only if there exists \(a + b \sqrt{10} \in \O_L\) such that \((a + b \sqrt{10}) = \mathfrak p_2\). Taking norm,
  \[
    a^2 - 10b^2 = \pm 2.
  \]
  Reduce modulo \(5\), neither \(2\) or \(-2\) is a quadratic residue. Absurd. Thus \(\mathfrak p_2\) is not principal and
  \[
    \Cl(\O_L) \cong \Z/2\Z.
  \]
\end{eg}

\begin{eg}
  Let \(L = \Q(\sqrt{-17})\). Then
  \[
    c_L = \frac{4}{\pi} \cdot \frac{1}{2} \cdot \sqrt{4 \cdot 17} = \frac{4}{\pi} \sqrt{17} < \frac{4}{3} \sqrt{17} < 6
  \]
  So \(\Cl(\O_L)\) is generated by primes of norm \(2, 3\) or \(5\).

  By Dedekind's criterion,
  \begin{itemize}
  \item \(x^2 + 17 = x^2 + 2 \pmod 5\) so \((5)\) is prime of norm \(25\).
  \item \(x^2 + 17 = x^2 - 1 \pmod 3\) so
    \[
      (3) = \mathfrak q_3 \mathfrak q_3'
    \]
    where
    \begin{align*}
      \mathfrak q_3 &= (3, 1 + \sqrt{-17}) \\
      \mathfrak q_3' &= (3, 1 - \sqrt{-17})
    \end{align*}
  \item \(x^2 + 17 = (x + 1)^2 \pmod 2\) so
    \[
      (2) = \mathfrak q_2^2
    \]
    where
    \[
      \mathfrak q_2 = (2, 1 + \sqrt{-17}).
    \]
  \end{itemize}
  Now compute, for example, the norm
  \[
    \n(1 + \sqrt{-17}) = 18 = 2 \cdot 3^2.
  \]
  Note that \(1 + \sqrt{-17} \in \mathfrak q_3\) so \(\mathfrak q_3 \divides (1 + \sqrt{-17})\). So we must have one of
  \begin{align*}
    (1 + \sqrt{-17}) &= \mathfrak q_2 \mathfrak q_3 \mathfrak q_3' \\
    (1 + \sqrt{-17}) &= \mathfrak q_2 \mathfrak q_3^2
  \end{align*}
  Note that they result in different structures of \(\Cl(\O_L)\). To decide between these, we compute
  \begin{align*}
    \mathfrak q_3^2
    &= (9, 3 + 3 \sqrt{-17}, (1 + \sqrt{-17})^2) \\
    &= (9, 3 + 3 \sqrt{-17}, -16 + 2 \sqrt{-17}) \\
    &= (9, 3 + 3 \sqrt{-17}, 2 + 2 \sqrt{-17}) \\
    &= (9, 1 + \sqrt{-17})
  \end{align*}
  We see \(1 + \sqrt{-17} \in \mathfrak q_3^2\) so we have \((1 + \sqrt{-17}) = \mathfrak q_2 \mathfrak q_3^2\).\footnote{In this specific case, one can take a shortcut by noting that \(\mathfrak q_3 \mathfrak q_3' = (3)\) which does not divide \((1 + \sqrt{-17})\).}

  We see \([\mathfrak q_3]\) generates \(\Cl(\O_L)\) and if \(\mathfrak q_2\) is not principal then \(\Cl(\O_L) \cong \Z/4\Z\). But \(\mathfrak q_2\) is principal if and only if we can solve
  \[
    a^2 + 17b^2 = 2
  \]
  in \(\Z\). This is impossible so
  \[
    \Cl(\O_L) \cong \Z/4\Z.
  \]
\end{eg}

\begin{remark}
  There are many open questions about ideal class groups, even for quadratic fields.
  \begin{itemize}
  \item We know: \(|\Cl(\O_{\Q(\sqrt d)})| \to \infty\) as \(d \to -\infty\) through square-free integers. In particular, there are only finitely many imaginary quadratic fields of given cardinality. For example, there are exactly \(9\) imaginary quadratic fields with trivial ideal class group. See example sheet for the existence (the uniqueness part is much more difficult).
  \item We don't know: are there infinitely many real quadratic fields of trivial ideal class group?
  \item Cohen-Lenstra heuristics: let \(p\) be an odd prime and \(A\) be a finite abelian group of \(p\)-power order. Then for \(d < 0\) square-free, conjecture that
    \[
      \prob(\Cl(\O_{\Q(\sqrt d)})_p \cong A) = \frac{\prod_{i = 1}^\infty (1 - \frac{1}{p^i})}{|\aut(A)|}.
      \]
      where for a finite abelian group \(M\), \(M_p\) is the (unique) \(p\)-Sylow subgroup and the probability on LHS is defined to be
      \[
        \lim_{x \to \infty} \frac{|\{ d < 0: |d| < x, d \text{ square-free}, \Cl(\O_{\Q(\sqrt d)})_p \cong A \}|}{|\{ d < 0: |d| < x, d \text{ square-free} \}|}.
      \]
  \end{itemize}
\end{remark}

\section{Dirichlet's unit theorem}

Let \(L\) be a number field of degree \(n\) and Let \(\tau_1, \dots, \tau_r: L \to \R\) be real embeddedings, \(\sigma_1, \dots, \sigma_s, \conj \sigma_1, \dots, \conj \sigma_s: L \to \C\) be distinct complex embeddings.

\begin{theorem}[Dirichlet's unit theorem]\index{Dirichlet's unit theorem}
  \label{thm:Dirichlet unit}
  There is an isomorphism
  \[
    \O_L^\times \cong \mu_L \times \Z^{r + s - 1}
  \]
  where \(\mu_L \subseteq \O_L^\times\) is the finite cyclic group of roots of unity in \(\O_L^\times\).
\end{theorem}

In fact, the proof shows more: define a map \(\ell: \O_L^\times \to \R^{r + s}\) by
\[
  \alpha \mapsto (\log |\tau_1(\alpha)|, \dots, \log |\tau_r(\alpha)|, 2\log |\sigma_1(\alpha)|, \dots, 2\log |\sigma_s(\alpha)|).
\]
Then this is a homomorphism of abelian groups, and \(\ell(\O_L^\times)\) is contained in the hyperplane
\[
  H = \{ \V x \in \R^{r + s}: \sum_{i = 1}^{r + s} x_i = 0\} \subseteq \R^{r + s}.
\]
This implies that if \(\alpha \in \O_L^\times\) then
\[
  \log \n(\alpha) = \sum_{i = 1}^r \log |\tau_i(\alpha)| + 2 \sum_{i = 1}^s \log |\sigma_i(\alpha)| = 0.
\]

The proof of the theorem will show \(\ell(\O_L^\times)\) is a lattice in \(H\).

\begin{eg}
  \(\O_L^\times\) is finite if and only if \(r + s = 1\), i.e.
  \begin{itemize}
  \item \(r = 1, s = 0\), so \(L = \Q\). 
  \item \(r = 0, s = 1\), so \(L = \Q(\sqrt d)\) where \(d < 0\) is square-free.
  \end{itemize}
  The first case where \(\O_L^\times\) is infinite is \(L = \Q(\sqrt d)\), \(d > 0\) square-free. Then \(r + s - 1 = 1\), so \(\ell(\O_L^\times)\) is infinite cyclic. Fix \(\sigma: \Q(\sqrt d) \to \R\) to be the real embedding with \(\sigma(\sqrt d) > 0\). \(\sigma(\mu_L) \subseteq \R^\times\) so \(\mu_L = \{\pm 1\}\). In this case we can consider the map
  \begin{align*}
    \ell': \O_L^\times &\to \R \\
    \alpha &\mapsto \log |\sigma(\alpha)|
  \end{align*}
  We know that \(\ell'(\O_L^\times) \subseteq \R\) is a lattice. In particular, there is a unique characterised unit \(\alpha \in \O_L^\times\) satisfying \(\sigma(\alpha) > 0, \log |\sigma(\alpha)| > 0\) and as small as possible. In other words, \(\alpha \in \O_L^\times\) is the unit for which \(\sigma(\alpha) > 1\) and \(\sigma(\alpha)\) is minimal with respect to this property. We call \(\alpha \) the \emph{fundamental unit}\index{fundamental unit} of \(L = \Q(\sqrt d)\). Then we have
  \[
    \O_L^\times = \{\pm \alpha^n: n \in \Z\}.
  \]
\end{eg}

How to find fundamental units?

\begin{lemma}\leavevmode
  \begin{enumerate}
  \item If \(d = 2, 3 \pmod 4\) and \(v \in \O_L^\times\) satisfies \(v > 1\), then
    \[
      v = a + b \sqrt d
    \]
    where \(a \geq b \geq 1\).
  \item If \(d = 1 \pmod 4\) and \(v \in \O_L^\times\) satisfies \(v > 1\), then
    \[
      v = \frac{1}{2}(a + b\sqrt d)
    \]
    where \(a \geq b \geq 1\).
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Let \(v' = a - b \sqrt d\). Then
    \[
      vv' = a^2 - db^2 = \n_{L/\Q}(v) = \pm 1
    \]
    so \(v > 1\) implies that \(|v'| < 1\). Hence
    \begin{align*}
      v + v' &= 2a > 0 \\
      v - v' &= 2b \sqrt d > 0
    \end{align*}
    As \(a, b\) are integers, we must have \(a \geq 1, b \geq 1\). Also
    \[
      \left( \frac{a}{b} \right)^2 = d \pm \frac{1}{b^2} \geq 1
    \]
    as \(d \geq 2\).
  \item Let \(v' = \frac{1}{2}(a - b\sqrt d)\). Then \(vv' = \pm 1\) and \(a^2 - db^2 = \pm 4\). Then
    \begin{align*}
      v + v' &= a > 0 \\
      v - v' &= b\sqrt d > 0
    \end{align*}
    so \(a \geq 1, b \geq 1\). Also
    \[
      \left( \frac{a}{b} \right)^2 = d \pm \frac{4}{b^2} \geq 1
    \]
    as \(d \geq 5\).
  \end{enumerate}
\end{proof}

We can use this to find the fundamental unit in a quadratic field \(\Q(\sqrt d)\) where \(d \in \Z\) is positive square-free.
\begin{enumerate}
\item \(d = 2, 3 \pmod 4\): let \(u = a + b \sqrt d\). Let \(u^k = a_k + b_k \sqrt d\). Then we have the relation
  \begin{align*}
    u^{k + 1}
    &= u \cdot u^k \\
    &= (a_1 + b_1 \sqrt d)(a_k + b_k \sqrt d) \\
    &= (a_1a_k + d b_1b_k) + (b_1a_k + a_1b_k) \sqrt d
  \end{align*}
  Hence
  \[
    b_{k + 1} = b_1a_k + a_1b_k > b_k
  \]
  so the sequence \((b_k)_{k \in \N}\) is strictly increasing.

  We can therefore characterise \(u\) as follow: let \(b \in \N\) be the least positive integer such that \(db^2 + 1\) or \(db^2 - 1\) is of the form \(a^2\) for some \(a \in \N\). Then \(u = a + b \sqrt d\).

\item \(d = 1 \pmod 4\): let \(u = \frac{1}{2}(a + b \sqrt d)\). Let \(u^k = \frac{1}{2}(a_k + b_k\sqrt d)\). Then
  \[
    b_{k + 1} = \frac{1}{2}(a_1b_k + b_1 a_k) \geq \frac{1}{2} (a_1 + b_1)b_k \geq b_k.
  \]
  We see \(b_{k + 1} \geq b_k\), with equality if and only if \(a_k = b_k\) and \(a_1 = b_1 = 1\). Note that if \(a_1 = b_1 = 1\) then
  \[
    \n(u) = \left| \frac{1 - d}{4} \right| = 1
  \]
  so \(d = 5\).
  \begin{enumerate}
  \item \(d > 5\): the sequence \((b_k)_{k \in \N}\) is strictly increasing. The fundamental unit can therefore be found as follow: let \(b \in \N\) be the least integer such that \(db^2 + 4\) or \(db^2 - 4\) is of the form \(a^2\) for some \(a \in \N\). Then \(\frac{1}{2}(a + b\sqrt d)\) is the fundamental unit.

  \item \(d = 5\): the sequence \((b_k)_{k \in \N}\) is non-decreasing and each value \(b_i\) can appear at most twice (as occurrence corresponds to solutions to \(db_i^2 \pm 4 = a_i^2\)). We can therefore characterise the fundamental unit \(u\) as follow: let \(b \in \N\) be the least positive integer for which \(db^2 + 4 = a^2\) or \(db^2 - 4 = a'^2\) for \(a, a' \in \N\). Recall that the fundamental unit is the least unit with \(u > 1\). Of these two possibilities, choose the unit with the smaller value of \(a\) or \(a'\). In this case, \(b = 1\) gives \(d + 4 = 3^2, d - 4 = 1^2\) so \(\frac{1}{2} (1 + \sqrt 5)\) is the fundamental unit.
  \end{enumerate}
\end{enumerate}

\begin{eg}\leavevmode
  \begin{enumerate}
  \item \(d = 2\). Then \(b = 1\) works since \(2 - 1 = 1^2\) so \(1 + \sqrt 2\) is a fundamental unit.
  \item \(d = 7\).
    \begin{align*}
      & b = 1: 7 \pm 1 \text{ not a square} \\
      & b = 2: 4 \cdot 7 \pm 1 \text{ not a square} \\
      & b = 3: 9 \cdot 7 + 1 = 8^2
    \end{align*}
    so \(8 + 3 \sqrt 7\) is a fundamental unit.
  \end{enumerate}
\end{eg}

\begin{note}
  This procedure is not always efficient. For example, the fundamental unit in \(\Q(\sqrt{22})\) is \(197 + 42\sqrt{22}\). There is a more efficient algorithm which uses continued fraction, but it is not discussed in this course.
\end{note}

Now we start the proof of \nameref{thm:Dirichlet unit}, which in non-examinable.

\begin{proof}[Proof of \nameref{thm:Dirichlet unit}]
  Recall the setup: let \(L\) be a number field, \(\tau_1, \dots, \tau_r: L \to \R\) are the real embeddings and \(\sigma_1, \conj \sigma_1, \dots, \sigma_s, \conj \sigma_s: L \to \C\) are the complex embeddings of \(L\). Define a map \(\ell: \O_L^\times \to \R^{r + s}\) by
  \[
    \alpha \mapsto (\log |\tau_1(\alpha)|, \dots, \log |\tau_r(\alpha)|, 2\log |\sigma_1(\alpha)|, \dots, 2\log |\sigma_s(\alpha)|).
  \]
  The image is contained inside the subspace
  \[
    H = \{ \V x \in \R^{r + s}: \sum_{i = 1}^{r + s} x_i = 0\}.
  \]

  \begin{lemma}
    Extend \(\ell\) to \(\O_L\). Let \(\alpha \in \O_L \setminus \{0\}\) such that \(\ell(\alpha) = (a_1, \dots, a_{r + s})\). Fix an integer \(1 \leq k \leq r + s\). Then there exists \(\beta \in \O_L \setminus \{0\}\) such that if \(\ell(\beta) = (b_1, \dots, b_{r + s}) \in \R^{r + s}\) then \(b_i < a_i\) if \(i \neq k\). Moreover,
    \[
      \n(\beta) \leq \left( \frac{2}{\pi} \right)^s \sqrt{|D_L|}.
    \]
  \end{lemma}

  \begin{proof}
    This proof is similar to the derivation of Minkowski constant but using a slightly different convex body. Let \(c_1, \dots, c_{r + s} \in \R_{> 0}\) and let
    \[
      E = \{(\V x, \V z) \in \R^r \times \C^s: |x_i| \leq c_i, |z_i|^2 \leq c_{r + i}\}.
    \]
    Then if \(\vol(E) \geq 2^{r + 2s} A(S(\O_L)) = 2^{r + s} \sqrt{|D_L|}\), then by \nameref{thm:Minkowski} there exists \(\beta \in \O_L \setminus \{0\}\) such that \(S(\beta) \in E\). In particular,
    \[
      \n(\beta) = \prod_{i = 1}^r |\tau_i(\beta)| \prod_{i = 1}^s |\sigma_i(\beta)|^2 \leq \prod_{i = 1}^{r + s} c_i.
    \]
    We choose \(c_i\) so that \(0 < c_i < e^{a_i}\) if \(i \neq k\) and
    \[
      \vol(E) = \pi^s 2^r \prod_{i = 1}^{r + s} c_i = 2^{r + s} \sqrt{|D_L|}.
    \]
    The first property gives \(b_i < a_i\) if \(i \neq k\) while the second gives
    \[
      \n(\beta) \leq \prod_{i = 1}^{r + s} c_i = \left( \frac{2}{\pi} \right)^s \sqrt{|D_L|}.
    \]
  \end{proof}

  \begin{corollary}
    \label{cor:Dirichlet corollary 2}
    Fix an integer \(1 \leq k \leq r + s\). Then there exists \(\varepsilon \in \O_L^\times\) such that if \(\ell(\varepsilon) = (a_1, \dots, a_{r + s})\) then \(a_i < 0\) if \(i \neq k\) and \(a_k > 0\).
  \end{corollary}

  \begin{proof}
    By the lemma we can find elements \(\alpha_1, \alpha_2, \dots \in \O_L \setminus \{0\}\) such that
    \[
      \n(\alpha_i) \leq \left( \frac{2}{\pi} \right)^s \sqrt{|D_L|}
    \]
    for all \(i \in \N\) and if \(\ell(\alpha_i) = (b_{i, 1}, \dots, b_{i, r + s})\) then \(b_{i + 1, j} < b_{i, j}\) if  \(j \neq k\) for all \(i \geq 1\). The ideals \((\alpha_i)\) have bounded norm, so are finite in number. So there exist \(N < M\) such that \((\alpha_N) = (\alpha_M)\). Then the element
    \[
      \varepsilon = \frac{\alpha_N}{\alpha_M}
    \]
    has the desired property.
  \end{proof}

  \begin{lemma}
    \label{lem:Dirichlet lemma 3}
    Let \(N \geq 1\) and \(A \in \matrixring_{N \times N} (\R)\) be such that
    \begin{enumerate}
    \item \(\sum_{i = 1}^N A_{ij} = 0\) for \(1 \leq j \leq N\),
    \item \(A_{ij} > 0\) if \(i = j\) and \(A_{ij} < 0\) if \(i \neq j\),
    \end{enumerate}
    then \(A\) has rank \(N - 1\).
  \end{lemma}

  \begin{proof}
    The rank is at most \(N - 1\). We show that the first \(N - 1\) rows of \(A\) are independent. Suppose there exists \(t_i \in \R\) for \(1 \leq i < N\), not all zero, such that
    \[
      \sum_{i = 1}^{N - 1} t_i A_{ij} = 0
    \]
    for \(1 \leq j \leq N\). Wlog after rescaling, there exists \(1 \leq k < N\) such that \(t_k = 1\) and \(t_i \leq 1\) if \(i \neq k\). Then
    \[
      0 = \sum_{i = 1}^{N - 1} t_iA_{ik}
      \geq \sum_{i = 1}^{N - 1} A_{ik}
      > \sum_{i = 1}^N A_{ik}
      = 0
    \]
    Absurd.
  \end{proof}

  \begin{lemma}
    \label{lem:Dirichlet lemma 4}
    Fix \(B > 0\). Let
    \[
      X_B = \{\alpha \in \O_L: \forall \sigma: L \to \C, |\sigma(\alpha)| \leq B\},
    \]
    then \(X_B\) is finite.
  \end{lemma}

  \begin{proof}
    Recall the map \(S: \O_L \to \R^r \times \C^s\). \(S(\O_L)\) is a lattice in \(\R^r \times \C^s\). \(S(X_B)\) is the intersection of the lattice \(S(\O_L)\) with a compact subset of \(\R^r \times \C^s\) so must be finite.
  \end{proof}

  Finally we get something we promised earlier:

  \begin{proposition}
    \(\ell(\O_L^\times)\) form a lattice in \(H \leq \R^{r + s}\).
  \end{proposition}

  \begin{proof}
    We must show that there exist units \(v_1, \dots, v_{r + s - 1} \in \O_L^\times\) such that their images under \(\ell\) span \(H\) as an \(\R\)-vector space and generate \(\ell(\O_L^\times)\) as an abelian group.

    By \Cref{cor:Dirichlet corollary 2}, we can find \(\varepsilon_1, \dots, \varepsilon_{r + s} \in \O_L^\times\) such that if \(\ell(\varepsilon_j) = (A_{1, j}, \dots, A_{r + s, j})\) then \(A_{i, j} < 0\) if \(i \neq j\) and \(A_{i, j} > 0\) if \(i = j\). By \Cref{lem:Dirichlet lemma 3}, the matrix \(A\) has rank \(r + s - 1\) so we can find \(v_1, \dots, v_{r + s - 1} \in \O_L^\times\) such that \(\ell(v_1), \dots, \ell(v_{r + s - 1})\) span \(H\) as an \(\R\)-vector space.

    Let \(\Lambda = \bigoplus_{i = 1}^{r + s - 1} \Z \ell(v_i) \leq H\) which is a lattice. Then \(\Lambda \leq \ell(\O_L^\times)\) and if \(u \in \O_L^\times\) then there exists \(\lambda \in \Lambda\) such that
    \[
      \ell(u) - \lambda \in \left\{ \sum_{i = 1}^{r + s - 1} t_i \ell(v_i): t_i \in [0, 1) \text{ for all } 1 \leq i \leq r + s - 1 \right\} = P.
    \]
    But the set of units \(\ell^{-1}(P)\) is finite by \Cref{lem:Dirichlet lemma 4}. Hence the quotient \(\ell(\O_L^\times)/\Lambda\) is finite. By Lagrange, there exists \(N \in \Z, N \geq 1\) such that \(N \cdot \ell(\O_L^\times) \leq \Lambda\). Hence
    \[
      \Lambda \leq \ell(\O_L^\times) \leq \frac{1}{N} \Lambda.
    \]
    By sandwich lemma, \(\ell(\O_L^\times)\) is a free abelian group of rank \(r + s - 1\). In particular, it is a lattice in \(H\).
  \end{proof}

  Let's now finish the proof the unit theorem, i.e.\ show there is an isomorphism
  \[
    \O_L^\times \cong \mu_L \times \Z^{r + s - 1}
  \]
  where \(\mu_L\) is the (finite) group of roots of unity in \(L\). Note that \(\mu_L = \ker \ell\): if \(\zeta \in \mu_L\) then \(\zeta^N = 1\) for some \(N \geq 1\). Hence \(\ell(\zeta^N) = N\cdot \ell(\zeta) = 0\). As \(\ell(\zeta) \in \R^{r + s}\), a vector space, we have \(\ell(\zeta) = 0\). Conversely, if \(\alpha \in \O_L^\times\) and \(\ell(\alpha) = 0\) then for all \(\sigma: L \to \C, |\sigma(\alpha)| = 1\). By \Cref{lem:Dirichlet lemma 4} \(\ker \ell\) is finite. By Lagrange it consists of roots of unity.

  Choose \(v_1, \dots, v_{r + s - 1} \in \O_L^\times\) such that \(\ell(v_1), \dots, \ell(v_{r + s - 1})\) is a \(\Z\)-basis of \(\ell(\O_L^\times)\). Define a map
  \begin{align*}
    \mu_L \times \Z^{r + s - 1} &\to \O_L^\times \\
    (\zeta, n_1, \dots, n_{r + s - 1}) &\mapsto \zeta v_1^{n_1} \cdots v_{r + s - 1}^{n_{r + s - 1}}
  \end{align*}
  It is an exercise to check this is an isomorphism.
\end{proof}

\section{Cyclotomic fields and the Fermat equation}

An warm-up exercise:

\begin{question}
  Find all Pythagorean triples \(x^2 + y^2 = z^2\) where \(x, y, z \in \Z\) not all zero.
\end{question}

Wlog \(\gcd(x, y, z) = 1\). Consider the parity: if \(2\) divides both \(x\) and \(y\) then \(2\) divides \(z\), so assume \(x\) is odd, \(y\) is even. The idea is to factor the equation in \(\Z[i]\) to get
\[
  (x + iy)(x - iy) = z^2.
\]
Claim that the ideals \((x + iy)\) and \((x - iy)\) of \(\Z[i]\) are coprime, i.e.\ there is no prime ideal \(\mathfrak p \in \Z[i]\) which divides both of them: if \(\mathfrak p\) divides both then \(\mathfrak p \divides (2x), \mathfrak p \divides (2y)\). If \(\ell\) is an odd prime such that \(\ell \divides \n(\mathfrak p)\) then this implies \(\ell \divides 2x, \ell \divides 2y\) so \(\ell \divides x\) and \(\ell \divides y\), impossible. Thus \(\mathfrak p \divides (2)\), hence \(\mathfrak p \divides (z^2)\), so \(2 \divides z\), absurd. Thus there is no such prime \(\mathfrak p\).

Using the identity \((x + iy)(x - iy) = (z)^2\), we see that \((x + iy)\) must be the square of another ideal. Using the fact that \(\Z[i]\) is a UFD, we get
\[
  (x + iy) = (a + ib)^2 = (a^2 - b^2 + 2ab i)
\]
where \(a, b \in \Z\). Hence \(x + iy = u(a^2 - b^2 + 2abi)\) for some \(u \in \Z[i]^\times = \{\pm 1, \pm i\}\). It is left as an exercise to show that there exists \(A, B \in \Z\) such that
\begin{align*}
  x &= A^2 - B^2 \\
  y &= 2AB \\
  z &= A^2 + B^2
\end{align*}

The aim of this section is to do something similar for
\[
  x^p + y^p = z^p
\]
where \(p\) is an odd prime.


From now on \(p\) is an odd prime.

\begin{definition}[Cyclotomic field]\index{cyclotomic field}
  The \emph{\(p\)th cyclotomic field} is \(K = \Q(\zeta_p)\) where \(\zeta_p = e^{2\pi i/p} \in \C\).
\end{definition}

\begin{lemma}\leavevmode
  \begin{enumerate}
  \item \((1 - \zeta_p)^{p - 1} = (p)\) in \(\O_K\), \(\n(1 - \zeta_p) = p\) and \((1 - \zeta_p) \subseteq \O_K\) is a prime ideal.
  \item Let \(f_p(x) = \frac{x^p - 1}{x - 1} \in \Z[x]\). Then \(f_p(x)\) is irreducible and \([K:\Q] = p - 1\).
  \end{enumerate}
\end{lemma}

\begin{proof}
  We can factorise
  \[
    f_p(x) = \prod_{j = 1}^{p - 1} (x - \zeta_p^i).
  \]
  In particular, \(f_p(\zeta_p) = 0\) and \([K: \Q] \leq p - 1\). We also have
  \[
    f_p(1) = p = \prod_{j = 1}^{p - 1} (1 - \zeta_p^i).
  \]
  Claim that for \(1 \leq j < p\),  we have \((1 - \zeta_p^j) = (1 - \zeta_p)\) as ideals of \(\O_K\). We show this by exhibiting inclusion both ways:
  \[
    \frac{1 - \zeta_p^j}{1 - \zeta_p} = 1 + \zeta_p + \dots + \zeta_p^{j - 1} \in \O_K
  \]
  so \(1 - \zeta_p^j \in (1 - \zeta_p)\). Choose \(k \in \Z, k \geq 1\) such that \(jk = 1 \pmod p\), then
  \[
    \frac{1 - \zeta_p}{1 - \zeta_p^j} = \frac{1 - \zeta_p^{jk}}{1 - \zeta_p^j} = 1 + \zeta_p^j + \dots + \zeta_p^{j(k - 1)} \in \O_K
  \]
  so \(1 - \zeta_p \in (1 - \zeta_p^j)\).

  Thus \((p) = (1 - \zeta_p)^{p - 1}\) is an ideal in \(\O_K\). It follows that \(p^{[K: \Q]} = \n(1 - \zeta_p)^{p - 1}\). But since we already know \([K: \Q] \leq p - 1\), we must have \(\n(1 - \zeta_p) = p\) and \([K: \Q] = p - 1\).
\end{proof}

\begin{lemma}
  \[
    \disc(1, \zeta_p, \dots, \zeta_p^{p - 2}) = (-1)^{\frac{p - 1}{2}} p^{p - 2}.
  \]
\end{lemma}

\begin{proof}
  We know 
  \[
    \disc(1, \zeta_p, \dots, \zeta_p^{p - 2}) = (-1)^{\binom{p - 1}{2}} \n_{K/\Q} (f'_p(\zeta_p)),
  \]
  but
  \[
    f'_p(x) = \frac{(x - 1) p x^{p - 1} - (x^p - 1)}{(x - 1)^2}
  \]
  so \(f'_p(\zeta_p) = \frac{p\zeta_p^{-1}}{\zeta_p - 1}\) and its norm is
  \[
    \n_{K/\Q}(f'_p(\zeta_p)) = \frac{p^{p - 1} \n_{K/\Q}(\zeta_p)^{-1}}{\n_{K/\Q}(\zeta_p - 1)}.
  \]
  Now notice that every embedding \(\sigma: K \to \C\) is purely complex so they appear in conjugate pairs. Thus for any \(\alpha \in K^\times\), \(\n_{K/\Q}(\alpha) \in \Q\) is positive. We already know
  \begin{align*}
    |\n_{K/\Q}(\zeta_p - 1)| &= \n(1 - \zeta_p) = p \\
    |\n_{K/\Q}(\zeta_p)| &= \n(\zeta_p) = 1
  \end{align*}
  so putting everything together,
  \[
    \disc(1, \zeta_p, \dots, \zeta_p^{p - 2}) = (-1)^{\frac{p - 1}{2}} \frac{p^{p - 1}}{p} = (-1)^{\frac{p - 1}{2}} p^{p - 2}.
  \]
\end{proof}

\begin{proposition}
  \[
    \O_K = \Z[\zeta_p].
  \]
\end{proposition}

\begin{proof}
  We already know \([\O_K: \Z[\zeta_p]] < \infty\) and
  \[
    \disc(\O_K) [\O_K: \Z[\zeta_p]]^2 = \disc(1, \zeta_p, \dots, \zeta_p^{p - 2}) = \pm p^{p - 2}.
  \]
  Hence \(\Z[\zeta_p] \subseteq \O_K\) if of \(p\)-power index, which we are going to prove to be \(1\). Look at the quotient ring \(\O_K/(1 - \zeta_p)\), which has order \(\n(1 - \zeta_p) = p\) so is just the finite field of \(p\) elements. Thus the characteristic homomorphism \(\Z \to \O_K/(1 - \zeta_p)\) is surjective. Hence for any \(z_0 \in \O_K\), there exists \(a_0 \in \Z, z_1 \in \O_K\) such that
  \[
    z_0 = a_0 + (1 - \zeta_p)z_1.
  \]
  Repeat for \(z_1\), there exists \(a_1 \in \Z, z_2 \in \O_K\) such that
  \begin{align*}
    z_0 &= a_0 + (1 - \zeta_p)(a_1 + (1 - \zeta_p)z_2) \\
        &= a_0 + (1 - \zeta_p)a_1 + (1 - \zeta_p)^2z_2
  \end{align*}
  By induction, we see we can write
  \[
    z_0 = \underbrace{a_0 + (1 - \zeta_p)a_1 + \dots + (1 - \zeta_p)^{n - 1}a_{n - 1}}_{\in \Z[1 - \zeta_p]} + (1 - \zeta_p)^n z_n
  \]
  where \(a_1, \dots, a_{n - 1} \in \Z, z_n \in \O_K\) for any \(n \geq 1\), i.e.
  \[
    \O_K = \Z[1 - \zeta_p] + (1 - \zeta_p)^n \O_K
  \]
  for any \(n \geq 1\).

  Observe that \(\Z[1 - \zeta_p] = \Z[\zeta_p]\) and \((1 - \zeta_p)^{(p - 1)N} \O_K = p^N \O_K\) for any \(N \geq 1\). Thus
  \[
    \O_K = \Z[\zeta_p] + p^N\O_K.
  \]
  We know \(\Z[\zeta_p] \subseteq \O_K\) has \(p\)-power index, so by Lagrange there exists \(N \geq 1\) such that \(p^N \O_K \subseteq \Z[\zeta_p]\). Hence
  \[
    \O_K = \Z[\zeta_p] + p^N\O_K = \Z[\zeta_p].
  \]
\end{proof}

What are the roots of unity in this ring? The \(\zeta_p^i\)'s certainly are. Stare at it a bit longer and you will find their negatives are as well. We use the following lemma to show that's all of them.

\begin{lemma}
  If \(\ell\) is a prime number, then \(\ell\) ramifies in \(K\) if and only if \(\ell = p\).
\end{lemma}

\begin{proof}
  Recall that by definition, \(\ell\) ramifies in \(K\) if and only if there exists \(\mathfrak p \subseteq \O_K\) prime such that \(\mathfrak p^2 \divides \ell \O_K\).

  We've seen that \((1 - \zeta_p)^{p - 1} = p\O_K\), so \(p\) is ramified in \(K\). Let \(\ell \neq p\) be a prime. Since \(\Z[\zeta_p] = \O_K\), \nameref{thm:Dedekind} tells us that \(\ell\) is ramified in \(K\) if and only if \(f_p(x) \pmod \ell\) has a repeated root. We know \(\disc f_p = \pm p^{p - 2}\), hence \(\disc(f_p \pmod \ell) \neq 0\) so \(f_p(x) \pmod \ell\) does not have any repeated roots.
\end{proof}

\begin{proposition}
  Let \(\mu_K \subseteq \O_K^\times\) be the group of roots of unity in \(K\). Then
  \[
    \mu_K = \{\pm \zeta_p^i: 0 \leq i < p\}.
  \]
\end{proposition}

\begin{proof}
  \(\{\pm \zeta_p^i: 0 \leq i < p\} \subseteq \mu_K\) is a subgroup of order \(2p\) so it suffices to show \(|\mu_K| = 2p\). If \(\ell \neq p\) is an odd prime and \(\ell \divides |\mu_K|\) then since \(\mu_K\) is cyclic, \(\zeta_\ell \in K\) so \(\Q(\zeta_\ell) \subseteq K\). As \((1 - \zeta_\ell)^{\ell - 1} \O_{\Q(\zeta_\ell)} = \ell \O_{\Q(\zeta_\ell)}\), we get \((1 - \zeta_\ell)^{\ell - 1} \O_K = \ell \O_K\), contradicting the fact that \(\ell\) is unramified in \(K\).

  Similarly if \(4 \divides |\mu_K|\) then \(i \in K\) and hence \((1 + i)^2 \O_K = 2\O_K\), contradicting the fact that \(2\) is unramified in \(K\).

  If \(p^2 \divides |\mu_K|\), then \(\omega = e^{2\pi i/p^2} \in K\). Let \(f(x) = \frac{x^{p^2} - 1}{x^p - 1} \in \Z[x]\), then
  \[
    f(x) = \prod_{\substack{1 \leq a \leq p^2 \\ p \ndivides a}} (x - \omega^a).
  \]
  Then
  \[
    f(1) = p = \prod_{\substack{1 \leq a \leq p^2 \\ p \ndivides a}} (1 - \omega^a).
  \]
  By the same argument as for \(\zeta_p\), \((1 - \omega^a) \O_K = (1 - \omega) \O_K\) if \((a, p) = 1\). Hence
  \[
    p \O_K = (1 - \omega)^{\phi(p^2)} = (1 - \omega)^{p(p - 1)}.
  \]
  Taking norm, get \(p^{p - 1} = \n(1 - \omega)^{p(p - 1)}\), absurd. Thus \(|\mu_K| = 2p\).
\end{proof}

\begin{lemma}[Kummer]\index{Kummer's lemma}
  If \(u \in \O_K^\times\), there exists \(g \in \Z\) such that
  \[
    \zeta_p^g u \in K \cap \R.
  \]
\end{lemma}

For those familiar with Galois theory, we have the tower of fields
\[
  \begin{tikzcd}
    K = \Q(\zeta_p) \ar[d, dash, "2"] \\
    K \cap \R = \Q(\zeta_p + \zeta_p^{-1}) \ar[d, dash, "\frac{p - 1}{2}"] \\
    \Q
  \end{tikzcd}
\]

\begin{proof}
  % Essentially suffices to prove the Galois group is abelian.
  Claim that if \(\sigma: K \to \C\) is a complex embedding, then for all \(\alpha \in K\), \(\sigma(\conj \alpha) = \conj{\sigma(\alpha)}\): suffices to check this for \(\alpha = \zeta_p\). If \(\sigma(\zeta_p) = \zeta_p^a\) then
  \[
    \sigma(\conj{\zeta_p}) = \sigma(\zeta_p^{-1}) = \zeta_p^{-a} = \conj{\zeta_p^a} = \conj{\sigma(\zeta_p)}.
  \]

  If \(u \in \O_K^\times\), then for any embedding \(\sigma: K \to \C\),
  \[
    |\sigma(u/\conj u)| = |\sigma(u) \conj{\sigma(u)}^{-1}| = 1.
  \]
  Hence \(u/\conj u \in \mu_K\), so we can write \(u/\conj u = (-1)^b \zeta_p^k\) for some \(b \in \{0, 1\}, k \in \Z\). After replacing \(k\) by \(k + p\), wlog \(k = 2g\). Then \(u = \conj u (-1)^b \zeta_p^{2g}\).

  Now look at the residue ring \(\O_K/(1 - \zeta_p) \cong \Z/p\Z\). The ideal \((1 - \zeta_p)\O_K\) is stable under complex conjugation, so complex conjugation induces an automorphism of \(\O_K/(1 - \zeta_p)\). As \(\Z \to \O_K/(1 - \zeta_p)\) is surjective, this automorphism is trivial, so for all \(\alpha \in \O_K\), \(\alpha = \conj \alpha \mod{(1 - \zeta_p)\O_K}\). Hence for all \(u \in \O_K^\times\),
  \begin{align*}
    u &= \conj u \mod{(1 - \zeta_p)} \\
      &= \conj u (-1)^b \zeta_p^{2g} = \conj u (-1)^b \mod{(1 - \zeta_p)}
  \end{align*}
  Since \(u \in \O_K^\times\), \(u \neq 0 \pmod{(1 - \zeta_p)}\) so must have \(b = 0\). Hence \(u = \conj u \zeta_p^{2g}\), so \(\zeta_p^{-g} u = \conj{\zeta_p^{-g} u} \in K \cap \R\).
\end{proof}

\begin{lemma}
  If \(\alpha \in \O_K\), then there exists \(a \in \Z\) such that
  \[
    \alpha^p = a \mod{p\O_K}.
  \]
\end{lemma}

\begin{proof}
  For all \(\alpha \in \O_K\), there exist \(b \in \Z\) such that \(\alpha = b \mod{(1 - \zeta_p)}\). Note the identity
  \[
    \alpha^p - b^p = \prod_{i = 0}^{p - 1}(\alpha - \zeta_p^i b).
  \]
  For any \(i \geq 0\),
  \[
    \alpha - \zeta_p^i b = \alpha - b = 0 \mod{(1 - \zeta_p)}.
  \]
  Hence
  \[
    \alpha^p - b^p \in (1 - \zeta_p)^p \subseteq (1 - \zeta_p)^{p - 1} = p\O_K.
  \]
\end{proof}

We now discuss Fermat's Last Theorem:

\begin{theorem}[Wiles, 1994]
  Let \(n \geq 3\) be an integer, and let \(x, y, z \in \Z\) be such that
  \[
    x^n + y^n = z^n
  \]
  then \(xyz = 0\).
\end{theorem}

A little history: in early 19th century, there are many false proofs of this theorem relying on the false assumption that \(\Z[e^{2\pi i/n}]\) is a UFD. In 1840s, Kummer invented the theory of ideal factorisation in number fields in order to try to give a correct proof, which worked for a large class of primes. The complete proof was announced by Wiles in 1993 in a room less than 100 yards from where we are now. Despite the geographical proximity, we are NOT going to prove it in this course!

\begin{definition}[Regular prime]\index{regular prime}
  An prime \(p\) is \emph{regular} if
  \[
    p \ndivides |\Cl(\Z[\zeta_p])|.
  \]
\end{definition}

\begin{theorem}[Kummer]
  Let \(p\) be an regular prime, then Fermat's Last Theorem holds in exponent \(n = p\).
\end{theorem}

Again we will not prove this. Instead we will prove

\begin{theorem}
  Let \(p\) be an odd regular prime. Let \(x, y, z \in \Z\) be such that \(p \ndivides xyz\). Then
  \[
    x^p + y^p \neq z^p.
  \]
\end{theorem}

Kummer called this the ``first case'' of Fermat's Last Theorem. He dealt with the ``second case'' (where \(p \divides xzy\)) using similar techniques.

\begin{proof}
  Let \(x, y, z \in \Z\) such that \(x^p + y^p + z^p = 0\), \(p \ndivides xyz\). Wlog \(\gcd(x, y, z) = 1\). Then we factor
  \[
    x^p + y^p = \prod_{i = 0}^{p - 1} (x + \zeta_p^i y) = -z^p \in \Z[\zeta_p].
  \]
  Claim that the ideals \((x + \zeta_p^i y)\) are pairwise coprime:
  \begin{proof}
    Suppose \(\mathfrak q \subseteq \O_K\) is a prime ideal dividing \((x + \zeta_p^i y)\) and \((x + \zeta_p^j y)\) where \(0 \leq i < j < p\). Then
    \[
      \mathfrak q \divides ((\zeta_p^i - \zeta_p^j) y) = (1 - \zeta_p)(y).
    \]
    If \(\mathfrak q \divides (y)\) then \(\mathfrak q \divides (z)\) so \(\mathfrak q \divides (x)\). Taking norm, we get \(\ell \divides \gcd(x, y, z)\) where \(\n(\mathfrak q) = \ell^f\), absurd.

    If \(\mathfrak q \divides (1 - \zeta_p) \). Hence \(\mathfrak q = (1 - \zeta_p)\) and \((1 - \zeta_p) \divides (z)\) so \(p \divides z\), absurd.
  \end{proof}

  Thus by
  \[
    \prod_{i = 0}^{p - 1} (x + \zeta_p^i y) = (z)^p
  \]
  there exists an ideal \(I \subseteq \O_K\) such that \((x + \zeta_p y) = I^p\). Since \(p\) is regular, i.e.\ \(p \ndivides |\Cl(\O_K)|\), this implies that \(I\) is principal. If \(I = (\delta)\) then \((x + \zeta_py) = (\delta^p)\), so there exists \(u \in \O_K^\times\) such that \(x + \zeta_p y = u \delta^p\). By previous lemmas, there exists \(v \in \O_K^\times \cap \R, g \in \Z, a \in \Z\) such that
  \[
    u \delta^p = \zeta_p^g va \mod{p\O_K}.
  \]
  Hence \(\zeta_p^{-g} (x + \zeta_p y) = va \mod{p\O_K}\).

  Observe that \(va \in \O_K \cap \R\) so is invariant under complex conugation. Hence
  \[
    \zeta_p^{-g} (x + \zeta_p y) = \zeta_p^g (x + \zeta_p^{-1} y) \mod{p\O_K}
  \]
  so
  \[
    \zeta_p^{-g} x + \zeta_p^{1 - g} y - \zeta_p^g x - \zeta_p^{g - 1} y = 0 \mod{p\O_K}.
  \]
  What is \(g\)? First note that \(g \neq 0, 1 \pmod p\): if \(g = 0 \pmod p\), then
  \[
    x + \zeta_p y - x - \zeta_p^{-1} y = \zeta_p(1 - \zeta_p^{-2}) y = 0 \mod (1 - \zeta_p)^{p - 1}
  \]
  and hence \(y \in (1 - \zeta_p)^{p - 2}\), so \(p \divides y\). Similar if \(g = 1 \pmod p\).

  Now observe that two of \(-g, 1 - g, g, g - 1\) must be congruent module \(p\), as otherwise the identity
  \[
    \zeta_p^{-g} x + \zeta_p^{1 - g} y - \zeta_p^g x - \zeta_p^{g - 1} y = 0 \mod{p\O_K}
  \]
  together with the fact the \(\{\zeta_p^i\}_{i = 1}^{p - 1}\) is an integral basis of \(\Z[\zeta_p]\), forces \(p \divides x, p \divides y\), absurd.

  Since \(g \neq 0, 1 \pmod p\), the only possibility is \(-g = g - 1 \pmod p\), i.e.\  \(2g = 1 \pmod p\). Hence
  \begin{align*}
    & \quad \zeta_p^{-g}(x + \zeta_p y - \zeta_p^{2g} x - \zeta_p^{2g - 1} y) \\
    &= \zeta_p^{-g} (x + \zeta_p y - \zeta_p x - y) \\
    &= \zeta_p^{-g} (x - y) (1 - \zeta_p) \\
    &= 0 \mod{(1 - \zeta_p)^{p - 1}}
  \end{align*}
  Thus \(x - y = 0 \mod{(1 - \zeta_p)^{p - 2}}\), hence \(x = y \pmod p\). Recall the equation
  \[
    x^p + y^p + z^p = 0
  \]
  is symmetric in \(x, y, z\) so the same argument also give \(y = z \pmod p\), hence
  \[
    3x^p = 0 \pmod p.
  \]
  If \(p \neq 3\) then \(p \divides x\), absurd. If \(p = 3\) then reduce modulo \(9\) shows there are no solutions, which is left as an exercise.
\end{proof}

The rest of the course is non-examinable.

The question now is how to decide if \(p\) is regular. Unfortunately Minkowski's bound is not very effective. To give an idea let \(h_p = |\Cl(\Z[\zeta_p])|\) be the class number. The table of class number of cyclotomic fields begins with
\begin{table}[ht]
  \centering
  \begin{tabular}{|c|c||c|c|}
    \(p\) & \(h_p\) & \(p\) & \(h_p\) \\ \hline
    3 & 1 & 37 & 37 \\ \hline
    5 & 1 & 41 & 121 \\ \hline
    7 & 1 & 43 & 211 \\ \hline
    11 & 1 & 47 & 695 \\ \hline
    13 & 1 & 53 & 4889 \\ \hline
    17 & 1 & 59 & 41241 \\ \hline
    19 & 1 & 61 & 76301 \\ \hline
    23 & 3 & 67 & 853513 \\ \hline
    29 & 8 & 71 & 3882809 \\ \hline
    31 & 9 & 73 & 11957417 \\
  \end{tabular}
\end{table}

We observe that \(h_p\) seems to grow quickly with \(p\). Also most primes seem to regular: of those in the table, all but \(p = 37, 59, 67\) are regular.

Kummer gave a criterion to decide whether or not \(p\) is regular in terms of the Bernoulli numbers \(B_n\).

\begin{definition}[Bernoulli number]\index{Bernoulli number}
  For \(n \geq 0\), the \(n\)th \emph{Bernoulli number} is defined by the formula
  \[
    \frac{t}{1 - e^{-t}} = \sum_{n \geq 0} B_n \frac{t^n}{n!}.
  \]
\end{definition}

Note that \(B_n \in \Q\). The first few Bernoulli numbers are
\begin{table}[ht]
  \centering
  \begin{tabular}{|c|c||c|c|}
    \(n\) & \(B_n\) & \(n\) & \(B_n\) \\ \hline
    0 & 1 & 6 & \(\frac{1}{42}\) \\ \hline
    1 & \(\frac{1}{2}\) & 7 & 0 \\ \hline
    2 & \(\frac{1}{6}\) & 8 & \(-\frac{1}{30}\) \\ \hline
    3 & 0 & 9 & 0 \\ \hline
    4 & \(-\frac{1}{30}\) & 10 & \(\frac{5}{66}\) \\ \hline
    5 & 0 & 11 & 0 \\ \hline
          & & 12 & \(- \frac{691}{2730}\) \\
  \end{tabular}
\end{table}

\begin{theorem}[Kummer's criterion]\index{Kummer's criterion}
  \label{thm:Kummer's criterion}
  If \(p\) is an odd prime, then \(p\) is regular if and only if \(p\) does not divide the numerator of \(B_n\) for any \(n = 2, 4, \dots, p - 3\).
\end{theorem}

\begin{eg}
  \(p = 691\) is prime. \(691\) divides the numerator of \(B_{12}\) so by \nameref{thm:Kummer's criterion} \(691 \divides h_{691}\).
\end{eg}

Alternatively we may define \(B_n\) as
\[
  B_n = -n\zeta(1 - n)
\]
where \(\zeta(s)\) is the Riemann zeta function. This is not coincidental. In fact the Riemann zeta function and its generalisation are closed related to the arithmetic of number fields.

\begin{definition}[Dedekind zeta function]\index{Dedekind zeta function}
  Let \(L\) be a number field. Its \emph{Dedekind zeta function} is
  \[
    \zeta_L(s) = \sum_{I \subseteq \O_L} \n(I)^{-s}
  \]
  where the sum is over all non-zero ideals.
\end{definition}

\begin{note}\leavevmode
  \begin{enumerate}
  \item One can show that the sum is absolutely convergent in the region \(\Re s > 1\) and it defines a holomorphic function there. This boils down to bound the number of ideals with certain norm.
  \item If \(L = \Q\) then
\[
  \zeta_L(s) = \zeta(s) = \sum_{n \geq 1} n^{-s}
\]
is the usual Riemann zeta function. Other properties such as Euler product generalises as well.
  \end{enumerate}
\end{note}

In general, unique factorisation of ideals gives an identity
\[
  \zeta_L(s) = \prod_{\mathfrak p \subseteq \O_K} (1 - \n(\mathfrak p)^{-s})^{-1}
\]
where the sum is over all non-zero prime ideals.

\begin{definition}[Regulator]\index{regulator}
  Let \(L\) be a number field. The \emph{regulator} of \(L\), \(R_L\), is defined as follow: let \(v_1, \dots, v_{r_1 + r_2 - 1} \in \O_L^\times\) generate the free abelian group \(\O_L^\times/\mu_L\). Let \(A\) be the matrix with columns \(\ell(v_1), \dots, \ell(v_{r_1 + r_2 - 1})\) where \(\ell: \O_L^\times \to \R^{r_1 + r_2}\) is the logarithmic map from the proof of Dedekind's unit theorem. Then \(R_L\) is the absolute value of any \((r_1 + r_2 - 1) \times (r_1 + r_2 - 1)\) minor of the matrix \(A\).
\end{definition}

The idea is that \(\ell(\O_L^\times)\) is a lattice in the hyperplane \(H\) and \(R_L\) is essentially the covolume of the lattice. This is a generalisation of fundamental unit.

\begin{theorem}\leavevmode
  \begin{enumerate}
  \item \(\zeta_L(s)\) has a meromorphic continuation to all \(s \in \C\) with no poles except a simple pole at \(1\). It satisfies the functional equation
    \[
      \Lambda_L(s) = \Lambda_L(1 - s)
    \]
    where by definition
    \[
      \Lambda_L(s) = \zeta_L(s) |D_L|^{s/2} (\pi^{-s/2} \Gamma(s/2))^{r_1} \cdot (2 (2\pi)^{-s} \Gamma(s))^{r_1}
    \]
    where \(r_1\) is the number of real embeddings of \(L\) and \(r_2\) is the number of pairs of complex embeddings.
  \item Analytic class number formula: the residue of \(\zeta_L(s)\) at \(s = 1\) is
    \[
      \frac{2^{r_1} (2\pi)^{r_2} h_L R_L}{w_L \sqrt{|D_L|}}
    \]
    where by definition \(h_L = |\Cl(\O_L)|\) and \(w_L = |\mu_L|\).
  \end{enumerate}
\end{theorem}

What does this have to do with cyclotomic fields? Let \(p\) be an odd prime and \(K = \Q(\zeta_p)\) and \(E = K \cap \R = \Q(\zeta_p + \zeta_p^{-1})\).

There exists factorisation
\[
  \zeta_K(s) = \prod_{\chi: (\Z/p\Z)^\times \to \C^\times} L(\chi, s)
\]
where \(\chi\) is a group character and \(L(\chi, s)\) is the Dirichlet \(L\)-function
\[
  L(\chi, s) = \prod_{\ell \neq p} (1 - \chi (\ell \mod p) \ell^{-s})^{-1}.
\]
There is a similar factorisation
\[
  \zeta_E(s) = \prod_{\chi: \chi(-1) = 1} L(\chi, s).
\]

In fact, if \(M/\Q\) is any finite Galois extension, then there is a factorisation
\[
  \zeta_M(s) = \prod_\rho L(\rho, s)^{\dim \rho}
\]
induced by irreducible representations \(\rho\) of \(\gal(M/\Q)\).

Taking the quotient of these two factorisations gives
\[
  \frac{\zeta_K(s)}{\zeta_E(s)} = \prod_{\chi: \chi(-1) = -1} L(\chi, s).
\]

Note that both sides are holomorphic at \(s = 1\). \nameref{thm:Kummer's criterion} for the regularity of the prime \(p\) is proved by evaluating either side at \(s = 1\).

On LHS, we can apply the analytic class number formula for \(K\) and \(E\) together to get
\[
  \frac{h_K R_K}{h_E R_E} \cdot \text{explicit factor}.
\]
Note that \(r_1 + r_2\) is the same for \(K\) and \(E\):
\[
  \begin{tikzcd}
    & r_1 & r_2 \\
    K \ar[d, dash] & 0 & \frac{p - 1}{2} \\
    E \ar[d, dash] & \frac{p - 1}{2} & 0 \\
    \Q & 1 & 0
  \end{tikzcd}
\]

\(\O_L^\times\) is a subgroup of \(\O_K^\times\) of finite index and thus \(R_k/R_E\) is an integer which can be explicitly evaluated. Thus LHS is \(h_K/h_E \cdot \text{explicit factor}\).

On RHS, each \(L(\chi, s)\) is holomorphic at \(s = 1\) and \(L(\chi, 1)\) can be evaluated explicitly in terms of (generalised) Bernoulli numbers using purely analytic techniques.

With more work, this leads to Kummer's criterion for the \(p\)-divisibility of \(h_K\).

\printindex
\end{document}
% Reading

% Marcus, Number Fields
% secret notes: https://www.dpmms.cam.ac.uk/~jat58/nfl2018
