\documentclass[a4paper]{article}

\def\npart{III}

\def\ntitle{Algebraic Number Theory}
\def\nlecturer{J.\ A.\ Thorne}

\def\nterm{Michaelmas}
\def\nyear{2019}

\input{header}

\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Div}{Div}
\renewcommand*{\O}{\mathcal{O}}
\DeclareMathOperator{\Cl}{Cl} % ideal class group
\DeclareMathOperator{\Frob}{Frob} % Frobenius automorphism
\DeclareMathOperator{\disc}{disc} % discriminant

\begin{document}

\input{titlepage}

\tableofcontents

\setcounter{section}{-1}

\section{Introduction}

In IID Number Fields, we studied finite extensions of \(\Q\) and their rings of integers. We proved two fundamental theorem for \(\O_K\):
\begin{itemize}
\item finiteness of ideal class group,
\item finite generation of \(\O_K^\times\).
\end{itemize}

In this course, we'll study
\begin{itemize}
\item completion at a prime,
\item Galois theory of local and global fields.
\end{itemize}
and finally we'll describe class field theory (description only).

\section{Dedekind domains}

\begin{definition}[discrete valuation ring]\index{discrete valuation ring}
  Let \(A\) be a ring. We say \(A\) is a \emph{discrete valuation ring} (DVR) if \(A\) is a principal ideal domain (PID) and \(A\) has a unique non-zero prime ideal.
\end{definition}

Let \(A\) be a DVR. Then the unique non-zero prime ideal \(\mathfrak m_A\) of \(A\) is also maximal, so \(A\) is also a local ring, i.e.\ \(A\) has a unique maximal ideal. Hence \(k_A = A/\mathfrak m_A\) is a field, the residue field of \(A\).

As \(A\) is a PID, \(\mathfrak m_A = (\pi)\) is principal. Any generator \(\pi\) is called a \emph{uniformiser}\index{uniformiser}. If \(\pi, \pi'\) are uniformisers then \((\pi) = (\pi')\) so \(\pi' = \pi u\) for some \(u \in A^\times\).

Since \(A\) is a local, \(A\) can be written as the disjoint union
\begin{align*}
  A &= A^\times \cup \mathfrak m_A \\
    &= A^\times \cup \pi A \\
    &= A^\times \cup \pi A^\times \cup \pi^2 A \\
    &= \bigcup_{i \geq 0} \pi^i A^\times \cup \bigcap_{i \geq 0} \pi^i A
\end{align*}

In fact, the ideal \(I = \bigcap_{i \geq 0} \pi^i A\) is zero. This follows from
\begin{lemma}[Nakayama's lemma]\index{Nakayama's lemma}
  Let \(R\) be a local ring, \(P \subseteq R\) the unique maximal ideal, \(M\) a finitely generated (fg) \(R\)-module. Then
  \begin{enumerate}
  \item if \(M = P M\) then \(M = 0\). This is equivalent to \(M/PM = 0\).
  \item if \(N \leq M\) is an \(R\)-submodule such that \(N + PM = M\) then \(N = M\). This is saying there is a surjection \(N \surj M/PM\).
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Let \(a_1, \dots a_g\) be a generating set for \(M\) with \(g\) as small as possible, \(g \geq 1\). Then \(a_1 \in M = PM\) so we can write
    \[
      a = \sum_{i = 1}^g x_i a_i
    \]
    where \(x_i \in P\). Hence
    \[
      (1 - x_1) a_1 = \sum_{i = 2}^g x_i a_i.
    \]
    Since \(R\) is local, \(1 - x_1 \in R^\times\) so \(a_1 \in \generation{a_2, \dots, a_g}\), contradicting the minimality of \(g\).
  \item Apply first part to \(M/N\).
  \end{enumerate}
\end{proof}

Now back to the statement. Note \(\pi I = I\) so Nakayama's lemma implies that \(I = 0\). Hence each element of \(x \in A, x \neq 0\) admits a unique description \(x = \pi^n u\), \(n \geq 0, u \in A^\times\). Each non-zero ideal of \(A\) has the form \((\pi^i)\) for some \(i \geq 0\).

Therefore we can define a function \(v: K^\times \to \Z\) where \(K = \Frac A\) with the following properties:
\begin{enumerate}
\item \(v\) is a surjective homomorphism,
\item for all \(x, y \in K^\times\) such that \(x + y \neq 0\), \(v(x + y) \geq \min(v(x), v(y))\), with equality if \(v(x) \neq v(y)\).
\end{enumerate}
We define \(v(x) = n\) when \(x = \pi^n u\) for some \(n \in \Z, u \in A^\times\).

\begin{proof}\leavevmode
  \begin{enumerate}
  \item \(\pi^n u \cdot \pi^m v = \pi^{n + m} uv\).
  \item wlog \(x = \pi^a u, y = \pi^{a + b} v\) where \(a \in \Z, b \geq 0\). Then
    \[
      x + y = \pi^a(u + v \pi^ b).
    \]
    If \(b > 0\) then \(u + v \pi^b \in A^\times\).
  \end{enumerate}
\end{proof}

\begin{definition}[valuation]\index{valuation}
  If \(L\) is a field, we call a function \(w: L^\times \to \Z\) a \emph{valuation} if satisfies 1, 2 above.
\end{definition}

Thus if we have a DVR then we have a valuation. The converse also holds: if \(w: L^\times \to \Z\) is a valuation, we define
\begin{align*}
  A_L &= \{x \in L^\times: w(x) \geq 0\} \cup \{0\} \\
  \mathfrak m_L &= \{x \in L^\times: w(x) > 0\} \cup \{0\}
\end{align*}

\begin{lemma}
  If \(k\) is a field, then there is a bijection between
  \begin{enumerate}
  \item subrings \(A \leq K\) such that \(A\) is a DVR and \(\Frac A = K\),
  \item valuations \(v: K^\times \to \Z\).
  \end{enumerate}
\end{lemma}

\begin{proof}
  Exercise.
\end{proof}

\begin{eg}\leavevmode
  \begin{enumerate}
  \item Let \(p\) be a prime, \(v: \Q^\times \to \Z\) defined by
    \[
      v(p^n \frac{r}{s}) = n
    \]
    if \(r, s \in \Z\), \((p, rs) = 1\).
  \item Let \(K\) be the field of meromorphic functions on \(\C\), \(v: K^\times \to \Z\) defined by
    \[
      v(f) = \operatorname{ord}_{z = 0} f(z).
    \]
  \end{enumerate}
\end{eg}

We will see via localisation we can reduce problems to DVR. Hence we need a way to recognise DVR. This is the content of the next proposition

\begin{proposition}
  Let \(A\) be a Noetherian domain. Then TFAE:
  \begin{enumerate}
  \item \(A\) is a DVR.
  \item \(A\) is integrally closed in \(\Frac A\) and \(A\) has a unique non-zero prime ideal.
  \end{enumerate}
\end{proposition}

Recall that \(A\) is integrally closed if for all \(\gamma \in K, a_1, \dots, a_n \in A\), if
there is a relation
\[
  \gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0
\]
then \(\gamma \in A\). Equivalently, for all \(\gamma \in K\), \(A[\gamma]\) is fg as an \(A\)-module then \(\gamma \in A\).

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(2 \implies 1\): suppose \(\gamma \in K - A\) and there exist \(a_1, \dots, a_n \in A\) such that
    \[
      \gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0.
    \]
    We can write \(\gamma = \pi^{-k} u\) for some \(k > 0, u \in A^\times\). Hence
    \[
      -\pi^{-nk} u^n = a_1 \pi^{-(n - 1)k} u^{n - 1} + \dots + a_n.
    \]
    The valuation of LHS is \(-nk\) and the valuation of RHS is at least
    \[
      \min_{i = 1}^n v(a_i \pi^{- (n - i) k}) \geq \min v(\pi^{-(n - i)k}) = \min -(n - i) k \geq -(n - 1) k.
    \]
    These two expressions must be equal, absurd. Thus \(A\) is integrally closed in \(K\). \(A\) has a unique non-zero prime ideal as \(A\) is a DVR.
  \item \(2 \implies 1\): Let \(\mathfrak m \subseteq A\) be the unique non-zero prime ideal. Claim that for any proper non-zero ideal \(I \subseteq A\), there exists \(n \geq 1\) such that \(\mathfrak m^n \subseteq I \subseteq \mathfrak m\).

    \begin{proof}
      \(I \subseteq \mathfrak m\) as \(\mathfrak m\) is the unique maximal ideal. Suppose for contradiction exists \(I\) such that \(\mathfrak m^n \nsubseteq I\) for all \(n \geq 1\). Since \(A\) is Noetherian, we can assume that \(I\) is maximal with this property. Note \(I\) is not prime as otherwise \(I = \mathfrak m\). This means that there exist \(a, b \in A\) such that \(a, b \notin I\) but \(ab \in I\). Then the inclusions \(I \subseteq I + (a), I \subseteq I + (b)\) are proper. By maximality of \(I\), there exists \(n_1, n_2 \geq 1\) such that
      \begin{align*}
        \mathfrak m^{n_1} &\subseteq I + (a) \\
        \mathfrak m^{n_2} &\subseteq I + (b)
      \end{align*}
      Then
      \begin{align*}
        \mathfrak m^{n_1 + n_2} &\subseteq (I + (a)) (I + (b)) \\
                                &\subseteq I + (ab) \\
                                &\subseteq I
      \end{align*}
      as \(ab \in I\). Absurd.
    \end{proof}
    Now we can show \(\mathfrak m\) is principal. Choose \(\alpha \in \mathfrak m - \{0\}\). If \(\mathfrak m = (\alpha)\) then done. Otherwise, choose \(n \geq 2\) minimal such that \(\mathfrak m^n \subseteq (\alpha) \subseteq \mathfrak m\). Then \(\mathfrak m^{n - 1} \nsubseteq (\alpha)\) so exists \(\beta \in \mathfrak m^{n - 1} - (\alpha)\) such that
    \[
      \gamma = \frac{\beta}{\alpha} \in \frac{1}{\alpha} \mathfrak m^{n - 1} - A.
    \]
    Then
    \[
      \gamma \mathfrak m = \frac{\beta}{\alpha} \mathfrak m \subseteq \frac{1}{\alpha} \mathfrak m^{n - 1} \mathfrak m \subseteq \frac{1}{\alpha} \mathfrak m^n \subseteq A.
    \]
    If \(\gamma \mathfrak m \subseteq \mathfrak m\) then \(A[\gamma] \embed \End_A(\mathfrak m)\) as \(A\)-modules. \(\End_A(\mathfrak m)\) is a fg \(A\)-module as \(A\) is Noetherian. So \(A\) integrally closed in \(K\) implies that \(\gamma \in A\). So we must have \(\gamma \mathfrak m = A\). Hence \(\mathfrak m = \gamma^{-1} A\). So \(\pi = \gamma^{-1} \in A\) and \(\pi\) generates \(\mathfrak m\).

    Since \(A\) is a local ring, we have
    \begin{align*}
      A &= A^\times \cup \mathfrak m \\
        &= A^\times \cup \pi A \\
        &= \bigcup_{i \geq 0} \pi^i A^\times \cup I
    \end{align*}
    where \(I = \bigcap_{i \geq 0} \pi^i A\). \(I = 0\) as \(I\) is fg (as \(A\) is Noetherian) and \(\pi I = I\), so we can apply Nakayama's lemma. Hence
    \[
      A = \{0\} \cup \bigcup_{i \geq 0} \pi^iA^\times
    \]
    and \(A\) is a DVR.
  \end{itemize}
\end{proof}

\begin{definition}[multiplicative subset]\index{multiplicative subset}
  Let \(A\) be a ring. A \emph{multiplicative subset} of \(A\) is a subset \(S \subseteq A\) satisfying
  \begin{enumerate}
  \item \(1 \in S\),
  \item for all \(x, y \in S\), \(xy \in S\).
  \end{enumerate}
\end{definition}

\begin{definition}[localisation of ring]\index{localisation}
  Let \(S \subseteq A\) be a multiplicative subset. We define \(S^{-1} A\) to be the set of equivalence classes of pairs \((a, s) \in A \times S\) under the relation \((a, x) \sim (a', s')\) if there exists \(t \in S\) such that \(t(s'a - sa') = 0\).

  We write \(\frac{a}{s} \in S^{-1} A\) for the equivalence class of \((a, s)\).
\end{definition}

\begin{lemma}\leavevmode
  \begin{enumerate}
  \item \(S^{-1}A\) is well-defined and admits a ring structure.
  \item There is a ring homomorphism
    \begin{align*}
      A &\to S^{-1} A \\
      a &\mapsto \frac{a}{1}
    \end{align*}
    with kernel \(\{a \in A: \text{ exists } s \in S, sa = 0\}\).
  \item If \(A\) is a domain and \(0 \notin S\) then \(S^{-1}A\) may be identified with the subring \(\{\frac{a}{s}: a \in A, s \in S\}\) of \(\Frac A = (A - \{0\})^{-1} A\).
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item \(\sim\) is an equivalence relation: it is reflexive and symmetric by definition. For transitivity, suppose \((a, s) \sim (a', s') \sim (a'', s'')\), then exist \(t, t' \in S\) such that \(tas' = ta's, t'a's'' = t'a''s'\). Then
    \[
      tt's'as'' = tt's''a's = tt'a''s's
    \]
    i.e.
    \[
      tt's'(as'' - a''s) = 0.
    \]

    To make \(S^{-1}A\) a ring, the zero element is \(\frac{0}{1}\), the multiplicative identity is \(\frac{1}{1}\), and addition and multiplication are defined as
    \begin{align*}
      \frac{a}{s} + \frac{a'}{s'} &= \frac{as' + a's}{ss'} \\
      \frac{a}{s} \cdot \frac{a'}{s'} &= \frac{aa'}{ss'}
    \end{align*}
    Check the ring axioms are satisfied.
  \item \(f: A \to S^{-1}A\) is a ring homomorphism by definition.
    \[
      \ker f = \{a \in A: \frac{a}{1} = \frac{0}{1}\} = \{a \in A: \text{ exists } s \in S \text{ such that } sa = 0\}.
    \]
  \item Now we suppose \(A\) is a domain. Recall that
    \[
      \Frac A = \{(a, s) \in A \times (A - \{0\})\} / \bullet
    \]
    where \((a, s) \bullet (a', s')\) if \(as' = a's\). We need to check that if \(S \subseteq A\) if a multiplicative subset with \(0 \notin S\) then \((a, s) \sim (a', s')\) implies \((a, s) \bullet (a', s')\).
  \end{enumerate}
\end{proof}

\begin{definition}[localisation of module]\index{localisation}
  Let \(S \subseteq A\) to be a multiplicative subset and let \(M\) be an \(A\)-module. Then we define \(S^{-1}M\) to be the set of equivalence classes in \(M \times S\) for the relation \((m, s) \sim (m', s')\) if there exists \(t \in S\) such that \(t(ms - m's) = 0\).

  We write \(\frac{m}{s}\) for the equivalence class of \((m, s)\).
\end{definition}

\begin{ex}\leavevmode
  \begin{enumerate}
  \item \(S^{-1}M\) is an \(S^{-1}A\)-module via
    \begin{align*}
      \frac{a}{s} \cdot \frac{m}{s'} &= \frac{am}{ss'} \\
      \frac{a}{s} + \frac{a'}{s'} &= \frac{as' + a's}{ss'}
    \end{align*}
  \item If \(f: M \to N\) is an \(A\)-module homomorphism then there is a homomorphism
    \begin{align*}
      S^{-1}f: S^{-1}M &\to S^{-1}N \\
      \frac{m}{s} &\mapsto \frac{f(m)}{s}
    \end{align*}
  \item \(S^{-1}\) is a functor from the category of \(A\)-modules to the category of \(S^{-1}A\)-modules.
  \end{enumerate}
\end{ex}

\begin{lemma}
  Let
  \[
    \begin{tikzcd}
      M' \ar[r, "f"] & M \ar[r, "f'"] & M''
    \end{tikzcd}
  \]
  be an exact sequence of \(A\)-modules. Then
  \[
    \begin{tikzcd}
      S^{-1}M' \ar[r, "S^{-1}f"] & S^{-1}M \ar[r, "S^{-1}f'"] & S^{-1}M''
    \end{tikzcd}
  \]
  is also exact.
\end{lemma}

\begin{proof}
  \(f' \compose f = 0\) so \(S^{-1}f' \compose S^{-1} f = 0\). For the other inclusion, let \(\frac{m}{s} \in \ker S^{-1} f'\), i.e.\ \(\frac{f'(m)}{s} = 0\), i.e.\ there exists \(s' \in S\) such that \(0 = s'f'(m) = f'(s'm)\) so \(s'm \in \ker f' = \im f\). Hence there exists \(m' \in M'\) such that \(f(m') = s'm\). Then
  \[
    S^{-1}f (\frac{m'}{ss'}) = \frac{f(m')}{ss'} = \frac{s'm}{ss'} = \frac{m}{s}.
  \]
\end{proof}

\begin{corollary}
  If \(f\) is surjective (injective, resp) then so is \(S^{-1} f\).
\end{corollary}

Let \(I \subseteq A\) be an ideal. Then \(I \embed A\) is an injective homomorphism of \(A\)-modules. Hence \(S^{-1}I \embed S^{-1}A\) is an injective homomorphism of \(S^{-1}A\)-module. Hence \(S^{-1}I\) may be identified with an ideal of \(S^{-1}A\). It's the ideal
\[
  S^{-1}A \cdot I = \{\frac{x}{s}: x \in I, s \in S\} \subseteq S^{-1}A.
\]

\begin{proposition}
  Let \(S \subseteq A\) be a multiplicative subset. Then there is a bijection between the following two sets:
  \begin{enumerate}
  \item prime ideals \(P \subseteq A\) such that \(P \cap S = \emptyset\),
  \item prime ideal \(Q \subseteq S^{-1}A\),
  \end{enumerate}
  given by \(P \mapsto S^{-1}P, Q \mapsto f^{-1}(Q)\) where \(f: A \to S^{-1}A\) is the localisation map.
\end{proposition}

\begin{proof}
  Check the maps are well-defined: if \(1 \in S^{-1}P\) then \(\frac{1}{s} = \frac{x}{s}\) for some \(x \in P, s \in S\) so exists \(t \in S\) such that \(t(s - x) = 0\). Then \(ts = tx \in P\) so \(t \in P\) or \(s \in P\).

  If \(\frac{a}{s}, \frac{a'}{s'} \in S^{-1}A\) and \(\frac{aa'}{ss'} \in S^{-1}P\) then \(\frac{aa'}{ss'} = \frac{x}{t}\). Hence exists \(t' \in S\) such that
  \[
    tt' aa' = t'ss'x \in P.
  \]
  Since \(P\) is prime, \(aa' = P\) so \(a \in P\) or \(a' \in P\). Hence \(\frac{a}{s}\) or \(\frac{a'}{s'} \in S^{-1}P\). Thus \(S^{-1}P\) is prime.

  If \(Q \subseteq S^{-1}A\) then \(S^{-1}A/Q\) is a non-zero domain. Then \(A/f^{-1}(Q) \embed S^{-1}A/Q\) so \(A/f^{-1}(Q)\) is also a non-zero domain so \(f^{-1}(Q)\) is a prime ideal (this in fact follows from the fact that pullback of any prime ideal is prime).

  It is left as an exercise to check the maps in the statement of the proposition are mutually inverse bijections.
\end{proof}

\begin{corollary}
  Let \(A\) be a ring and \(P \subseteq A\) a prime ideal. Then
  \begin{enumerate}
  \item \(S = A - P\) is a multiplicative subset of \(A\).
  \item \(S^{-1}A\) is a local ring with unique maximal ideal \(S^{-1} P\).
  \end{enumerate}
  We usually write \(A_P\) for \((A - P)^{-1}A\).
\end{corollary}

For example \(\Z_{(p)} = (\Z - p\Z)^{-1}\Z\).

\begin{proposition}
  Let \(A\) be a Noetherian domain. Then TFAE:
  \begin{enumerate}
  \item For every non-zero prime ideal \(P \subseteq A\), \(A_P\) is a DVR.
  \item \(A\) is integrally closed in \(K = \Frac A\) and every non-zero prime ideal is maximal.
  \end{enumerate}
\end{proposition}

Consequently, for any \(P\) there is the valuation \(v_P: K^\times \to \Z\) associated to \(A_P\).

\begin{definition}[Dedekind domain]\index{Dedekind domain}
  Any ring satisfying the conditions is called a \emph{Dedekind domain}.
\end{definition}

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(1 \implies 2\): wlog we can assume \(A\) does have non-zero prime ideals. Suppose given a relation
    \[
      a^n + a_1 a^{n - 1} + \dots + a_n = 0
    \]
    where \(a \in A, a_i \in A\). Then \(A_P\) is a DVR implies that \(A_P\) is integrally closed in \(K\) so \(a \in A_P\) for all \(P\). Therefore for all \(P\) we can find \(x_P \in A, s_P \in A - P\) such that \(a = \frac{x_P}{s_P}\) in \(K\). In particular \(s_Pa \in A\).

    The ideal
    \[
      I = (s_P: P \subseteq A \text{ non-zero prime ideal})
    \]
    is the unit ideal, since it is not contained in any maximal ideal of \(A\). Therefore there exists element \(t_P \in A\), with only finitely many non-zero, such that
    \[
      1 = \sum_P t_P s_P.
    \]
    Then
    \[
      a = \sum_P t_P s_Pa \in A.
    \]

    Let \(P \subseteq Q\) be non-zero prime ideals of \(A\), with \(Q\) maximal. Then \(PA_Q \subseteq QA_Q\) are non-zero prime ideals of \(A_Q\), a DVR. Hence \(PA_Q = QA_Q\) and \(P = Q\).
  \item \(2 \implies 1\): Again we can assume that \(A\) has a non-zero prime ideal \(P\). We must show \(A_P\) is a DVR, or equivalently that \(A_P\) is integrally closed in \(K\) and has a unique non-zero prime ideal.

    Suppose given a relation
    \[
      \left( \frac{a}{s} \right)^n + \frac{a_1}{s_1} \left( \frac{a}{s} \right)^{n - 1} + \dots + \frac{a_n}{s_n} = 0
    \]
    where \(a, a_1, \dots, a_n \in A, s_1, \dots, s_n \in A - P, s \in A - \{0\}\). Multiply through by \((s_1 \cdots s_n)^n\),
    \[
      \left( \frac{as_1 \cdots s_n}{s} \right)^n + \left( \frac{as_1 \cdots s_n}{s} \right)^{n - 1} a_1 s_2 \cdots s_n + \dots + s_1s_2 \cdots a_n = 0.
    \]
    As \(A\) is integrally closed, \(\frac{as_1 \cdots s_n}{s} \in A\) so
    \[
      \frac{a}{s} = \frac{as_1 \cdots s_n}{s} \cdot \frac{1}{s_1 \cdots s_n} \in A_P
    \]
    so \(A_P\) is integrally closed.

    Let \(Q \subseteq A_P\) be a non-zero prime ideal. Then eixsts \(Q' \subseteq P\) such that \(Q'A_P = Q\). By assumption we must have \(Q' = P\) and hence \(Q = PA_P\).
  \end{itemize}
\end{proof}

\begin{definition}[fractional ideal]\index{fractional ideal}
  Let \(A\) be a domain, \(K = \Frac A\). A \emph{fractional ideal} of \(A\) is a fg \(A\)-submodule of \(K\).
\end{definition}

If \(I, J \subseteq K\) are fractional ideals then
\begin{align*}
  I + J &= \{x + y: x \in I, y \in J\} \\
  IJ &= \{xy: x \in I, y \in J\} \\
\end{align*}
are also fractional ideals. On the other hand,
\[
  (I: J) = \{x \in K: xJ \subseteq I\}
\]
is an \(A\)-submodule of \(K\) but is in general not fg.

\begin{lemma}
  Let \(A\) be a Noetherian domain, \(S \subseteq A\) a multiplicative subset. Then
  \begin{enumerate}
  \item if \(I, J\) are fractional ideals then \(S^{-1}I\) is a fractional ideal of \(S^{-1}A\) and
    \begin{align*}
      S^{-1}(I + J) &= S^{-1}I + S^{-1}J \\
      S^{-1}(IJ) &= S^{-1}I \cdot S^{-1}J
    \end{align*}
  \item if \(I, J\) are fractional ideals of \(A\) and \(J\) is non-zero then \((I : J)\) is a fractional ideal of \(A\) and
    \[
      S^{-1}(I : J) = (S^{-1}I : S^{-1}J).
    \]
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Exercise.
  \item If \(a \in A - \{0\}\) then
    \[
      (I : (a)) = \{x \in K: x(a) \subseteq I\} = \{x \in K: xa \in I\} = a^{-1}I.
    \]
    In partuclar \((I : (a))\) is fg and hence a fractional ideal.

    In general, write \(J = (a_1, \dots, a_n)\) where \(a_i \in K^\times\). Then
    \[
      (I : J) = \{x \in K: \text{for all } i, xa_i \in I\} = \bigcap_{i = 1}^n a_i^{-1}I.
    \]
    In paricular \((I : (a)) \subseteq (I : (a_1))\). Since \(A\) is Noetherian, any submodule of \((I : (a_1))\) is fg and hence \((I : J)\) is a fractional ideal.

    To show \(S^{-1}(I : J) = (S^{-1}I : S^{-1}J)\), we have
    \begin{align*}
      \text{LHS} &= S^{-1} \bigcap_{i = 1}^n a_i^{-1} I \\
      \text{RHS} &= \bigcap_{i = 1}^n a_i^{-1} S^{-1} I = \bigcap_{i = 1}^n S^{-1} (a_i^{-1} I)
    \end{align*}
    so in fact it's enough to show that if \(I, J \subseteq K\) are fractional ideals of \(A\) then
    \[
      S^{-1}(I \cap J) = (S^{-1}I) \cap (S^{-1}J).
    \]
    We certainly have \(S^{-1}(I \cap J) \subseteq (S^{-1}I) \cap (S^{-1}J)\). Suppose \(\frac{x}{s} = \frac{y}{t}\) where \(x \in I, y \in J, s, t \in S\) then \(xt = sy \in I \cap J\) and
    \[
      \frac{x}{s} = \frac{xt}{st} \in S^{-1}(I \cap J).
    \]
  \end{enumerate}
\end{proof}

\begin{proposition}
  Let \(A\) be a Dedekind domain and let \(\Div A\) be the set of non-zero fractional ideals of \(A\). Then \(\Div A\) forms a group under the multiplication of fractional ideals.
\end{proposition}

\begin{proof}
  \(A = (1)\) is a multiplicative identity. Must show that for any non-zero fractional ideal \(I\),
  \[
    I (A : I) = A.
  \]
  Observe that if \(P \subseteq A\) is a non-zero prime ideal then \(IA_P = (\pi_P^i)\) as \(A_P\) is a DVR, so \((A_P: IA_P) = (\pi_P^{-i})\) so
  \[
    \text{LHS}_P = IA_P (A_P: IA_P) = A_P = \text{RHS}_P
  \]
  so it is enough to show that if \(I, J\) are fractional ideals of \(A\) such that \(IA_P = JA_P\) for all \(P\) then \(I = J\). In fact, we are going to show if \(IA_P \subseteq JA_P\) then \(I \subseteq J\). Suppose \(IA_P \subseteq JA_P\) for any non-zero prime ideal \(P \subseteq A\). Let \(x \in I\). Then \(x \in IA_P \subseteq JA_P\) so we can write \(x = \frac{y_P}{s_P}\) where \(y_P \in J, s_P \in A - P\). Now we use
  \[
    (s_P: P \subseteq A \text{ non-zero prime ideal}) = (1)
  \]
  to write \(1 = \sum_P s_P t_P\) where \(t_P \in A\) and only finitely many are non-zero. Then
  \[
    x = \sum_P t_Ps_P x \in J.
  \]
\end{proof}

Observe that for any non-zero \(P\), there is a homomorphism
\begin{align*}
  \Div A &\to \Div A_P \\
  I &\mapsto IA_P
\end{align*}
But \(\Div A_P \cong \Z\) canonically as every non-zero fractional ideal of \(A_P\) has the form \((\pi^i)\) for some \(i \in \Z\).

We can define a homomorphism \(v_P: \Div A \to \Z\) by \(v_P(I) = v_P(x)\) where \(IA_P = (x)\). In particular, for any \(x \in K^\times\), \(v_P((x)) = v_P(x)\). Note that \(v_P\) is surjective since \(P A_P = (\pi)\) as \(v_P(P) = 1\) for any \(P\). Taking the product over all non-zero prime ideals, we get a homomorphism
\[
  \prod_P v_P: \Div A \to \prod_P \Z.
\]
This is injective as we showed that for any \(I, J \in \Div A\), \(I = J\) if and only if for all \(P\), \(I A_P = J A_P\). Now we characterise the image.

\begin{lemma}
  For any \(I \in \Div A\), the set \(\{P: v_P(I) \neq 0\}\) is finite. 
\end{lemma}

In other words, \(\prod_P v_P\) takes values in \(\bigoplus_P \Z \subseteq \prod_P \Z\).

\begin{proof}
  Suppose \(I = (\frac{a_1}{b_1}, \dots, \frac{a_n}{b_n})\) where \(a_i \in A, b_i \in A - \{0\}\). Let \(b = b_1 \cdots b_n\). Then \(J = bI\) is an ideal of \(A\) and
  \[
    v_P(I) = v_P(J) - v_P((b)).
  \]
  So it's enough to prove the lemma in the case \(I \subseteq A\) is an ideal.

  Let \(\alpha \in I - \{0\}\). Then \((\alpha) \subseteq I\) and for any non-zero prime ideal \(P \subseteq A\), \(v_P(\alpha) \geq v_P(I) \geq 0\) so in fact we can assume \(I = (\alpha)\) is principal.

  Now we observe that \(v_P(\alpha) > 0\) if and only if \(\alpha \in P A_P\) if and only if \(\alpha \in P\). So it's enough to show that there are only finitely many \(P\)'s such that \(\alpha \in P\).

  Suppose for contradiction there are infinitely many \(P_1, P_2, \dots\) such that \(\alpha \in P_i\). Define \(J_i = P_1 \cap \cdots \cap P_i\). Then
  \[
    J_1 \supseteq J_2 \supseteq \cdots \supseteq (\alpha)
  \]
  so
  \[
    \alpha J_1^{-1} \subseteq \alpha J_2^{-1} \subseteq \cdots \subseteq A.
  \]
  This is an ascending chain of ideals of \(A\) so there exists \(n \geq 1\) such that \(\alpha J_n^{-1} = \alpha J_{n + 1}^{-1}\). Hence \(J_n = J_{n + 1}\), i.e.
  \[
    P_1 \cap \cdots \cap P_n = P_1 \cap \cdots \cap P_n \cap P_{n + 1}.
  \]
  Choose \(x_i \in P_i - P_{n + 1}\) for \(i \leq n\). Then
  \[
    x_1 \cdots x_n \in P_1 \cap \cdots \cap P_n = P_1 \cap \cdots \cap P_n \cap P_{n + 1}.
  \]
  Since \(P_{n + 1}\) is prime, we have \(x_i \in P_{n + 1}\) for some \(i \leq n\). Absurd.
\end{proof}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item \(\prod_P v_P: \Div A \to \bigoplus_P \Z\) is an isomorphism.
  \item For any \(I \in \Div A\),
    \[
      I = \prod_I P^{v_P(I)}
    \]
    so we have unique factorisation of fractional ideals.
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item It's enough to show
    \[
      v_Q(P) =
      \begin{cases}
        1 & P = Q \\
        0 & \text{otherwise}
      \end{cases}
    \]
    as then \((\delta_{PQ})_Q\) are in the ring and they generate \(\bigoplus_P \Z\). \(v_P(P) = 1\) by definition as \(P A_P\) is the maximal ideal of \(A_P\). If \(Q \neq P\) then we must show \(P A_Q = A_Q\): if \(P A_Q \neq A_Q\) then \(P A_Q \subseteq Q A_Q\) so \(P \subseteq Q\). This is impossible as both \(P\) and \(Q\) are maximal ideals.
  \item \(I = \prod_P P^{v_P(I)}\) if and only if for all \(Q\),
    \[
      v_Q(I) = v_Q(\prod_P P^{v_P(I)}).
    \]
    As \(v_Q(P) = \delta_{PQ}\), RHS equals to \(v_Q(I)\).
  \end{enumerate}
\end{proof}

\section{Complete DVRs}

\begin{definition}[inverse system, inverse limit]\index{inverse limit}
  Suppose given groups \(A_i\) and homomorphisms \(f_i: A_{i + 1} \to A_i\) for all \(i \geq 1\)
  \[
    \begin{tikzcd}
      A_1 & A_2 \ar[l, "f_1"'] & A_3 \ar[l, "f_2"'] & \cdots \ar[l, "f_3"']
    \end{tikzcd}
  \]
  we call such a collection an \emph{inverse system}. Its \emph{inverse limit} is
  \[
    \varprojlim_i A_i = \{(a_i) \in \prod_{i = 1}^\infty A_i: f_i(a_{i + 1}) = a_i \text{ for all } i \geq 1\} \subseteq \prod_{i = 1}^\infty A_i.
  \]
\end{definition}

This is a group. If the \(A_i\)'s (\(f_i\)'s respectively) are abelian groups/rings (homomorphisms/ring homomorphisms) then so is \(\varprojlim_i A_i\).

Suppose \(A\) is a DVR with uniformiser \(\pi\). Then we can make an inverse system
\[
  \begin{tikzcd}
    A/(\pi^1) & A/(\pi^2) \ar[l] & A/(\pi^3) \ar[l] & \cdots \ar[l]
  \end{tikzcd}
\]
with maps the natural quotient maps. There's a homomorphism \(A \to A/(\pi^i)\), hence \(A \to \prod_{i = 1}^\infty A/(\pi^i)\) which takes values in \(\varprojlim_i A/(\pi^i)\).

\begin{definition}[complete]\index{complete DVR}
  We say \(A\) is \emph{complete} if the homomorphism
  \[
    A \to \varprojlim_i A/(\pi^i)
  \]
  is an isomorphism.
\end{definition}

The kernel of this homomorphism is \(\bigcap_{i \geq 1} (\pi^i) = 0\) so \(A\) is complete if and only if the map is surjective.

\begin{lemma}
  TFAE:
  \begin{enumerate}
  \item \(A\) is complete.
  \item \(A\) is complete as a metric space with respect to the metric
    \[
      d(x, y) =
      \begin{cases}
        0 & x = y \\
        2^{-v(x - y)} & x \neq y
      \end{cases}
    \]
  \item \(K\) is complete as a metric space with respect to the metric given by the formula.
  \end{enumerate}
\end{lemma}

\begin{proof}
  We first explain why \(d\) is a metric. \(d\) satisfies the ultrametric triangle inequality
  \[
    d(x, y) \leq \max(d(x, y), d(y, z))
  \]
  for all \(x, y, z\). This is because we can assume \(x, y, z\). Then this is equivalent to
  \[
    v(x - z) \geq \min(v(x - y), v(y - z))
  \]
  but LHS is equal to \(v((x - y) + (y - z))\). This is the axiom defining a valuation.
  \begin{itemize}
  \item \(1 \implies 2\): Let \((a_n)_{n \geq 1}\) be a Cauchy sequence in \(A\), meaning that for all \(\varepsilon > 0\), exists \(N\) such that for all \(n, m \geq N\), \(d(a_n, a_m) < \varepsilon\). Equivalently, for all \(M > 0\), exists \(N(M)\) such that for all \(n, m \geq N(M)\),
    \[
      a_n = a_m \pmod{\pi^M}.
    \]
    We can define \(b = (b_i)_{i \geq 1} \in \prod_{i = 1}^\infty A/(\pi^i)\) by
    \[
      b_n = a_{N(n)} \pmod {\pi^n}
    \]
    By definition of Cauchy sequence, \(b \in \varprojlim_i A/(\pi^i)\). Since \(A\) is a complete DVR, exists \(a \in A\) such that \(a = a_{N(n)} \pmod{\pi^n}\) for all \(n \geq 1\). Hence \(v(a - a_{N(n)}) \geq n\), i.e.\ \(d(a, a_{N(n)}) \leq 2^{-n}\) so \(\lim_{n \to \infty} a_n = a\).
  \item \(2 \implies 1\): Suppose given \((a_n)_{n \geq 1} \in \varprojlim_n A/(\pi^n)\). Let \(\tilde a_n \in A\) be any element such that \(\tilde a_n \pmod{\pi^n} = a_n\). Then for all \(m \geq n\), \(\tilde a_m = \tilde a_n \pmod{\pi^n}\) by definition of inverse limit, i.e.\ \(d(\tilde a_m, \tilde a_n) \leq 2^{-n}\), so \((\tilde a_n)_{n \geq 1}\) is a Cauchy sequence in \(A\). So there exists \(a \in A\) such that \(\tilde a_n \to a\) in \(A\), i.e.\ for all \(M \geq 1\) exists \(N(M)\) such that for all \(n \geq N(M)\), \(\tilde a_n = a \pmod{\pi^M}\). Hence \(a\) is a preimage of \((a_n)_{n \geq 1}\) under the map \(A \to \varprojlim_i A/(\pi^i)\).
  \item \(3 \implies 2\): We must show \(A\) is a closed subspace of \(K\). Claim that
    \[
      A = \{x \in K: d(0, x) \leq 1\},
    \]
    as \(d(0, x) \leq 1\) if and only if \(x = 0\) and \(v(x) \geq 0\).
  \item \(2 \implies 3\): For any \(x, y \in K\),
    \[
      d(\pi x, \pi y) = \frac{1}{2} d(x, y).
    \]
    Let \((a_n)_{n \geq 1}\) be a Cauchy sequence in \(K\). Then there exists \(N \geq 1\) such that \(\pi^N a_n \in A\) for all \(n \geq 1\): there exists \(M\) such that for all \(n, m \geq M\), \(d(a_n, a_m) \leq 1\). Equivalently, \(a_n - a_m \in A\) so it's enough to choose \(N\) so that \(\pi^N a_n \in A\) for \(1 \leq n \leq M\). \((\pi^N a_n)_{n \geq 1}\) is a Cauchy sequence in \(A\) so exists \(a \in A\) such that \(d(\pi^N a_n, a) \to 0\) as \(n \to \infty\). Thus \(a_n \to \pi^{-N} a\) in \(K\).
  \end{itemize}
\end{proof}

\begin{ex}
  Show that \(A\) is also open in \(K\). Show futhermore that \(K\) is totally disconnected.
\end{ex}

\begin{remark}
  When we speak of topology on \(K\) or convergence in \(K\) we always mean with respect to the metric \(d\).
\end{remark}

\begin{proposition}
  Let \(A\) be a DVR, \(\pi \in A\) a uniformiser. Then
  \begin{enumerate}
  \item \(A \to \hat A = \varprojlim_i A/(\pi^i)\) is injective, \(\hat A\) is a complete \(DVR\) and \(\pi\) is a uniformiser of \(\hat A\).
  \item For all \(i \geq 1\), the map \(A/\pi^iA \to \hat A/\pi^i \hat A\) is an isomorphism.
  \item Let \(X \subseteq A\) be a subset of representatives for the residue classes of \(A/(\pi)\), with \(0 \in X\). Then for all \(a \in \hat A\), there exists a unique expression
    \[
      a = \sum_{i = 0}^\infty a_i \pi^i
    \]
    with \(a_i \in X\) for all \(i \geq 0\). This is the \emph{\(\pi\)-adic expansion}\index{\(\pi\)-adic expansion} of \(a\).
  \end{enumerate}
\end{proposition}

\begin{proof}
  We first observe that for all \(a \in A/(\pi^i)\), there exist unique \(a_0, \dots, a_{i - 1} \in X\) such that
  \[
    a = a_0 + a_1 \pi + \dots + a_{i - 1} \pi^{i - 1} \pmod{\pi^i}.
  \]
  Induction on \(i\): for \(i = 1\) this is the definition of \(X\). To show this for \(i + 1\), let \(a \in A/(\pi^{i + 1})\). Then \(a \pmod{\pi^i} \in A/(\pi^i)\) so by induction there exist unqiue \(a_0, \dots, a_{i - 1}\) such that
  \[
    a - (a_0 + a_1 \pi + \dots + a_{i - 1} \pi^{i - 1}) \in \pi^i A/ \pi^{i + 1}A.
  \]
  The map
  \begin{align*}
    X &\to A/(\pi) \to \pi^iA/\pi^{i + 1}A \\
    x &\mapsto x \pmod \pi \\
    &\phantom{\to} y \pmod \pi \mapsto \pi^i y \pmod{\pi^{i + 1}}
  \end{align*}
  is bijective. Hence there eixsts unique \(a_i \in X\) such that
  \[
    a - (a_0 + \dots + a_i \pi^i) = 0 \pmod{\pi^{i + 1}}.
  \]

  Note that we have a commutative diagram
  \[
    \begin{tikzcd}
      A/(\pi^{i + 1}) \ar[r, leftrightarrow] \ar[d] & \{a_0 + a_1 \pi + \dots + a_i \pi^i: a_j \in X\} \ar[d] \\
      A/(\pi^i) \ar[r, leftrightarrow] & \{a_0 + a_1 \pi + \dots + a_{i - 1} \pi^{i - 1}: a_j \in X\}
    \end{tikzcd}
  \]
  where the map on the right is to omit the \(\pi^i\) term. Thus there is a bijection between \(\hat A\) and the set of formal sums \(\sum_{i = 0}^\infty a_i \pi^i\) where \(a_i \in X\) for all \(i \geq 0\). Note that we can't yet think of it as an infinite sum since we haven't yet shown \(\hat A\) is complete. For any \(i\), we set
  \[
    x_ i = a_0 + a_1\pi + \dots + a_{i - 1}\pi^{i - 1} \pmod{\pi^i} \in A/(\pi^i),
  \]
  then \(\sum_{i = 0}^\infty a_i\pi^i\) is simply a short hand for the element \(x = (x_i)_{i \geq 1} \in \varprojlim_i A/(\pi^i) = \hat A\).

  Let's now show \(\hat A\) is a DVR. We know \(A \to \hat A\) is injective. We'll show each non-zero element \(x \in \hat A\) has a unique expression \(x = \pi^n u\) where \(n \geq 0, u \in \hat A^\times\). Let's write \(x = a_0 + a_1 \pi + \cdots\) and say
  \[
    a_0 = a_1 = \dots = a_{n - 1} = 0, a_n \neq 0.
  \]
  Then \(x = \pi^n y\) where \(y = a_n + a_{n + 1} \pi + \cdots\). Note if \(\alpha \in X - \{0\}\) then \(\alpha \pmod \pi\) is non-zero and hence \(\alpha \in A^\times\). Thus \(y = a_n(1 - \pi b)\) where
  \[
    b = 1 - \pi a_n^{-1} a_{n + 1} - \pi^2 a_n^{-1} a_{n + 2} + \cdots \in \hat A.
  \]
  It's enough to show \(1 - \pi b \in \hat A^\times\). An inverse is given by
  \[
    1 + \pi b + \pi^2 b^2 + \cdots \in \hat A.
  \]
  This shows \(\hat A\) is a DVR with uniformiser \(\pi\).

  The map \(A/\pi^i A \to \hat A/ \pi^i \hat A\) is bijective as elements of both sides can be uniquely represented by elements of the form
  \[
    a_0 + a_1 \pi + \dots + a_{i - 1}\pi^{i - 1} \pmod{\pi^i}
  \]
  where \(a_i \in X\). It follows that \(\hat A\) is complete, as the map
  \[
    \hat A \to \varprojlim_i \hat A/\pi^i \hat A \cong \varprojlim_i A/\pi^i A
  \]
  is an isomorphism by the definition of \(\hat A\).
\end{proof}

\begin{remark}
  If \(A\) is complete then \(\hat A \cong A\).
\end{remark}

Observe that if \(K = \Frac A, \hat K = \Frac \hat A\) then the valuation \(v: K^\times \to \Z\) extends to a valuation \(v: \hat K^\times \to \Z\) such that \(\hat A = \{x \in \hat K: v(x) \geq 0\}\).
\[
  \begin{tikzcd}
    A \ar[r, hook] \ar[d, hook] & K \ar[d, hook] \\
    \hat A \ar[r, hook] & \hat K
  \end{tikzcd}
\]

An element of \(\hat A\) admits a unique \(\pi\)-adic expansion \(\sum_{i = 0}^\infty a_i \pi^i\) where \(a_i\) lie in a fixed set representatives in \(A\) for \(A/(\pi)\), and the series \(\sum_{i = 0}^\infty a_i \pi^i\) is a convergent infinite sum in \(\hat A\).

\begin{definition}[\(p\)-adic integer]\index{\(p\)-adic integer}
  Let \(p\) be a prime. Then we define the \emph{\(p\)-adic integers} and \emph{\(p\)-adic rational numbers} to be
  \begin{align*}
    \Z_p &= \hat \Z_{(p)} \\
    \Q_p &= \Frac \Z_p
  \end{align*}
  respectively.
\end{definition}

\(p \in \Z_p\) is a uniformiser and \(\Z_p/(p) \cong \Z_{(p)}/(p)\). To compute the residue field of \(\Z_{(p)}\), we use the exact sequence
\[
  \begin{tikzcd}
    0 \ar[r] & p\Z \ar[r] & \Z \ar[r] & \Z/p\Z \ar[r] & 0
  \end{tikzcd}
\]
of \(\Z\)-modules. It remains exact after localisation so
\[
  \begin{tikzcd}
    0 \ar[r] & p\Z_{(p)} \ar[r] & \Z_{(p)} \ar[r] & (\Z - (p))^{-1} (\Z/p\Z) \ar[r] & 0
  \end{tikzcd}
\]
is still exact so
\[
  \Z_{(p)}/p\Z_{(p)} \cong (\Z - (p))^{-1}\Z/p\Z.
\]
In fact \(\Z/p\Z \to (\Z - (p))^{-1} \Z/p\Z\) is an isomorphism as every element of \(\Z - (p)\) has image in \(\Z/p\Z\) contained in \((\Z/p\Z)^\times\).

As a consequence, we have \(\Z_p/(p) \cong \Z/p\Z\) so we can choose the set of representatives to be \(\{0, 1, \dots, p- 1\}\). It follows that each element of \(\Z_p\) has a unique expression as \(\sum_{i = 0}^\infty a_i p^i\) and each element of \(\Q_p\) has a unique expression \(\sum_{i \in \Z} a_i p^i\) where \(a_i \in \{0, \dots, p_1\}\) and the set \(\{i < 0: a_i \neq 0\}\) is finite.

\begin{eg}
  \(-1 \in \Z \subseteq \Z_2\) has
  \[
    -1 = \frac{1}{1 - 2} = 1 + 2 + 2^2 + \cdots
  \]
\end{eg}

What is \(\Q_p\) like? It is a mixture of \(\R\) and \(\F_p\) and has features of both analytic (\(\R\)) and algebraic (number fields) objects.

\begin{lemma}[Hensel's lemma]\index{Hensel's lemma}
  \label{lem:Hensel's lemma}
  Let \(A\) be a complete DVR. Let \(f(x) \in A[x]\) be monic. Suppose given \(\alpha \in A\) such that \(v(f(\alpha)) > 2v(f'(\alpha))\). Then exists a unique \(a \in A\) such that \(f(a) = 0\) and \(v(a - \alpha) > v(f'(\alpha))\).
\end{lemma}

\begin{corollary}
  Let \(A\) be a complete DVR and \(f(x) \in A[x]\) a monic polnomial. Let \(k = A/(\pi)\) and \(\overline f(x) = f(x) \pmod \pi \in k[x]\). Suppose there exists \(\overline \alpha \in k\) a simple root of \(\overline f(x)\), then exists a unique \(a \in A\) such that \(f(a) = 0\) and \(a = \overline \alpha \pmod \pi\).
\end{corollary}

\begin{proof}
  Let \(\alpha \in A\) be a lift of \(\overline \alpha\). Then \(\overline f'(\overline \alpha) \neq 0\) implies that \(f'(\alpha) \in A^\times\) so \(v(f'(\alpha)) = 0\). Then apply the lemma.
\end{proof}

\begin{proof}[Proof of \nameref{lem:Hensel's lemma}]
  We first show existence of \(a\) by Newton's method. Define
  \[
    a_1 = \alpha, \quad a_{n + 1} = a_n - \frac{f(a_n)}{f'(a_n)}.
  \]
  We show the following claims by induction on \(n \geq 1\):
  \begin{enumerate}
  \item \(a_n \in A\), or equivalently \(v(a_n) \geq 0\).
  \item \(v(f'(a_n)) = v(f'(a_1))\).
  \item \(v(f(a_n)) \geq 2v(f'(a_n)) + 2^{n - 1} v(f(a_1)/f'(a_1)^2)\).
  \end{enumerate}
  For \(n = 1\),
  \begin{enumerate}
  \item \(a_n = \alpha \in A\) by hypothesis.
  \item Tautological.
  \item \(v(f(a_1)) \geq 2v(f'(a_1)) + v(f(a_1)/f'(a_1)^2) = v(f(a_1))\).
  \end{enumerate}
  Suppose the three statements hold for \(1, 2, \dots, n\). We will show they hold for \(n + 1\).
  \begin{enumerate}
  \item By definition \(a_{n + 1} = a_n - f(a_n)/f'(a_n)\) so \(a_{n + 1} \in A\) if and only if \(v(f(a_n)/f'(a_n)) \geq 0\). But 3 says
    \[
      v(f(a_n)/f'(a_n)) \geq v(f'(a_n)) + 2^{n - 1} v(f(a_1)/f'(a_1)^2) \geq 0.
    \]
  \item Enough to show \(v(f'(a_{n + 1})) = v(f'(a_n))\). Easy to see that \(f'(a_{n + 1}) - f'(a_n)\) is divisible by \(-a_{n + 1} + a_n = f(a_n)/f'(a_n)\) so we'll have \(v(f'(a_{n + 1})) = v(f'(a_n))\) if
    \[
      v(f(a_n)/f'(a_n)) > v(f'(a_n)),
    \]
    i.e.\ \(v(f(a_n)/f'(a_n)^2) > 0\). But
    \[
      v(f(a_n)/f'(a_n)^2) \geq 2^{n - 1} v(f(a_1)/f'(a_1)^2) > 0.
    \]
  \item Suppose \(f(x) = \sum_{i = 0}^m a_i x^i\) where \(a_i \in A\). Then we use Taylor expansion with a small tweak
    \begin{align*}
      f(X + Y)
      &= \sum_{i = 0}^m a_i (X + Y)^i \\
      &= \sum_{i = 0}^m a_i (X^i + iX^{i - 1}Y + Y^2 g_i(X, Y)) \quad g_i(X, Y) \in \Z[X, Y] \\
      &= f(X) + f'(X) Y + Y^2 g(X, Y) \quad g(X, Y) \in A[X, Y]
    \end{align*}
    hence
    \begin{align*}
      f(a_{n + 1})
      &= f(a_n - f(a_n)/f'(a_n)) \\
      &= f(a_n) - f'(a_n)f(a_n)/ f'(a_n) \\
      &+ (f(a_n)/f'(a_n))^2 \underbrace{g(a_n, f(a_n)/f'(a_n))}_{\in A}
    \end{align*}
    so
    \begin{align*}
      v(f(a_{n + 1}))
      &\geq 2v(f(a_n)) - 2v(f'(a_n)) \\
      &\geq 2(2v(f'(a_n)) + 2^{n - 1} v(f(a_1)/f'(a_1)^2)) - 2v(f'(a_n)) \\
      &= 2v(f'(a_n)) + 2^n v(f(a_1)/f'(a_1)^2)
    \end{align*}
  \end{enumerate}
  We've also shown \((a_n)_{n \geq 1}\) is a Cauchy sequence as
  \[
    v(a_{n + 1} - a_n) = v(f(a_n)/f'(a_n)) \to \infty
  \]
  as \(n \to \infty\) so there is a limit \(a \in A\). We have \(f(a) = \lim_{n \to \infty} f(a_n) = 0\) so \(a\) is a root.

  For uniqueness, we need to show if \(a + h \in A\) is another root such that \(v(a + h - \alpha) > v(f'(\alpha))\) then \(h = 0\). Since \(v(a - \alpha) > v(f'(\alpha))\), we must have \(v(h) > v(f'(\alpha))\). Using Taylor expansion, we find
  \[
    0 = f(a + h) = f(a) + hf'(a) + h^2 g(a, h)
  \]
  and hence \(hf'(\alpha) = -h^2 g(a, h)\). If \(h \neq 0\) then \(f'(\alpha) = -h g(a, h)\). Hence
  \[
    v(f'(\alpha)) \geq v(h) > v(f'(\alpha)),
  \]
  absurd.
\end{proof}

\begin{eg}
  Which elements in \(\Q_p^\times\) are squares? Any element of \(\Q_p^\times\) admits a unqiue expression \(x = p^n u\) where \(n \in \Z, u \in \Z_p^\times\). Equivalently, there is an isomorphism
  \begin{align*}
    \Q_p^\times &\cong \Z \times \Z_p^\times \\
    x &\mapsto (n, u)
  \end{align*}
  It's enough to determine when \(u \in \Z_p^\times\) is a square. Equivalently, when the polynomial \(f(x) = x^2 - u\) has a root in \(\Z_p\). There is a simple necessary condition from arithmetics: there is a surjective homomorphism \(\Z_p^\times \to \F_p^\times, x \mapsto \overline x \pmod p\) and if \(u \in (\Z_p^\times)^2\) then \(\overline u \in (\F_p^\times)^2\). Let's check if it is sufficient: if \(\overline u \in (\F_p^\times)^2\) and let \(v \in \Z_p^\times\) satisfy \(\overline v^2 = \overline u\). Then \(\overline f(\overline v) = 0\) so we are in the position to use Hensel's lemma. Note \(f'(v) = 2v\) and \(v(f'(v)) = v(2)\). If \(p\) is odd then \(f'(v)\) is a unit, so by the corollary there exists a unique \(w \in \Z_p^\times\) such that \(w^2 = u\) and \(\overline w = \overline v\).

  If \(p = 2\) then we have \(v(f(v)) \geq 1, v(f'(v)) = 1\) so we can't conclude anything yet. Note for any \(n \geq 1\) there is a homomorphism \(\Z_p^\times \to (\Z/p^n\Z)^\times\) so if \(u\) is a square, \(u \pmod{p^n}\) is also a square for any \(n \geq 1\). For \(n = 3\) we have a map
  \[
    \Z_2^\times \to (\Z/8\Z)^\times \cong \Z/2\Z \times \Z/2\Z
  \]
  hence if \(u \in (\Z_2^\times)^2\) then \(u = 1 \pmod 8\). Conversely, if \(u = 1 \pmod 8\) then \(f(1) = 1 - u = 0 \pmod 8\), i.e.\ \(v(f(1)) \geq 3\), and \(f'(1) = 2\) so \(v(f'(1)) = 1\). In this case Hensel's lemma does apply and \(u\) is indeed a square.
\end{eg}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item If \(p\) is odd then \(u \in \Z_p^\times\) is a square if and only if \(u \pmod p \in \F_p^\times\) is a square.
  \item If \(p = 2\) then \(u \in \Z_2^\times\) is a square if and only if \(u = 1 \pmod 8\), or equivalently \(u \pmod 8 \in (\Z/8\Z)^\times\) is a square.
  \end{enumerate}
\end{proposition}

In the example we used the surjective homomorphism
\begin{align*}
  \Z_p^\times &\to \F_p^\times \\
  \sum_{i = 0}^\infty a_i p^i &\mapsto a_0 \pmod p
\end{align*}
In fact, this homomoprhism has a unique splitting, i.e.\ exists a unique homomorphism \(\tau: \F_p^\times \to \Z_p^\times\) such that for all \(\overline \alpha \in \F_p^\times\), \(\tau(\overline \alpha) \pmod p = \overline \alpha\). This \(\tau\) is called the \emph{Teichmüller lift}\index{Teichmüller lift} and is constructed as follow: let \(f(x) = x^p - x\). Then for all \(\overline \alpha \in \F_p, \overline f(\overline \alpha) = 0\), and \(\overline f'(x) = px^{p - 1} - 1 \pmod p = -1\) so never vanishes. So Hensel's lemma says that for all \(\overline \alpha \in \F_p\), exists a unique \(\alpha \in \Z_p\) such that \(\alpha^p = \alpha\) and \(\alpha \pmod{p\Z_p} = \overline \alpha\). Define \(\tau(\overline \alpha) = \alpha\).

If \(\overline \alpha, \overline \beta \in \F_p^\times\) then
\[
  (\tau(\overline \alpha) \tau(\overline \beta))^p
  = \tau(\overline \alpha)^p \tau(\overline \beta)^p
  = \tau(\overline \alpha) \tau(\overline \beta)
\]
and \(\tau(\overline \alpha) \tau(\overline \beta) \pmod{p\Z_p} = \overline \alpha \overline \beta\). Uniqueness part of Hansel's lemma thus says that \(\tau(\overline \alpha \overline \beta) = \tau(\overline \alpha) \tau(\overline \beta)\), i.e.\ \(\tau\) is a homomorphism.

\(\tau\) is the unique splitting: if \(\sigma: \F_p^\times \to \Z_p^\times\) is another splitting then for all \(\overline \alpha \in \F_p^\times\),
\[
  \sigma(\overline \alpha)^p = \sigma(\overline \alpha^p) = \sigma(\overline \alpha)
\]
so \(f(\sigma(\overline \alpha)) = 0\). Uniqueness again says that \(\sigma = \tau\).

As a consequence
\[
  \Q_p^\times \cong \Z \times \Z_p^\times \cong \Z \times (1 + p \Z_p) \times \F_p^\times
\]
corresponding to the expression \(p^n \cdot u \cdot \tau(\overline \alpha)\). There is an isomorphism
\[
  1 + p \Z_p \cong \varprojlim_i \underbrace{\ker ((\Z/p^i\Z)^\times \to (\Z/p\Z)^\times)}_{\text{\(p\)-power order}}
\]
so for any \(n \in \N, (n, p) = 1\), the map
\begin{align*}
  1 + p \Z_p &\to 1 + p\Z_p \\
  x &\mapsto x^n
\end{align*}
is a bijective group homomorphism. Hence there is an isomorphism
\[
  \Q_p^\times /(\Q_p^\times)^n \cong \Z/n\Z \times \F_p^\times/(\F_p^\times)^n.
\]

Suppose \(q\) is a prime such that \(p = 1 \pmod q\). Then \(\Q_p^\times\) contains a primitive \(q\)th root of unit \(\zeta_q\). This is because \(\zeta_q \in \Q_p^\times\) if and only if \(\Q_p^\times\) contains an element of order \(q\). But \(\F_p^\times\) is cyclic of order \(p - 1\) so this is true.

\begin{lemma}
  Under this assumption, \(\Q_p\) has exactly \(q + 1\) isomorphism classes of Galois extensions of degree \(q\).
\end{lemma}

\begin{proof}
  Since \(\zeta_q \in \Q_p^\times\), Kummer theory tells us that such extensions correspond to subgroups of \(\Q_p^\times/(\Q_p^\times)^q\) of order \(q\), where an element \(z\) of the subgroup corresponds to the extension \(\Q_p(\sqrt[q]{z})\). We've computed \(\Q_p^\times/(\Q_p^\times)^q \cong \Z/q\Z \times \Z/q\Z\), which has \(q + 1\) subgroups of order \(q\).
\end{proof}

Before the end of the chapter, we briefly indicate where we're heading: we define \(K_Q\) to be the fraction field associated to the completion of \(\O_K\) localised at \(Q\). Then we are going to consider its ``rings of integers'' \(\O_{K_Q}\) so we have the following picture:
\[
  \begin{tikzcd}
    K \ar[d, dash] & \O_K \ar[d, dash] & Q \ar[d, dash] & \O_{K_Q} \ar[d, dash] & \ar[d, dash] K_Q \\
    \Q & \Z & p\Z & \Z_p & \Q_p
  \end{tikzcd}
\]
If \(K/\Q\) is Galois then so is \(K_Q/\Q_p\) and \(\gal(K_Q/\Q_p) \embed \gal(K/\Q)\), and we are going to study \(\gal(K_Q/\Q_p)\) in detail.

\section{Extensions of Dedekind domains}

Let \(A\) be a Dedekind domain and \(K = \Frac A\). Let \(E/K\) be a finite separable extension.

\begin{definition}[integral element]\index{integral element}
  We say \(\gamma \in E\) is \emph{integral} over \(A\) if exists \(n \geq 1\), \(a_1, \dots, a_n \in A\) such that
  \[
    \gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0.
  \]
\end{definition}

\begin{lemma}
  TFAE:
  \begin{enumerate}
  \item \(\gamma\) is integral over \(A\).
  \item \(A[\gamma]\) is a finitely generated \(A\)-module.
  \item there exists a non-zero \(A[\gamma]\)-submodule \(M \leq E\) which is a finitely generated \(A\)-module.
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(1 \implies 2\): If \(\gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0\) then \(A[\gamma] = A + A \gamma + \dots + A\gamma^{n - 1}\).
  \item \(2 \implies 1\): \(A\) is Noetherian and \(A[\gamma]\) is a finitely generated \(A\)-module so
    \[
      A \subseteq A + A[\gamma] \subseteq A + A\gamma + A[\gamma^2] \subseteq \cdots
    \]
    is eventually stationary, so exists \(n \geq 1\) such that \(\gamma^n \in A + A\gamma + \dots + A\gamma^{n - 1}\).
  \item \(2 \implies 3\): \(M = A[\gamma]\).
  \item \(3 \implies 2\): Since \(M\) is finitely generated and \(A\) is Noetherian, \(\End_A(M)\) is a finitely generated \(A\)-module. Since \(M\) is non-zero, \(A[\gamma] \to \End_A(M), x \mapsto (m \mapsto xm)\) is an injective homomorphism of \(A\)-modules. Hence \(A[\gamma]\) is a finitely generated \(A\)-module.
  \end{itemize}
\end{proof}

Let \(B = \{\gamma \in E: \gamma \text{ integral over } A\}\), the integral closure of \(A\) in \(E\).

\begin{lemma}
  \(B\) is a subring of \(E\) and \(B\) is integrally closed in \(E\).
\end{lemma}

\begin{proof}
  Suppose \(b_1, \dots, b_m \in B\). Then \(A[b_1, \dots, b_m]\) is a finitely generated \(A\)-module: if we have relations
  \[
    b_i^{n_i} + a_{1, i} b_i^{n_i - 1} + \dots + a_{n_i, i} = 0
  \]
  for all \(i\) then \(\{\prod_{i = 1}^m b_i^{m_i}: 0 \leq m_i < n_i\}\) is a generating set for \(A[b_1, \dots, b_m]\).

  This also shows that \(B\) is a ring: if \(b_1, b_2 \in B\) then \(A[b_1, b_2] \subseteq E\) is a fg \(A\)-module stable under multiplication by \(b_1 + b_2\) and \(b_1b_2\). So part 3 of the lemma implies that \(b_1 + b_2, b_1b_2 \in B\).

  Now suppose \(\gamma \in E\) and exists \(n \geq 1\), \(b_1, \dots, b_n \in B\) such that
  \[
    \gamma^n + b_1 \gamma^{n - 1} + \dots + b_n = 0.
  \]
  We must show \(\gamma \in B\). This relation shows \(A[b_1, \dots, b_n][\gamma] = A[b_1, \dots, b_n, \gamma]\) is a fg \(A[b_1, \dots, b_n]\)-module. But \(A[b_1, \cdots, b_n]\) is a fg \(A\)-module, so \(A[b_1, \dots, b_m, \gamma]\) is a fg \(A\)-module: if \(\{x_i\}\) generates \(A[b_1, \dots, b_m, \gamma]\) as an \(A[b_1, \dots, b_m]\)-module and \(\{y_j\}\) generates \(A[b_1, \dots, b_m]\) as an \(A\)-module then \(\{x_i y_j\}\) generates \(A[b_1, \dots, b_n, \gamma]\) as an \(A\)-module. In particular \(\gamma\) is integral over \(A\) so \(\gamma \in B\).
\end{proof}

\begin{lemma}
  Let \(T: E \times E \to K\) be the symmetric \(K\)-bilinear form defined by \(T(x, y) = \tr_{E/K} (xy)\). Then \(T\) is nondegenerate.
\end{lemma}

\begin{proof}
  This is a consequence of the assumption that \(E/K\) is separable. Let \(L/K\) be the Galois closure of \(E/K\). Let \(\sigma_1, \dots, \sigma_n: E \to L\) be the distinct \(K\)-embeddings, where \(n = [E: K]\). Then for all \(x \in E\)
  \[
    \tr_{E/K}(x) = \sigma_1(x) + \dots + \sigma_n(x).
  \]
  Recall from Galois theory that \(\sigma_1, \dots, \sigma_n\) are linearly independent (over \(K\)) as homomorphisms \(\sigma_i: E^\times \to L^\times\), so there exists \(x \in E^\times\) such that \(\sigma_1(x) + \dots + \sigma_n(x) \neq 0\) and therefore \(\tr_{E/K}(x) \neq 0\). Then for all \(y \in E^\times\),
  \[
    T(xy^{-1}, y) = \tr_{E/K}(x) \neq 0,
  \]
  i.e.\ \(\ker T = 0\) and \(T\) is nondegenerate.
\end{proof}

\begin{remark}
  If \(x \in B\) then \(\tr_{E/K}(x) \in A\): \(\sigma_i(x) \in L\) is integral over \(A\) and hence \(\sigma_1(x) + \dots + \sigma_n(x)\) is an element of \(L\) which is in \(K\) and integral over \(A\). \(A\) being integrally closed implies that \(\tr_{E/K}(x) \in A\).
\end{remark}

Observe that if \(S \subseteq A\) is multiplicatively closed and \(0 \notin S\) then \(S^{-1}A\) is a Dedekind domain with field of fractions \(K\). Moreover, the integral closure of \(S^{-1}A\) in \(E\) is \(S^{-1}B\). This is because \(S^{-1}B\) is contained in the integral closure of \(S^{-1}A\) in \(E\). Conversely, if \(\gamma \in E\) satisfies
\[
  \gamma^n + \frac{a_1}{s_1} \gamma^{n - 1} + \cdots + \frac{a_n}{s_n} = 0
\]
where \(a_i \in A, s_i \in S\) then
\[
  (\gamma s_1 \cdots s_n)^n + \frac{a_1}{s_1} (s_1 \cdots s_n)^{n - 1} (\gamma s_1 \cdots s_n)^{n - 1} + \cdots = 0
\]
and hence \(\gamma s_1 \cdots s_n \in B\) so \(\gamma \in S^{-1}B\).

For example \((A - \{0\})^{-1} A = K\) so \((A - \{0\})^{-1}B = E\). In particular \(B\) always span \(E\) as a \(K\)-vector space and \(\Frac B = E\).

\begin{proposition}
  \(B\) is fg as \(A\)-module and is a Dedekind domain.
\end{proposition}

\begin{proof}
  Let \(e_1, \dots, e_n\) be basis of \(E\) as \(K\)-vector space. We assume that in fact \(e_1, \dots, e_n \in B\). Recall that there is a \(K\)-bilinear form \(T: E \times E \to K, (x, y) \mapsto \tr_{E/K}(xy)\) and is nondegenerate as \(E/K\) is separable. Moreover if \(x \in B\) then \(\tr_{E/K}(x) \in A\). Let \(f_1, \dots, f_n\) be the dual basis of \(e_1, \dots, e_n\) with respect to \(T\), i.e.\ for all \(i, j\), \(T(e_i, f_j) = \tr_{E/K}(e_if_j) = \delta_{ij}\). If \(x \in B\) we can write \(x = \sum_{j = 1}^n a_jf_j\) where \(a_j \in K\), and
  \[
    \tr_{E/K}(x e_i) = T(x, e_i) = \sum_{j = 1}^n a_j T(f_j, e_i) = a_i \in A.
  \]
  As \(x\) is arbitrary, this shows \(B \subseteq \sum_{j = 1}^n Af_j\). As \(A\) is Noetherian, \(B\) is fg as an \(A\)-module. Hence \(B\) is fg as an \(A\)-algebra, so by Hilbert basis theorem \(B\) is Noetherian as a ring.

  To show \(B\) is a Dedekind domain, it remains to show that every non-zero prime ideal \(Q \subseteq B\) is maximal or equivalently, \(B/Q\) is a field. To show this let \(P = A \cap Q\). Then \(P\) is prime. It is also non-zero: if \(\gamma \in Q - \{0\}\) then it satisfies an equation
  \[
    \gamma^m + a_1 \gamma^{m - 1} + \dots + a_m = 0
  \]
  where \(a_i \in A\). We can assume \(a_m \neq 0\) (otherwise divide by \(\gamma\)). Then
  \[
    a_m = - (\gamma^m + a_1 \gamma^{m - 1} + \dots + a_{m - 1} \gamma) \in A \cap Q - \{0\}.
  \]
  \[
    \begin{tikzcd}
      E \ar[r, dash] \ar[d, dash] & B \ar[r, dash] \ar[d, dash] & Q \ar[d, dash] \\
      K \ar[r, dash] & A \ar[r, dash] & P
    \end{tikzcd}
  \]
  We have an injective ring homomorphism \(A/P \to B/Q\) where \(A/P\) is a field, \(B/Q\) is a domain and \(B/Q\) is finite dimensional as an \(A/P\)-vector space (as \(B\) is fg as \(A\)-module). It follows that \(B/Q\) is a field: let \(\alpha \in B/Q - \{0\}\) and consider the map \(M_\alpha: B/Q \to B/Q, \beta \mapsto \beta\alpha\). \(M_\alpha\) is a linear map of \(A/P\)-vector spaces and is injective because \(A \neq 0\) and \(B/Q\) is a domain. Since \(B/Q\) has finite dimension, \(M_\alpha\) must be surjective. Hence exists \(\alpha' \in B/Q\) such that \(M_\alpha(\alpha') = \alpha\alpha' = 1\).
\end{proof}

We showed in the proof that if \(Q \subseteq B\) is a non-zero prime ideal then \(P = A \cap Q \subseteq A\) is a non-zero prime ideal. In this case, we say \emph{\(Q\) lies above \(P\)}\index{lie above}. We have \(Q\) lies above \(P\) if and only if \(Q \supseteq PB\) if and only if \(v_Q(PB) > 0\) where \(v_Q: E^\times \to \Z\) is the valuation corresponding to \(Q\). This is left as an exercise.

\begin{definition}[residue degree, ramification index]\index{residue degree}\index{ramification index}
  If \(Q\) lies above \(P\), we define the \emph{residue degree} of \(Q\) over \(P\) to be
  \[
    f_{Q/P} = [B/Q: A/P]
  \]
  and the \emph{ramification index} to be
  \[
    e_{Q/P} = v_Q(PB).
  \]
\end{definition}
Note that they are both integers greater than \(0\).

\begin{proposition}
  Let \(P \subseteq A\) be a non-zero prime ideal. Then
  \[
    \sum_{v_Q(PB) > 0} e_{Q/P} f_{Q/P} = [E : K].
  \]
\end{proposition}

\begin{proof}
  Let \(S = A - P\). Then \(S^{-1}B\) is the integral closure of \(S^{-1}A\). In addition localisation preserves residue degree and ramification index: we have
  \[
    e_{S^{-1}Q/S^{-1}P} = e_{Q/P}, \quad f_{S^{-1}Q/S^{-1}P} = f_{Q/P}.
  \]
  The first is because by unique factorisation,
  \begin{align*}
    PB &= \prod_Q Q^{e_{Q/P}} \\
    S^{-1}PB &= \prod_{Q} (S^{-1}Q)^{e_{Q/P}}
  \end{align*}
  so by prime ideal correspondence for localisation we must have equality. The second is because the maps \(A/P \to S^{-1}A/S^{-1}P, B/Q \to S^{-1}B/S^{-1}Q\) are both isomophisms. Therefore we can replace \(A\) by \(S^{-1}A\) and assume that \(A\) is a DVR, in particular a PID. Then \(B\) is a fg \(A\)-module which is torsion free, so we can use the classification of fg modules over a PID to conclude that as an \(A\)-module, \(B \cong A^n\) for some \(n \in \N\). Then
  \[
    E = (A - \{0\})^{-1}B \cong (A - \{0\})^{-1}A^n \cong K^n
  \]
  and hence \(n = [E : K]\).

  Reducing modulo \(P\), we have an isomorphism \(B/PB \cong (A/P)^n\) of \(A/P\)-vector spaces. By Chinese remainder theorem we have an isomorphism
  \[
    B/PB \cong \prod_{Q: v_Q(PB) > 0} B/Q^{v_Q(PB)}.
  \]
  Hence
  \[
    [E : K] = n = \sum_{Q: v_Q(PB) > 0} \dim_{A/P} B/Q^{v_Q(PB)}.
  \]
  We have a chain of inclusions
  \[
    B \supseteq Q \supseteq Q^2 \supseteq \cdots \supseteq Q^{v_Q(PB)}
  \]
  so
  \[
    \dim_{A/P} B/Q^{v_Q(B)} = \sum_{i = 0}^{e_{Q/P} - 1} \dim_{A/P} Q^i/Q^{i + 1}.
  \]
  For any \(i \geq 0\), \(Q^i/Q^{i + 1}\) has dimension \(1\) as a \(B/Q\)-vector space (as \(Q^i/Q^{i + 1} \to Q^iB_Q/Q^{i + 1}B_Q\) is an isomorphism, so can reduce to the case of \(B_Q\)). Therefore
  \[
    \dim_{A/P} Q^i/Q^{i + 1} = [B/Q : A/P] \dim_{B/Q} Q^i/Q^{i + 1} = f_{Q/P}.
  \]
  We thus get
  \[
    [E : K] = n = \sum_{Q: v_Q(PB) > 0} \sum_{i = 0}^{e_{Q/P} - 1} f_{Q/P} = \sum_Q e_{Q/P} f_{Q/P}.
  \]
\end{proof}

\[
  \begin{tikzcd}
    E \ar[r, dash] \ar[d, dash] & B \ar[r, dash] \ar[d, dash] & \{Q_1, \dots, Q_r\} \ar[d, dash] \\
    K \ar[r, dash] & A \ar[r, dash] & P
  \end{tikzcd}
\]
Let \(e_i = e_{Q_i/P}, f_i = f_{Q_i/P}\) and so \(\sum_{i = 1}^r e_if_i = [E : K]\).

\begin{definition}[unramified ideal, split ideal]\index{unramified ideal}\index{split ideal}
  If for all \(1 \leq i \leq r, e_i = 1\), \(B/Q_i\) is a separable extension of \(A/P\) we say \(P\) is \emph{unramified} in \(B\) (or \(E\)).

  If for all \(1 \leq i \leq r, e_i = f_i = 1\), we say \(P\) \emph{splits completely} in \(B\) (or \(E\)).
\end{definition}

\begin{notation}
  If \(P\) is a prime ideal in a Dedekind domain then we write \(k_P\) for the quotient field by \(P\). For example \(k_Q = B/Q, k_P = A/P\).
\end{notation}

\begin{eg}
  If \(E/\Q\) is a number field (i.e.\ finite extension), we write \(\O_E\) for the integral closure of \(\Z\) in \(K\). If \(E = \Q(\sqrt d)\) where \(d \in \Z, d \neq 0, 1\) is a squarefree integer, then we can show
  \[
    \O_E =
    \begin{cases}
      \Z[\sqrt d] & d = 2, 3 \pmod 4 \\
      \Z[\frac{1 + \sqrt d}{2}] & d = 1 \pmod 4
    \end{cases}
  \]
  Note \(\sqrt d\) satisfies \(X^2 - d = 0\) and \(\frac{1 + \sqrt d}{2}\) satisfied \(X^2 - X + \frac{1 - d}{4}\). This shows the given rings are at least subrings of \(\O_E\). To show there's nothing else, let \(\alpha \in \O_E\). We can write \(\alpha = a + b \sqrt d\) where \(a, b \in \Q\). Note \(\gal(E/\Q)\) acts on \(E\) and preserves \(\O_E\): if \(\alpha \in \O_E\) so
  \[
    \alpha^n + a_1 \alpha^{n - 1} + \dots + a_n = 0
  \]
  for \(a_i \in \Z\), and \(\sigma \in \gal(E/\Q)\) then
  \[
    \sigma(\alpha)^n + a_1 \sigma(\alpha)^{n - 1} + \dots + a_n = 0
  \]
  so \(\sigma(\alpha) \in \O_E\). Hence \(\overline \alpha = a - b\sqrt d \in \O_E\) so
  \begin{align*}
    \alpha + \overline \alpha &= 2a \in \O_E \cap \Q = \Z \\
    \alpha \overline \alpha &= a^2 - b^2d \in \Z
  \end{align*}
  we can make substitution \(a = \frac{u}{2}\) where \(u \in \Z\) to get \(u^2 - 4b^2d \in 4\Z\) so \(4b^2d \in \Z\). Let \(p\) be an odd prime. Then
  \[
    v_p(4b^2d) = v_p(d) + 2v_p(b) \geq 0.
  \]
  \(d\) is squarefree so \(v_p(d) \in \{0, 1\}\). Hence \(v_p(b) \geq 0\). Similarly
  \[
    v_2(4b^2d) = v_2(d) + 2(v_2(b) + 1) \geq 0
  \]
  so \(v_2(b) \geq -d\). So we can write \(b = \frac{v}{2}\) for some \(v \in \Z\). Then
  \[
    4 \alpha \overline \alpha = u^2 - dv^2 \in 4\Z,
  \]
  i.e.\ \(u^2 = dv^2 \pmod 4\). If \(d = 2, 3 \pmod 4\) this forces both \(u, v \in 2\Z\) so have \(a, b \in \Z\), and therefore \(\alpha \in \Z[\sqrt d]\). If \(d = 1 \pmod 4\) we get \(u^2 = v^2 \pmod 4\) so \(u = v \pmod 2\). This shows \(\O_E = \Z[\frac{1 + \sqrt d}{2}]\) in this case.

  Next we show how to factorise \(p \O_E\) when \(p\) is a prime number. First suppose \(p\) is odd. Then it's enough to factorise \(p\O_E[\frac{1}{2}] = p\Z[\frac{1}{2}, \sqrt d]\). We compute
  \[
    \frac{\O_E[\frac{1}{2}]}{p \O_E[\frac{1}{2}]}
    = \frac{\Z[\frac{1}{2}, \sqrt d]}{p \Z[\frac{1}{2}, \sqrt d]}
    = \frac{\Z[\frac{1}{2}, X]}{(X^2 - d, p)}
    = \frac{\F_p[X]}{(X^2 - d)}
    =
    \begin{cases}
      \F_ p \times \F_p & \legendre{d}{p} = 1 \\
      \F_{p^2} & \legendre{d}{p} = -1 \\
      \F_p[X]/(X^2) & p \divides d
    \end{cases}
  \]
  Now suppose \(p \O_E = \prod_Q Q^{e_{Q/P}}\), then by Chinese remainder theorem
  \[
    \O_E/p\O_E \cong \prod_Q (\O_E/Q^{e_{Q/P}}).
  \]
  There are three possible isomorphism classes of this quotient, corresponding to that for \(\O_E[\frac{1}{2}]/p\O_E[\frac{1}{2}]\):
  \begin{itemize}
  \item \(p\) splits completely if \(\legendre{d}{p} = 1\).
  \item \(p\) is unramified (and not split) if \(\legendre{d}{p} = -1\).
  \item \(p\) is ramified if \(p \divides d\).
  \end{itemize}

  It remains to treat the case \(p = 2\). If \(d = 2, 3 \pmod 4\) then
  \[
    \O_E/2\O_E \cong \F_2[X]/(X^2 - d) = \F_2[X]/((X - d)^2)
  \]
  so \(2\) is ramified in \(\O_E\) in this case. If \(d = 1 \pmod 4\) then
  \[
    \O_E/2\O_E \cong \F_2[X]/(X^2 - X + \frac{1 - d}{4})
  \]
  so
  \begin{itemize}
  \item \(2\) splits completely if \(\frac{1 - d}{4}\) is even, i.e.\ \(d = 1 \pmod 8\).
  \item \(2\) is unramified (and not split) if \(\frac{1 - d}{4}\) is odd, i.e.\ \(d = 5 \pmod 8\).
  \end{itemize}

  This is a rather hands-on method and can be inefficient for large number fields. Soon we'll see another method to determine the factorisation of \(p \O_E\) for a general number field \(E\) based on factorisations in \(\Q_p[X]\).
\end{eg}

Now suppose \(A, K, E, B\) are as before and suppose \(E/K\) is Galois with \(G = \gal(E/K)\). Then the action of \(G\) on \(E\) leaves \(B\) invariant.

\begin{proposition}
  Le \(Q \subseteq B\) be a non-zero prime ideal, \(P = Q \cap A\). Then
  \begin{enumerate}
  \item \(G\) acts transitively on the set of prime ideals of \(B\) which lie above \(P\).
  \item for all \(\sigma \in G\), \(f_{\sigma(Q)/P} = f_{Q/P}\) and \(e_{\sigma(Q)/P} = e_{Q/P}\).
  \item If \(g_{Q/P}\) is the number of prime ideals lying above \(P\) then \(e_{Q/P} f_{Q/P} g_{Q/P} = [E : K] = |G|\).
  \end{enumerate}
\end{proposition}

\begin{proof}
  If \(\sigma \in G\) then \(\sigma(Q) \subseteq B\) is a prime ideal and
  \[
    \sigma(Q) \cap A = \sigma(Q) \cap \sigma(A) = \sigma(Q \cap A) = Q \cap A = P.
  \]
  To show the action is transitive, we can assume \(A\) is DVR by replacing \(A\) with \(A_P\). Then \(B\) has only finitely many prime ideals so by example sheet 1 is a PID. Let \(\pi \in B\) be a generator of \(Q\). Then
  \[
    N_{E/K}(\pi) = \prod_{\sigma \in G} \sigma(\pi) \in Q \cap A = P.
  \]
  If \(Q'\) is another prime ideal of \(B\) which lies above \(P\) then \(N_{E/K}(\pi) \in Q'\) and hence (as \(Q'\) is prime) there exists \(\sigma \in G\) such that \(\sigma(\pi) \in Q'\). Hence \(\sigma(Q) \subseteq Q'\) so equality.

  For the second part, \(\sigma|_B: B \to B\) is an automorphism. If \(\sigma(Q) = Q'\) then it descends to an isomorphism \(B/Q \cong B/Q'\) which acts as identity on \(A/P\). In other words, \(\sigma\) determines an isomorphism \(k_Q \to k_{Q'}\) of extensions of \(k_P\). In particular \(f_{Q/P} = f_{Q'/P}\). By definition we can factorise \(PB = \prod_Q Q^{e_{Q/P}}\). Then for all \(\sigma \in G\),
  \[
    \sigma(PB) = \prod_Q \sigma(Q)^{e_{Q/P}}
  \]
  so by unique factorisation for all \(Q\) have \(e_{Q/P} = e_{\sigma(Q)/P}\).

  Finally
  \[
    [E: K] = \sum_{Q'} e_{Q'/P} f_{Q'/P} = e_{Q/P} f_{Q/P} g_{Q/P}
  \]
  as \(e_{Q'/P} = e_{Q/P}, f_{Q'/P} = f_{Q/P}\) for all \(Q'\).
\end{proof}

We just saw that if \(\sigma(Q) = Q\) then \(\sigma|_B \pmod Q\) is an automorphism of \(k_Q\).

\begin{definition}[decomposition group]\index{decomposition group}
  If \(Q \subseteq B\) lies above \(P \subseteq A\) then the \emph{decomposition group} \(D_{Q/P} = \operatorname{Stab}_G(Q)\).
\end{definition}

\begin{proposition}
  Suppose \(Q \subseteq B\) is a non-zero prime ideal and \(P = Q \cap A\) and suppose \(k_Q/k_P\) is separable. Then
  \begin{enumerate}
  \item \(k_Q/k_P\) is a Galois extension.
  \item the map \(D_{Q/P} \to \gal(k_Q/k_P), \sigma \mapsto \sigma|_B \pmod Q\) is a surjective group homomorphism.
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item We must show \(k_Q\) is normal, i.e.\ for all \(\overline \alpha \in k_Q\), all Galois conjugates of \(\overline \alpha\) in a normal closure of \(k_Q\) actually lie in \(k_Q\). Fix \(\overline \alpha \in k_Q = B/Q\). Choose any \(\alpha \in B\) such that \(\alpha \pmod Q = \overline \alpha\). Define
    \[
      f(X) = \prod_{\sigma \in G} (X - \sigma(\alpha)) \in B[X].
    \]
    The coefficients of \(f(X)\) are invariant under \(G\), so lie in \(E^G = K\), so in \(B \cap K = A\). Define \(\overline f(X) = f(X) \pmod P \in k_P[X]\). Observe that \(\overline f(X)\) has \(\overline \alpha\) as a root and \(\overline f(X)\) splits into linear factors in \(k_Q[X]\). \(k_Q\) is normal, hence Galois.
  \item Since \(k_Q/k_P\) is separable, there exists \(\overline \alpha \in k_Q\) such that \(k_Q = k_P(\overline \alpha)\), i.e.\ \(\overline \alpha\) is a primitive element. Let \(Q = Q_1, Q_2, \dots, Q_r\) be the prime ideals lying above \(P\). By Chinese remainder theorem we can find \(\alpha \in B\) such that \(\alpha \pmod Q = \overline \alpha\), and for each \(2 < i \leq r\), \(\alpha \pmod{Q_i} = 0\). Let \(f(X) = \prod_{\sigma \in G}(X - \sigma(\alpha)) \in A[X]\). Let \(\overline f(X) = f(X) \pmod Q \in k_P[X]\). Then
    \begin{align*}
      \overline f(X)
      &= \prod_{\sigma \in G} (X - \sigma(\alpha) \pmod Q) \\
      &= \prod_{\sigma \in D_{Q/P}} (X - \sigma (\alpha) \pmod Q)
      \cdot \prod_{\sigma \notin D_{Q/P}} (X - \sigma (\alpha) \pmod Q)
    \end{align*}
    Note if \(\sigma \notin D_{Q/P}\) then \(\sigma^{-1}(Q) = Q_i\) for some \(i > 1\) and hence
    \[
      \sigma(\alpha) \pmod Q = \sigma(\alpha) + Q= \sigma(\alpha + \sigma^{-1}(Q)) = \sigma(\alpha + Q_i).
    \]
    By construction \(\alpha \in Q_i\) so \(\sigma(\alpha) \pmod Q = 0\). Hence \(\overline f(X) = \overline g(X) X^d\) where
    \[
      \overline g(X) = \prod_{\sigma \in D_{Q/P}} (X - \sigma(\alpha) \pmod Q) \in k_P[X]
    \]
    and \(d = |G| - |D_{Q/P}|\). Suppose \(\tau \in \gal(k_Q/k_P)\). Then \(\tau(\overline \alpha)\) is also a root of \(\overline g(X)\). Hence exists \(\sigma \in D_{Q/P}\) such that \(\sigma(\alpha) \pmod Q = \tau(\overline \alpha)\). Since \(k_Q = k_P(\overline \alpha)\), this forces \(\sigma|_B \pmod Q = \tau\).
  \end{enumerate}
\end{proof}

As an application, suppose \(E/K\) is a Galois extension of number fields. Note if \(P \subseteq \O_K\) is a non-zero prime ideal then \(k_P\) is a finite field so perfect (i.e.\ any finite extension is separable). If \(Q\) is a prime ideal of \(\O_E\) lying above \(P\) then \(\gal(k_Q/k_P)\) has a canonical generator, i.e.\ the Frobenius automorphism \(\alpha \mapsto \alpha^{|k_P|}\). Observe that
\[
  |D_{Q/P}| = |G|/g_{Q/P} = e_{Q/P} f_{Q/P}
\]
and \(|\gal(k_Q/k_P)| = f_{Q/P}\) so
\[
  |\ker (D_{Q/P} \to \gal(k_Q/k_P))| = e_{Q/P}
\]
so if \(P\) is unramified in \(E\) then \(D_{Q/P} \to \gal(k_Q/k_P)\) is an isomorphism. Thus we can specifiy an element \(\Frob_{Q/P} \in D_{Q/P} \subseteq G\) uniquely by defining \(\Frob_{Q/P}\) to be the preimage of Frobenius automorphism in \(\gal(k_Q/k_P)\).

\begin{eg}
  Let \(f(X) = X^n + a_1X^{n - 1} + \dots + a_n \in \Z[X]\) irreducible. Let \(E\) be the splitting field of \(f(X)\) over \(\Q\). Let \(\alpha_1, \dots, \alpha_n \in E\) be the roots of \(f(X)\). Then there is an injection \(\varphi: \gal(E/\Q) \embed S_n = \operatorname{Sym}(\alpha_1, \dots, \alpha_n)\).

  Suppose \(p\) is a prime element such that \(\overline f(X) = f(X) \pmod p \in \F_p[X]\) factors as \(\overline f(X) = \prod_{i = 1}^r \overline f_i(X)\) where \(\overline f_1(X), \dots, \overline f_r(X)\) are distinct monic irreducible polynomials in \(\F_p[X]\) (equivalently \(p \ndivides \operatorname{disc} f\)).
\end{eg}

\begin{proposition}
  The image of \(\gal(E/\Q)\) in \(S_n\) contains a permutation of cycle types \((d_1) (d_2) \cdots (d_r)\) where \(d_i = \deg \overline f_i(X)\).
\end{proposition}

\begin{proof}
  Choose \(Q \subseteq \O_E\) lying above \((p) \subseteq \Z\). Let \(\overline \alpha_i = \alpha_i \pmod Q\). Note \(\overline \alpha_i\) are all the roots of \(\overline f(X)\) so are distinct. The map \(D_{Q/P} \to \gal(k_Q/k_P)\) is injective: if \(\sigma \in D_{Q/P}\) lies in the kernel then \(\sigma \pmod Q\) fixes each \(\overline \alpha_i\). Since these are distinct, this forces \(\sigma\) to fix \(\alpha_i\) so \(\sigma = 1\). So \(D_{Q/P} \cong \gal(k_Q/k_P)\) and \(e_{Q/P} = 1\) and we can define \(\Frob_{Q/P} \in D_{Q/P}\). Claim that \(\varphi(\Frob_{Q/P})\) has cycle type \((d_1) \cdots (d_r)\).

  \begin{proof}
    We must show \(\Frob_{Q/P}\) has orbits on \(\alpha_1, \dots, \alpha_n\) of size \(d_1, \dots, d_r\), or equivalently \(\gal(k_Q/k_P)\) has orbits on \(\overline \alpha_1, \dots, \overline \alpha_n\) of size \(d_1, \dots, d_r\). Note these orbits are in bijection with irreducible factors of \(\overline f(X)\)
    \[
      \O = \{\beta_1, \dots, \beta_s\} \longleftrightarrow \prod_{i = 1}^s(X - \beta_i).
    \]
    This lies in \(k_p[X]\) because this is an orbit, and is irreducible because it is a single orbit.
  \end{proof}
\end{proof}

\begin{definition}[inertia group]\index{inertia group}
  We define the \emph{inertia group} of \(Q\) to be
  \[
    I_{Q/P} = \ker (D_{Q/P} \to \gal(k_Q/k_P)).
  \]
\end{definition}

We've seen that \(|I_{Q/P}| = e_{Q/P}\). When ramification occurs, \(I_{Q/P}\) is nontrivial and interesting things can happen. To understand \(D_{Q/P}\) in such cases we must use completion.

\begin{proposition}
  Let \(A\) be a Dedekind domain, \(K = \Frac A\), \(E/K\) a finite separable extension, \(B\) the integral closure of \(A\) in \(E\). Let \(P \subseteq A\) be a non-zero prime ideal and let \(Q \subseteq B\) be a prime ideal lying above \(P\). Then
  \begin{enumerate}
  \item there's a natural homomorphism \(\hat A_P \to \hat B_Q\) extending \(A \to B\).
  \item Let \(K_P = \Frac \hat A_P, E_Q = \Frac \hat B_Q\). Then \(E_Q = K_P \cdot E\) is a finite separable extension of \(K_P\) and \(\hat B_Q\) is the integral closure of \(\hat A_P\) in \(E_Q\).
  \item \(e_{Q/P} = e_{Q \hat B_Q/P \hat A_P}\) and \(f_{Q/P} = f_{Q \hat B_Q/P \hat A_P}\) and \([E_Q: K_P] = e_{Q/P} f_{Q/P}\).
  \item Suppose further \(E/K\) is Galois. Then \(E_Q/K_P\) is also Galois and there is a natural isomorphism \(D_{Q/P} \to \gal(E_Q/K_P)\).
  \end{enumerate}
\end{proposition}

\begin{proof}
  Factor
  \[
    PB = Q_1^{e_{Q_1/P}} \cdots Q_r^{e_{Q_r/P}}
  \]
  where \(Q_1 = Q\). Then
  \[
    \hat A_P = \varprojlim_i A_P/P^iA_P = \varprojlim_i A/P^i
  \]
  and similarly \(\hat B_Q = \varprojlim_i B/Q^i\). There is a natural map \(A/P^i \to B/Q^i\) for any \(i \geq 1\) so passage to inverse limits gives a homomorphism \(\hat A_P \to \hat B_Q\).

  Note we are free to replace \(A\) by \(A_P\) and assume wlog that \(A\) is a DVR. In this case, we've seen that \(B\) is a finite free \(A\)-module. Then
  \[
    B/P^iB = B/\prod_{j = 1}^r Q_j^{i e_{Q_j/P}} \cong \prod_{j = 1}^r B/Q_j^{i e_{Q_j/P}}
  \]
  so
  \[
    \varprojlim_i B/P^iB \cong \prod_{j = 1}^r \hat B_{Q_j}
  \]
  as \(\hat A_P\)-modules, which are finite free as \(\hat A_P\)-module since each \(B/P^iB\) is a finite free \(A/P^i\)-module. Thus each summand \(\hat B_{Q_i}\) is finite free as \(\hat A_P\)-module. In particular \(\hat B_Q\) is integral over \(\hat A_P\) so \(\hat B_Q\) is the integral closure of \(\hat A_P\) in \(E_Q\).

  Note
  \[
    P\hat B_Q = \prod_{i = 1}^r Q_i^{e_{Q_i/P}} \hat B_Q = Q^{e_{Q/P}} \hat B_Q
  \]
  as for each \(i > 1\), \(Q_i \hat B_{Q} = \hat B_{Q}\) so \(\hat B_Q/P \hat B_Q\) is isomorphic to \(B/Q^{e_{Q/P}}\) as \(\hat A_P/P \hat A_P \cong A/P\)-module. Thus the map \(B/PB \to \hat B_Q/P\hat B_Q\) is surjective and by Nakayama, \(\hat B_Q\) is generated by \(B\) as \(\hat A_P\)-module. Passing to fraction field, we see \(E_Q\) is generated by \(E\) as \(K_P\)-vector space. If \(E/K\) is separable then every element of \(E\) is separable over \(K\) so \(E_Q/K_P\) is separable. If \(E/K\) is Galois then \(E\) is the splitting field of a polynomial with coefficients in \(K\), which can be viewed as a polynomial with coefficients in \(K_P\), so \(E_Q/K_P\) is Galois.

  Note
  \[
    f_{Q\hat B_Q/P\hat A_P} = [\hat B_Q/Q\hat B_Q: \hat A_P/P\hat A_P] = [B/Q: A/P] = f_{Q/P}.
  \]
  In addition
  \[
    (P \hat A_P) \hat B_Q = P \hat B_Q = (Q \hat B_Q)^{e_{Q/P}}
  \]
  implies \(e_{Q\hat B_Q/P \hat A_P} = e_{Q/P}\). We know
  \[
   [E_Q: K_P] = e_{Q\hat B_Q/P\hat A_P} f_{Q\hat B_Q/P\hat A_P} = e_{Q/P} f_{Q/P}.
  \]

  Now let's assume \(E/K\) is Galois and show 4 holds. We've already seen that as \(E_Q = K_P E\) and \(E_Q/K_P\) is a Galois extension. If \(\sigma \in D_{Q/P}\) then \(\sigma(Q) = Q\) so \(\sigma(Q^i) = Q^i\) for all \(i \geq 1\). Hence \(\sigma\) determines an automorphism \(\sigma|_B \pmod{Q^i}: B/Q^i \to B/Q^i\). By passage to inverse limit, we get an automorphism \(\varprojlim_i \sigma|_B \pmod{Q^i}: \hat B_Q \to \hat B_Q\). By passsage to fraction field, this determines an element of \(\gal(E_Q/K_P)\). This determines a homomorphism \(D_{Q/P} \to \gal(E_Q/K_P)\). By what we've just show,
  \[
    |\gal(E_Q/K_P)| = [E_Q: K_P] = e_{Q/P} f_{Q/P} = |D_{Q/P}|
  \]
  so it's enough to show injectivity. If \(\sigma \in D_{Q/P}\) gets sent to \(1\) then it acts as the identity on \(E_Q = K_P \cdot E\), so in particular acts as the identity on \(E\). As \(D_{Q/P} \subseteq \gal(E/K)\), this means that \(\sigma = 1\) in \(D_{Q/P}\).
\end{proof}

At this point one may wonder why we must pass to the completion, instead of using the localsation. If we had done so, then firstly the field of fraction would be the same. Secondly if \(Q\) is not the only prime ideal of \(B\) lying above \(P\) then \(B_Q\) would not be a finite \(A_P\)-module, so none of the developed techniques are available. For example take \(E = \Q(i), K = \Q, A = \Z, B = \Z[i]\). Consider \((5) = (2 + i)(2 - i)\). Then \(\frac{1}{2 + i}\) is not integral over \(\Z_{(5)}\), as for example its norm is \(\frac{1}{5}\). However as an exercise, by writing down the \(5\)-adic expansion of the minimal polynomial, check \(\frac{1}{2 + i}\) is a integral over \(\Z_5\).

\begin{corollary}
  Suppose \(E = K(\alpha)\) is finite separable over \(K\) and let \(f(X) \in K[X]\) be the minimal polynomial of \(\alpha\). For any non-zero prime ideals \(P \subseteq A\), there is a bijection between
  \begin{align*}
    \left\{
    \begin{tabular}{c}
      prime ideals \(Q\) of \(B\) \\
      lying above \(P\)
    \end{tabular}
    \right\}
    &\longleftrightarrow
      \left\{
      \begin{tabular}{c}
        irreducible factors \\
        of \(f(X)\) in \(K_P[X]\)
      \end{tabular}
      \right\}
    \\
    Q &\mapsto
        \begin{tabular}{c}
          unique irreducible factor \\
          \(g(X)\) of \(f(X)\) in \(K_P[X]\) \\
          such that \(g(\alpha) = 0\) in \(E_Q\)
        \end{tabular}
  \end{align*}
\end{corollary}

\begin{proof}
  Let \(L/K\) be the Galois closure of \(E/K\). Let \(C\) be the integral closure of \(A\) in \(L\). Fix \(R \subseteq C\) a prime ideal lying above \(P\). Let \(G = \gal(L/K), H = \gal(L/E)\). We know \(G\) acts transitively on the set of prime ideals of \(C\) lying above \(P\), so by orbit-stabiliser there is a bijection
  \begin{align*}
    G/D_{R/P} &\longleftrightarrow
                \left\{
                \begin{tabular}{c}
                  primes in \(C\) \\
                  lying above \(P\)
                \end{tabular}
    \right\}
    \\
    \sigma &\mapsto \sigma(R)
  \end{align*}
  More importantly, the bijection is \(G\)-equivariant. We know that \(H\) acts transitively on the set of prime ideals of \(C\) lying above any give non-zero prime ideals of \(B\), so there is a bijection
  \begin{align*}
    \left\{
    \begin{tabular}{c}
      prime ideals of \(B\) \\
      lying above \(P\)
    \end{tabular}
    \right\}
    =
      \left\{
      \begin{tabular}{c}
        \(H\)-orbits of \\
        prime ideal of \(C\) \\
        lying above \(P\)
      \end{tabular}
    \right\}
    &\longleftrightarrow
      H \backslash G /D_{R/P} \\
    \sigma(R) \cap B &\leftrightarrow \sigma
  \end{align*}
  This means every \(Q \subseteq B\) lying above \(P\) has the form \(Q = \sigma(R) \cap B\) for some \(\sigma \in G\). If \(\sigma, \sigma' \in G\) then \(\sigma(R) \cap B = \sigma'(R) \cap B\) if and only if exists \(h \in H, d \in D_{R/P}\) such that \(\sigma' = h\sigma d\).

  On the other hand there is a bijection
  \begin{align*}
    \{\text{roots of \(f(X)\) in \(L\)}\} &\longleftrightarrow G/H \\
    \sigma(\alpha) &\mapsfrom \sigma
  \end{align*}
  which is again \(G\)-equivariant. As \(\gal(L_R/K_P) \embed \gal(L/K)\), there is a \(\gal(L_R/K_P)\)-equivariant bijection
  \begin{align*}
    \{\text{roots of \(f(X)\) in \(L_R\)}\} &\longleftrightarrow G/H \\
    \sigma(\alpha) &\mapsfrom \sigma
  \end{align*}
  Now irreducible factors of \(f(X)\) in \(K_P[X]\) corresponds to \(\gal(L_R/K_P) = D_{R/P}\)-orbits of roots in \(L_R\) so there's a bijection between irreducible factors of \(f(X)\) in \(K_P[X]\) and \(D_{R/P} \backslash G/H\), given by sending \(\sigma\) to the unique \(g(X)\) such that \(g(\sigma(\alpha)) = 0\) in \(L_R = K_P \cdot L\). Since there is an obvious bijection
  \begin{align*}
    H \backslash G /D_{R/P} &\longleftrightarrow D_{R/P} \backslash G/H \\
    \sigma &\mapsto \sigma^{-1}
  \end{align*}
  there is also a bijection
  \begin{align*}
    \left\{
    \begin{tabular}{c}
      prime ideals \(Q\) of \(B\) \\
      lying above \(P\)
    \end{tabular}
    \right\}
    &\longleftrightarrow
      \left\{
      \begin{tabular}{c}
        irreducible factors \\
        of \(f(X)\) in \(K_P[X]\)
      \end{tabular}
    \right\}
    \\
    Q = \sigma(R) \cap B &\mapsto
                           \begin{tabular}{c}
                             unique irreducible factor \\
                             \(g(X)\) of \(f(X)\) such that \\
                             \(g(\sigma^{-1}(\alpha)) = 0\) in \(L_R\)
                           \end{tabular}
  \end{align*}
  To finish the proof, it's enough to show that this map is the same as that in the statement of the corollary. What we need is to show that for all \(\sigma \in G\), \(g(\sigma^{-1}(\alpha)) = 0\) in \(L_R\) if and only if \(g(\alpha) = 0\) in \(E_Q\). At first sight this seems preposterous as \(L_R\) and \(E_Q\) live in completely different world. The key observation is that \(\sigma: L \to L\) extends to an isomorphism \(L_R \to L_{\sigma(R)}\) which acts as the identity on \(K_P\): \(\sigma(R)^i = \sigma(R^i)\) so \(\sigma\) determines a map \(\sigma|_C \pmod{R^i}: C/R^i \to C/\sigma(R)^i\) for every \(i \geq 1\). Passage to inverse limits and fraction fields gives the induced map \(L_R \to L_{\sigma(R)}\). Hence if \(g(X) \in K_P[X]\) is an irreducible factor of \(f(X)\) then \(g(\sigma^{-1}(\alpha)) = 0\) in \(L_R\) if and only if \(\sigma(g(\sigma^{-1}(\alpha))) = 0\) in \(L_{\sigma(R)}\), if and only if \(g(\alpha) = 0\) in \(L_{\sigma(R)}\). Note the coefficients of \(g\) are in \(K_P\) and \(\alpha \in E\) so it is equivalent to \(g(\alpha) = 0\) in \(E_Q\).
  \[
    \begin{tikzcd}
      L_R \ar[d, dash] & L \ar[d, dash] \ar[l, hook'] \ar[r, hook] & L_{\sigma(R)} \ar[d, dash] \\
      E_{R \cap B} \ar[d, dash] & E \ar[d, dash] \ar[l, hook'] \ar[r, hook] & E_Q \ar[d, dash] \\
      K_P & K \ar[l, hook'] \ar[r, hook] & K_P
    \end{tikzcd}
  \]
\end{proof}

\begin{eg}
  Let \(K = \Q, E = \Q(i), A = \Z, B = \O_E\). We know \(2 \O_E = (1 + i)^2\) so \(X^2 + 1\) is irreducible in \(\Q_2[X]\). On the other hand, \(5 \O_E = (2 + i)(2 - i)\) splits so \(X^2 + 1\) must factor in \(\Q_5[X]\). By Hensel's lemma, there exists a unique \(\theta \in \Z_5\) such that \(\theta^2 = -1\) and \(\theta = 2 \pmod 5\), and \(X^2 + 1 = (X - \theta)(X + \theta)\) in \(\Q_5[X]\). The embedding \(\Q \to E\) extends to isomorphisms \(\Q_5 \to E_{(2 + i)}\) and \(\Q_5 \to E_{(2 - i)}\). Note that \(X - \theta = X - 2 \in \Q_5[X]\) and \(i = 2 \in E_{(2 - i)}\) so \(X - \theta\) corresponds to the ideal \((2 - i)\).
\end{eg}

\begin{eg}
  Let \(K = \Q, E = \Q(\sqrt[3]{2}), P = 5\Z\). How does \(5\O_E\) factorise? We need to factor \(X^3 - 2\) in \(\Q_5[X]\). As \(3^3 = 2 \pmod 5\), by Hensel's lemma there exists a unique \(\theta \in \Z_5\) such that \(\theta^3 = 2\) and \(\theta = 3 \pmod{5\Z_5}\). We can write \(X^3 - 2 = (X - \theta) g(X)\) in \(\Q_5[X]\). In fact \(g(X)\) must be irreducible, as any root of \(g(X)\) must differ from \(\theta\) by a primitive 3rd root of unity. Note 3rd roots of unity in \(\Q_5\) are roots of \(X^3 - 1\), which by Hensel's lemma are in bijection with roots of \(X^3 - 1\) in \(\F_5\), so only one such. Thus \(5\O_E\) has two distinct prime factors.
\end{eg}

\section{Extensions of complete DVRs}

\begin{definition}[complete discrete valuation field]\index{complete discrete valuation field}\index{CDVF}
  We call a pair \((K, v_K)\) a \emph{complete discrete valuation field} (CDVF) if \(v_K: K^\times \to \Z\) is a valuation and the corresponding DVR
  \[
    A_K = \{x \in K^\times: v_K(x) \geq 0\} \cup \{0\}
  \]
  is complete.
\end{definition}

We usually have \(v_K\) implicit and call \(K\) a CDVF, for example \(K = \Q_p\). We'll usually write \(\pi_K \in A_K\) for a choice of uniformiser and \(k_K = A_K/(\pi_K)\) for the residue field.

Next is an extremely important lemma on which almost all results in this chapter depend.

\begin{lemma}
  Let \(K\) be a CDVF and let \(E/K\) be a finite separable extension. Then \(E\) has a natural structure of a CDVF.
\end{lemma}

\begin{proof}
  Let \(B\) be the integral closure of \(A_K\) in \(E\). By result in last chapter there is a bijection
  \[
    \{\text{non-zero prime ideals of \(B\)}\} \longleftrightarrow \{\text{factors of \(f(X)\) in \(K_P[X]\)}\}
  \]
  where \(f(X) \in K[X]\) is the minimal polynomial of a generator for \(E\) and \(P = (\pi_K)\). Since \(K\) is a CDVF, \(K_P = K\). Since \(f(X) \in K[X]\) is irreducible, this shows \(B\) has a unique non-zero prime ideal \(Q\), hence is a DVR. Let \(v_E: E^\times \to \Z\) be the corresponding valuation. We've seen that \(E_Q = K_P \cdot E = K \cdot E = E\), showing \((E, v_E)\) is a CDVF.
\end{proof}

\begin{definition}[extension of CDVF]\index{complete discrete valuation field!extension}
  We call \(E/K\) an \emph{extension of CDVF} if \(K\) is a CDVF, \(E/K\) is finite separable and \(E\) has the structure of CDVF given by the lemma.
\end{definition}

In this situation \(A_E, A_K\) are DVRs. We write
\begin{align*}
  f_{E/K} &= f_{(\pi_E)/(\pi_K)} = [k_E: k_K] \\
  e_{E/K} &= e_{(\pi_E)/(\pi_K)} = v_E(\pi_K)
\end{align*}
then \([E: K] = e_{E/K} f_{E/K}\).

\begin{remark}\leavevmode
  \begin{enumerate}
  \item If \(E/K\) is Galois then for all \(\sigma \in \gal(E/K), x \in E\), \(v_E(\sigma(x)) = v_E(x)\). In other words, \(\gal(E/K)\) acts on \(E\) by isometry. This is because \(\sigma(\pi_E)\) is a uniformiser of \(A_E\) as \(\sigma|_{A_E}\) is a ring automorphism.
  \item In general, without assuming \(E/K\) is Galois, we have that for all \(x \in E^\times\),
    \[
      v_E(x) = \frac{1}{f_{E/K}} v_K(N_{E/K}(x)).
    \]

    \begin{proof}
      If \(E/K\) is Galois then
      \[
        \mathrm{RHS } = \frac{1}{f_{E/K}} \frac{1}{e_{E/K}} v_E(N_{E/K}(x))
      \]
      as \(v_E|_{K^\times} = e_{E/K} v_K\) by checking the uniformisers. But
      \[
        N_{E/K}(x) = \prod_{\alpha \in \gal(E/K)} \sigma(x)
      \]
      so
      \[
        \mathrm{RHS} = \frac{1}{[E : K]} \sum_{\sigma \in \gal(E/K)} v_E(\sigma(x)) = v_E(x)
      \]
      as \(v_E\) is Galois invariant.

      Now suppose \(E/K\) is only separable and let \(L/K\) be the Galois closure. Then we have for all \(x \in L^\times\),
      \[
        v_L(x) = \frac{1}{f_{L/E}} v_E(N_{L/E}(x)) = \frac{1}{f_{L/K}} v_K(N_{L/K}(x))
      \]
      For \(x \in E^\times\), \(N_{L/E}(x) = x^{[L: E]}\) and \(N_{L/K}(x) = N_{E/K}(x)^{[L :E]}\) so
      \[
        \frac{[L: E]}{f_{L/E}} v_E(x) = \frac{1}{f_{L/K}} v_K(N_{L/K}(x)) = \frac{[L : E]}{f_{L/K}} v_K(N_{E/K}(x))
      \]
      and hence
      \[
        v_E(x) = \frac{f_{L/E}}{f_{L/K}} v_K(N_{E/K}(x)) = \frac{1}{f_{E/K}} v_K(N_{E/K}(x))
      \]
      by tower law.
    \end{proof}
  \end{enumerate}
\end{remark}

\begin{definition}[Newton polygon]\index{Newton polygon}
  Let \(A\) be a DVR, \(K = \Frac A\) and let \(f(X) = X^n + a_1X^{n - 1} + \dots + a_n\) be a polynomial in \(K[X]\) with \(a_n \neq 0\). Then the \emph{Newton polygon} \(N_K(f)\) is the graph of the largest piecewise linear continuous function \(N: [0, n] \to \R\) such that
  \begin{enumerate}
  \item \(N(0) = 0, N(n) = v(a_n)\),
  \item for all \(0 < j < n\), \(N(j) \leq v(a_j)\) if \(a_j \neq 0\),
  \item \(N\) is convex.
  \end{enumerate}
  Equivalently, \(N\) is the lower convex hull of the points \((j, v(a_j))\) for \(0 \leq j \leq n\).
\end{definition}

\begin{eg}
  Let \(f(X) = X^3 + 25X^2 + 5X + 125 \in \Q_5[X]\). Then we have
  \begin{center}
    \begin{tikzpicture}
      \draw [->] (-0.5, 0) -- (4, 0);
      \draw [->] (0, -0.5) -- (0, 3.5);

      \draw (0, 0) -- (2, 1) -- (3, 3);
      \node at (0,0) [circle, fill, inner sep=1pt] {};
      \node at (1,2) [circle, fill, inner sep=1pt] {};
      \node at (2,1) [circle, fill, inner sep=1pt] {};
      \node at (3,3) [circle, fill, inner sep=1pt] {};

      \foreach \x in {1, 2, 3} {
        \node at (\x, 0) [below] {\(\x\)};
        \draw [shift={(\x, 0)}] (0pt, 2pt) -- (0pt, -2pt);
      }

      \foreach \y in {1, 2, 3} {
        \node at (0, \y) [left] {\(\y\)};
        \draw [shift={(0, \y)}] (-2pt, 0pt) -- (2pt, 0pt);
      }

      \iffalse
      \begin{axis}[
        ticks=none,
        axis equal image,
        axis lines=center,
        xmin=-.2,
        xmax=3.5,
        ymin=-.2,
        ymax=3.2
        ]
        \addplot[domain=0:2]{0.5*x};
        \addplot[domain=2:3]{2*x-3};
        \node at (0,0) [circle, fill, inner sep=1.5pt]{};
        \node at (1,2) [circle, fill, inner sep=1.5pt]{};
        \node at (2,1) [circle, fill, inner sep=1.5pt]{};
        \node at (3,3) [circle, fill, inner sep=1.5pt]{};
      \end{axis}
      \fi
    \end{tikzpicture}
  \end{center}
\end{eg}

We define the \emph{slopes} of \(N_K(f)\) to be the slopes of the line segments, and the \emph{multiplicity of a slope} is the length of the projection of the corresponding line segment to the \(x\)-axis.

In the above example we have slopes \(\frac{1}{2}\) with multiplicity \(2\) and \(2\) with multiplicity \(1\).

\begin{lemma}
  Let \(A\) be a DVR, \(K = \Frac A\), \(\alpha_1, \dots, \alpha_n \in K^\times\) and
  \[
    f(X) = \prod_{i = 1}^n (X - \alpha_i) = X^n + a_1 X^{n - 1} + \dots + a_n \in K[X].
  \]
  Let \(\lambda_i = v(\alpha_i)\) for \(1 \leq i \leq n\). Then \(\lambda_1, \dots, \lambda_n\) are the slopes of \(N_K(f)\) with multiplicity. In particular the slopes of \(N_K(f)\) are all integers.
\end{lemma}

\begin{proof}
  wlog \(\lambda_1 \leq \dots \leq \lambda_n\). Let \(L(f)\) be the polygon with slopes \(\lambda_1, \dots, \lambda_n\). Then if \(L: [0, n] \to \R\) is the corresponding function then \(L(0) = 0\) by definition, \(L(n) = \lambda_1 + \dots + \lambda_n = v(\alpha_1 \cdots \alpha_n) = v(a_n) = N(n)\), and \(L\) is convex. If \(0 < j < n\) then \(L(j) = \lambda_1 + \dots + \lambda_j\). Also
  \[
    v(a_j) = v(\alpha_1 \cdots \alpha_j + \sum_{i_1 < \dots < i_j} \alpha_{i_1} \cdots \alpha_{i_j}) \geq v(\alpha_1 \cdots \alpha_j) = \lambda_1 + \dots + \lambda_j
  \]
  so in fact \(L(f)\) satisfies 1 -- 3 in the definition of \(N_K(f)\) so \(L(f)\) lies below \(N_K(f)\) by maximality of \(N_K(f)\). To show equality, it is enough to show each vertex of \(L(f)\) lies on \(N_K(f)\). If \((j, \lambda_1 + \dots + \lambda_j)\) is a vertex of \(L(f)\) then \(\lambda_{j + 1} > \lambda_j\), i.e.\ \(v(\alpha_{j + 1}) > v(\alpha_j)\) since in the above expression for \(v(a_j)\), if \((i_1, \dots, i_j) \neq (1, \dots j)\) then
  \[
    v(\alpha_{i_1} \cdots \alpha_{i_j}) \geq \lambda_1 + \dots + \lambda_{j - 1} + \lambda_{j + 1} > \lambda_1 + \dots + \lambda_j
  \]
  so by ultrametric inequality
  \[
    v(a_j) = v(\alpha_1 \cdots \alpha_j) = \lambda_1 + \dots + \lambda_j.
  \]
  Hence \(v(a_j) \geq N(j) \geq L(j) = v(a_j)\) so in fact \((j, v(a_j))\) is a vertex of both \(L(f)\) and \(N_K(f)\).
\end{proof}

\begin{proposition}
  Let \(K\) be a CDVF and let \(f(X) \in K[X], a_n \neq 0\) be monic separable. Let \(\lambda_1 < \dots < \lambda_r\) be the slopes of \(N_K(f)\) where \(\lambda_i\) occurs with multiplicity \(m_i \geq 1\). Then there exists a unique factorisation \(f(X) = \prod_{i = 1}^r g_i(X)\) in \(K[X]\) where for all \(1 \leq i \leq r\), \(g_i(X)\) is a monic polynomial with degree \(m_i\) and \(N_K(g)\) has a single slope \(\lambda_i\).
\end{proposition}

\begin{proof}
  Let \(L/K\) be the splitting field of \(f(X)\). Let \(\alpha_1, \dots, \alpha_n \in L\) be the roots of \(f(X)\) in \(L\). Note \(N_L(f)\) is the image of \(N_K(f)\) under the linear transformation \(
  \begin{psmallmatrix}
    1 & 0 \\
    0 & e_{L/K}
  \end{psmallmatrix}
  :\R^2 \to \R^2\), as \(v_L(a_j) = e_{L/K} v_K(a_j)\). The slopes of \(N_L(f)\) are \(e_{L/K} \lambda_1 < \dots < e_{L/K} \lambda_n\). We define
  \[
    g_i(X) = \prod_{v_L(\alpha_j) = e_{L/K} \lambda_i} (X - \alpha_j) \in L[X].
  \]
  Since \(\gal(L/K)\) leaves \(v_L\) invariant, it acts on \(\{\alpha_j: v_i(\alpha_j) = e_{L/K} \lambda_i\}\) so by Galois theory \(g_i(X) \in K[X]\). By construction \(f(X) = \prod_{i = 1}^r g_i(X)\). Uniqueness follows from essentially the same argument.
\end{proof}

\begin{eg}
  Let \(f(X) = X^3 + X^2 + 2X + 8\). Then \(N_{\Q_2}(f)\) is
  \begin{center}
    \begin{tikzpicture}
      \draw [->] (-0.5, 0) -- (4, 0);
      \draw [->] (0, -0.5) -- (0, 3.5);

      \draw (0, 0) -- (1, 0) -- (2, 1) -- (3, 3);
      \node at (0,0) [circle, fill, inner sep=1pt] {};
      \node at (1,0) [circle, fill, inner sep=1pt] {};
      \node at (2,1) [circle, fill, inner sep=1pt] {};
      \node at (3,3) [circle, fill, inner sep=1pt] {};

      \foreach \x in {1, 2, 3} {
        \node at (\x, 0) [below] {\(\x\)};
        \draw [shift={(\x, 0)}] (0pt, 2pt) -- (0pt, -2pt);
      }

      \foreach \y in {1, 2, 3} {
        \node at (0, \y) [left] {\(\y\)};
        \draw [shift={(0, \y)}] (-2pt, 0pt) -- (2pt, 0pt);
      }


      \iffalse
      \begin{axis}[
        ticks=none,
        axis equal image,
        axis lines=center,
        xmin=-.2,
        xmax=3.5,
        ymin=-.2,
        ymax=3.2
        ]
        \addplot[domain=1:2]{x-1};
        \addplot[domain=2:3]{2*x-3};
        \node at (0,0) [circle, fill, inner sep=1.5pt]{};
        \node at (1,0) [circle, fill, inner sep=1.5pt]{};
        \node at (2,1) [circle, fill, inner sep=1.5pt]{};
        \node at (3,3) [circle, fill, inner sep=1.5pt]{};
      \end{axis}
      \fi
    \end{tikzpicture}
  \end{center}
  The slopes are \(0, 1, 2\) each with multiplicity \(1\). Thus \(f(X)\) splits into linear factors in \(\Q_2[X]\).
\end{eg}

\begin{definition}
  If \(E/K\) is an extension of CDVF, we say
  \begin{enumerate}
  \item \(E/K\) is \emph{unramified} if \(k_E/k_K\) is separable and \(e_{E/K} = 1\).
  \item \(E/K\) is \emph{totally ramified} if \(f_{E/K} = 1\).
  \end{enumerate}
\end{definition}

We are going to show how to construct totally ramified extensions, followed by unramified extensions. Then we show everything can be done in these two stages.

\begin{definition}[Eisenstein polynomial]\index{Eisenstein polynomial}
  Let \(A\) be a DVR, \(K = \Frac A\). We say \(f(X) = X^n + a_1 X^{n - 1} + \dots + a_0 \in A[X]\) is \emph{Eisenstein} if \(v_K(a_i) \geq 1\)  for each \(i = 1, \dots, n - 1\) if \(a_i \neq 0\) and \(v_K(a_n) = 1\).
\end{definition}

Eisenstein polynomial has a very simple characterisation in terms of Newton polygon: for any \(f(X) \in K[X]\), \(f(X)\) is Eisenstein if and only if \(N_K(f)\) is a single line segment of slope \(\frac{1}{n}\).

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item Let \(E/K\) be a totally ramified extension of CDVFs. Let \(f(X) \in K[X]\) be the minimal polynomial of \(\pi_E\). Then \(f(X)\) is Eisenstein and \(E = K(\pi_E)\).
  \item Let \(K\) be a CDVF and let \(f(X) \in K[X]\) be a separable polynomial which is Eisenstein. Then \(f(X)\) is irreducible and if \(E = K[X]/(f(X))\) then \(E/K\) is totally ramified and \(X \pmod{f(X)}\) is a uniformiser in \(A_E\).
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Suppose \(E/K\) is totally ramified and let \(f(X) \in K[X]\) be the minimal polynomial of \(\pi_E\). Then \(f(X) = X^n + a_1 X^{n - 1} + \dots + a_n\) where \(n = [K(\pi_E): K] \leq [E: K] = e_{E/K}\). We know \(N_E(f)\) is the dilation by a factor of \(e_{E/K}\) of \(N_K(f)\). Note that \(N_E(f)\) has a single slope, namely \(1\) with multiplicity \(n\): the roots of \(f(X)\) in a splitting field are all Galois conjugates of \(\pi_E\), so in particular have the same valuation as \(\pi_E\). In \(E\), \(v_E(\pi_E) = 1\), so \(N_E(f)\) has a single slope of \(1\). Hence \(N_K(f)\) has a single slope \(\frac{1}{e_{E/K}}\), and the endpoint is therefore \(\frac{n}{e_{E/K}}\). But this is the valuation of the constant term and we know \(v_K(a_n) \geq 1\), so must have \(n \geq e_{E/K}\). Thus we have equality and \(E = K(\pi_E)\). \(f(X)\) is Eisenstein.
  \item Suppose \(K\) is a CDVF and let \(f(X) \in K[X]\) be a separable Eisenstein polynomial. Let \(E = K(\alpha)\) where \(\alpha\) is a root of \(f(X)\). Note that a priori this does not give a fixed isomorphism class of extensions \(E/K\), as \(f(X)\) is not assumed to be irreducible. Nevertheless \(E/K\) is finite and separable so \(E/K\) is an extension of CDVF. We know \(f(X)\) has a root in \(E\) so at least one slope of \(N_E(f)\) must be an integer. However as \(f\) is Eisenstein, \(N_K(f)\) has a single slope \(\frac{1}{n}\), hence \(N_E(f)\) has a single slope \(\frac{e_{E/K}}{n}\). As it is a non-zero integer, \(e_{E/K} \geq n\). Conversely,
    \[
      e_{E/K} \leq [E: K] = [K(\alpha): K] \leq n
    \]
    so equality. \(f(X)\) is irreducible and \(E/K\) is totally ramified. Moreover \(v_E(\alpha) = \frac{e_{E/K}}{n} = 1\) so \(\alpha \in A_E\) is a uniformiser.
  \end{enumerate}
\end{proof}

\begin{eg}
  We've seen \((1 + i)^2 = 2 \O_E\) where \(E = \Q(i)\). Thus \(E_{(1 + i)}/\Q_2\) is a totally ramified quadratic extension, with uniformiser \(1 + i\). So the minimal polynomial of \(1 + i\) must be Eisenstein. It is \(X^2 - 2X + 2\).
\end{eg}

We now show how to construct unramified extensions.

\begin{proposition}
  Let \(K\) be a CDVF. Let \(\ell/k_K\) be a finite separable extension. Then there exists an extension \(L/K\) of CDVFs and an isomorphism \(\iota: \ell \to k_L\) with the following property: for any extension \(E/K\) of CDVFs and field homomorphism \(j: \ell \to k_E\), there exists a unique \(K\)-embedding \(J: L \to E\) such that the diagram
  \[
    \begin{tikzcd}
      k_L \ar[r, "\iota^{-1}"] \ar[dr, "\overline J"'] & \ell \ar[d, "j"] \\
      & k_E
    \end{tikzcd}
  \]
  commutes. Moreover \(L/K\) is unramified.
\end{proposition}

In other words, there is an unramified extension \(L/K\) such that
\[
  \Hom_K(L, E) \cong \Hom_{k_K}(\ell, k_E).
\]

\begin{proof}
  Since \(\ell/k_K\) is separable, we can choose a primitive element \(\overline \alpha \in \ell\). Let \(\overline f(X) \in k_K[X]\) be the minimal polynomial and let \(f(X) \in A_K[X]\) be any monic lift of \(\overline f(X)\). \(f(X)\) is irreducible since \(\overline f(X)\) is, and is separable since \(\operatorname{disc} f \pmod{(\pi_K)} = \operatorname{disc} \overline f \neq 0 \in k_K\). We define \(L = K[X]/(f(X))\), which is separable, and \(\alpha = X \pmod{f(X)} \in L\). Claim \(A_L = A_K[\alpha]\): we have \(A_K[\alpha] \subseteq A_L\) since \(\alpha\) is integral over \(A_K\). There is a ring homomorphism \(A_K[\alpha]/(\pi_K) \to A_L/(\pi_K)\), so inducing a ring homomorphism \(\iota: \ell \to A_L/(\pi_K)\) as \(\ell = k_K[X]/(\overline f(X)) = A_K[X]/(f(X), \pi_K)\). To show \(A_L = A_K[\alpha]\), take \(z \in A_L\) and choose \(n \geq 0\) as small as possible such that \(\pi_K^nz \in A_K[\alpha]\). Since \(z\) is integral over \(A_K\), we can write
  \[
    z^m + a_1z^{m - 1} + \dots + a_m = 0
  \]
  for \(a_i \in A_K\). Then
  \[
    (\pi_K^n z)^m + a_1\pi_K^n (\pi_K^nz)^{m - 1} + \dots + a_m \pi_K^{nm} = 0
  \]
  in \(A_L\). Reduction modulo \(\pi_K\) gives \((\pi_K^n z)^m \pmod{(\pi_K)} = 0\) in \(A_L/(\pi_K)\). But \(\pi^n_K z \in A_K[\alpha]\) so \(\pi^n_K z \pmod{(\pi_K)}\) is in the image of \(\iota\). \(\iota(\ell)\) is a field so contains no non-zero nilpotent, so we must have \(\pi_K^n z \pmod{(\pi_K)} = 0\). Since \(\iota\) is injective this means \(\pi_K^n z \pmod{(\pi_K)} = 0 \in A_K[\alpha]/(\pi_K)\), i.e.\ \(\pi_K^n z\) is divisible by \(\pi_K\) in \(A_K[\alpha]\), so either \(\pi_K^{n - 1}z \in A_K[\alpha]\) or \(n = 0\). The first case contradicts the minimality of \(n\) so \(n = 0\) and \(z \in A_K[\alpha]\). Since \(z\) is arbitrary, this show \(A_L = A_K[\alpha]\), and also the map \(\iota: \ell \to A_L/(\pi_K) = k_L\) is an isomorphism. In particular \(L/K\) is unramified.

  We need to show that if \(E/K\) is an extension of CDVFs then embeddings \(L \to E\) correspond to embeddings \(\ell \to k_E\). We know
  \[
    \{K\text{-embeddings } L \to E\}
    \longleftrightarrow
    \{\text{roots of } f(X) \text{ in } E\}
    \longleftrightarrow
    \{\text{roots of } f(X) \text{ in } A_E\}
  \]
  where the last correspondence is because \(f(X) \in A_K[X]\) is monic. On the other hand \(k_K\)-embeddings \(\ell \to k_E\) correspond to roots of \(\overline f(X)\) in \(k_E\). There is a map
  \[
    \{\text{roots of } f(X) \text{ in } A_E\}
    \to
    \{\text{roots of } \overline f(X) \text{ in } k_E\}
  \]
  Hensel's lemma shows this map is bijective: \(\overline \alpha\) is separable so \(\overline f(X)\) has simple roots.
\end{proof}

\begin{eg}
  Let \(p\) be a prime. Then for any \(n \geq 1\) there is a unique unramified extension of \(\Q_p\) of degreee \(n\) up to isomorphism. This follows from uniqueness of finite extension of degree \(n\) of finite field and the universal property: there is a unique extension \(\F_{p^n}/\F_p\) up to isomorphism. By proposition we can find \(L_n/\Q_p\) unramified extension of degree \(n\) and an isomorphism \(\iota: \F_{p^n} \to k_{L_n}\). To show uniqueness, let \(E_n/\Q_p\) be another unramified extension of degree \(n\). Then \(k_{E_n}/\F_p\) has degree \(n\), so we can find an isomorphism \(j: \F_{p^n} \to k_{E_n}\). Then there is a unique \(\Q_p\)-embedding \(J: L_n \to E_n\) inducing \(j \compose \iota^{-1}\) at the level of residue fields. Since \(L_n, E_n\) both have degree \(n\) over \(\Q_p\), \(J\) is an isomorphism.
\end{eg}

Let \(E/K\) be an extension of CDVFs with \(k_E/k_K\) separable. Then there exists a unique subextension \(E_0/K\) which is unramified, and such that \(k_{E_0} = k_E\). Then \(f_{E_0/K} = f_{E/K}\) and \(e_{E/E_0} = e_{E/K}\). Then we have
\[
  \begin{tikzcd}
    E \ar[d, dash, "\text{totally ramified}"] \\
    E_0 \ar[d, dash, "\text{unramified}"] \\
    K
  \end{tikzcd}
\]

We construct \(E_0\) as follow. Take a pair \((L, \iota)\) where \(L/K\) is unramified and \(\iota: k_E \to k_L\). Then there exists a unique \(K\)-embedding \(J: L \to E\) inducing \(\iota^{-1}\) at the level of residue fields. We define \(E_0\) to be the image \(J(L)\) of this embedding. To show uniqueness, note that any embedding of \(L\) in \(E\) must have image in \(E_0\). Moreover \(E_0\) contains any unramified subextension. \(E_0\) is called the \emph{maximal unramified subextension}\index{maximal unramified subextension} of \(E/K\).

Now suppose further that \(E/K\) is Galois and \(G = \gal(E/K)\). In this case we know \(k_E/k_K\) is also Galois and there is a surjective homomorphism \(G \to \gal(k_E/k_K)\). By Galois theory there is an intermediate extension \(E^{I_{E/K}}/K\). Claim that \(E^{I_{E/K}} = E_0\).

\begin{proof}
  By Galois theory it's enough to show that for all \(\sigma \in G = \gal(E/K)\), \(\sigma \in I_{E/K}\) if and only if \(\sigma|_{E_0} = \id|_{E_0}\). Note for all \(\sigma \in G\), \(\sigma(E_0)/K\) is still an unramified subextension of \(E/K\). As \(E_0\) is the maximal such, we have \(\sigma(E_0) = E_0\). In particular \(E_0/K\) is Galois. Moreover
  \[
    \Hom_K(E_0, E) = \gal(E_0/K) \to \gal(k_E/k_K)
  \]
  is bijective so for all \(\sigma \in G\), \(\sigma|_{E_0} = \id|_{E_0}\) if and only if the image of \(\sigma\) in \(\gal(E_0/K)\) is identity, if and only if the action of \(\sigma\) on \(k_E\) is the identity action.
\end{proof}

Thus we have an alternative characterisation of the maximal unramified subextension. As a consequence We have a tower of Galois extensions \(E/E_0/K\) with \(\gal(E/E_0) = I_{E/K}, \gal(E_0/K) = \gal(k_E/k_K)\).

In fact we can do much more. We assume for the rest of today that \(E/K\) is a Galois extension of CDVFs with \(k_E/k_K\) separable. For concreteness one might have in mind finite extensions \(E/\Q_p\) and \(E/\Q((t))\).

\begin{definition}[lower ramification group]\index{lower ramification group}
  Let \(i \geq 0\). We define the \emph{\(i\)th lower ramification group} of \(G = \gal(E/K)\) to be \(G_i = \ker(G \to \aut(A_E/(\pi_E^{i + 1})))\). We set \(G_{-1} = G\).
\end{definition}

\begin{remark}\leavevmode
  \begin{enumerate}
  \item Informally, \(G_i\) is the set of elements which fix the first \(i + 1\) digits of the \(\pi_E\)-adic expansion of elements of \(A_E\).
  \item \(G_0 = \ker(G \to \gal(k_E/k_K)) = I_{E/K}\).
  \item \(G_{-1} \supseteq G_0 \supseteq G_1 \supseteq \cdots\) and \(\bigcap_{i \geq 0} G_i = \{1\}\).
  \item Each \(G_i\) is normal in \(G\). If \(E/L/K\) is an intermediate extension and \(H = \gal(E/L)\) then \(H_i = H \cap G_i\).
  \end{enumerate}
\end{remark}

\begin{lemma}
  Suppose \(\sigma \in G_0\). Then for any \(i \geq 0\), \(\sigma \in G_i\) if and only if \(v_E(\sigma(\pi_E) - \pi_E) \geq i + 1\).
\end{lemma}

\begin{proof}
  Let \(E_0/K\) be the maximal unramified subextension. Then \(\sigma \in \gal(E/E_0)\). Note \(A_E = A_{E_0}[\pi_E]\) as any element of \(A_E\) admits a \(\pi_E\)-adic expansion with digits in \(A_{E_0}\): since maximal unramified implies they have the same residue field we may choose representatives in \(A_{E_0}\). Thus the map \(A_{E_0}[\pi_E] \to A_E/(\pi_E) = A_E/(\pi_K^{e_{E/K}})\) is surjective. We know \(A_E\) is a finitely generated \(A_{E_0}\)-module so Nakayama implies that \(A_{E_0}[\pi_E] = A_E\).

  If \(\sigma \in G_0\) then the image of \(\sigma\) in \(\aut(A_E/(\pi_E^{i + 1}))\) is a ring automorphism and \(A_E/(\pi_E^{i + 1})\) is generated by \(A_{E_0}[\pi_E]\). So the image of \(\sigma\) is trivial if and only if \(\sigma(\pi_E) = \pi_E \pmod{\pi_E^{i + 1}}\), if and only if \(v_E(\sigma(\pi_E) - \pi_E) \geq i + 1\).
\end{proof}

\begin{eg}
  Let \(K = \Q_2, E = \Q_2(\sqrt 2)\). \(E\) is the splitting field of \(X^2 + 2\) which is Eisenstein so \(E/K\) is totally ramified. \(G = G_0\) and we can take \(\pi_E = \sqrt 2\). Suppose \(G = \{1, s\}\), then
  \[
    v_E(s(\pi_E) - \pi_E) = v_E(-\sqrt 2 - \sqrt 2) = v_E( -2 \sqrt 2) = v_E(-(\sqrt 2)^3) = 3
  \]
  so by the lemma
  \[
    G = G_0 = G_1 = G_2, \{1\} = G_3 = G_4 = \cdots
  \]
\end{eg}

\begin{eg}
  Let \(K = \Q_2, E = \Q_2(i)\) so \(E\) is the splitting field of \(X^2 + 1\). We have \((1 + i)^2 = 2i\) so \(E/K\) must be a quadratic ramified extension (otherwise \(v_E(1 + i) = \frac{1}{2}\)) with \(\pi_E = 1 + i\). Suppose \(G = \{1, t\}\), then
  \[
    v_E(t(1 + i) - (1 + i)) = v_E(1- i - (1 + i)) = v_E(-2i) = 2.
  \]
  Hence
  \[
    G = G_0 = G_1, \{1\} = G_2 = G_3 = \cdots
  \]

  The extension \(\Q_2(\sqrt 2)\) is ``more ramified'' than \(\Q_2(i)\) as it has more non-trivial ramification groups.
\end{eg}

\begin{eg}
  Let \(K = \Q_2, E = \Q_2(\sqrt 2, i)\). As \(\Q_2(\sqrt 2) \ncong \Q_2(i)\) by calculation above, \(E/K\) is Galois with \(G = \{1, s, t, st\}\) where
  \[
    s|_{\Q_2(\sqrt 2)} = s, s|_{\Q_2(i)} = \id_{\Q_2(i)}, \quad
    t|_{\Q_2(i)} = t, t|_{\Q_2(\sqrt 2)} = \id_{\Q_2(\sqrt 2)}
  \]
  in notations above.

  Let \(\zeta = \frac{1 + i}{\sqrt 2}\) so \(\zeta^2 = \frac{1 + 2i - 1}{2} = i\) so \(\zeta\) is a primitive \(8\)th roots of unity in \(\Q_2(\sqrt 2, i)\). \(\zeta - 1\) satisfies the polynomial
  \[
    (X + 1)^4 + 1 = X^4 + 4X^3 + 6X^2 + 4X + 2
  \]
  which is Eisenstein in \(\Q_2\). Thus \(E/K\) is totally ramified with uniformiser \(\pi_E = \zeta - 1\). We now calculate \(v_E(\sigma(\pi_E) - \pi_E)\) for all \(\sigma \in G = G_0\).
  \begin{align*}
    v_E(s(\pi_E) - \pi_E) &= v_E(- \frac{1 + i}{\sqrt 2} - \frac{1 + i}{\sqrt 2}) = v_E(-2\zeta) = v_E(2) = e_{E/K} = 4 \\
    v_E(t(\pi_E) - \pi_E) &= v_E( \frac{1 - i}{\sqrt 2} - \frac{1 + i}{\sqrt 2}) = v_E(- \frac{2i}{\sqrt 2}) = v_E(\sqrt 2) = 2 \\
    v_E(st(\pi_E) - \pi_E) &= v_E(-\frac{1 - i}{\sqrt 2} - \frac{1 + i}{\sqrt 2}) = v_E(-\frac{2}{\sqrt 2}) = v_E(\sqrt 2) = 2
  \end{align*}
  Thus
  \[
    G = G_0 = G_1, \{1, s\} = G_2 = G_3, \{1\} = G_4 = G_5 = \cdots
  \]
  In this case there are two jumps in the filtration of \(G\) by its lower ramification groups.
\end{eg}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item There exists an injective homomorphism \(G_0/G_1 \to k_E^\times\). In particular \(G_0/G_1\) is of order prime to \(p\) if \(\ch k_E = p > 0\).
  \item If \(i \geq 1\) then there's an injective homomorphism \(G_i/G_{i + 1} \to (k_E, +)\). In particular \(G_i/G_{i + 1}\) is abelian, and is trivial if \(\ch k_E = 0\) and an \(\F_p\)-vector space if \(\ch k_E = p > 0\).
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Note for any \(\sigma \in G_0\), we can write \(\sigma(\pi_E) = a_\sigma \pi_E \mod{\pi_E^2}\) for some \(a_\sigma \in A_{E_0}\) where \(E_0/K\) is the maximal unramified subextension: we can choose \(X \subseteq A_{E_0}\) containing \(0\) and giving a set of representatives of \(k_{E_0} = k_E\). Then any \(\alpha \in A_E\) has a unique expression \(\sum_{i = 0}^\infty a(\alpha)_i \pi_E^i\). \(\sigma(\pi_E)\) has valuation \(1\) so equals to \(a(\sigma(\pi_E))_1 \pi_E + \pi_E^2 z\) for some \(z \in A_E\), so we can take \(a_\sigma = a(\sigma(\pi_E))\). Note as well that \(a_\sigma \pmod{\pi_E} \ne 0\). Moreover \(a_\sigma \pmod{\pi_E}\) depends only on \(\sigma\) and \(\pi_E\) (but not \(X\)).

    We define \(G_0 \to k_E^\times\) by \(\sigma \mapsto a_\sigma \pmod{\pi_E}\). To show \(a_{\sigma\tau} = a_\sigma a_\tau \pmod{\pi_E}\), note we have
    \[
      \sigma\tau (\pi_E) = a_{\sigma\tau} \pi_E \pmod{\pi_E^2}
    \]
    while
    \[
      \sigma(\tau(\pi_E)) = \sigma(a_\tau \pi_E + \pi_E^2 z) = a_\tau \sigma(\pi_E) + \pi_E^2 z' = a_\tau a_\sigma \pi_E \pmod{\pi_E^2}
    \]
    so we must have \(a_{\sigma\tau} = a_\sigma a_\tau \pmod{\pi_E}\), so the map is a homomorphism.

    An element \(\sigma \in G_0\) lies in the kernel if and only if \(\sigma(\pi_E) = \pi_E \pmod{\pi_E^2}\), if and only if \(v_E(\sigma(\pi_E) - \pi_E) \geq 2\), if and only if \(\sigma \in G_1\). \(\im (G_0/G_1 \embed k_E^\times)\) is a finite subgroup of \(k_E^\times\). Any finite subgroup of the multiplicative group of a field is cyclic, of order prime to \(p\) if the characteristic \(p > 0\).
  \item Observe if \(\sigma \in G_i\) for some \(i \geq 1\) then we can write
    \[
      \sigma(\pi_E) = \pi_E + a_\sigma \pi_E^{i + 1} \pmod{\pi_E^{i + 2}}
    \]
    where \(a_\sigma \in A_{E_0}\) and \(a_\sigma \pmod{\pi_E} \in k_E\) depends only on \(\sigma\) and \(\pi_E\). We thus define \(G_i \to (k_E, +)\) by \(\sigma \mapsto a_\sigma \pmod{\pi_E}\). This is a homomorphism:
    \begin{align*}
      \sigma(\tau(\pi_E))
      &= \sigma(\pi_E + a_\tau \pi_E^{i + 1} + \pi_E^{i + 2} z) \\
      &= \pi_E + a_\sigma \pi_E^{i + 1} + \pi_E^{i + 2} z' + \sigma(a_\tau \pi_E^{i + 1}) + \sigma(\pi_E^{i + 2} z) \\
      &= \pi_E + a_\sigma \pi_E^{i + 1} + a_\tau \sigma(\pi_E)^{i + 1} \pmod{\pi_E^{i + 2}} \\
      &= \pi_E + a_\sigma \pi_E^{i + 1} + a_\tau(\pi_E + a_\sigma \pi_E^{i + 1})^{i + 1} \pmod{\pi_E^{i + 2}} \\
      &= \pi_E + (a_\sigma + a_\tau) \pi_E^{i + 1} \pmod{\pi_E^{i + 2}} \\
      &= \pi_E + a_{\sigma\tau} \pi_E^{i + 1} \pmod{\pi_E^{i + 2}}
    \end{align*}
    so \(a_\sigma + a_\tau = a_{\sigma\tau} \pmod{\pi_E}\).

    \(\sigma\) lies in the kernel if and only if \(\sigma(\pi_E) = \pi_E \pmod{\pi^{i + 2}}\), if and ony if \(v_E(\sigma(\pi_E) - \pi_E) \geq i + 2\), if and only if \(\sigma \in G_{i + 2}\). Thus we have an injective homomorphism \(G_i/G_{i + 1} \embed (k_E, +)\) so \(G_i/G_{i + 1}\) is abelian.

    If \(\ch k_E = 0\) then \(k_E\) is a \(\Q\)-vector space so contains no non-trivial finite group so \(G_i/G_{i + 1} = \{1\}\). If \(\ch k_E = p\) then \(k_E\) is an \(\F_p\)-vector space, so \(G_i/G_{i + 1}\) is annihilated by \(p\).
  \end{enumerate}
\end{proof}

As a consequence, if \(\ch k_E = 0\) then \(G_1\) is trivial, as each \(G_i/G_{i + 1}\) and \(\bigcap_{i \geq 0} G_i = \{1\}\). Thus \(G_0 = G_0/G_1\) is cyclic. If \(\ch k_E = p\) then \(G_0\) is solvable since we have
\[
  G_0 \supseteq G_1 \supseteq \cdots
\]
and all quotients \(G_i/G_{i + 1}\) are abelian. \(G_1\) is the (unique) \(p\)-Sylow subgroup of \(G_0\), as \(G_0/G_1\) has order prime to \(p\) while \(G_1\) has order a power of \(p\). As all \(p\)-Sylow subgroups are conjugate and \(G_1 \trianglelefteq G_0\), \(G_1\) is the unique one.

Moreover in the case \(k_E\) is finite (such as when \(K/\Q_p\) is an extension of CDVFs) then \(G/G_0 \cong \gal(k_E/k_K)\) is cyclic so
\[
  G \supseteq G_0 \supseteq G_1 \supseteq \cdots
\]
and hence \(G = \gal(E/K)\) is solvable (not just \(G_0\)).

\begin{definition}[tamely/wildly ramified]\index{tamely/wildly ramified}
  If \(E/K\) is an extension of CDVFs, we say it's \emph{tamely ramified} if either \(\ch k_E = 0\) or \(\ch k_E = p > 0\) and \(p \ndivides e_{E/K}\). Otherwise we say \(E/K\) is \emph{wildly ramified}.
\end{definition}

Note that if \(E/K\) is Galois and \(k_E/k_K\) is separable, then \(E/K\) is wildly ramified if and only if \(G_1 \neq \{1\}\) (and the only case where the inertia group is not cyclic).

\begin{proposition}
  Let \(E/K\) be a Galois extension of CDVFs such that it's totally and tamely ramified, i.e.\ \(e_{E/K} = [E: K]\) and if \(\ch k_E = p > 0\) then \(p \ndivides e_{E/K}\). Then if \(n = [E: K]\) then \(K\) contains \(n\) \(n\)th roots of unity and there exists a uniformiser \(\pi_K \in A_K\) such that \(E = K(\sqrt[n]{\pi_K})\).
\end{proposition}

Eisenstein polynomial \(X^n - \pi_K\). Also if and only if (assuming \(K\) containing \(n\) \(n\)th roots of unity).

\begin{proof}
  Since it is tamely ramified, \(G_1\) is trivial so \(G_0 \embed k_E^\times = k_K^\times\). Since \(E/K\) is totally ramified, \(G = G_0\) and so \(G = G_0\) is cyclic of order \(n\). Hence \(k_K\) contains \(n\) \(n\)th roots of unity and \(f(X) = X^n - 1\) splits into linear factors in \(k_K[X]\). \(f'(X) = nX^{n - 1}\) and \(n \pmod{\pi_K} \in k_K^\times\) so the simple version of Hensel's lemma applies to show \(X^n - 1\) splits into linear factors in \(A_K[X]\) and \(K\) contains \(n\) \(n\)th roots of unity.

  Let \(\sigma \in \gal(E/K)\) be a generator and \(\pi_E \in A_E\) be a choice of uniformiser. Then exists a unique primitive \(n\)th root of unity \(\zeta \in A_K\) such that
  \[
    \sigma(\pi_E) = \zeta \pi_E \pmod{\pi_E^2}.
  \]
  If
  \[
    \alpha = \pi_E + \zeta^{-1} \sigma(\pi_E) + \zeta^{-2} \sigma^2(\pi_E) + \cdots + \zeta^{1 - n} \sigma^{n - 1}(\pi_E) \pmod{\pi_E}
  \]
  then
  \[
    \sigma(\alpha) = \sigma(\pi_E) + \zeta^{-1} \sigma^2(\pi_E) + \cdots + \zeta \pi_E = \zeta \alpha
  \]
  and \(\alpha = n \pi_E \pmod{\pi_E^2}\). So \(v_E(\alpha) = 1\) and \(\alpha \in A_E\) is a uniformiser and \(\sigma(\alpha^n) = (\zeta \alpha)^n = \alpha^n\), so \(\alpha^n \in A_K\). Hence \(E = K(\sqrt[n]{\pi_K})\) where \(\pi_K = \alpha^n\).
\end{proof}

We have seen that \(\Q_2(\sqrt 2)/\Q_2\) is ``more ramified'' than \(\Q_2(i)/\Q_2\). How can we make this precise? The dream is to define for any \(v \in \R_{\geq 0}\) a subfield \(E^v/K\) inside \(E/K\). This should have the following property:
\begin{enumerate}
\item \(E^0\) is maximal unramified, \(E = \bigcup_{v \geq 0} E^v\) and if \(v \leq v'\) then \(E^v \subseteq E^{v'}\).
\item for any intermediate extension \(E/L/K\) with \(L/K\) Galois, want \(L^v = L \cap E^v\).
\item if \(L_1, L_2\) are intermediate extensions with \(E = L_1 \cdot L_2\) then \(E^v = L_1^v \cdot L_2^v\).
\end{enumerate}

The naïve idea is to define \(E^v = E^{G_v}\) for \(v \in \N\). This satisfies 1 as \(G_0 = I_{E/K}, \bigcap_{i \geq 0} G_i = \{1\}\) and \(G_0 \supseteq G_1 \supseteq \cdots\). However this definition does not satisfy 2 or 3. For 2, this is related to having an equality \((G/H)_i = \im(G_i \to G/H)\) where \(H = \gal(E/L)\) and \(G/H = \gal(L/K)\). Although \(G_i \cap H = H_i\), this does not hold in general for quotient group. For example take \(E = \Q_2(\sqrt 2, i), K = \Q_2\). Recall that
\[
  \gal(E/K)_i =
  \begin{cases}
    \gal(E/K) & i = 0, 1 \\
    \{1, s\} & i = 2, 3 \\
    \{1\} & i \geq 4
  \end{cases}
\]
Look at \(\im(\gal(\Q_2(\sqrt 2, i)/\Q_2)_3 \to \gal(\Q_2(\sqrt 2)/\Q_2)) = \gal(\Q_2(\sqrt 2)/\Q_2)\), which is not the same as \(\gal(\Q_2(\sqrt 2)/\Q_2)_3 = \{1\}\).

To solve this problem we introduce the upper ramification groups. These are the same as the lower groups but with a different indexing. First we extend \(G_u\) to \(u \in \R_{\geq 0}\) by \(G_u = G_{\ceil u}\). We define
\[
  \varphi_{E/K}(u) = \int_{t = 0}^u [G_0 : G_t]^{-1} dt.
\]
\(\varphi_{E/K}\) is a continuous piecewise linear function. The discontinuities of \(\varphi'_{E/K}(u)\) occur only at integer values of \(u\). Moreover \(\varphi_{E/K}(u)\) is strictly increasing and \(\varphi_{E/K}(0) = 0\) so \(\varphi_{E/K}: [0, \infty) \to [0, \infty)\) is a homeomorphism. We define \(\psi_{E/K} = \varphi_{E/K}^{-1}: [0, \infty) \to [0, \infty)\). Then \(\psi_{E/K}\) is also a strictly increasing piecewise linear homeomorphism.

\begin{definition}[upper ramification group]\index{upper ramification group}
  If \(v \in \R_{\geq 0}\), we define the \emph{\(v\)th upper ramification group} to be \(G^v = G_{\psi_{E/K}(v)} \leq G = \gal(E/K)\).

  We say \(v\) is a jump in the upper ramification group if \(G^v \ne G^{v + \varepsilon}\) for any \(\varepsilon > 0\).
\end{definition}

Warning: by definition, the jumps in the lower ramification groups \(G_u\) can only occur at integer values of \(u\). However, the jump in the upper ramification groups can occur at rational but non-integer values of \(v\).

\begin{eg}
  \(E = \Q_2(\sqrt 2, i), K = \Q_2, G = \gal(E/K)\). First plot \([G_0 : G_t]^{-1}\) against \(t\).
  \begin{center}
    \begin{tikzpicture}
      \draw [->] (-0.5, 0) -- (5, 0) node [right] {\(t\)};
      \draw [->] (0, -0.5) -- (0, 2.5) node [above] {\([G_0: G_t]^{-1}\)};

      \draw (0, 2) -- (1, 2);
      \draw (1, 1) -- (3, 1);
      \draw (3, 0.5) -- (4.5, 0.5);

      \node at (1, 2) [circle, fill, inner sep=1pt] {};
      \node at (1, 1) [circle, fill=white, outer sep=0pt,inner sep=1pt] {};
      \node at (3, 1) [circle, fill, inner sep=1pt] {};

      \foreach \x in {1,2,3,4} {
        \node at (\x, 0) [below] {\(\x\)};
        \draw [shift={(\x, 0)}] (0pt, 2pt) -- (0pt, -2pt);
      }

      \node at (0, 1) [left] {\(\frac{1}{2}\)};
      \draw [shift={(0, 2)}] (-2pt, 0pt) -- (2pt, 0pt);
      \node at (0, 2) [left] {\(1\)};
      \draw [shift={(0, 1)}] (-2pt, 0pt) -- (2pt, 0pt);
   \end{tikzpicture}
  \end{center}
  Then plot \(\varphi\) against \(u\).
  \begin{center}
    \begin{tikzpicture}
      \draw [->] (-0.5, 0) -- (5, 0) node [right] {\(t\)};
      \draw [->] (0, -0.5) -- (0, 2.75) node [left] {\(\varphi\)};

      \draw (0, 0) -- (1, 1) -- (3, 2) -- (4.5, 2.375);

      \foreach \x in {1,2,3,4} {
        \node at (\x, 0) [below] {\(\x\)};
        \draw [shift={(\x, 0)}] (0pt, 2pt) -- (0pt, -2pt);
      }

      \node at (0, 1) [left] {\(1\)};
      \draw [shift={(0, 2)}] (-2pt, 0pt) -- (2pt, 0pt);
      \node at (0, 2) [left] {\(2\)};
      \draw [shift={(0, 1)}] (-2pt, 0pt) -- (2pt, 0pt);
    \end{tikzpicture}
  \end{center}
  Its inverse \(\psi\) is
   \begin{center}
    \begin{tikzpicture}
      \draw [->] (-0.5, 0) -- (3.5, 0) node [right] {\(t\)};
      \draw [->] (0, -0.5) -- (0, 3) node [left] {\(\psi\)};

      \draw (0, 0) -- (1, .5) -- (2, 1.5) -- (2.5, 2.5);

      \foreach \x in {1,2,3} {
        \node at (\x, 0) [below] {\(\x\)};
        \draw [shift={(\x, 0)}] (0pt, 2pt) -- (0pt, -2pt);
      }

      \foreach \y in {2, 4} {
        \node at (0, \y/2) [left] {\(\y\)};
        \draw [shift={(0, \y/2)}] (-2pt, 0pt) -- (2pt, 0pt);
      }
    \end{tikzpicture}
  \end{center}
  so we conclude
  \[
    G^v =
    \begin{cases}
      G & v \in [0, 1] \\
      \{1, s\} & v \in (1, 2] \\
      \{1\} & v \in (2, \infty)
    \end{cases}
  \]
  In this case all jumps occur at integer points.
\end{eg}

\begin{eg}
  \(E = \Q_2(\sqrt 2)\).
  \[
    G^v =
    \begin{cases}
      G & v \in [0, 2] \\
      \{1\} & v \in (2, \infty)
    \end{cases}
  \]
  Note the map \(\gal(\Q_2(\sqrt 2, i)/\Q_2) \to \gal(\Q_2(\sqrt 2)/\Q_2)\) has kernel \(\{1, t\}\) and \(\im(\gal(\Q_2(\sqrt 2, i)/\Q_2)^v) = \gal(\Q_2(\sqrt 2)/\Q_2)^v\) for any \(v \in \R_{\geq 0}\).
\end{eg}

To show this works in general, we introduce some more notations. Given a Galois extension \(E/K\) of CDVFs with \(k_E/k_K\) separable and \(G = \gal(E/K)\), we define \(i_G: G \to \Z_{\geq 0} \cup \{\infty\}\) by
\[
  i_G(1) = \infty, i_G(s) = \sup \{i: s \in G_{i - 1}\} = 1 + \sup \{i: s \in G_i\}
\]
so in general \(i_G(s) \geq i + 1\) if and only if \(s \in G_i\).

\begin{lemma}
  For any \(u \in \R_{\geq 0}\) we have
  \[
    \varphi(u) + 1 = \frac{1}{|G_0|} \sum_{s \in G} \min(i_G(s), u + 1).
  \]
\end{lemma}

\begin{proof}
  Both sides are continuous, piecewise linear and linear away from integer value of \(u\) and
  \[
    \mathrm{LHS}(0) = 1, \mathrm{RHS}(0) = \frac{1}{|G_0|} \sum_{s \in G} \min(i_G(s), 1) = \frac{1}{|G_0|} \sum_{s \in G_0} 1 = 1.
  \]
  To show they are equal it's enough to show for any \(i \in \Z_{\geq 0}\) and for any \(t \in (i, i + 1)\), \(\mathrm{LHS}'(t) = \mathrm{RHS}'(t)\).
  \begin{align*}
    \mathrm{LHS}'(t) &= [G_0: G_{i + 1}]^{-1} = [G_0: G_t]^{-1} \\
    \mathrm{RHS}'(t) &= \frac{1}{|G_0|} \sum_{s \in G} \min(i_G(s), u + 1)'(t).
  \end{align*}
  We have
  \[
    \min(i_G(s), u + 1) =
    \begin{cases}
      i_G(s) & i_G(s) \leq u + 1 \\
      u + 1 & i_G(s) \geq u + 1
    \end{cases}
  \]
  so for \(t \in (i, i + 1)\),
  \[
    \min(i_G(s), u + 1)'(t) =
    \begin{cases}
      0 & i_G(s) \leq t + 1 \\
      1 & i_G(s) \geq t + 1
    \end{cases}
  \]
  Recall \(s \in G_i\) if and only if \(i_G(s) \geq i + 1\) so
  \[
    \mathrm{RHS}'(t) = \frac{1}{|G_0|} \sum_{s \in G_t} 1 = [G_0: G_t]^{-1} = \mathrm{LHS}'(t).
  \]
\end{proof}

\begin{lemma}
  Suppose exists \(\alpha \in A_E\) such that \(A_E = A_K[\alpha]\). Then \(i_G(s) = v_E(s(\alpha) - \alpha)\).
\end{lemma}

\begin{proof}
  By definition, \(s \in G_i\) if and only if \(s\) acts trivially on \(A_E/(\pi_E^{i + 1})\), which is generated as a ring by the image of \(A_K\) and \(\alpha\), so if and only if \(s\) acts trivially on the image of \(\alpha\) in \(A_E/(\pi_E^{i + 1})\), if and only if \(s(\alpha) = \alpha \pmod{\pi_E^{i + 1}}\).
\end{proof}

\begin{lemma}
  There exists \(\alpha \in A_E\) such that \(A_E = A_K[\alpha]\).
\end{lemma}

\begin{proof}
  By Nakayama, it's enough to find \(\alpha\) such that \(A_K[\alpha] \to A_E/(\pi_K)\) is surjective. Let \(\overline y \in k_E\) be a primitive element and \(\overline f(X) \in k_K[X]\) be its minimal polynomial, \(f(X) \in A_K[X]\) a choice of monic lift of \(\overline f(X)\), and \(y \in A_E\) the unique root of \(f(X)\) such that \(y \pmod{\pi_E} = \overline y\). Since \(\overline f(X)\) is separable, \(\overline f'(\overline y) \neq 0\) so \(f'(y) \in A_E^\times\). Thus
  \[
    f(y + \pi_E) = f(y) + f'(y) \pi_E + \pi_E^2 z
  \]
  has valuation \(1\) and is a uniformiser for \(A_E\). Moreover \(A_K[y + \pi_E] \to k_E\) sends \(y + \pi_E \mapsto \overline y\) so is surjective, so we can choose a set \(X \subseteq A_E\) of representative for \(k_E\) with \(0 \in X\) and \(X \subseteq A_K[y + \pi_K]\). Then any element of \(A_E/(\pi_K) = A_E/(\pi_E^{e_{E/K}})\) has a unique representation of the form \(\sum_{i = 0}^{e_{E/K} - 1} a_i f(y + \pi_E)\) with \(a_i \in X\). But this lies in \(A_K[y + \pi_E]\) so \(A_E = A_K[y + \pi_E]\).
\end{proof}

\begin{lemma}
  Let \(H \trianglelefteq G, L = E^H\) so \(\gal(L/K) = G/H\). Let \(s \in G\). Then
  \[
    i_{G/H}(sH) = \frac{1}{e_{E/L}} \sum_{t \in H} i_G(st).
  \]
\end{lemma}

\begin{proof}
  Choose \(\alpha \in E_E, \beta \in A_L\) such that \(A_E = A_K[\alpha], A_L = A_K[\beta]\).
  \[
    \begin{tikzcd}
      E \ar[d, dash] & A_K[\alpha] \ar[d, dash] \\
      L \ar[d, dash] & A_K[\beta] \ar[d, dash] \\
      K & A_K
    \end{tikzcd}
  \]
  Then
  \begin{align*}
    i_{G/H}(sH) &= v_L(s(\beta) - \beta) = \frac{1}{e_{E/L}} v_E(s(\beta) - \beta) \\
    i_G(st) &= v_E(st(\alpha) - \alpha)
  \end{align*}
  for \(t \in H\). We need to show
  \[
     \frac{1}{e_{E/L}} v_E(s(\beta) - \beta) = \frac{1}{e_{E/L}} \sum_{t \in H} v_E(st(\alpha) - \alpha)
  \]
  or equivalently,
  \[
    v_E(s(\beta) - \beta) = v_E(\prod_{t \in H} (st(\alpha) - \alpha)).
  \]
  Let \(f(X) \in A_L[X]\) be the minimal polynomial of \(\alpha\) over \(L\). Then \(f(X) = \prod_{t \in H} (X - t(\alpha))\). Let \(s(f)(X)\) denote the polynomial where \(s\) acts on the coefficients of \(f(X)\) so \(s(f)(X) = \prod_{t \in H} (X - st(\alpha))\) and \(s(f)(\alpha) = \prod_{t \in H}(\alpha - st(\alpha))\). Write \(f(X) = \sum a_i X^i, s(f)(X) = \sum s(a_i)X^i\) for \(a_i \in A_L\). Then
  \[
    s(f)(\alpha) = s(f)(\alpha) - f(\alpha) = \sum (s(a_i) - a_i) \alpha^i.
  \]
  Since \(A_L = A_K[\beta]\), for \(a \in A_L\), \(s(a) - a\) is divisible by \(s(\beta) - \beta\) so \(s(\beta) - \beta \divides s(f)(\alpha) = \prod_{t \in H}(\alpha - st(\alpha))\). Thus
  \[
    v_E(s(\beta) - \beta) \leq v_E(\prod_{t \in H}(\alpha - st(\alpha))).
  \]

  To show the reverse inequality, choose \(g(X) \in A_K[X]\) such that \(g(\alpha) = \beta\). We can do this since \(b \in A_E\) and \(A_E = A_K[\alpha]\). Then \(g(X) - \beta \in A_L[X]\) has \(\alpha\) as a zero, so is divisible by \(f(X)\) in \(A_L[X]\). Hence \(f(X) \divides g(X) - \beta\) in \(A_E[X]\), hence \(s(f)(X) \divides g(X) - s(\beta)\) in \(A_E[X]\). Now evaluate at \(X = \alpha\) to get
  \[
    s(f)(\alpha) \divides g(\alpha) - s(\beta) = \beta - s(\beta)
  \]
  in \(A_E\). Equivalently,
  \[
    v_E(\prod_{t \in H}(\alpha - st(\alpha))) \leq v_E(\beta - s(\beta))
  \]
  so equality.
\end{proof}

\begin{lemma}
  Suppose \(H \trianglelefteq G\) and \(L = E^H\). Define \(j: G/H \to \Z_{\geq 0} \cup \{\infty\}\) by \(j(sH) = \sup_{t \in H} i_G(st)\). Then
  \[
    i_{G/H}(sH) = 1 + \varphi_{E/L}(j(sH) - 1).
  \]
\end{lemma}

\begin{proof}
  Recall that
  \begin{align*}
    \mathrm{LHS} &= \frac{1}{e_{E/L}} \sum_{t \in H} i_G(st) \\
    \mathrm{RHS} &= \frac{1}{|H_0|} \sum_{t \in H} \min(i_H(t), j(sH))
  \end{align*}
  Note that \(e_{E/L} = |H_0|\) and for all \(t \in H\), \(i_G(t) = i_H(t)\) (as both sides equal \(v_E(t(\alpha) - \alpha)\) where \(A_E = A_K[\alpha]\)). We can assume that the representative for \(sH\) is chosen so that \(j(sH) = i_G(s)\) or equivalently for all \(t \in H\), \(i_G(st) \leq i_G(s)\). Therefore it suffices to show
  \[
    \sum_{t \in H} i_G(st) = \sum_{t \in H} \min(i_G(t), i_G(s)).
  \]

  We will show for all \(t \in H\), \(i_G(st) = \min(i_G(t), i_G(s))\). If \(m + 1 = i_G(t) < i_G(s) = n + 1\) then \(t \in G_m \setminus G_n, s \in G_n\). Hence \(st \in G_m \setminus G_n\) so \(i_G(st) = i_G(t)\). On the other hand if \(i_G(t) \geq i_G(s)\) then \(i_G(st) \geq i_G(s)\). Since \(s\) was chosen so that for all \(t \in H\), \(i_G(st) \leq i_G(s)\), we get \(i_G(st) = i_G(s)\).
\end{proof}

\begin{theorem}[Herbrand]\index{Herbrand's theorem}
  Suppose \(H \trianglelefteq G\) and \(L = E^H\). If \(u \in \R_{\geq 0}\) and \(v = \varphi_{E/L}(u)\) then
  \[
    (G/H)_v = G_uH/H (= \im(G_u \to G/H)).
  \]
\end{theorem}

\begin{proof}
  For \(s \in G\), we have \(sH \in G_uH/H\) if and only if exists \(t \in H\) such that \(i_G(st) \geq u + 1\), if and only if \(j(sH) \geq u + 1\). Since \(\varphi_{E/L}\) is strictly increasing, we have \(j(sH) \geq u + 1\) if and only if \(\varphi_{E/L}(j(sH) - 1) \geq \varphi_{E/L}(u)\), if and only if \(i_{G/H}(sH) \geq \varphi_{E/L}(u) + 1\), if and only if \(sH \in (G/H)_{\varphi_{E/L}(u)}\).
\end{proof}

\begin{lemma}
  We have \(\varphi_{E/K} = \varphi_{L/K} \compose \varphi_{E/L}\).
\end{lemma}

\begin{proof}
  Both sides are piecewise linear continuous functions \([0, \infty) \to [0, \infty)\) which take \(0\) to \(0\) so it's enough to show derivatives coincide.
  \begin{align*}
    \mathrm{LHS}'(u) &= [G_0 : G_u]^{-1} \\
    \mathrm{RHS}'(u) &= \varphi'_{L/K}(\varphi_{E/L}(u)) \varphi'_{E/L}(u) \\
                    &= [(G/H)_0: (G/H)_{\varphi_{E/L}(u)}]^{-1} [H_0 : H_u]^{-1} \\
                    &= [G_0H/H: G_uH/H]^{-1} [H_0: H_u]^{-1}  \text{ Herbrand}
  \end{align*}
  Now use isomorphism theorem
  \[
    G_uH/H \cong G_u/G_u \cap H = G_u/H_u
  \]
  (as lower ramification groups are compatible with subgroups) so
  \[
    [G_0H/H : G_uH/H] = \frac{|G_0|}{|H_0|} \frac{|H_u|}{|G_u|} = \frac{[G_0: G_u]}{[H_0: H_u]}
  \]
  so the result follows.
\end{proof}

Finally we can deduce upper ramifications groups are compatible with quotients:

\begin{theorem}
  For any \(v \geq 0\),
  \[
    G^vH/H = (G/H)^v.
  \]
\end{theorem}

\begin{proof}
  By definition \(G^v = G_{\psi_{E/K}(v)}, (G/H)^v = (G/H)_{\psi_{L/K}(v)}\). \(\varphi_{E/K} = \varphi^{-1}_{E/K}\) so by the lemma \(\psi_{E/K} = \psi_{E/L} \compose \psi_{L/K}\). Herbrand gives
  \[
    (G/H)^v = (G/H)_{\psi_{L/K}(v)} = G_{\psi_{E/L}(\psi_{L/K}(v))} H/H
    = G_{\psi_{E/K}(v)} H/H = G^vH/H.
  \]
\end{proof}

\begin{definition}
  Let \(E/K\) be an extension of CDVF (not necessarily Galois) with \(k_E/k_K\) separable. If \(v \in [0, \infty)\) we define
  \[
    E^v = E \cap L^{G^v}
  \]
  where \(L/E\) is any extension of CDVFs with \(k_L/k_K\) separable, \(L/K\) Galois with \(G = \gal(L/K)\).
\end{definition}

This is independent of the choice of \(L\): it's enough to show that if \(L'/L\) is a further extension of CDVFs and \(L'/K\) is Galois then
\[
  E \cap L^{G^v} = E \cap (L')^{(G')^v}
\]
where \(G' = \gal(L'/K)\). Let \(H = \gal(L'/L)\). Then
\[
  E \cap L^{G^v} = E \cap L^{(G'/H)^v} = E \cap L^{(G')^vH/H} = E \cap (L')^{(G')^v H} = E \cap (L')^{(G')^v}
\]
where the last equality is because \(E \subseteq L = (L')^H\).

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item \(E^0\) is the maximal unramified subextension and
    \[
      E^0 = E \cap L^{G^0} = E \cap L^{G_0} = E \cap L_0.
    \]
  \item If \(v \leq v'\) then \(E^v \subseteq E^{v'}\). For \(v \gg 0, E^v = E\).
  \item If \(E/M/K\) is an intermediate extension then \(M^v = M \cap E^v\) (as both are \(M \cap L^{G^v}\) for \(L/E\) with \(L/K\) Galois).
  \item If \(E/M, N/K\) are two intermediate extensions then \(M^v \cdot N^v \subseteq (M\cdot N)^v\) (as \((M \cap L^{G^v}) \cdot (N \cap L^{G^v}) \subseteq (M \cdot N) \cap L^{G^v}\)). Moreover if \(M^v = M, N^v = N\) then \((M \cdot N)^v = M \cdot N\).
  \end{enumerate}
\end{proposition}

We can think of \(\inf\{v: E^v = E\}\) as a measure of ``how ramified'' an extension \(E/K\) is. For example back to the example \(E = \Q_2(\sqrt 2, i), K = \Q_2\). Recall that
\[
  G^v =
  \begin{cases}
    G & v \in [0, 1] \\
    \{1, s\} & v \in (1, 2] \\
    \{1\} & v \in (2, \infty)
  \end{cases}
\]
so
\[
  E^v =
  \begin{cases}
    \Q_2 & v \in [0, 1] \\
    \Q_2(i) & v \in (1, 2] \\
    E & v \in (2, \infty)
  \end{cases}
\]

This example displays another important feature of the group \(G^v\), which we will not prove:

\begin{theorem}[Hasse-Arf]\index{Hasse-Arf theorem}
  Let \(K/\Q_p\) be a finite extension and let \(E/K\) be an abelian extension, i.e.\ \(E/K\) is a Galois extension and \(\gal(E/K)\) is abelian. Then all of the jumps in the upper ramification groups are integers.
\end{theorem}

The example \(\Q_2(\sqrt 2, i)/\Q_2\) is an application. For counterexample in nonabelian case, example sheet 3 gives \(\Q_2(\zeta_3, \sqrt[3]{2})/\Q_2\) in which \(\frac{1}{2}\) is a jump.

\begin{definition}[conductor ideal]\index{conductor ideal}
  Let \(K/\Q_p\) be a finite extension. Let \(E/K\) be an abelian extension. We define the \emph{conductor ideal} \(C_{E/K}\) of \(A_K\) to be \((\pi_K^a)\) where
  \[
    a = \inf \{n \in \Z_{\geq 0}: G^n = \{1\}\} = 1 + \text{highest jump}.
  \]
\end{definition}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item \(C_{E/K} = A_K\) if and only if \(E/K\) is unramified.
  \item If \(E_1, E_2/K\) are abelian extensions then \(C_{E_1 \cdot E_2/K} = \lcm(C_{E_1/K}, C_{E_2/K})\), as if \(C_{E_i/K} = (\pi_K^{a_i})\) then \(a_i = \inf \{n \in \Z_{\geq 0}: E^n_i = E_i\}\), but \((E_1 \cdot E_2)^n = E_1 \cdot E_2\) if and only if \(E_1^n = E_1\) and \(E_2^n = E_2\).
  \end{enumerate}
\end{proposition}

This formulation will be important when studying global fields.

\section{Global class field theory}

What is GCFT? Fix a number field \(K\). Want to give a description of all abelian extensions \(E/K\). We will organise these around the notion of conductor ideal.

\begin{definition}[conductor ideal]\index{conductor ideal}
  Let \(E/K\) be an abelian extension of number fields. The \emph{conductor ideal} is the unique \(C_{E/K} \subseteq \O_K\) with the following property: for any non-zero prime ideal \(P \subseteq \O_K\) and any prime ideal \(Q \subseteq \O_E\) lying above \(P\), \(C_{E/K} A_{K_P} = C_{E_Q/K_P}\). Equivalently \(v_P(C_{E/K}) = v_P(C_{E_Q/K_P})\).
\end{definition}

This is well-defined as
\begin{enumerate}
\item \(C_{E_Q/K_P}\) is independent of choice of \(Q\) (as \(E_Q \cong E_{Q'}\) as extensions of \(K_P\)).
\item \(C_{E_Q/K_P} = A_{K_P}\) for all but finitely many \(P\) (as all but finitely many \(P \subseteq \O_K\) are unramified in \(\O_E\)).
\item existence and uniqueness of \(C_{E/K}\) then follows by unique factorisation of ideals in \(\O_K\).
\end{enumerate}

We first explain what happens for \(K = \Q\). We know that if \(N \in \Z_{\geq 1}\) then \(\Q(\zeta_N)\) is an abelian extension of \(\Q\) and there's an isomorphism
\begin{align*}
  \gal(\Q(\zeta_N)/\Q) &\cong (\Z/N\Z)^\times \\
  \sigma_a &\leftrightarrow a
\end{align*}
where \(\sigma_a(\zeta_N) = \zeta_N^a\). By Galois theory there's a bijection
\[
  \left\{
  \begin{tabular}{c}
    abelian extensions \(L/\Q\) \\
    contained in \(\Q(\zeta_N)/\Q\)
  \end{tabular}
  \right\}
  \longleftrightarrow
  \{\text{quotients of } (\Z/N\Z)^\times\}
\]

We have the Kronecker-Weber(-Hilbert) theorem\index{Kronecker-Weber theorem}: if \(L/\Q\) is any abelian extension then exists \(N \in \Z_{\geq 1}\) such that \(L \subseteq \Q(\zeta_N)\). In fact, for any \(N \in \Z_{\geq 1}\), \(L \subseteq \Q(\zeta_N)\) if and only if \(C_{L/\Q} \divides (N)\). Thus we get a bijection for any \(N \in \Z_{\geq 1}\)
\[
  \left\{
    \begin{tabular}{c}
      abelian extension \(L/\Q\) \\
      in a fixed algebraic closure \\
      such that \(C_{L/\Q} \divides (N)\)
    \end{tabular}
  \right\}
  \leftrightarrow
  \{\text{quotients of } (\Z/N\Z)^\times\}
\]
This is almost GCFT for \(K = \Q\), but we still need to give a characterisation of the bijection independent of explicit description of \(\Q(\zeta_N)\). We do this using the \emph{Artin symbol}.

Recall that if \(L/K\) is a Galois extension of number fields, not necessarily abelian, then for any non-zero prime ideal \(P \subseteq \O_K\) and prime ideal \(Q \subseteq \O_L\) lying above \(P\) such that \(e_{Q/P} = 1\) (i.e.\ \(P\) is unramified in \(\O_L\)), we define \(\Frob_{Q/P} \in \gal(L/K)\) as the unique element such that
\begin{enumerate}
\item \(\Frob_{Q/P}(Q) = Q\),
\item for all \(x \in k_Q\), we have \(\Frob_{Q/P}(x) = x^{|k_P|}\), i.e.\ it is the Frobenius automorphism of \(k_Q/k_P\).
\end{enumerate}
If \(\sigma \in \gal(L/K)\) then there is a commutative diagram
\[
  \begin{tikzcd}
    k_Q \ar[r, "x \mapsto x^{|k_P|}"] \ar[d, "\sigma"] & k_Q \ar[d, "\sigma"] \\
    k_{\sigma(Q)} \ar[r, "x \mapsto x^{|k_P|}"] & k_{\sigma(Q)}
  \end{tikzcd}
\]
so by the characterisation of Frobenius element
\[
  \Frob_{\sigma(Q)/P} = \sigma \Frob_{Q/P} \sigma^{-1}.
\]
In particular, if \(\gal(L/K)\) is abelian then \(\Frob_{\sigma(Q)/P} = \Frob_{Q/P}\), so is independent of choice of \(Q\).

\begin{definition}[Artin symbol]\index{Artin symbol}
  If \(L/K\) is an abelian extension of number fields and \(P \subseteq \O_K\) is a non-zero prime ideal that is unramified in \(\O_L\), we define the \emph{Artin symbol} \((P, L/K) \in \gal(L/K)\) by \((P, L/K) = \Frob_{Q/P}\) for any prime ideal \(Q \subseteq \O_L\) lying above \(P\).
\end{definition}

This allows us to give a formulation of GCFT over \(\Q\) that does not rely on knowing the extension \(\Q(\zeta_N)\): for any \(N \in \Z_{\geq 1}\), there's a bijection
\[
  \left\{
    \begin{tabular}{c}
      abelian extension \(L/\Q\) \\
      such that \(C_{L/\Q} \divides (N)\)
    \end{tabular}
  \right\}
  \longleftrightarrow
  \{\text{quotients of } (\Z/N\Z)^\times\}
\]
This may be uniquely characterised as follow: suppose given \(L/\Q\). Then there is a unique surjective homomorphism \(\phi_{L/\Q}: (\Z/N\Z)^\times \to \gal(L/\Q)\) with the property that for any prime \(p \ndivides N\),
\[
  \phi_{L/\Q}(p \bmod N) = ((p), L/\Q).
\]

\begin{remark}
  When \(L = \Q(\zeta_N)\) this does recover the inverse of the usual map \(\gal(\Q(\zeta_N)/\Q) \to (\Z/N\Z)^\times\): need to check that if \(p \ndivides N\) then \(\sigma_p \in \gal(\Q(\zeta_N)/\Q)\) equals \(((p), \Q(\zeta_N)/\Q)\). Let \(Q \subseteq \O_{\Q(\zeta_N)}\) be a prime lying above \((p)\). Then \(k_Q = \F_p(\zeta_N)\) and
  \[
    ((p), \Q(\zeta_N)/\Q) (\zeta_N \pmod Q) = \zeta_N^p \pmod Q.
  \]
  But reduction modulo \(Q\) gives a bijection between roots of \(X^N - 1\) in \(\Q(\zeta_N)\) and in \(k_Q\). So we must have
  \[
    ((p), \Q(\zeta_N)/\Q)(\zeta_N) = \zeta_N^p
  \]
  so \(((p), \Q(\zeta_N)/\Q) = \sigma_p\).
\end{remark}

The first step is generalising this to arbitrary base number field \(K\). We first need to explain what object will replace \((\Z/N\Z)^\times\). This will be ray class group.

\begin{definition}[modulus]\index{modulus}
  A \emph{modulus} is a pair \(m = (m_0, m_\infty)\) where \(m_0 \subseteq \O_K\) is a non-zero ideal and \(m_\infty \subseteq \Hom_\Q(K, \R)\), a possibly empty subset.
\end{definition}

Recall that for any number field \(K\), \(|\Hom_\Q(K, \C)| = [K : \Q] = r + 2s\) where \(r\) is the number of real embeddings and \(s\) is the number of pairs of complex embeddings.

If \(m = (m_0, m_\infty)\) and \(n = (n_0, n_\infty)\) are moduli, we write \(m \leq n\) if \(m_0 \divides n_0\) and \(m_\infty \subseteq n_\infty\).

Let \(K\) be a number field. We write \(\mathcal I = \Div \O_K, \mathcal P = \{I \in \mathcal I: \text{exists } \alpha \in K^\times \text{ such that } I = (\alpha)\}\) the principal fractional ideals. Then \(\mathcal I/\mathcal P\) is the \emph{ideal class group}\index{ideal class group} of \(\O_K\). Now let \(m = (m_0, m_\infty)\) be a modulus. We define
\begin{align*}
  K(m_0) &= \left\{
           \begin{tabular}{c}
             \(\alpha \in K^\times\): for all non-zero prime \(P \subseteq \O_K\) \\
             such that \(v_P(m_0) > 0\), \(v_P(\alpha) = 0\)
           \end{tabular}
  \right\} \\
  K_m &= \left\{
        \begin{tabular}{c}
          \(\alpha \in K(m_0)\): for all non-zero prime \(P \subseteq \O_K\) \\
          such that \(v_P(m_0) > 0\), \(v_P(\alpha - 1) \geq v_P(m_0)\) \\
          and for all \(\tau \in m_\infty\), \(\tau(\alpha) > 0\)
        \end{tabular}
  \right\} \\
  \mathcal I(m_0) &= \left\{
                    \begin{tabular}{c}
                      \(I \in \mathcal I\): for all \(P \subseteq \O_K\) non-zero prime \\
                      such that \(v_P(m_0) > 0 \), \(v_P(I) = 0\)
                    \end{tabular}
  \right\} \\
  \mathcal P(m_0) &= \mathcal P \cap \mathcal I(m_0) = \{(\alpha): \alpha \in K(m_0)\} \\
  \mathcal P_m &=
                 \left\{
                 \begin{tabular}{c}
                   \(I \in \mathcal I\): exists \(\alpha \in K^\times\) such that \((\alpha) = I\) \\
                   and for all \(P \subseteq \O_K\) non-zero prime \\
                   such that \(v_P(m_0) > 0\), \(v_p(\alpha - 1) \geq v_p(m_0)\) \\
                   and for all \(\tau \in m_\infty\), \(\tau(\alpha) > 0\)
                 \end{tabular}
  \right\} \\
                  &= \{(\alpha): \alpha \in K_m\}
\end{align*}
Note \(\mathcal P_m\) is a subgroup of \(\mathcal P(m_0)\).

\begin{definition}[ray class group]\index{ray class group}
  The \emph{ray class group} of modulus \(m\) is
  \[
    H(m) = \mathcal I(m_0)/\mathcal P_m.
  \]
\end{definition}

\begin{remark}
  If \(m\) is the trivial modulus \((\O_K, \emptyset)\) then
  \[
    \mathcal I(m_0) = \mathcal I, \mathcal P_m = \mathcal P
  \]
  and \(H(m) = \mathcal I/\mathcal P\), the usual ideal class group.
\end{remark}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item \(H(m)\) is a finite abelian group.
  \item There are short exact sequences
    \[
      \begin{tikzcd}
        0 \ar[r] & \mathcal P(m_0)/\mathcal P_m \ar[r] & H(m) \ar[r] & H_K \ar[r] & 0
      \end{tikzcd}
    \]
    where \(H_K\) is the usual ideal class group of \(\O_K\), and
    \[
      \begin{tikzcd}[column sep=small]
        0 \ar[r] & \O_K^\times/(\O_K^\times \cap K_m) \ar[r] & (\O_K/m_0)^\times \times \{\pm 1\}^{m_\infty} \ar[r] & \mathcal P(m_0)/\mathcal P_m \ar[r] & 0
      \end{tikzcd}
    \]
    In particular
    \[
      |H(m)| = |H_K| \cdot |(\O_K/m_0)^\times| \cdot 2^{|m_\infty|} \cdot |\O_K^\times/\O_K^\times \cap K_m|^{-1}.
    \]
  \end{enumerate}
\end{proposition}

\begin{proof}
  1 follows from 2 and the finiteness of \(H_K\) which is done in IID Number Fields. There's a short exact sequence
  \[
    \begin{tikzcd}[row sep=scriptsize]
      0 \ar[r] & \mathcal P(m_0)/\mathcal P_m \ar[r] & \mathcal I(m_0)/\mathcal P_m \ar[r] \ar[d, equal] & \mathcal I(m_0)/\mathcal P(m_0) \ar[r] & 0 \\
      & & H(m)
    \end{tikzcd}
  \]
  There is a homomorphism \(\mathcal I(m_0)/\mathcal P(m_0) \to \mathcal I/ \mathcal P = H_K\). This is injective as \(\mathcal P(m_0) = \mathcal P \cap \mathcal I(m_0)\). We need to show it's surjective, i.e.\ for any \(I \in \mathcal I\), exists \(\alpha \in K^\times\) such that \(\alpha^{-1} I \in \mathcal I(m_0)\). Write \(I = I_1 I_2^{-1}\) where \(I_1, I_2 \subseteq \O_K\) are non-zero ideal. By Chinese remainder theorem we can find \(\alpha_1, \alpha_2 \in \O_K\) such that for all \(P \subseteq \O_K\) such that \(v_P(m_0) > 0\),
  \[
    v_P(I_1) = v_P(\alpha_1), v_P(I_2) = v_P(\alpha_2).
  \]
  Then
  \[
    v_P(\alpha_1^{-1} I_1) = v_P(\alpha_2^{-1} I_2) = 0
  \]
  for all such \(P\), so
  \[
    \alpha_1^{-1} I_1 (\alpha_2^{-1} I_2)^{-1} = (\alpha_1/\alpha_2)^{-1} I \in \mathcal I(m_0).
  \]
  Set \(\alpha = \frac{\alpha_1}{\alpha_2}\).

  To obtain the second short exact sequence, we consider the commutative diagram with exact rows
  \[
    \begin{tikzcd}
      0 \ar[r] & \O_K^\times \ar[r] & K(m_0) \ar[r] & \mathcal P(m_0) \ar[r] & 0 \\
      0 \ar[r] & \O_K^\times \cap K_m \ar[r] \ar[u] & K_m \ar[u] \ar[r] & \mathcal P_m \ar[r] \ar[u] & 0 \\
    \end{tikzcd}
  \]
  By snake lemma there's a short exact sequence
  \[
    \begin{tikzcd}
      0 \ar[r] & \O_K^\times/(\O_K^\times \cap K_m) \ar[r] & K(m_0)/K_m \ar[r] & \mathcal P(m_0)/\mathcal P_m \ar[r] & 0
    \end{tikzcd}
  \]
  We need to construct an isomorphism \(K(m_0)/K_m \to (\O_K/m_0)^\times \times \{\pm 1\}^{m_\infty}\). There is at least a homomorphism: we can think of
  \[
    (\O_K/m_0)^\times \times \{\pm 1\}^{m_\infty} = \prod_{P: v_P(m_0) > 0} (A_{K_P}^\times/1 + m_0 A_{K_P}) \times \prod_{\tau \in m_\infty} (\R^\times/\R_{> 0})
  \]
  For any \(P \subseteq \O_K\), there's an inclusion \(K^\times \subseteq K_P^\times\). If \(v_P(m_0) > 0\), this extends to an inclusion \(K(m_0) \subseteq A_{K_P}^\times\). The homomorphism we want is
  \begin{align*}
    K(m_0) &\to \prod_{P: v_P(m_0) > 0} A_{K_P}^\times \times \prod_{\tau \in m_\infty} \R^\times \to \prod_{P: v_P(m_0) > 0} (A_{K_P}^\times/1 + m_0 A_{K_P}) \times \prod_{\tau \in m_\infty} (\R^\times/\R_{> 0}) \\
    \alpha &\mapsto ((\alpha)_P, (\tau(\alpha)))
  \end{align*}
  The kernel equals \(K_m\) by definition. To complete the proof we need to show this homomorphism is surjective. Let \(((x_P)_P, (\varepsilon_\tau)_\tau) \in \prod_{P: v_P(m_0) > 0} (A_{K_P}^\times/1 + m_0 A_{K_P}) \times \{\pm 1\}^{m_\infty}\). By Chinese remainder theorem exists \(x \in \O_K - \{0\}\) such that for all \(P\) such that \(v_P(m_0) > 0\), \(x \pmod{m_0 A_{K_P}} = x_P\). In particular \(x \in K(m_0)\). It's now enough to prove that for any \((\varepsilon_\tau)_{\tau \in m_\infty}\), exists \(y \in \O_K - \{0\}\) such that for all \(P\) such that \(v_P(m_0) > 0\), \(y = 1 \pmod{m_0 A_{K_P}}\) and for all \(\tau \in m_\infty\), \(\sgn(\tau(y)) = \varepsilon_\tau\). Equivalently, \(y = 1 \pmod{m_0}\) and for all \(\tau \in m_\infty\), \(\sgn(\tau(y)) = \varepsilon_\tau\). Note \(m_0 \cap \Z\) is a non-zero ideal, so we can find \(N \geq 2\) such that \(N \in m_0 \cap \Z\). We can find \(\beta \in \O_K\) such that \(K = \Q(\beta)\). Let \(f(X) \in \Z[X]\) be the minimal polynomial of \(\beta\). Then
  \begin{align*}
    \Hom_\Q(K, \C) &= \{\gamma \in \C: f(\gamma) = 0\} \\
    \Hom_\Q(K, \R) &= \{\gamma \in \R: f(\gamma) = 0\}
  \end{align*}
  Let \(\gamma_\tau \in \R\) be \(\tau(\beta)\) for any \(\tau \in m_\infty\). We can find a polynomial \(g(X) \in \R[X]\) such that for all \(\tau \in m_\infty\), \(\sgn(g(\gamma_\tau)) = \varepsilon_\tau\). Since \(\Q\) is dense in \(\R\), we can assume that \(g(X) \in \Q[X]\). By multiplying \(g(X)\) by a positive integer we can assume \(g(X) \in \Z[X]\). Then we take \(y = 1 + kNg(\beta)\) for some \(k \in \N\). Then \(y = 1 \pmod{m_0}\) as \(N \in m_0\). If \(k\) is large enough then
  \[
    \sgn(\tau(y)) = \sgn(1 + kN g(\gamma_\tau)) = \sgn(g(\gamma_\tau)) = \varepsilon_\tau.
  \]
\end{proof}

\begin{eg}
  Let \(K = \Q, m = (N, \{\tau\})\) where \(N \in \N\). Then \(H_\Q = \{1\}\) so
  \begin{align*}
    H(m) \cong \frac{(\Z/N\Z)^\times \times \{\pm 1\}}{\Z^\times} &\cong (\Z/N\Z)^\times \\
    (a \pmod N, 1) &\mapsfrom a \pmod N
  \end{align*}
  So ray class group generalises the classical ideal class group. If instead \(m = (N, \emptyset)\) then \(H(m) = (\Z/N\Z)^\times/\{\pm 1\}\).
\end{eg}

\begin{eg}
  Let \(K = \Q(\sqrt d)\) where \(d \in \Z, d > 1\) squarefree. Then exists \(\varepsilon \in \O_K^\times\) such that \(\O_K^\times = \{\pm \varepsilon^\Z\}\) and there exist two distinct embeddings \(\sigma, \tau: K \to \R\) where \(\sigma(\sqrt d) > 0, \tau(\sqrt d) < 0\). Suppose \(H_K\) is trivial. Let \(m = (\O_K, \{\sigma, \tau\})\). Then
  \[
    H(m)
    = \frac{\{\pm 1\} \times \{\pm 1\}}{\{(\sgn \sigma(\alpha), \sgn \tau(\alpha)): \alpha \in \O_K^\times\}}
    \cong \frac{\{\pm 1\} \times \{\pm 1\}}{\langle (-1, -1), (\sgn \sigma(\varepsilon), \sgn \tau(\varepsilon)) \rangle}
  \]
  so two possibilities for \(H(m)\): it is trivial if \(\sigma(\varepsilon)\) and \(\tau(\varepsilon)\) have different signs, or cyclic of order \(2\) if same sign. Note
  \[
    N_{K/\Q}(\varepsilon) = \sigma(\varepsilon) \tau(\varepsilon) =
    \begin{cases}
      1 & \sgn(\varepsilon) = \tau(\varepsilon) \\
      -1 & \sgn(\varepsilon) \ne \tau(\varepsilon)
    \end{cases}
  \]
  They both occur: if \(d = 2\) then \(H_K = \{1\}\) and \(\varepsilon = 1 + \sqrt 2\) has norm \(N_{K/\Q}(\varepsilon) = 1 - 2 = -2\). If \(d = 3\) then \(H_K = \{1\}\) and \(\varepsilon = 2 + \sqrt 3\) has norm \(1\).
\end{eg}

\begin{theorem}[global class field theorem]\index{GCFT}\index{global class field theorem}
  Let \(K\) be a number field and \(m\) a modulus of \(K\).
  \begin{enumerate}
  \item Let \(L/K\) be an abelian extension. Define its associated modulus\index{modulus} \(m_{L/K} = (m_{L/K, 0}, m_{L/K, \infty})\) where
    \begin{align*}
      m_{L/K, 0} &= C_{L/K} \\
      m_{L/K, \infty} &=
                        \left\{
                        \begin{tabular}{c}
                          \(\tau \in \Hom_\Q(K, \R)\): exist no \\
                          \(\tilde \tau \in \Hom_\Q(L, \R)\) such that \(\tilde \tau|_K = \tau\)
                        \end{tabular}
      \right\}
    \end{align*}
    Define the homomorphism \(\psi_{L/K}: \mathcal I(C_{L/K}) \to \gal(L/K)\) as the unique homomorphism such that for any non-zero prime \(P \subseteq \O_K\) such that \(v_P(C_{L/K}) = 0, \psi_{L/K}(P) = (P, L/K)\). Suppose \(m_{L/K} \leq m\). Then \(\mathcal P_m \subseteq \ker \psi_{L/K}\) so \(\psi_{L/K}\) determines a homomorphism \(\phi_{L/K}: H(m) \to \gal(L/K)\) which is surjective.
  \item The assignment \(L/K \mapsto \ker \phi_{L/K}\) defines an inclusion-reversing bijection
    \[
      \left\{
        \begin{tabular}{c}
          abelian extesion \(L/K\) \\
          such that \(m_{L/K} \leq m\)
        \end{tabular}
      \right\}
      \longleftrightarrow
      \{\text{subgroup of } H(m)\}
    \]
    If \(L\) corresponds to \(H\) then \(\phi_{L/K}: H(m)/H \to \gal(L/K)\) is an isomorphism. In partciular the trivial subgroup of \(H(m)\) corresponds to the maximal abelian extension \(L(m)/K\) such that \(m_{L(m)K} \leq m\). \(L(m)\) is called the \emph{ray class field of modulus \(m\)}\index{ray class field}, and \(\phi_{L(m)/K}: H(m) \cong \gal(L(m)/K)\).
  \end{enumerate}
\end{theorem}

\begin{eg}
  For any \(K\) there's the ray class field \(E\) associated the trivial modulus. This is the maximal extension \(E/K\), everywhere unramified, and such that every embedding \(\tau: K \embed \R\) extends to an embedding \(\tilde \tau: E \embed \R\). \(E\) is called the \emph{Hilbert class field}\index{Hilbert class field} of \(K\), and comes with an isomorphism \(\phi_{E/K}: H_K \cong \gal(E/K)\).

  If \(K\) has trivial ideal class group then \(E = K\), for example \(E = \Q\).

  If \(K = \Q(\sqrt{-23})\) then \(E\) is the splitting field of \(X^3 - X + 1\).

  \begin{proof}
    Define \(L\) to be the splitting field of \(f(X) = X^3 - X + 1\) over \(\Q\). Then \(\operatorname{disc} f = -4a^3 - 27b^2 = -23\) so \(\Q(\sqrt{-23}) \subseteq L\) and \(f(X)\) is irreducible mod \(3\) so \(\gal(L/\Q) \cong S_3\) and \(\gal(L/K)\) is cyclic of order \(3\). To show \(L/K\) is the Hilbert class field, we need to check
    \begin{enumerate}
    \item \(m_{L/K} \leq (\O_K, \emptyset)\) (i.e.\ \(L/K\) is everywhere unramified),
      \item \(|H_K| = 3\).
      \end{enumerate}
      We take 2 as given. For 1, note that \(L/\Q\) is unramified for any prime away from \(p = 23\). Note \(\O_K\) has a unique prime ideal \(P\) lying above \(23\) as \(23\) is ramified, i.e.\ \(23\O_K = P^2\) (in fact \(P = (\sqrt{-23})\). We need to show \(P\) is unramified in \(L\), equivalently that if \(Q\) is a prime ideal of \(\O_L\) lying above \(23\) then \(e_{Q/(23)} = |I_{Q/(23)}|\) is prime to \(3\).

      If \(\overline f(X) = f(X) \bmod{23}\) then \(\overline f(X)\) has a repeated root. In fact \(\overline f(X) = a(X) b(X)^2\) where \(a(X), b(X) \in \F_{23}[X]\) of degree \(1\): a cubic having a repeated root either has a single root with multiplicity \(3\) or is of this form. But
      \[
        3f(X) - Xf'(X) = 3x^3 - 3X + 3 - 3X^3 + X = -2X + 3
      \]
      so \((\overline f, \overline f') \ni (-2X + 3)\) and \(\gcd(\overline f, \overline f')\) has degree \(1\). Let \(\alpha_1, \alpha_2, \alpha_3 \in \O_L\) be the roots of \(f(X)\). Assume they're labeled so that \(a(\alpha_1 \pmod Q) = 0, b(\alpha_2 \pmod Q) = 0\). Recall
      \[
        I_{Q/(23)} = \{\sigma \in \gal(L/\Q): \sigma(Q) = Q, \sigma \pmod Q = \id_{k_Q}\}.
      \]
      If \(\sigma \in I_{Q/(23)}\) then
      \begin{align*}
        a(\sigma(\alpha_1) \pmod Q) &= 0 \\
        b(\sigma(\alpha_2) \pmod Q) &= b(\sigma(\alpha_3) \pmod Q) = 0
      \end{align*}
      hence we must have \(\sigma(\alpha_1) = \alpha_1, \sigma(\alpha_2) \in \{\alpha_2, \alpha_3\}\) so \(I_{Q/(23)} \subseteq \{1, (23)\}\).
  \end{proof}
\end{eg}

\begin{eg}
  Let \(d \in \Z, d > 1\) squarefree and let \(K = \Q(\sqrt d)\). Suppose \(H_K = \{1\}\). Recall that if \(m = (\O_K, \Hom_\Q(K, \R))\) then
  \[
    H(m) =
    \begin{cases}
      \{1\} & N_{K/\Q}(\varepsilon) = -1 \\
      \Z/2 & N_{K/\Q}(\varepsilon) = 1
    \end{cases}
  \]
 By GCFT if \(N_{K/\Q}(\varepsilon) = 1\) then there exists a quadratic extension \(L/K\) which is everywhere unramified but with no real embedding. For example let \(K = \Q(\sqrt 3)\). Then \(H_K = \{1\}, \varepsilon = 2 + \sqrt 3, N_{K/\Q}(\varepsilon) = 1\). In this case \(L = K(i) = K(\sqrt{-23})\) is an everywhere unramified quadratic extension of \(K\).
  \[
    \begin{tikzcd}
      & L \ar[dl, dash] \ar[dr, dash] & & & L \ar[dl, dash] \ar[dr, dash] \\
      K \ar[dr, dash] & & \Q(i) \ar[dl, "\text{ramified only at } 2", dash] & K \ar[dr, dash] & & \Q(\sqrt{-3}) \ar[dl, "\text{ramified only at } 3", dash] \\
      & \Q & & & \Q
    \end{tikzcd}
  \]
\end{eg}

In the remainder of the course we'll examine the relation between GCFT of imaginary quadratic fields and binary quadratic forms.

\begin{definition}[binary quadratic form]\index{binary quadratic form}
  A \emph{binary quadratic form} is a polynomial \(f(x, y) = ax^2 + bxy + cy^2\) where \(a, b, c \in \Z\). Equivalently
  \[
    f(x, y) = (x, y)
    \begin{pmatrix}
      a & b/2 \\
      b/2 & c
    \end{pmatrix}
    \begin{pmatrix}
      x \\
      y
    \end{pmatrix}
  \]

  We say an integer \(m\) is \emph{represented} by \(f(x, y)\) if there exist \(x_0, y_0 \in \Z\) such that \(f(x_0, y_0) = m\).
\end{definition}

A classical question in number theory asks: which primes \(p\) are represented by a fixed BQF? For example (for \(p\) odd)
\begin{itemize}
\item \(p = x^2 + y^2\) if and only if \(p = 1 \pmod 4\) (Fermat).
\item \(p = x^2 + 2y^2\) if and only if \(p = 1, 3 \pmod 8\) (Euler).
\item \(p = x^2 + 5y^2\) if and only if \(p = 1, 9 \pmod{20}\) (Gauss).
\item \(p = x^2 + 14y^2\) if and only if the equations \(x^2 = -14\) and \((y^2 + 1)^2 = 8\) both have solutions in \(\F_p\).
\end{itemize}

In fact if \(n \in \N\) and \(-n = 2, 3 \pmod 4\) squarefree then \(p\) is represented by \(x^2 + ny^2\) (with \(p \ndivides 4n\)) if and only if \(p\) splits completely in the Hilbert class field of \(\Q(\sqrt{-n})\).

\begin{definition}[discriminant of a BQF]\index{discriminant}
  If \(f(x, y) = ax^2 + bxy + cy^2\) is a BQF we define its \emph{discriminant} to be \(\disc f = b^2 - 4ac\).
\end{definition}

\(\SL_2(\Z)\) acts on the set of BQFs by
\[
  \gamma \cdot f(x, y) = f(\gamma^{-1}
  \begin{pmatrix}
    x \\
    y
  \end{pmatrix})
\]
Equivalently \(\gamma \cdot f\) is associated to \(\gamma^{-T}
\begin{psmallmatrix}
  a & b/2 \\
  b/2 & c
\end{psmallmatrix}
\gamma^{-1}\). Since \(\disc f = -4 \det \begin{psmallmatrix}
  a & b/2 \\
  b/2 & c
\end{psmallmatrix}
\) it is invariant under the action.

\begin{remark}
  If \(\disc f < 0\) then \(f(x, y)\) is either positive definite (\(a > 0\)) or negative definite (\(a < 0\)).
\end{remark}

To describe the relation between BQFs and imaginary quadratic fields we need to introduce the \emph{discriminant}\index{discriminant} of a number field. Recall from IID Number Fields that if \(K/\Q\) is a number field of degree \([K: \Q] = n\) and \(\alpha_1, \dots, \alpha_n \in K\), we define
\[
  \disc (\alpha_1, \dots, \alpha_n) = \det D^2
\]
where \(D_{ij} = \sigma_i(\alpha_j), \sigma_1, \dots, \sigma_n: K \to \C\) are the distinct embeddings. This doesn't depend on the ordering of \(\sigma_1, \dots, \sigma_n\). If \(A \in M_n(\Z)\) and \(\beta_i = \sum_{j = 1}^n A_{ij} \alpha_j\) then
\[
  \disc (\beta_1, \dots, \beta_n) = \det A^2 \disc(\alpha_1, \dots, \alpha_n).
\]
In particular if \(M \leq K\) is a free \(\Z\)-module of rank \(n\) then we can define \(\disc M = \disc(\alpha_1, \dots, \alpha_n)\), where \(\alpha_1, \dots, \alpha_n\) is a generating set for \(M\). This does not depends on the choice of \(\alpha_i\)'s. If \(M' \leq M\) are free of rank \(n\) then by a similar argument using Smith normal form
\[
  \disc M' = \disc M \cdot [M : M']^2.
\]

\begin{note}
  \(\O_K\) is always free of rank \(n\) as a \(\Z\)-module so we can define \(\disc \O_K\). For example if \(d \in \Z\) squarefree, \(d \neq 0, 1\) then
  \[
    \O_K =
    \begin{cases}
      \Z \oplus \Z \sqrt d & d = 2, 3 \pmod 4 \\
      \Z \oplus \Z \frac{1 + \sqrt d}{2} & d = 1 \pmod 4
    \end{cases}
  \]
  so
  \[
    \disc \O_K =
    \begin{cases}
      \det
      \begin{psmallmatrix}
        1 & \sqrt d \\
        1 & - \sqrt d
      \end{psmallmatrix}
      ^2 = 4d & d = 2, 3 \pmod 4 \\
      \det
      \begin{psmallmatrix}
        1 & \frac{1 + \sqrt d}{2} \\
        1 & \frac{1 - \sqrt d}{2}
      \end{psmallmatrix}
      ^2 = d & d = 1 \pmod 4 \\
    \end{cases}
  \]
\end{note}

\begin{theorem}
  \label{thm:bijection between SL2 orbits of BQF and class group}
  Let \(d \in \Z\) squarefree, \(d < 0\). Fix an embedding \(K = \Q(\sqrt d) \to \C\). Then there is a bijection
  \begin{align*}
    \SL_2(\Z)
    \left\{
    \begin{tabular}{c}
      positive definite BQF \\
      of discriminant \(D\)
    \end{tabular}
    \right\}
    &\longleftrightarrow H_K \\
    ax^2 + bxy + y^2 &\mapsto \Z \oplus \Z \beta
  \end{align*}
  where \(\beta = \frac{-b + \sqrt D}{2a}\).
\end{theorem}

We first prove
\begin{proposition}
  There is a bijection
  \[
    \left\{
    \begin{tabular}{c}
      positive definite BQF \\
      of discriminant \(D\)
    \end{tabular}
    \right\}
    \longleftrightarrow
    \left\{
      \begin{tabular}{c}
        \(\beta \in K\) such that \(\Im \beta > 0\) \\
        and \(\Z \oplus \Z \beta\) is a \\
        fractional ideal of \(\O_K\)
      \end{tabular}
    \right\}
  \]
  given by the same formula as above. This bijection is \(\SL_2(\Z)\)-equivariant, where \(\SL_2(\Z)\) acts on \(\beta \in K\) with \(\Im \beta > 0\) by Möbius transformation
  \[
    \begin{pmatrix}
      A & B \\
      C & D
    \end{pmatrix}
    \cdot \beta = \frac{A \beta + B}{C \beta + D}.
  \]
\end{proposition}

\begin{proof}
  First check that \(\Z \oplus \Z \beta\) is a fractional ideal of \(\O_K\), i.e.\ it is stable under multiplication by \(\O_K\). Note \(\beta = \frac{-b + \sqrt D}{2a}\) is a root of \(f(x, 1) = ax^2 + bx + c\) so \(a\beta^2 = -(b \beta + c)\) and
  \[
    a \beta \cdot (\Z \oplus \Z \beta) \subseteq \Z \oplus \Z \beta.
  \]
  This implies that \(a\beta\) is integral over \(\Z\), hence \(a \beta \in \O_K\), hence \(\Z \oplus \Z a \beta \subseteq \O_K\).
  \[
    \disc (\Z \oplus \Z a \beta) = \det
    \begin{pmatrix}
      1 & a \beta \\
      1 & a \overline \beta
    \end{pmatrix}
    ^2 = a^2 (\beta - \overline \beta)^2 = D = \disc \O_K
  \]
  Hence \(\Z \oplus \Z a\beta = \O_K\) so \(\Z \oplus \Z \beta\) is a fractional ideal of \(\O_K\).

  We now define an inverse to the map in the statement of the proposition. It sends \(\beta\) to the binary quadratic form \(f(x, y) = ax^2 + bxy + cy^2\) where \(ax^2 + bx + c \in \Z[x]\) is the unique quadratic which has \(\beta\) as a root, \(\gcd(a, b, c) = 1\) and \(a > 0\). We need to check that \(\disc f = D\). Note \(a \beta^2 = -(b \beta + c)\) so \(a\beta \cdot (\Z \oplus \Z \beta) \subseteq \Z \oplus \Z \beta\) and \(a\beta \in \O_K\). If \(A + B \beta \in \O_K\) for \(A, B \in \Q\) then \((A + B \beta) \cdot (\Z \oplus \Z \beta) \subseteq \Z \oplus \Z \beta\) so
  \begin{align*}
    A + B \beta &\in \Z \oplus \Z \beta \\
    (A + B \beta) \beta &= A\beta + B(- \frac{b \beta}{a} - \frac{c}{a}) \\
                &= - \frac{Bc}{a} + (A - \frac{Bb}{a}) \beta \in \Z \oplus \Z \beta
  \end{align*}
  so \(A, B \in \Z\) and \(- \frac{Bc}{a}, A - \frac{Bb}{a} \in \Z\) so \(\frac{B}{a} \in \Z\) (as \(a, b, c\) coprime) so \(B \in a \Z\). Thus \(A + B \beta \in \O_K\) lies in \(\Z \oplus \Z a\beta\). Hence \(\O_K = \Z \oplus \Z a \beta\) and
  \[
    D = \disc \O_K = \disc (\Z \oplus \Z a \beta) = \disc f.
  \]
  This shows the existence of a bijection as in the statement of the proposition. \(\SL_2(\Z)\)-equivariane is left as an exercise.
\end{proof}

\begin{proof}[Proof of \Cref{thm:bijection between SL2 orbits of BQF and class group}]
  By proposition there's a bijection
  \[
    \SL_2(\Z) \backslash
    \left\{
    \begin{tabular}{c}
      positive definite BQF \\
      of discriminant \(D\)
    \end{tabular}
    \right\}
    \longleftrightarrow
    \SL_2(\Z) \backslash
    \left\{
      \begin{tabular}{c}
        \(\beta \in K\) such that \(\Im \beta > 0\) \\
        and \(\Z \oplus \Z \beta\) is a \\
        fractional ideal of \(\O_K\)
      \end{tabular}
    \right\}
  \]
  We need to show the map
  \begin{align*}
    \mathrm{RHS} &\to H_K \\
    \Z \oplus \Z \beta &\mapsto [\Z \oplus \Z \beta]
  \end{align*}
  is an bijection. First show it is well-defined: suppose \(\beta, \beta' \in K, \Im \beta > 0, \Im \beta' > 0\), \(\Z \oplus \Z \beta, Z \oplus \Z \beta'\) fractional ideals of \(\O_K\) and \(\beta = \frac{x \beta + y}{z \beta + w}\) for \(
  \begin{psmallmatrix}
    x & y \\
    z & w
  \end{psmallmatrix}
  \in \SL_2(\Z)\). Then
  \[
    \Z \oplus \Z \beta' = \Z \oplus \frac{x\beta + y}{z\beta + w} = \frac{1}{z\beta + w} (\Z(z \beta + w) \oplus \Z(x\beta + y))
  \]
  so
  \[
    [\Z \oplus \Z \beta'] = [\Z(z \beta + w) \oplus \Z(x \beta + y)] = [\Z \oplus \Z \beta].
  \]

  Now show the map is injective. If \([\Z \oplus \Z\beta] = [\Z \oplus \Z \beta']\) then exists \(\alpha \in K^\times\) such that \(\Z \oplus \Z \beta = \Z \alpha \oplus \Z \alpha \beta'\), so exists \(
  \begin{psmallmatrix}
    x & y \\
    z & w
  \end{psmallmatrix}
  \in \GL_2(\Z)\) such that
  \[
    1 = x\alpha + y \alpha \beta', \beta = z \alpha + w \alpha \beta'
  \]
  so \(\beta = \frac{w\beta' + z}{y\beta' + x}\). Since \(\beta, \beta'\) both have positive imaginary part, the matrix \(
  \begin{psmallmatrix}
    w & z \\
    y & x
  \end{psmallmatrix}
  \) has determinant \(+ 1\).

  Finally we show the map is surjective. Let \(I\) be a fractional ideal of \(\O_K\). Then \(I\) is free of rank \(2\) as a \(\Z\)-module, so has a basis \(\alpha_1, \alpha_2\) over \(\Z\). wlog we can assume \(\Im \frac{\alpha_2}{\alpha_1} > 0\). Then
  \[
    [I] = [\Z \alpha_1 \oplus \Z \alpha_2] = [\Z \oplus \Z \frac{\alpha_2}{\alpha_1}]
  \]
  which lies in the image.
\end{proof}

This gives an efficient way to compute \(H_K\) as a set, using the existence of a fundamental domain for the action of \(\SL_2(\Z)\) on \(\H\), the upper half plane. We set
\[
  \mathcal D = \{z \in \H: |z| > 1, -\frac{1}{2} \leq \Re z < \frac{1}{2}\} \cup \{z \in \H: |z| = 1, -\frac{1}{2} \leq \Re z < 0\}.
\]
It is a fact that for all \(z \in \H\), \(\SL_2(\Z) \cdot z) \cap \mathcal D\) contains exactly one element.

For any orbit of BQFs with discriminant \(D\), there is a unique representative \(f(x, y) = ax^2 + bxy + cy^2\) such that \(\beta = \frac{-b + \sqrt D}{2a} \in \mathcal D\). e have \(|\beta|^2 = \frac{c}{a}, \Re \beta = -\frac{b}{2a}\). Thus \(\beta \in \mathcal D\) if and only if
\[
  \frac{c}{a} > 1, a \geq b > -a \text{ or } \frac{c}{a}, a \geq b \geq 0.
\]
This is usually written as \(c \geq a \geq |b|\) and if \(c = a\) or \(a = |b|\) then \(b \geq 0\).

\begin{definition}[reduced BQF]\index{BQF!reduced}
  A positive definite BQF of disciminant \(D\) is called \emph{reduced} if it satisfies the condition above.
\end{definition}

\begin{lemma}
  There is a bijection between \(H_K\) and the set of reduced positive definite BQFs of discriminant \(D\).
\end{lemma}

This also shows \(H_K\) is finite, as there are finitely many reduced forms \(f(x, y)\): \(-D = 4ac - b^2 \geq 4b^2 - b^2 = 3b^2\) so \(|b| \leq \sqrt{|D|}{3}\) so there are only finitely many possibilities for \(b\), hence for \(a, c\).

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item The identity \([\O_K] \in H_K\) corresponds to the reduced form
    \[
      f(x, y) =
      \begin{cases}
        x^2 - dy^2 & d = 2, 3 \pmod 4 \\
        x^2 + xy + \frac{1 - d}{4} y^2 & d = 1 \pmod 4
      \end{cases}
    \]
    called \emph{principal form of \(\O_K\)}.
  \item A class \([I] \in \O_K\) satisfies \([I]^2 = [\O_K]\) if and only if the corresponding reduced form \(ax^2 + bxy + cy^2\) satisfies \(c = a, a = b\) or \(b = 0\).
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item We do the calculation for \(d = 2, 3 \pmod 4\). \(x^2 - dy^2\) has discriminat \(D\) and is reduced. It corresponds to the fractional ideal class \([\Z \oplus \Z \beta]\) where \(\beta = \frac{-b + \sqrt D}{2a} = \sqrt d\). We know \(\Z \oplus \Z \sqrt d = \O_K\).
  \item Observe that \(\gal(K/\Q) = \{1, c\}\) acts on \(H_K\). In fact for any \([I] \in H_K\) we have \([I] [c(I)] = [\O_K]\): it's enough to check that if \(Q \subseteq \O_K\) is a non-zero prime ideal, \(Q c(Q)\) is principal. Say \(Q\) lies above \((p) \subseteq \Z\). Then one of the three cases:
    \begin{enumerate}
    \item \(p\) splits in \(\O_K\): \(p \O_K = Q c(Q)\) so \(Q c(Q) = p\O_K\).
    \item \(p\) is inert: \(p \O_K = Q\) so \(Q c(Q) = p^2 \O_K\).
    \item \(p\) is ramified: \(p \O_K = Q^2\) so \(Q c(Q) = p\O_K\).
    \end{enumerate}
    so we need to show \([I] = [c(I)]\) if and only if \(a = c, a = b\) or \(b = 0\). wlog \(I = \Z \oplus \Z \beta\) where \(\beta = \frac{-b + \sqrt D}{2a}\) so \(c(I) = \Z \oplus \Z \overline \beta = \Z \oplus \Z(-\overline \beta)\). If \(f(\beta, 1) = 0\) where \(f(x, y) = ax^2 + bxy + cy^2\) then \(g(-\overline \beta, 1) = 1\) where \(g(x, y) = ax^2 - bxy + cy^2\). Thus \([I]^2 = [\O_K]\) if and only if \(f(x, y), g(x, y)\) lies in the same \(\SL_2(\Z)\)-orbit.

    If \(\beta\) lies in the interior of \(\mathcal D\), i.e.\ if \(c > a\) and \(a > |b|\) then \(\overline \beta\) also lies in the interior so \(g(x, y)\) is reduced, so \(f(x, y), g(x, y)\) lies in the same \(\SL_2(\Z)\)-orbit so by uniqueness \(f(x, y) = g(x,y)\) so \(b = 0\).

    The other case is when \(\beta\) lies on the boundary of \(\mathcal D\), i.e.\ \(b = a\) or \(c = a\). In this case \(-\overline \beta\) is not in \(\mathcal D\) so \(g(x, y)\) is not reduced. However \(-\overline \beta\) \emph{is} \(\SL_2(\Z)\)-conjugate to \(\beta\) to \(f(x, y)\), (use, for example, the MMöbius tranformation \(
    \begin{psmallmatrix}
      1 & -1 \\
      0 & 1
    \end{psmallmatrix}
    \) when \(b = 1\)) and indeed \([I]^2 = [\O_K]\).
  \end{enumerate}
\end{proof}

\begin{corollary}
  Let \(p \ndivides D\) be a prime number. Then \(p\) is represented by the principal form of \(\O_K\) if and only if \(p\) splits completely in the Hilbert class field \(H/K\).
\end{corollary}

\begin{proof}
  Suppose \(\O_K = \Z \oplus \Z \beta\) where \(\beta = \sqrt d\) \(\frac{1 + \sqrt d}{2}\). Have
  \[
    f(x, y) = (x + y\beta)(x + y \overline \beta) = N_{K/\Q}(x + y \beta)
  \]
  so \(p\) is representated by \(f(x, y)\) if and only if exists \(\alpha \in \O_K\) such that \(N_{K/\Q}(\alpha) = \alpha \overline \alpha = p\), if and only if exists \(\alpha \in \O_K\) such that \((\alpha)(\overline \alpha) = (p)\), if and only if \(p\) splits in \(\O_K\), \(p = Q_1 Q_2\) and both \(Q_1\) and \(Q_2\) are principal. Now recall the isomorphism \(\phi_{H/K}: H_K \to \gal(H/K)\) sending \([Q] \mapsto \gal(Q, H/K)\), \(Q \subseteq \O_K\) a non-zero prime ideal, \(D_{Q'/Q} = \langle (Q, H/K) \rangle\). So \(p\) is represented by \(f(x, y)\) if and only if \(p\) splits and \(\phi_{H/K}(Q_1) = \id_H\), if and only if \(p\) splits and \(Q_1Q_2\) splits completely in \(H/K\) (?), if and only if \(p\) splits completely in \(H/\Q\).
\end{proof}

We can show that if \(f(x, y)\) is a reduced form of discriminant \(D\) then \(f(x, y)\) represents a prime \(p \divides D\) if and only if \(p\) splits \(p = Q_1Q_2\) in \(\O_K\) and \(\phi_{H/K}(Q_i)\) equals \(\phi_{H/K}([I])\) for some \(i = 1, 2\), where \([I]\) is the class corresponding to \(f(x, y)\).

Idea:\(H/K/\Q\). \(p\) is represented by some form \(f(x, y)\) of discriminant \(D\) if and only if \(p\) splits in \(\O_K\), which forms \(f(x, y)\) repsent \(p\) is determined by the factorisation of \(p\) in \(\O_H\).

\begin{eg}
  \(d = -1, K = \Q(i), D = -4\). There is a unique reduced form \(x^2 + y^2\) so if \(p ndivides 2\) then \(x^2 + y^2\) represents \(p\) if and only if \(p\) splits in \(\Z[i]\), if and only if \(\legendre{-1}{p} = 1\), if and only if \(p = 1 \pmod 4\).
\end{eg}

\begin{eg}
  \(d = -5, D = -20\). Have bound \(|b| \leq \sqrt{\frac{|D|}{3}} < 3\) so \(|b| = 0, 1, 2\). Also \(b^2 - 4ac = -20\). If \(b = 0\) then there is a unique reduced form \(x^2 + 5y^2\). If \(b = 2\) then there is a unique reduced form \(2x^2 + 2xy + 3y^2\). The Hilbert class field is \(H = K(i) = K(\sqrt 5)\). Thus if \(p \ndivides 20\) then \(x^2 + 5y^2\) representes \(p\) if and only if \(p\) splits in \(H\) and \(2x^2 + 2xy + 3y^2\) represents \(p\) if and only if \(p\) splits in \(K\) but does not split in \(\Q(i)\).
\end{eg}



\printindex
\end{document}

% Books:
% Lang: Algebraic Number theory
% Swinnerton-Dyer: A brief guide to algebraic number theory
% Weil History of number theory