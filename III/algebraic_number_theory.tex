\documentclass[a4paper]{article}

\def\npart{III}

\def\ntitle{Algebraic Number Theory}
\def\nlecturer{J.\ A.\ Thorne}

\def\nterm{Michaelmas}
\def\nyear{2019}

\input{header}

\DeclareMathOperator{\Frac}{Frac}
\DeclareMathOperator{\Div}{Div}

\renewcommand*{\O}{\mathcal{O}}
\DeclareMathOperator{\Cl}{Cl} % ideal class group

\begin{document}

\input{titlepage}

\tableofcontents

\setcounter{section}{-1}

\section{Introduction}

In IID Number Fields, we studied finite extensions of \(\Q\) and their rings of integers. We proved two fundamental theorem for \(\O_K\):
\begin{itemize}
\item finiteness of ideal class group,
\item finite generation of \(\O_K^\times\).
\end{itemize}

In this course, we'll study
\begin{itemize}
\item completion at a prime,
\item Galois theory of local and global fields.
\end{itemize}
and finally we'll describe class field theory (description only).

\section{Dedekind domains}

\begin{definition}[discrete valuation ring]\index{discrete valuation ring}
  Let \(A\) be a ring. We say \(A\) is a \emph{discrete valuation ring} (DVR) if \(A\) is a principal ideal domain (PID) and \(A\) has a unique non-zero prime ideal.
\end{definition}

Let \(A\) be a DVR. Then the unique non-zero prime ideal \(\mathfrak m_A\) of \(A\) is also maximal, so \(A\) is also a local ring, i.e.\ \(A\) has a unique maximal ideal. Hence \(k_A = A/\mathfrak m_A\) is a field, the residue field of \(A\).

As \(A\) is a PID, \(\mathfrak m_A = (\pi)\) is principal. Any generator \(\pi\) is called a \emph{uniformiser}\index{uniformiser}. If \(\pi, \pi'\) are uniformisers then \((\pi) = (\pi')\) so \(\pi' = \pi u\) for some \(u \in A^\times\).

Since \(A\) is a local, \(A\) can be written as the disjoint union
\begin{align*}
  A &= A^\times \cup \mathfrak m_A \\
    &= A^\times \cup \pi A \\
    &= A^\times \cup \pi A^\times \cup \pi^2 A \\
    &= \bigcup_{i \geq 0} \pi^i A^\times \cup \bigcap_{i \geq 0} \pi^i A
\end{align*}

In fact, the ideal \(I = \bigcap_{i \geq 0} \pi^i A\) is zero. This follows from
\begin{lemma}[Nakayama's lemma]\index{Nakayama's lemma}
  Let \(R\) be a local ring, \(P \subseteq R\) the unique maximal ideal, \(M\) a finitely generated (fg) \(R\)-module. Then
  \begin{enumerate}
  \item if \(M = P M\) then \(M = 0\). This is equivalent to \(M/PM = 0\).
  \item if \(N \leq M\) is an \(R\)-submodule such that \(N + PM = M\) then \(N = M\). This is saying there is a surjection \(N \surj M/PM\).
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Let \(a_1, \dots a_g\) be a generating set for \(M\) with \(g\) as small as possible, \(g \geq 1\). Then \(a_1 \in M = PM\) so we can write
    \[
      a = \sum_{i = 1}^g x_i a_i
    \]
    where \(x_i \in P\). Hence
    \[
      (1 - x_1) a_1 = \sum_{i = 2}^g x_i a_i.
    \]
    Since \(R\) is local, \(1 - x_1 \in R^\times\) so \(a_1 \in \generation{a_2, \dots, a_g}\), contradicting the minimality of \(g\).
  \item Apply first part to \(M/N\).
  \end{enumerate}
\end{proof}

Now back to the statement. Note \(\pi I = I\) so Nakayama's lemma implies that \(I = 0\). Hence each element of \(x \in A, x \neq 0\) admits a aunique description \(x = \pi^n u\), \(n \geq 0, u \in A^\times\). Each non-zero ideal of \(A\) has the form \((\pi^i)\) for some \(i \geq 0\).

Therefore we can define a function \(v: K^\times \to \Z\) where \(K = \Frac A\) with the following properties:
\begin{enumerate}
\item \(v\) is a surjective homomorphism,
\item for all \(x, y \in K^\times\) such that \(x + y \neq 0\), \(v(x + y) \geq \min(v(x), v(y))\), with equality if \(v(x) \neq v(y)\).
\end{enumerate}
We define \(v(x) = n\) when \(x = \pi^n u\) for some \(n \in \Z, u \in A^\times\).

\begin{proof}\leavevmode
  \begin{enumerate}
  \item \(\pi^n u \cdot \pi^m v = \pi^{n + m} uv\).
  \item wlog \(x = \pi^a u, y = \pi^{a + b} v\) where \(a \in \Z, b \geq 0\). Then
    \[
      x + y = \pi^a(u + v \pi^ b).
    \]
    If \(b > 0\) then \(u + v \pi^b \in A^\times\).
  \end{enumerate}
\end{proof}

\begin{definition}[valuation]\index{valuation}
  If \(L\) is a field, we call a function \(w: L^\times \to \Z\) a \emph{valuation} if satisfies 1, 2 above.
\end{definition}

Thus if we have a DVR then we have a valuation. The converse also holds: if \(w: L^\times \to \Z\) is a valuation, we define
\begin{align*}
  A_L &= \{x \in L^\times: w(x) \geq 0\} \cup \{0\} \\
  \mathfrak m_L &= \{x \in L^\times: w(x) > 0\} \cup \{0\}
\end{align*}

\begin{lemma}
  If \(k\) is a field, then there is a bijection between
  \begin{enumerate}
  \item subrings \(A \leq K\) such that \(A\) is a DVR and \(\Frac A = K\),
  \item valuations \(v: K^\times \to \Z\).
  \end{enumerate}
\end{lemma}

\begin{proof}
  Exercise.
\end{proof}

\begin{eg}\leavevmode
  \begin{enumerate}
  \item Let \(p\) be a prime, \(v: \Q^\times \to \Z\) defined by
    \[
      v(p^n \frac{r}{s}) = n
    \]
    if \(r, s \in \Z\), \((p, rs) = 1\).
  \item Let \(K\) be the field of meromorphic functions on \(\C\), \(v: K^\times \to \Z\) defined by
    \[
      v(f) = \operatorname{ord}_{z = 0} f(z).
    \]
  \end{enumerate}
\end{eg}

We will see via localisation we can reduce problems to DVR. Hence we need a way to recognise DVR. This is the content of the next proposition

\begin{proposition}
  Let \(A\) be a Noetherian domain. Then TFAE:
  \begin{enumerate}
  \item \(A\) is a DVR.
  \item \(A\) is integrally closed in \(\Frac A\) and \(A\) has a unique non-zero prime ideal.
  \end{enumerate}
\end{proposition}

Recall that \(A\) is integrally closed if for all \(\gamma \in K, a_1, \dots, a_n \in A\), if
there is a relation
\[
  \gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0
\]
then \(\gamma \in A\). Equivalently, for all \(\gamma \in K\), \(A[\gamma]\) is fg as an \(A\)-module then \(\gamma \in A\).

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(2 \implies 1\): suppose \(\gamma \in K - A\) and there exist \(a_1, \dots, a_n \in A\) such that
    \[
      \gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0.
    \]
    We can write \(\gamma = \pi^{-k} u\) for some \(k > 0, u \in A^\times\). Hence
    \[
      -\pi^{-nk} u^n = a_1 \pi^{-(n - 1)k} u^{n - 1} + \dots + a_n.
    \]
    The valuation of LHS is \(-nk\) and the valuation of RHS is at least
    \[
      \min_{i = 1}^n v(a_i \pi^{- (n - i) k}) \geq \min v(\pi^{-(n - i)k}) = \min -(n - i) k \geq -(n - 1) k.
    \]
    These two expressions must be equal, absurd. Thus \(A\) is integrally closed in \(K\). \(A\) has a unique non-zero prime ideal as \(A\) is a DVR.
  \item \(2 \implies 1\): Let \(\mathfrak m \subseteq A\) be the unique non-zero prime ideal. Claim that for any proper non-zero ideal \(I \subseteq A\), there exists \(n \geq 1\) such that \(\mathfrak m^n \subseteq I \subseteq \mathfrak m\).

    \begin{proof}
      \(I \subseteq \mathfrak m\) as \(\mathfrak m\) is the unique maximal ideal. Suppose for contradiction exists \(I\) such that \(\mathfrak m^n \nsubseteq I\) for all \(n \geq 1\). Since \(A\) is Noetherian, we can assume that \(I\) is maximal with this property. Note \(I\) is not prime as otherwise \(I = \mathfrak m\). This means that there exist \(a, b \in A\) such that \(a, b \notin I\) but \(ab \in I\). Then the inclusions \(I \subseteq I + (a), I \subseteq I + (b)\) are proper. By maximality of \(I\), there exists \(n_1, n_2 \geq 1\) such that
      \begin{align*}
        \mathfrak m^{n_1} &\subseteq I + (a) \\
        \mathfrak m^{n_2} &\subseteq I + (b)
      \end{align*}
      Then
      \begin{align*}
        \mathfrak m^{n_1 + n_2} &\subseteq (I + (a)) (I + (b)) \\
                                &\subseteq I + (ab) \\
                                &\subseteq I
      \end{align*}
      as \(ab \in I\). Absurd.
    \end{proof}
    Now we can show \(\mathfrak m\) is principal. Choose \(\alpha \in \mathfrak m - \{0\}\). If \(\mathfrak m = (\alpha)\) then done. Otherwise, choose \(n \geq 2\) minimal such that \(\mathfrak m^n \subseteq (\alpha) \subseteq \mathfrak m\). Then \(\mathfrak m^{n - 1} \nsubseteq (\alpha)\) so exists \(\beta \in \mathfrak m^{n - 1} - (\alpha)\) such that
    \[
      \gamma = \frac{\beta}{\alpha} \in \frac{1}{\alpha} \mathfrak m^{n - 1} - A.
    \]
    Then
    \[
      \gamma \mathfrak m = \frac{\beta}{\alpha} \mathfrak m \subseteq \frac{1}{\alpha} \mathfrak m^{n - 1} \mathfrak m \subseteq \frac{1}{\alpha} \mathfrak m^n \subseteq A.
    \]
    If \(\gamma \mathfrak m \subseteq \mathfrak m\) then \(A[\gamma] \embed \End_A(\mathfrak m)\) as \(A\)-modules. \(\End_A(\mathfrak m)\) is a fg \(A\)-module as \(A\) is Noetherian. So \(A\) integrally closed in \(K\) implies that \(\gamma \in A\). So we must have \(\gamma \mathfrak m = A\). Hence \(\mathfrak m = \gamma^{-1} A\). So \(\pi = \gamma^{-1} \in A\) and \(\pi\) generates \(\mathfrak m\).

    Since \(A\) is a local ring, we have
    \begin{align*}
      A &= A^\times \cup \mathfrak m \\
        &= A^\times \cup \pi A \\
        &= \bigcup_{i \geq 0} \pi^i A^\times \cup I
    \end{align*}
    where \(I = \bigcap_{i \geq 0} \pi^i A\). \(I = 0\) as \(I\) is fg (as \(A\) is Noetherian) and \(\pi I = I\), so we can apply Nakayama's lemma. Hence
    \[
      A = \{0\} \cup \bigcup_{i \geq 0} \pi^iA^\times
    \]
    and \(A\) is a DVR.
  \end{itemize}
\end{proof}

\begin{definition}[multiplicative subset]\index{multiplicative subset}
  Let \(A\) be a ring. A \emph{multiplicative subset} of \(A\) is a subset \(S \subseteq A\) satisfying
  \begin{enumerate}
  \item \(1 \in S\),
  \item for all \(x, y \in S\), \(xy \in S\).
  \end{enumerate}
\end{definition}

\begin{definition}[localisation of ring]\index{localisation}
  Let \(S \subseteq A\) be a multiplicative subset. We define \(S^{-1} A\) to be the set of equivalence classes of pairs \((a, s) \in A \times S\) under the relation \((a, x) \sim (a', s')\) if there exists \(t \in S\) such that \(t(s'a - sa') = 0\).

  We write \(\frac{a}{s} \in S^{-1} A\) for the equivalence class of \((a, s)\).
\end{definition}

\begin{lemma}\leavevmode
  \begin{enumerate}
  \item \(S^{-1}A\) is well-defined and admits a ring structure.
  \item There is a ring homomorphism
    \begin{align*}
      A &\to S^{-1} A \\
      a &\mapsto \frac{a}{1}
    \end{align*}
    with kernel \(\{a \in A: \text{ exists } s \in S, sa = 0\}\).
  \item If \(A\) is a domain and \(0 \notin S\) then \(S^{-1}A\) may be identified with the subring \(\{\frac{a}{s}: a \in A, s \in S\}\) of \(\Frac A = (A - \{0\})^{-1} A\).
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item \(\sim\) is an equivalence relation: it is reflexive and symmetric by definition. For transitivity, suppose \((a, s) \sim (a', s') \sim (a'', s'')\), then exist \(t, t' \in S\) such that \(tas' = ta's, t'a's'' = t'a''s'\). Then
    \[
      tt's'as'' = tt's''a's = tt'a''s's
    \]
    i.e.
    \[
      tt's'(as'' - a''s) = 0.
    \]

    To make \(S^{-1}A\) a ring, the zero element is \(\frac{0}{1}\), the multiplicative identity is \(\frac{1}{1}\), and addition and multiplication are defined as
    \begin{align*}
      \frac{a}{s} + \frac{a'}{s'} &= \frac{as' + a's}{ss'} \\
      \frac{a}{s} \cdot \frac{a'}{s'} &= \frac{aa'}{ss'}
    \end{align*}
    Check the ring axioms are satisfied.
  \item \(f: A \to S^{-1}A\) is a ring homomorphism by definition.
    \[
      \ker f = \{a \in A: \frac{a}{1} = \frac{0}{1}\} = \{a \in A: \text{ exists } s \in S \text{ such that } sa = 0\}.
    \]
  \item Now we suppose \(A\) is a domain. Recall that
    \[
      \Frac A = \{(a, s) \in A \times (A - \{0\})\} / \bullet
    \]
    where \((a, s) \bullet (a', s')\) if \(as' = a's\). We need to check that if \(S \subseteq A\) if a multiplicative subset with \(0 \notin S\) then \((a, s) \sim (a', s')\) implies \((a, s) \bullet (a', s')\).
  \end{enumerate}
\end{proof}

\begin{definition}[localisation of module]\index{localisation}
  Let \(S \subseteq A\) to be a multiplicative subset and let \(M\) be an \(A\)-module. Then we define \(S^{-1}M\) to be the set of equivalence classes in \(M \times S\) for the relation \((m, s) \sim (m', s')\) if there exists \(t \in S\) such that \(t(ms - m's) = 0\).

  We write \(\frac{m}{s}\) for the equivalence class of \((m, s)\).
\end{definition}

\begin{ex}\leavevmode
  \begin{enumerate}
  \item \(S^{-1}M\) is an \(S^{-1}A\)-module via
    \begin{align*}
      \frac{a}{s} \cdot \frac{m}{s'} &= \frac{am}{ss'} \\
      \frac{a}{s} + \frac{a'}{s'} &= \frac{as' + a's}{ss'}
    \end{align*}
  \item If \(f: M \to N\) is an \(A\)-module homomorphism then there is a homomorphism
    \begin{align*}
      S^{-1}f: S^{-1}M &\to S^{-1}N \\
      \frac{m}{s} &\mapsto \frac{f(m)}{s}
    \end{align*}
  \item \(S^{-1}\) is a functor from the category of \(A\)-modules to the category of \(S^{-1}A\)-modules.
  \end{enumerate}
\end{ex}

\begin{lemma}
  Let
  \[
    \begin{tikzcd}
      M' \ar[r, "f"] & M \ar[r, "f'"] & M''
    \end{tikzcd}
  \]
  be an exact sequence of \(A\)-modules. Then
  \[
    \begin{tikzcd}
      S^{-1}M' \ar[r, "S^{-1}f"] & S^{-1}M \ar[r, "S^{-1}f'"] & S^{-1}M''
    \end{tikzcd}
  \]
  is also exact.
\end{lemma}

\begin{proof}
  \(f' \compose f = 0\) so \(S^{-1}f' \compose S^{-1} f = 0\). For the other inclusion, let \(\frac{m}{s} \in \ker S^{-1} f'\), i.e.\ \(\frac{f'(m)}{s} = 0\), i.e.\ there exists \(s' \in S\) such that \(0 = s'f'(m) = f'(s'm)\) so \(s'm \in \ker f' = \im f\). Hence there exists \(m' \in M'\) such that \(f(m') = s'm\). Then
  \[
    S^{-1}f (\frac{m'}{ss'}) = \frac{f(m')}{ss'} = \frac{s'm}{ss'} = \frac{m}{s}.
  \]
\end{proof}

\begin{corollary}
  If \(f\) is surjective (injective, resp) then so is \(S^{-1} f\).
\end{corollary}

Let \(I \subseteq A\) be an ideal. Then \(I \embed A\) is an injective homomorphism of \(A\)-modules. Hence \(S^{-1}I \embed S^{-1}A\) is an injective homomorphism of \(S^{-1}A\)-module. Hence \(S^{-1}I\) may be identified with an ideal of \(S^{-1}A\). It's the ideal
\[
  S^{-1}A \cdot I = \{\frac{x}{s}: x \in I, s \in S\} \subseteq S^{-1}A.
\]

\begin{proposition}
  Let \(S \subseteq A\) be a multiplicative subset. Then there is a bijection between the following two sets:
  \begin{enumerate}
  \item prime ideals \(P \subseteq A\) such that \(P \cap S = \emptyset\),
  \item prime ideal \(Q \subseteq S^{-1}A\),
  \end{enumerate}
  given by \(P \mapsto S^{-1}P, Q \mapsto f^{-1}(Q)\) where \(f: A \to S^{-1}A\) is the localisation map.
\end{proposition}

\begin{proof}
  Check the maps are well-defined: if \(1 \in S^{-1}P\) then \(\frac{1}{s} = \frac{x}{s}\) for some \(x \in P, s \in S\) so exists \(t \in S\) such that \(t(s - x) = 0\). Then \(ts = tx \in P\) so \(t \in P\) or \(s \in P\).

  If \(\frac{a}{s}, \frac{a'}{s'} \in S^{-1}A\) and \(\frac{aa'}{ss'} \in S^{-1}P\) then \(\frac{aa'}{ss'} = \frac{x}{t}\). Hence exists \(t' \in S\) such that
  \[
    tt' aa' = t'ss'x \in P.
  \]
  Since \(P\) is prime, \(aa' = P\) so \(a \in P\) or \(a' \in P\). Hence \(\frac{a}{s}\) or \(\frac{a'}{s'} \in S^{-1}P\). Thus \(S^{-1}P\) is prime.

  If \(Q \subseteq S^{-1}A\) then \(S^{-1}A/Q\) is a non-zero domain. Then \(A/f^{-1}(Q) \embed S^{-1}A/Q\) so \(A/f^{-1}(Q)\) is also a non-zero domain so \(f^{-1}(Q)\) is a prime ideal (this in fact follows from the fact that pullback of any prime ideal is prime).

  It is left as an exercise to check the maps in the statement of the proposition are mutually inverse bijections.
\end{proof}

\begin{corollary}
  Let \(A\) be a ring and \(P \subseteq A\) a prime ideal. Then
  \begin{enumerate}
  \item \(S = A - P\) is a multiplicative subset of \(A\).
  \item \(S^{-1}A\) is a local ring with unique maximal ideal \(S^{-1} P\).
  \end{enumerate}
  We usually write \(A_P\) for \((A - P)^{-1}A\).
\end{corollary}

For example \(\Z_{(p)} = (\Z - p\Z)^{-1}\Z\).

\begin{proposition}
  Let \(A\) be a Noetherian domain. Then TFAE:
  \begin{enumerate}
  \item For every non-zero prime ideal \(P \subseteq A\), \(A_P\) is a DVR.
  \item \(A\) is integrally closed in \(K = \Frac A\) and every non-zero prime ideal is maximal.
  \end{enumerate}
\end{proposition}

Consequently, for any \(P\) there is the valuation \(v_P: K^\times \to \Z\) associated to \(A_P\).

\begin{definition}[Dedekind domain]\index{Dedekind domain}
  Any ring satisfying the conditions is called a \emph{Dedekind domain}.
\end{definition}

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(1 \implies 2\): wlog we can assume \(A\) does have non-zero prime ideals. Suppose given a relation
    \[
      a^n + a_1 a^{n - 1} + \dots + a_n = 0
    \]
    where \(a \in A, a_i \in A\). Then \(A_P\) is a DVR implies that \(A_P\) is integrally closed in \(K\) so \(a \in A_P\) for all \(P\). Therefore for all \(P\) we can find \(x_P \in A, s_P \in A - P\) such that \(a = \frac{x_P}{s_P}\) in \(K\). In particular \(s_Pa \in A\).

    The ideal
    \[
      I = (s_P: P \subseteq A \text{ non-zero prime ideal})
    \]
    is the unit ideal, since it is not contained in any maximal ideal of \(A\). Therefore there exists element \(t_P \in A\), with only finitely many non-zero, such that
    \[
      1 = \sum_P t_P s_P.
    \]
    Then
    \[
      a = \sum_P t_P s_Pa \in A.
    \]

    Let \(P \subseteq Q\) be non-zero prime ideals of \(A\), with \(Q\) maximal. Then \(PA_Q \subseteq QA_Q\) are non-zero prime ideals of \(A_Q\), a DVR. Hence \(PA_Q = QA_Q\) and \(P = Q\).
  \item \(2 \implies 1\): Again we can assume that \(A\) has a non-zero prime ideal \(P\). We must show \(A_P\) is a DVR, or equivalently that \(A_P\) is integrally closed in \(K\) and has a unique non-zero prime ideal.

    Suppose given a relation
    \[
      \left( \frac{a}{s} \right)^n + \frac{a_1}{s_1} \left( \frac{a}{s} \right)^{n - 1} + \dots + \frac{a_n}{s_n} = 0
    \]
    where \(a, a_1, \dots, a_n \in A, s_1, \dots, s_n \in A - P, s \in A - \{0\}\). Multiply through by \((s_1 \cdots s_n)^n\),
    \[
      \left( \frac{as_1 \cdots s_n}{s} \right)^n + \left( \frac{as_1 \cdots s_n}{s} \right)^{n - 1} a_1 s_2 \cdots s_n + \dots + s_1s_2 \cdots a_n = 0.
    \]
    As \(A\) is integrally closed, \(\frac{as_1 \cdots s_n}{s} \in A\) so
    \[
      \frac{a}{s} = \frac{as_1 \cdots s_n}{s} \cdot \frac{1}{s_1 \cdots s_n} \in A_P
    \]
    so \(A_P\) is integrally closed.

    Let \(Q \subseteq A_P\) be a non-zero prime ideal. Then eixsts \(Q' \subseteq P\) such that \(Q'A_P = Q\). By assumption we must have \(Q' = P\) and hence \(Q = PA_P\).
  \end{itemize}
\end{proof}

\begin{definition}[fractional ideal]\index{fractional ideal}
  Let \(A\) be a domain, \(K = \Frac A\). A \emph{fractional ideal} of \(A\) is a fg \(A\)-submodule of \(K\).
\end{definition}

If \(I, J \subseteq K\) are fractional ideals then
\begin{align*}
  I + J &= \{x + y: x \in I, y \in J\} \\
  IJ &= \{xy: x \in I, y \in J\} \\
\end{align*}
are also fractional ideals. On the other hand,
\[
  (I: J) = \{x \in K: xJ \subseteq I\}
\]
is an \(A\)-submodule of \(K\) but is in general not fg.

\begin{lemma}
  Let \(A\) be a Noetherian domain, \(S \subseteq A\) a multiplicative subset. Then
  \begin{enumerate}
  \item if \(I, J\) are fractional ideals then \(S^{-1}I\) is a fractional ideal of \(S^{-1}A\) and
    \begin{align*}
      S^{-1}(I + J) &= S^{-1}I + S^{-1}J \\
      S^{-1}(IJ) &= S^{-1}I \cdot S^{-1}J
    \end{align*}
  \item if \(I, J\) are fractional ideals of \(A\) and \(J\) is non-zero then \((I : J)\) is a fractional ideal of \(A\) and
    \[
      S^{-1}(I : J) = (S^{-1}I : S^{-1}J).
    \]
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item Exercise.
  \item If \(a \in A - \{0\}\) then
    \[
      (I : (a)) = \{x \in K: x(a) \subseteq I\} = \{x \in K: xa \in I\} = a^{-1}I.
    \]
    In partuclar \((I : (a))\) is fg and hence a fractional ideal.

    In general, write \(J = (a_1, \dots, a_n)\) where \(a_i \in K^\times\). Then
    \[
      (I : J) = \{x \in K: \text{for all } i, xa_i \in I\} = \bigcap_{i = 1}^n a_i^{-1}I.
    \]
    In paricular \((I : (a)) \subseteq (I : (a_1))\). Since \(A\) is Noetherian, any submodule of \((I : (a_1))\) is fg and hence \((I : J)\) is a fractional ideal.

    To show \(S^{-1}(I : J) = (S^{-1}I : S^{-1}J)\), we have
    \begin{align*}
      \text{LHS} &= S^{-1} \bigcap_{i = 1}^n a_i^{-1} I \\
      \text{RHS} &= \bigcap_{i = 1}^n a_i^{-1} S^{-1} I = \bigcap_{i = 1}^n S^{-1} (a_i^{-1} I)
    \end{align*}
    so in fact it's enough to show that if \(I, J \subseteq K\) are fractional ideals of \(A\) then
    \[
      S^{-1}(I \cap J) = (S^{-1}I) \cap (S^{-1}J).
    \]
    We certainly have \(S^{-1}(I \cap J) \subseteq (S^{-1}I) \cap (S^{-1}J)\). Suppose \(\frac{x}{s} = \frac{y}{t}\) where \(x \in I, y \in J, s, t \in S\) then \(xt = sy \in I \cap J\) and
    \[
      \frac{x}{s} = \frac{xt}{st} \in S^{-1}(I \cap J).
    \]
  \end{enumerate}
\end{proof}

\begin{proposition}
  Let \(A\) be a Dedekind domain and let \(\Div A\) be the set of non-zero fractional ideals of \(A\). Then \(\Div A\) forms a group under the multiplication of fractional ideals.
\end{proposition}

\begin{proof}
  \(A = (1)\) is a multiplicative identity. Must show that for any non-zero fractional ideal \(I\),
  \[
    I (A : I) = A.
  \]
  Observe that if \(P \subseteq A\) is a non-zero prime ideal then \(IA_P = (\pi_P^i)\) as \(A_P\) is a DVR, so \((A_P: IA_P) = (\pi_P^{-i})\) so
  \[
    \text{LHS}_P = IA_P (A_P: IA_P) = A_P = \text{RHS}_P
  \]
  so it is enough to show that if \(I, J\) are fractional ideals of \(A\) such that \(IA_P = JA_P\) for all \(P\) then \(I = J\). In fact, we are going to show if \(IA_P \subseteq JA_P\) then \(I \subseteq J\). Suppose \(IA_P \subseteq JA_P\) for any non-zero prime ideal \(P \subseteq A\). Let \(x \in I\). Then \(x \in IA_P \subseteq JA_P\) so we can write \(x = \frac{y_P}{s_P}\) where \(y_P \in J, s_P \in A - P\). Now we use
  \[
    (s_P: P \subseteq A \text{ non-zero prime ideal}) = (1)
  \]
  to write \(1 = \sum_P s_P t_P\) where \(t_P \in A\) and only finitely many are non-zero. Then
  \[
    x = \sum_P t_Ps_P x \in J.
  \]
\end{proof}

Observe that for any \(P\), there is a homomorphism
\begin{align*}
  \Div A &\to \Div A_P \\
  I &\mapsto IA_P
\end{align*}
But \(\Div A_P \cong \Z\) canonically as every non-zero fractional ideal of \(A_P\) has the form \((\pi^i)\) for some \(i \in \Z\).

We can define a homomorphism \(v_P: \Div A \to \Z\) by \(v_P(I) = v_P(x)\) where \(IA_P = (x)\). In particular, for any \(x \in K^\times\), \(v_P((x)) = v_P(x)\). Note that \(v_P\) is surjective since \(P A_P = (\pi)\) as \(v_P(P) = 1\) for any \(P\). Taking the product over all non-zero prime ideals, we get a homomorphism
\[
  \prod_P v_P: \Div A \to \prod_P \Z.
\]
This is injective as we showed that for any \(I, J \in \Div A\), \(I = J\) if and only if for all \(P\), \(I A_P = J A_P\). Now we characterise the image.

\begin{lemma}
  For any \(I \in \Div A\), the set \(\{P: v_P(I) \neq 0\}\) is finite. 
\end{lemma}

In other words, \(\prod_P v_P\) takes values in \(\bigoplus_P \Z \subseteq \prod_P \Z\).

\begin{proof}
  Suppose \(I = (\frac{a_1}{b_1}, \dots, \frac{a_n}{b_n})\) where \(a_i \in A, b_i \in A - \{0\}\). Let \(b = b_1 \cdots b_n\). Then \(J = bI\) is an ideal of \(A\) and
  \[
    v_P(I) = v_P(J) - v_P((b)).
  \]
  So it's enough to prove the lemma in the case \(I \subseteq A\) is an ideal.

  Let \(\alpha \in I - \{0\}\). Then \((\alpha) \subseteq I\) and for any non-zero prime ideal \(P \subseteq A\), \(v_P(\alpha) \geq v_P(I) \geq 0\) so in fact we can assume \(I = (\alpha)\) is principal.

  Now we observe that \(v_P(\alpha) > 0\) if and only if \(\alpha \in P A_P\) if and only if \(\alpha \in P\). So it's enough to show that there are only finitely many \(P\)'s such that \(\alpha \in P\).

  Suppose for contradiction there are infinitely many \(P_1, P_2, \dots\) such that \(\alpha \in P_i\). Define \(J_i = P_1 \cap \cdots \cap P_i\). Then
  \[
    J_1 \supseteq J_2 \supseteq \cdots \supseteq (\alpha)
  \]
  so
  \[
    \alpha J_1^{-1} \subseteq \alpha J_2^{-1} \subseteq \cdots \subseteq A.
  \]
  This is an ascending chain of ideals of \(A\) so there exists \(n \geq 1\) such that \(\alpha J_n^{-1} = \alpha J_{n + 1}^{-1}\). Hence \(J_n = J_{n + 1}\), i.e.
  \[
    P_1 \cap \cdots \cap P_n = P_1 \cap \cdots \cap P_n \cap P_{n + 1}.
  \]
  Choose \(x_i \in P_i - P_{n + 1}\) for \(i \leq n\). Then
  \[
    x_1 \cdots x_n \in P_1 \cap \cdots \cap P_n = P_1 \cap \cdots \cap P_n \cap P_{n + 1}.
  \]
  Since \(P_{n + 1}\) is prime, we have \(x_i \in P_{n + 1}\) for some \(i \leq n\). Absurd.
\end{proof}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item \(\prod_P v_P: \Div A \to \bigoplus_P \Z\) is an isomorphism.
  \item For any \(I \in \Div A\),
    \[
      I = \prod_I P^{v_P(I)}
    \]
    so we have unique factorisation of fractional ideals.
  \end{enumerate}
\end{proposition}

\begin{proof}\leavevmode
  \begin{enumerate}
  \item It's enough to show
    \[
      v_Q(P) =
      \begin{cases}
        1 & P = Q \\
        0 & \text{otherwise}
      \end{cases}
    \]
    as then \((\delta_{PQ})_Q\) are in the ring and they generate \(\bigoplus_P \Z\). \(v_P(P) = 1\) by definition as \(P A_P\) is the maximal ideal of \(A_P\). If \(Q \neq P\) then we must show \(P A_Q = A_Q\): if \(P A_Q \neq A_Q\) then \(P A_Q \subseteq Q A_Q\) so \(P \subseteq Q\). This is impossible as both \(P\) and \(Q\) are maximal ideals.
  \item \(I = \prod_P P^{v_P(I)}\) if and only if for all \(Q\),
    \[
      v_Q(I) = v_Q(\prod_P P^{v_P(I)}).
    \]
    As \(v_Q(P) = \delta_{PQ}\), RHS equals to \(v_Q(I)\).
  \end{enumerate}
\end{proof}

\section{Complete DVRs}

\begin{definition}[inverse system, inverse limit]\index{inverse limit}
  Suppose given groups \(A_i\) and homomorphisms \(f_i: A_{i + 1} \to A_i\) for all \(i \geq 1\)
  \[
    \begin{tikzcd}
      A_1 & A_2 \ar[l, "f_1"'] & A_3 \ar[l, "f_2"'] & \cdots \ar[l, "f_3"']
    \end{tikzcd}
  \]
  we call such a collection an \emph{inverse system}. Its \emph{inverse limit} is
  \[
    \varprojlim_i A_i = \{(a_i) \in \prod_{i = 1}^\infty A_i: f_i(a_{i + 1}) = a_i \text{ for all } i \geq 1\} \subseteq \prod_{i = 1}^\infty A_i.
  \]
\end{definition}

This is a group. If the \(A_i\)'s (\(f_i\)'s respectively) are abelian groups/rings (homomorphisms/ring homomorphisms) then so is \(\varprojlim_i A_i\).

Suppose \(A\) is a DVR with uniformiser \(\pi\). Then we can make an inverse system
\[
  \begin{tikzcd}
    A/(\pi^1) & A/(\pi^2) \ar[l] & A/(\pi^3) \ar[l] & \cdots \ar[l]
  \end{tikzcd}
\]
with maps the natural quotient maps. There's a homomorphism \(A \to A/(\pi^i)\), hence \(A \to \prod_{i = 1}^\infty A/(\pi^i)\) which takes values in \(\varprojlim_i A/(\pi^i)\).

\begin{definition}[complete]\index{complete DVR}
  We say \(A\) is \emph{complete} if the homomorphism
  \[
    A \to \varprojlim_i A/(\pi^i)
  \]
  is an isomorphism.
\end{definition}

The kernel of this homomorphism is \(\bigcap_{i \geq 1} (\pi^i) = 0\) so \(A\) is complete if and only if the map is surjective.

\begin{lemma}
  TFAE:
  \begin{enumerate}
  \item \(A\) is complete.
  \item \(A\) is complete as a metric space with respect to the metric
    \[
      d(x, y) =
      \begin{cases}
        0 & x = y \\
        2^{-v(x - y)} & x \neq y
      \end{cases}
    \]
  \item \(K\) is complete as a metric space with respect to the metric given by the formula.
  \end{enumerate}
\end{lemma}

\begin{proof}
  We first explain why \(d\) is a metric. \(d\) satisfies the ultrametric triangle inequality
  \[
    d(x, y) \leq \max(d(x, y), d(y, z))
  \]
  for all \(x, y, z\). This is because we can assume \(x, y, z\). Then this is equivalent to
  \[
    v(x - z) \geq \min(v(x - y), v(y - z))
  \]
  but LHS is equal to \(v((x - y) + (y - z))\). This is the axiom defining a valuation.
  \begin{itemize}
  \item \(1 \implies 2\): Let \((a_n)_{n \geq 1}\) be a Cauchy sequence in \(A\), meaning that for all \(\varepsilon > 0\), exists \(N\) such that for all \(n, m \geq N\), \(d(a_n, a_m) < \varepsilon\). Equivalently, for all \(M > 0\), exists \(N(M)\) such that for all \(n, m \geq N(M)\),
    \[
      a_n = a_m \pmod{\pi^M}.
    \]
    We can define \(b = (b_i)_{i \geq 1} \in \prod_{i = 1}^\infty A/(\pi^i)\) by
    \[
      b_n = a_{N(n)} \pmod {\pi^n}
    \]
    By definition of Cauchy sequence, \(b \in \varprojlim_i A/(\pi^i)\). Since \(A\) is a complete DVR, exists \(a \in A\) such that \(a = a_{N(n)} \pmod{\pi^n}\) for all \(n \geq 1\). Hence \(v(a - a_{N(n)}) \geq n\), i.e.\ \(d(a, a_{N(n)}) \leq 2^{-n}\) so \(\lim_{n \to \infty} a_n = a\).
  \item \(2 \implies 1\): Suppose given \((a_n)_{n \geq 1} \in \varprojlim_n A/(\pi^n)\). Let \(\tilde a_n \in A\) be any element such that \(\tilde a_n \pmod{\pi^n} = a_n\). Then for all \(m \geq n\), \(\tilde a_m = \tilde a_n \pmod{\pi^n}\) by definition of inverse limit, i.e.\ \(d(\tilde a_m, \tilde a_n) \leq 2^{-n}\), so \((\tilde a_n)_{n \geq 1}\) is a Cauchy sequence in \(A\). So there exists \(a \in A\) such that \(\tilde a_n \to a\) in \(A\), i.e.\ for all \(M \geq 1\) exists \(N(M)\) such that for all \(n \geq N(M)\), \(\tilde a_n = a \pmod{\pi^M}\). Hence \(a\) is a preimage of \((a_n)_{n \geq 1}\) under the map \(A \to \varprojlim_i A/(\pi^i)\).
  \item \(3 \implies 2\): We must show \(A\) is a closed subspace of \(K\). Claim that
    \[
      A = \{x \in K: d(0, x) \leq 1\},
    \]
    as \(d(0, x) \leq 1\) if and only if \(x = 0\) and \(v(x) \geq 0\).
  \item \(2 \implies 3\): For any \(x, y \in K\),
    \[
      d(\pi x, \pi y) = \frac{1}{2} d(x, y).
    \]
    Let \((a_n)_{n \geq 1}\) be a Cauchy sequence in \(K\). Then there exists \(N \geq 1\) such that \(\pi^N a_n \in A\) for all \(n \geq 1\): there exists \(M\) such that for all \(n, m \geq M\), \(d(a_n, a_m) \leq 1\). Equvalently, \(a_n - a_m \in A\) so it's enough to choose \(N\) so that \(\pi^N a_n \in A\) for \(1 \leq n \leq M\). \((\pi^N a_n)_{n \geq 1}\) is a Cauchy sequence in \(A\) so exists \(a \in A\) such that \(d(\pi^N a_n, a) \to 0\) as \(n \to \infty\). Thus \(a_n \to \pi^{-N} a\) in \(K\).
  \end{itemize}
\end{proof}

\begin{ex}
  Show that \(A\) is also open in \(K\). Show futhermore that \(K\) is totally disconnected.
\end{ex}

\begin{remark}
  When we speak of topology on \(K\) or convergence in \(K\) we always mean with respect to the metric \(d\).
\end{remark}

\begin{proposition}
  Let \(A\) be a DVR, \(\pi \in A\) a uniformiser. Then
  \begin{enumerate}
  \item \(A \to \hat A = \varprojlim_i A/(\pi^i)\) is injective, \(\hat A\) is a complete \(DVR\) and \(\pi\) is a uniformiser of \(\hat A\).
  \item For all \(i \geq 1\), the map \(A/\pi^iA \to \hat A/\pi^i \hat A\) is an isomorphism.
  \item Let \(X \subseteq A\) be a subset of representatives for the residue classes of \(A/(\pi)\), with \(0 \in X\). Then for all \(a \in \hat A\), there exists a unique expression
    \[
      a = \sum_{i = 0}^\infty a_i \pi^i
    \]
    with \(a_i \in X\) for all \(i \geq 0\). This is the \emph{\(\pi\)-adic expansion}\index{\(\pi\)-adic expansion} of \(a\).
  \end{enumerate}
\end{proposition}

\begin{proof}
  We first observe that for all \(a \in A/(\pi^i)\), there exist unique \(a_0, \dots, a_{i - 1} \in X\) such that
  \[
    a = a_0 + a_1 \pi + \dots + a_{i - 1} \pi^{i - 1} \pmod{\pi^i}.
  \]
  Induction on \(i\): for \(i = 1\) this is the definition of \(X\). To show this for \(i + 1\), let \(a \in A/(\pi^{i + 1})\). Then \(a \pmod{\pi^i} \in A/(\pi^i)\) so by induction there exist unqiue \(a_0, \dots, a_{i - 1}\) such that
  \[
    a - (a_0 + a_1 \pi + \dots + a_{i - 1} \pi^{i - 1}) \in \pi^i A/ \pi^{i + 1}A.
  \]
  The map
  \begin{align*}
    X &\to A/(\pi) \to \pi^iA/\pi^{i + 1}A \\
    x &\mapsto x \pmod \pi \\
    &\phantom{\to} y \pmod \pi \mapsto \pi^i y \pmod{\pi^{i + 1}}
  \end{align*}
  is bijective. Hence there eixsts unique \(a_i \in X\) such that
  \[
    a - (a_0 + \dots + a_i \pi^i) = 0 \pmod{\pi^{i + 1}}.
  \]

  Note that we have a commmutative diagram
  \[
    \begin{tikzcd}
      A/(\pi^{i + 1}) \ar[r, "="] \ar[d] & \{a_0 + a_1 \pi + \dots + a_i \pi^i: a_j \in X\} \ar[d] \\
      A/(\pi^i) \ar[r, "="] & \{a_0 + a_1 \pi + \dots + a_{i - 1} \pi^{i - 1}: a_j \in X\}
    \end{tikzcd}
  \]
  where the map on the right is to forget the last digit. Thus there is a bijection between \(\hat A\) and the set of formal sums \(\sum_{i = 0}^\infty a_i \pi^i\) where \(a_i \in X\) for all \(i \geq 0\).

  How do we interpret \(a_0 + a_1 \pi + \cdots\) as an element of \(\hat A\)? We can't yet think of it as an infinite sum since we haven't yet shown \(\hat A\) is a DVR. For any \(i\), we set
  \[
    x_ i = a_0 + a_1\pi + \dots + a_{i - 1}\pi^{i - 1} \pmod{\pi^i} \in A/(\pi^i),
  \]
  then \(x = (x_i)_{i \geq 1} \in \varprojlim_i A/(\pi^i) = \hat A\).

  Let's now show \(\hat A\) is a DVR. We know \(A \to \hat A\) is injective. We'll show each nonzero element \(x \in \hat A\) has a unique expression \(x = \pi^n u\) where \(n \geq 0, u \in \hat A^\times\). Let's write \(x = a_0 + a_1 \pi + \cdots\) and say
  \[
    a_0 = a_1 = \dots = a_{n - 1} = 0, a_n \neq 0.
  \]
  Then \(x = \pi^n y\) where \(y = a_n + a_{n + 1} \pi + \cdots\). We must show \(y \in \hat A^\times\). Note \(0 \in X \subseteq A\). If \(\alpha \in X - \{0\}\) then \(\alpha \pmod \pi\) is nonzero and hence \(\alpha \in A^\times\). So \(y = a_n(1 - \pi b)\) where
  \[
    b = 1 - \pi a_n^{-1} a_{n + 1} - \pi^2 a_n^{-1} a_{n + 2} + \cdots \in \hat A.
  \]
  It's enough to show \(1 - \pi b \in \hat A^\times\). An inverse is given by
  \[
    1 + \pi b + \pi^2 b^2 + \cdots \in \hat A.
  \]
  This shows \(\hat A\) is a DVR with uniformiser \(\pi\).

  The map \(A/\pi^i A \to \hat A/ \pi^i \hat A\) is bijective as elements of both sides can be uniquely represented by elements of the form
  \[
    a_0 + a_1 \pi + \dots + a_{i - 1}\pi^{i - 1} \pmod{\pi^i}
  \]
  where \(a_i \in X\). It follows that \(\hat A\) is complete, as the map
  \[
    \hat A \to \varprojlim_i \hat A/\pi^i \hat A \cong \varprojlim_i A/\pi^i A
  \]
  is an isomorphism by the definition of \(\hat A\).
\end{proof}

\begin{remark}
  If \(A\) is complete then \(\hat A \cong A\).
\end{remark}

Observe that if \(K = \Frac A, \hat K = \Frac \hat A\) then the valuation \(v: K^\times \to \Z\) extends to a valuation \(v: \hat K^\times \to \Z\) such that \(\hat A = \{x \in \hat K: v(x) \geq 0\}\).
\[
  \begin{tikzcd}
    A \ar[r, hook] \ar[d, hook] & K \ar[d, hook] \\
    \hat A \ar[r, hook] & \hat K
  \end{tikzcd}
\]

An element of \(\hat A\) admits a unique \(\pi\)-adic expansion \(\sum_{i = 0}^\infty a_i \pi^i\) where \(a_i\) lie in a fixed set representatives in \(A\) for \(A/(\pi)\), and the series \(\sum_{i = 0}^\infty a_i \pi^i\) is a convergent infinite sum in \(\hat A\).

\begin{definition}[\(p\)-adic integer]\index{\(p\)-adic integer}
  Let \(p\) be a prime. Then we define the \emph{\(p\)-adic integers} and \emph{\(p\)-adic rational numbers} to be
  \begin{align*}
    \Z_p &= \hat \Z_{(p)} \\
    \Q_p &= \Frac \Z_p
  \end{align*}
  respectively.
\end{definition}

\(p \in \Z_p\) is a uniformiser and \(\Z_p/(p) \cong \Z_{(p)}/(p)\). To compute the residue field of \(\Z_{(p)}\), we use the exact sequence
\[
  \begin{tikzcd}
    0 \ar[r] & p\Z \ar[r] & \Z \ar[r] & \Z/p\Z \ar[r] & 0
  \end{tikzcd}
\]
of \(\Z\)-modules. It remains exact after localisation so
\[
  \begin{tikzcd}
    0 \ar[r] & p\Z_{(p)} \ar[r] & \Z_{(p)} \ar[r] & (\Z - (p))^{-1} (\Z/p\Z) \ar[r] & 0
  \end{tikzcd}
\]
is still exact so
\[
  \Z_{(p)}/p\Z_{(p)} \cong (\Z - (p))^{-1}\Z/p\Z.
\]
In fact \(\Z/p\Z \to (\Z - (p))^{-1} \Z/p\Z\) is an isomorphism as every element of \(\Z - (p)\) has image in \(\Z/p\Z\) contained in \((\Z/p\Z)^\times\).

As a consequence, we have \(\Z_p/(p) \cong \Z/p\Z\) so we can choose the set of representatives to be \(\{0, 1, \dots, p- 1\}\). It follows that each element of \(\Z_p\) has a unique expression as \(\sum_{i = 0}^\infty a_i p^i\) and each element of \(\Q_p\) has a unique expression \(\sum_{i \in \Z} a_i p^i\) where \(a_i \in \{0, \dots, p_1\}\) and the set \(\{i < 0: a_i \neq 0\}\) is finite.

\begin{eg}
  \(-1 \in \Z \subseteq \Z_2\) has
  \[
    -1 = \frac{1}{1 - 2} = 1 + 2 + 2^2 + \cdots
  \]
\end{eg}

What is \(\Q_p\) like? It is a mixture of \(\R\) and \(\F_p\) and has features of both analytic (\(\R\)) and algebraic (number fields) objects.

\begin{lemma}[Hensel's lemma]\index[Hensel's lemma]
  \label{lem:Hensel lemma}
  Let \(A\) be a complete DVR. Let \(f(x) \in A[x]\) be monic. Suppose given \(\alpha \in A\) such that \(v(f(\alpha)) > 2v(f'(\alpha))\). Then exists a unique \(a \in A\) such that \(f(a) = 0\) and \(v(a - \alpha) > v(f'(\alpha))\).
\end{lemma}

\begin{corollary}
  Let \(A\) be a complete DVR and \(f(x) \in A[x]\) a monic polnomial. Let \(k = A/(\pi)\) and \(\overline f(x) = f(x) \pmod \pi \in k[x]\). Suppose there exists \(\overline \alpha \in K\), a simple root of \(\overline f(x)\), then exists a unique \(a \in A\) such that \(f(a) = 0\) and \(a = \overline \alpha \pmod \pi\).
\end{corollary}

\begin{proof}
  Let \(\alpha \in A\) be a lift of \(\overline \alpha\). Then \(\overline f'(\overline \alpha) \neq 0\) implies that \(f'(\alpha) \in A^\times\) so \(v(f'(\alpha)) = 0\). Then apply the lemma.
\end{proof}

\begin{proof}[Proof of \nameref{lem:Hensel lemma}]
  We first show existence of \(a\) by Newton's method. Define
  \[
    a_1 = \alpha, \quad a_{n + 1} = a_n - \frac{f(a_n)}{f'(a_n)}.
  \]
  We show the following claims by induction on \(n \geq 1\):
  \begin{enumerate}
  \item \(a_n \in A\), or equivalently \(v(a_n) \geq 0\).
  \item \(v(f'(a_n)) = v(f'(a_1))\).
  \item \(v(f(a_n)) \geq 2v(f'(a_n)) + 2^{n - 1} v(f(a_1)/f'(a_1)^2)\).
  \end{enumerate}
  For \(n = 1\),
  \begin{enumerate}
  \item \(a_n = \alpha \in A\) by hypothesis.
  \item Tautological.
  \item \(v(f(a_1)) \geq 2v(f'(a_1)) + v(f(a_1)/f'(a_1)^2) = v(f(a_1))\).
  \end{enumerate}
  Suppose the three statements hold for \(1, 2, \dots, n\). We will show they hold for \(n + 1\).
  \begin{enumerate}
  \item By definition \(a_{n + 1} = a_n - f(a_n)/f'(a_n)\) so \(a_{n + 1} \in A\) if and only if \(v(f(a_n)/f'(a_n)) \geq 0\). But 3 says
    \[
      v(f(a_n)/f'(a_n)) \geq v(f'(a_n)) + 2^{n - 1} v(f(a_1)/f'(a_1)^2) \geq 0.
    \]
  \item Enough to show \(v(f'(a_{n + 1})) = v(f'(a_n))\). Easy to see that \(f'(a_{n + 1}) - f'(a_n)\) is divisible by \(-a_{n + 1} + a_n = f(a_n)/f'(a_n)\) so we'll have \(v(f'(a_{n + 1})) = v(f'(a_n))\) if
    \[
      v(f(a_n)/f'(a_n)) > v(f'(a_n)),
    \]
    i.e.\ \(v(f(a_n)/f'(a_n)^2) > 0\). But
    \[
      v(f(a_n)/f'(a_n)^2) \geq 2^{n - 1} v(f(a_1)/f'(a_1)^2) > 0.
    \]
  \item Suppose \(f(x) = \sum_{i = 0}^m a_i x^i\) where \(a_i \in A\). Then we use Taylor expansion with a small tweak
    \begin{align*}
      f(X + Y)
      &= \sum_{i = 0}^m a_i (X + Y)^i \\
      &= \sum_{i = 0}^m a_i (X^i + iX^{i - 1}Y + Y^2 g_i(X, Y)) \quad g_i(X, Y) \in \Z[X, Y] \\
      &= f(X) + f'(X) Y + Y^2 g(X, Y) \quad g(X, Y) \in A[X, Y]
    \end{align*}
    hence
    \begin{align*}
      f(a_{n + 1})
      &= f(a_n - f(a_n)/f'(a_n)) \\
      &= f(a_n) - f'(a_n)f(a_n)/ f'(a_n) \\
      &+ (f(a_n)/f'(a_n))^2 \underbrace{g(a_n, f(a_n)/f'(a_n))}_{\in A}
    \end{align*}
    so
    \begin{align*}
      v(f(a_{n + 1}))
      &\geq 2v(f(a_n)) - 2v(f'(a_n)) \\
      &\geq 2(2v(f'(a_n)) + 2^{n - 1} v(f(a_1)/f'(a_1)^2)) - 2v(f'(a_n)) \\
      &= 2v(f'(a_n)) + 2^n v(f(a_1)/f'(a_1)^2)
    \end{align*}
  \end{enumerate}
  We've also shown \((a_n)_{n \geq 1}\) is a Cauchy sequence as
  \[
    v(a_{n + 1} - a_n) = v(f(a_n)/f'(a_n)) \to \infty
  \]
  as \(n \to \infty\) so there is a limit \(a \in A\). We have \(f(a) = \lim_{n \to \infty} f(a_n) = 0\) so \(a\) is a root.

  For uniqueness, we need to show if \(a + h \in A\) is another root such that \(v(a + h - \alpha) > v(f'(\alpha))\) then \(h = 0\). Since \(v(a - \alpha) > v(f'(\alpha))\), we must have \(v(h) > v(f'(\alpha))\). Using Taylor expansion, we find
  \[
    0 = f(a + h) = f(a) + hf'(a) + h^2 g(a, h)
  \]
  and hence \(hf'(\alpha) = -h^2 g(a, h)\). If \(h \neq 0\) then \(f'(\alpha) = -h g(a, h)\). Hence
  \[
    v(f'(\alpha)) \geq v(h) > v(f'(\alpha)),
  \]
  absurd.
\end{proof}

\begin{eg}
  Which elements in \(\Q_p^\times\) are squares? Any element of \(\Q_p^\times\) admits a unqiue expression \(x = p^n u\) where \(n \in \Z, u \in \Z_p^\times\). Equivalently, there is an isomorphism
  \begin{align*}
    \Q_p^\times &\cong \Z \times \Z_p^\times \\
    x &\mapsto (n, u)
  \end{align*}
  It's enough to determine when \(u \in \Z_p^\times\) is a square. Equivalently, when the polynomial \(f(x) = x^2 - u\) has a root in \(\Z_p\). There is a simple necessary condition from arithmetics: there is a surjective homomorphism \(\Z_p^\times \to \F_p^\times, x \mapsto \overline x \pmod p\) and if \(u \in (\Z_p^\times)^2\) then \(\overline u \in (\F_p^\times)^2\). Let's check if it is sufficient: if \(\overline u \in (\F_p^\times)^2\) and let \(v \in \Z_p^\times\) satisfy \(\overline v^2 = \overline u\). Then \(\overline f(\overline v) = 0\) so we are in the position to use Hensel's lemma. Note \(f'(v) = 2v\) and \(v(f'(v)) = v(2)\). If \(p\) is odd then \(f'(v)\) is a unit, so by the corollary there exists a unique \(w \in \Z_p^\times\) such that \(w^2 = u\) and \(\overline w = \overline v\).

  If \(p = 2\) then we have \(v(f(v)) \geq 1, v(f'(v)) = 1\) so we can't conclude anything yet. Note for any \(n \geq 1\) there is a homomorphism \(\Z_p^\times \to (\Z/p^n\Z)^\times\) so if \(u\) is a square, \(u \pmod{p^n}\) is also a square for any \(n \geq 1\). For \(n = 3\) we have a map
  \[
    \Z_2^\times \to (\Z/8\Z)^\times \cong \Z/2\Z \times \Z/2\Z
  \]
  hence if \(u \in (\Z_2^\times)^2\) then \(u = 1 \pmod 8\). Conversely, if \(u = 1 \pmod 8\) then \(f(1) = 1 - u = 0 \pmod 8\), i.e.\ \(v(f(1)) \geq 3\), and \(f'(1) = 2\) so \(v(f'(1)) = 1\). In this case Hensel's lemma does apply and \(u\) is indeed a square.
\end{eg}

\begin{proposition}\leavevmode
  \begin{enumerate}
  \item If \(p\) is odd then \(u \in \Z_p^\times\) is a square if and only if \(u \pmod p \in \F_p^\times\) is a square.
  \item If \(p = 2\) then \(u \in \Z_2^\times\) is a square if and only if \(u = 1 \pmod 8\), or equivalently \(u \pmod 8 \in (\Z/8\Z)^2\) is a square.
  \end{enumerate}
\end{proposition}

In the previous example we use the surjective homomorphism \(\Z_p^\times \to \F_p^\times, \sum_{i = 0}^\infty a_i p^i \mapsto a_0 \pmod p\). In fact, this homomoprhism has a unique splitting, i.e.\ exists a unique homomorphism \(\tau: \F_p^\times \to \Z_p^\times\) such that for all \(\overline \alpha \in \F_p^\times\), \(\tau(\overline \alpha) \pmod p = \overline \alpha\). This \(\tau\) is called the \emph{Teichmüller lift}\index{Teichmüller lift} and is constructed as follow: let \(f(x) = x^p - x\). Then for all \(\overline \alpha \in \F_p, \overline f(\overline \alpha) = 0\), and \(\overline f'(x) = px^{p - 1} - 1 \pmod p = -1\) so never vanishes. So Hensel's lemma says that for all \(\overline \alpha \in \F_p\), exists a unique \(\alpha \in \Z_p\) such that \(\alpha^p = \alpha\) and \(\alpha \pmod{p\Z_p} = \overline \alpha\). Define \(\tau(\overline \alpha) = \alpha\).

If \(\overline \alpha, \overline \beta \in \F_p^\times\) then
\[
  (\tau(\overline \alpha) \tau(\overline \beta))^p
  = \tau(\overline \alpha)^p \tau(\overline \beta)^p
  = \tau(\overline \alpha) \tau(\overline \beta)
\]
and \(\tau(\overline \alpha) \tau(\overline \beta) \pmod{p\Z_p} = \overline \alpha \overline \beta\). Uniqueness part of Hansel's lemma thus says that \(\tau(\overline \alpha \overline \beta) = \tau(\overline \alpha) \tau(\overline \beta)\), i.e.\ \(\tau\) is a homomorphism.

\(\tau\) is the unique splitting: if \(\sigma: \F_p^\times \to \Z_p^\times\) is another splitting then for all \(\overline \alpha \in \F_p^\times\),
\[
  \sigma(\overline \alpha)^p = \sigma(\overline \alpha^p) = \sigma(\overline \alpha)
\]
so \(f(\sigma(\overline \alpha)) = 0\). Uniqueness again says that \(\sigma = \tau\).

As a consequence
\[
  \Q_p^\times \cong \Z \times \Z_p^\times \cong \Z \times (1 + p \Z_p) \times \F_p^\times
\]
since each element can be written as \(p^n \cdot u \cdot \tau(\overline \alpha)\). There is an isomorphism
\[
  1 + p \Z_p \cong \varprojlim_i \underbrace{\ker ((\Z/p^i\Z)^\times \to (\Z/p\Z)^\times)}_{\text{\(p\)-power order}}
\]
so for any \(n \in \N, (n, p) = 1\), the map
\begin{align*}
  1 + p \Z_p &\to 1 + p\Z_p \\
  x &\mapsto x^n
\end{align*}
is a bijective group homomorphism. Hence there is an isomorphism
\[
  \Q_p^\times /(\Q_p^\times)^n \cong \Z/n\Z \times \F_p^\times/(\F_p^\times)^n.
\]

Suppose \(q\) is a prime such that \(p = 1 \pmod q\). Then \(\Q_p^\times\) contains a primitive \(q\)th root of unit \(\zeta_q\). This is because \(\zeta_q \in \Q_p^\times\) if and only if \(\Q_p^\times\) contains an element of order \(q\). But \(\F_p^\times\) is cyclic of order \(p - 1\) so this is true.

\begin{lemma}
  Under this assumption, \(\Q_p\) has exactly \(q + 1\) isomorphism classes of Galois extensions of degree \(q\).
\end{lemma}

\begin{proof}
  Since \(\zeta_q \in \Q_p^\times\), Kummer theory tells us that such extensions correspond to subgroups of \(\Q_p^\times/(\Q_p^\times)^q\) of order \(q\), where an element \(z\) of the subgroup corresponds to the extension \(\Q_p(\sqrt[q]{z})\). We've computed \(\Q_p^\times/(\Q_p^\times)^q \cong \Z/q\Z \times \Z/q\Z\), which has \(q + 1\) subgroups of order \(q\).
\end{proof}

End of this chapter. Where are we going?

\[
  \begin{tikzcd}
    K & \O_K & \Q & \O_{K_Q} & K_Q \\
    \Q & \Z & p & \Z_p & \Q_p
  \end{tikzcd}
\]
if \(K/\Q\) is Galoios then \(K_Q/\Q_p\) is Glaois and \(\gal(K_\Q/\Q_p) \embed \gal(K/\Q)\). We are going to study \(\gal(K_\Q/\Q_p)\).

\section{Extensions of Dedekind domains}

Let \(A\) be a Dedekind domain and \(K = \Frac A\). Let \(E/K\) be a finite separable extension.

\begin{definition}[integral element]\index{integral element}
  We say \(\gamma \in E\) is \emph{integral} over \(A\) if exists \(n \geq 1\), \(a_1, \dots, a_n \in A\) such that
  \[
    \gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0.
  \]
\end{definition}

\begin{lemma}
  TFAE:
  \begin{enumerate}
  \item \(\gamma\) is integral over \(A\).
  \item \(A[\gamma]\) is a finitely generated \(A\)-module.
  \item there exists a nonzero \(A[\gamma]\)-submodule \(M \leq E\) which is a finitely generated \(A\)-module.
  \end{enumerate}
\end{lemma}

\begin{proof}\leavevmode
  \begin{itemize}
  \item \(1 \implies 2\): If \(\gamma^n + a_1 \gamma^{n - 1} + \dots + a_n = 0\) then \(A[\gamma] = A + A \gamma + \dots + A\gamma^{n - 1}\).
  \item \(2 \implies 1\): \(A\) is Noetherian and \(A[\gamma]\) is a finitely generated \(A\)-module so
    \[
      A \subseteq A + A[\gamma] \subseteq A + A\gamma +A\gamma^2 \subseteq \cdots
    \]
    is eventually stationary, so exists \(n \geq 1\) such that \(\gamma^n \in A + A\gamma + \dots + A\gamma^{n - 1}\).
  \item \(2 \implies 3\): \(M = A[\gamma]\).
  \item \(3 \implies 2\): Since \(M\) is finitely generated and \(A\) is Noetherian, \(\End_A(M)\) is a finitely generated \(A\)-module. Since \(M\) is non-zero, \(A[\gamma] \to \End_A(M), x \mapsto (m \mapsto xm)\) is an injective homomorphism of \(A\)-modules. Hence \(A[\gamma]\) is a finitely generated \(A\)-module.
  \end{itemize}
\end{proof}

Let \(B = \{\gamma \in E: \gamma \text{ integral over } A\}\), the integral closure of \(A\) in \(E\).

\begin{lemma}
  \(B\) is a subring of \(E\) and \(B\) is integrally closed in \(E\).
\end{lemma}

\begin{proof}
  Suppose \(b_1, \dots, b_m \in B\). Then \(A[b_1, \dots, b_m]\) is a finitely generated \(A\)-module: if we have relations
  \[
    b_i^{n_i} + a_{1, i} b_i^{n_i - 1} + \dots + a_{n_i, i} = 0
  \]
  for all \(i\) then \(\{\prod_{i = 1}^m b_i^{m_i}: 0 \leq m_i < n_i\}\) is a generating set for \(A[b_1, \dots, b_m]\).

  This also shows that \(B\) is a ring: if \(b_1, b_2 \in B\) then \(A[b_1, b_2] \subseteq E\) is a fg \(A\)-module stable under multiplication by \(b_1 + b_2\) and \(b_1b_2\). So part 3 of the lemma implies that \(b_1 + b_2, b_1b_2 \in B\).

  Now suppose \(\gamma \in E\) and exists \(n \geq 1\), \(b_1, \dots, b_n \in B\) such that
  \[
    \gamma^n + b_1 \gamma^{n - 1} + \dots + b_n = 0.
  \]
  We must show \(\gamma \in B\). This relation shows \(A[b_1, \dots, b_n][\gamma] = A[b_1, \dots, b_n, \gamma]\) is a fg \(A[b_1, \dots, b_n]\)-module. But \(A[b_1, \cdots, b_n]\) is a fg \(A\)-module, so \(A[b_1, \dots, b_m, \gamma]\) is a fg \(A\)-module: if \(\{x_i\}\) generates \(A[b_1, \dots, b_m, \gamma]\) as an \(A[b_1, \dots, b_m]\)-module and \(\{y_j\}\) generates \(A[b_1, \dots, b_m]\) as an \(A\)-module then \(\{x_i y_j\}\) generates \(A[b_1, \dots, b_n, \gamma]\) as an \(A\)-module. In particular \(\gamma\) is integral over \(A\) so \(\gamma \in B\).
\end{proof}

\begin{lemma}
  Let \(T: E \times E \to K\) be the symmetric \(K\)-bilinear form defined by \(T(x, y) = \tr_{E/K} (xy)\). Then \(T\) is nondegenerate.
\end{lemma}

\begin{proof}
  This is a consequence of the assumption that \(E/K\) is separable. Let \(L/K\) be the Galois closure of \(E/K\). Let \(\sigma_1, \dots, \sigma_n: E \to L\) be the distinct \(K\)-embeddings, where \(n = [E: K]\). Then for all \(x \in E\)
  \[
    \tr_{E/K}(x) = \sigma_1(x) + \dots + \sigma_n(x).
  \]
  Recall from Galois theory that \(\sigma_1, \dots, \sigma_n\) are linearly independent (over \(K\)) as homomorphisms \(\sigma_i: E^\times \to L^\times\), so there exists \(x \in E^\times\) such that \(\sigma_1(x) + \dots + \sigma_n(x) \neq 0\) and therefore \(\tr_{E/K}(x) \neq 0\). Then for all \(y \in E^\times\),
  \[
    T(xy^{-1}, y) = \tr_{E/K}(x) \neq 0,
  \]
  i.e.\ \(\ker T = 0\) and \(T\) is nondegenerate.
\end{proof}

\begin{remark}
  If \(x \in B\) then \(\tr_{E/K}(x) \in A\): \(\sigma_i(x) \in L\) is integral over \(A\) and hence \(\sigma_1(x) + \dots + \sigma_n(x)\) is an element of \(L\) which is in \(K\) and integral over \(A\). \(A\) is integrally closed implies that \(\tr_{E/K}(x) \in A\).
\end{remark}

Observe that if \(S \subseteq A\) is multiplicatively closed and \(0 \notin S\) then \(S^{-1}A\) is a Dedekind domain with field of fractions \(K\). Moreover, the integral closure of \(S^{-1}A\) in \(E\) is \(S^{-1}B\). This is because \(S^{-1}B\) is contained in the integral closure of \(S^{-1}A\) in \(E\). Conversely, if \(\gamma \in E\) satisfies
\[
  \gamma^n + \frac{a_1}{s_1} \gamma^{n - 1} + \cdots + \frac{a_n}{s_n} = 0
\]
where \(a_i \in A, s_i \in S\) then
\[
  (\gamma s_1 \cdots s_n)^n + \frac{a_1}{s_1} (s_1 \cdots s_n)^{n - 1} (\gamma s_1 \cdots s_n)^{n - 1} + \cdots = 0
\]
and hence \(\gamma s_1 \cdots s_n \in B\) so \(\gamma \in S^{-1}B\).

For example \((A - \{0\})^{-1} A = K\) so \((A - \{0\})^{-1}B = E\). In particular \(B\) always span \(E\) as a \(K\)-vector space and \(\Frac B = E\).

\begin{proposition}
  \(B\) is fg as \(A\)-module and is a Dedekind domain.
\end{proposition}

\begin{proof}
  Let \(e_1, \dots, e_n\) be basis of \(E\) as \(K\)-vector space. We assume that in fact \(e_1, \dots, e_n \in B\). Recall that there is a \(K\)-bilinear form \(T: E \times E \to K, (x, y) \mapsto \tr_{E/K}(xy)\) and is non-degenerate as \(E/K\) is separable. Moreover if \(x \in B\) then \(\tr_{E/K}(x) \in A\). Let \(f_1, \dots, f_n\) be the dual basis of \(e_1, \dots, e_n\) with respect to \(T\), i.e.\ for all \(i, j\), \(T(e_i, f_j) = \tr_{E/K}(e_if_j) = \delta_{ij}\). If \(x \in B\) we can write \(x = \sum_{j = 1}^n a_jf_j\) where \(a_j \in K\), and
  \[
    \tr_{E/K}(x e_i) = T(x, e_i) = \sum_{j = 1}^n a_j T(f_j, e_i) = a_i \in A.
  \]
  As \(x\) is arbitrary, this shows \(B \subseteq \sum_{j = 1}^n Af_j\). As \(A\) is Noetherian, \(B\) is fg as an \(A\)-module. Hence \(B\) is fg as an \(A\)-algebra, so by Hilbert basis theorem \(B\) is Noetherian as a ring.

  To show \(B\) is a Dedekind domain, it remains to show that every non-zero prime ideal \(Q \subseteq B\) is maximal or equivalently, \(B/Q\) is a field. To show this let \(P = A \cap Q\). Then \(P\) is prime. It is also non-zero: if \(\gamma \in Q - \{0\}\) then it satisfies an equation
  \[
    \gamma^m + a_1 \gamma^{m - 1} + \dots + a_m = 0
  \]
  where \(a_i \in A\). We can assume \(a_m \neq 0\) (otherwise divide by \(\gamma\)). Then
  \[
    a_m = - (\gamma^m + a_1 \gamma^{m - 1} + \dots + a_{m - 1} \gamma) \in A \cap Q - \{0\}.
  \]
  \[
    \begin{tikzcd}
      E \ar[r, dash] \ar[d, dash] & B \ar[r, dash] \ar[d, dash] & Q \ar[d, dash] \\
      K \ar[r, dash] & A \ar[r, dash] & P
    \end{tikzcd}
  \]
  We have an injective ring homomorphism \(A/P \to B/Q\) where \(A/P\) is a field, \(B/Q\) is a domain and \(B/Q\) is finite dimensional as an \(A/P\)-vector space (as \(B\) is fg as \(A\)-module). It follows that \(B/Q\) is a field: let \(\alpha \in B/Q - \{0\}\) and consider the map \(M_\alpha: B/Q \to B/Q, \beta \mapsto \beta\alpha\). \(M_\alpha\) is a linear map of \(A/P\)-vector spaces and is injective because \(A \neq 0\) and \(B/Q\) is a domain. Since \(B/Q\) has finite dimension, \(M_\alpha\) must be surjective. Hence exists \(\alpha' \in B/Q\) such that \(M_\alpha(\alpha') = \alpha\alpha' = 1\).
\end{proof}

We showed in the proof that if \(Q \subseteq B\) is a non-zero prime ideal then \(P = A \cap Q \subseteq A\) is a non-zero prime ideal. In this case, we say \emph{\(Q\) lies above \(P\)}\index{lie above}. We have \(Q\) lies above \(P\) if and only if \(Q \supseteq PB\) if and only if \(v_Q(PB) > 0\) where \(v_Q: E^\times \to \Z\) is the valuation corresponding to \(Q\). This is left as an exercise.

\begin{definition}[residue degree, ramification index]\index{residue degree}\index{ramification index}
  If \(Q\) lies above \(P\), we define the \emph{residue degree} of \(Q\) over \(P\) to be
  \[
    f_{Q/P} = [B/Q: A/P]
  \]
  and the \emph{ramification index} to be
  \[
    e_{Q/P} = v_Q(PB).
  \]
\end{definition}
Note that they are both integers greater than \(0\).

\begin{proposition}
  Let \(P \subseteq A\) be a non-zero prime ideal. Then
  \[
    \sum_{v_Q(PB) > 0} e_{Q/P} f_{Q/P} = [E : K].
  \]
\end{proposition}

\begin{proof}
  Let \(S = A - P\). Then \(S^{-1}B\) is the integral closure of \(S^{-1}A\). In addition localisation preserves residue degree and ramification index: we have
  \[
    e_{S^{-1}Q/S^{-1}P} = e_{Q/P}, \quad f_{S^{-1}Q/S^{-1}P} = f_{Q/P}.
  \]
  The first is because by unique factorisation,
  \begin{align*}
    PB &= \prod_Q Q^{e_{Q/P}} \\
    S^{-1}PB &= \prod_{Q} Q^{e_{Q/S^{-1}P}}
  \end{align*}
  so by prime ideal correspondence for localisation we must have equality. The second is because the maps \(A/P \to S^{-1}A/S^{-1}P, B/Q \to S^{-1}B/S^{-1}Q\) are both isomophisms. Therefore we can replace \(A\) by \(S^{-1}A\) and assume that \(A\) is a DVR, in particular a PID. Then \(B\) is a fg \(A\)-module which is torsion free (i.e.\ for all \(b \in B\) if exists \(a \in A - \{0\}\) such that \(ab = 0\) then \(b = 0\)), so we can use the classification of fg modules over a PID to conclude that as an \(A\)-module, \(B \cong A^n\) for some \(n \in \N\). Then
  \[
    E = (A - \{0\})^{-1}B \cong (A - \{0\})^{-1}A^n \cong K^n
  \]
  and hence \(n = [E : K]\).

  By reduction modulo \(P\), we have an isomorphism \(B/PB \cong (A/PA)^n\) of \(A/P\)-vector spaces. By the Chinese remainder theorem, we have an isomorphism
  \[
    B/PB \cong \prod_{Q: v_Q(PB) > 0} B/Q^{v_Q(PB)}.
  \]
  Hence
  \[
    [E : K] = n = \sum_{Q: v_Q(PB) > 0} \dim_{A/P} B/Q^{v_Q(PB)}.
  \]
  We have a chain of inclusions
  \[
    B \supseteq Q \supseteq Q^2 \supseteq \cdots \supseteq Q^{v_Q(PB)}
  \]
  so
  \[
    \dim_{A/P} B/Q^{v_Q(B)} = \sum_{i = 0}^{e_{Q/P} - 1} \dim_{A/P} Q^i/Q^{i + 1}.
  \]
  For any \(i \geq 0\), \(Q^i/Q^{i + 1}\) has dimension \(1\) as a \(B/Q\)-vector space (as \(Q^i/Q^{i + 1} \to Q^iB_Q/Q^{i + 1}B_Q\) is an isomorphism, so can reduce to the case of \(B_Q\)). Therefore
  \[
    \dim_{A/P} Q^i/Q^{i + 1} = [B/Q : A/P] \dim_{B/Q} Q^i/Q^{i + 1} = f_{Q/P}.
  \]
  We thus get
  \[
    [E : K] = n = \sum_{Q: v_Q(PB) > 0} \sum_{i = 0}^{e_{Q/P} - 1} f_{Q/P} = \sum_Q e_{Q/P} f_{Q/P}.
  \]
\end{proof}

\[
  \begin{tikzcd}
    E \ar[r, dash] \ar[d, dash] & B \ar[r, dash] \ar[d, dash] & \{Q_1, \dots, Q_r\} \ar[d, dash] \\
    K \ar[r, dash] & A \ar[r, dash] & P
  \end{tikzcd}
\]
Let \(e_i = e_{Q_i/P}, f_i = f_{Q_i/P}\) and so \(\sum_{i = 1}^r e_if_i = [E : K]\).

\begin{definition}[unramified ideal, split ideal]\index{unramified ideal}\index{split ideal}
  If for all \(1 \leq i \leq r, e_i = 1\), \(B/Q_i\) is a separable extension of \(A/P\) we say \(P\) is \emph{unramified} in \(B\) (or \(E\)).

  If for all \(1 \leq i \leq r, e_i = f_i = 1\), we say \(P\) \emph{splits completely} in \(B\) (or \(E\)).
\end{definition}

\begin{eg}
  If \(K/Q\) is a number field (i.e.\ finite extension), we write \(\O_K\) for the integral closure of \(\Z\) in \(K\). If \(K = Q(\sqrt d)\) where \(d \in \Z, d \neq 0, 1\) is a squarefree integer, then we can compute
  \[
    \O_K =
    \begin{cases}
      \Z[\sqrt d] & d = 2, 3 \pmod 4 \\
      \Z[\frac{1 + \sqrt d}{2}] & d = 1 \pmod 4
    \end{cases}
  \]
\end{eg}




\printindex
\end{document}
